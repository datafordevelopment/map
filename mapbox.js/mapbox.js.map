{"version":3,"file":"bundle.js","sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","package.json","src/index.js","src/mapbox.js","src/leaflet.js","src/grid_control.js","src/geocoder_control.js","src/legend_control.js","src/feature_layer.js","src/share_control.js","src/tile_layer.js","src/info_control.js","src/map.js","src/grid_layer.js","src/marker.js","src/geocoder.js","src/simplestyle.js","src/config.js","src/feedback.js","src/util.js","src/url.js","src/request.js","src/load_tilejson.js","src/mapbox_logo.js","src/grid.js","node_modules/leaflet/dist/leaflet-src.js","node_modules/sanitize-caja/index.js","node_modules/mustache/mustache.js","node_modules/sanitize-caja/sanitizer-bundle.js","node_modules/corslite/corslite.js"],"names":["require","geocoderControl","gridControl","featureLayer","legendControl","shareControl","tileLayer","infoControl","map","gridLayer","L","mapbox","module","exports","VERSION","version","geocoder","marker","simplestyle","TileLayer","InfoControl","ShareControl","LegendControl","GeocoderControl","GridControl","GridLayer","FeatureLayer","Map","config","sanitize","template","to_html","feedback","window","Icon","Default","imagePath","document","location","protocol","util","Mustache","Control","extend","options","pinnable","follow","sanitizer","touchTeaser","_currentContent","_pinned","initialize","_","Util","setOptions","this","strict_instance","Class","_layer","setTemplate","strict","_template","format","data","getTileJSON","d","_show","content","o","_popup","setContent","setLatLng","latLng","_map","openOn","_container","style","display","_contentWrapper","innerHTML","hide","closePopup","DomUtil","removeClass","_mouseover","addClass","_mousemove","_navigateTo","url","top","href","_click","location_formatted","search","Browser","touch","_onPopupClose","_createClosebutton","container","fn","link","create","title","DomEvent","on","stopPropagation","preventDefault","onAdd","className","contentWrapper","appendChild","Popup","autoPan","closeOnClick","disableClickPropagation","addListener","onRemove","off","includes","Mixin","Events","position","pointZoom","keepOpen","autocomplete","setURL","_updateSubmit","bind","_updateAutocomplete","_chooseResult","accessToken","getURL","setID","setTileJSON","_toggle","e","stop","hasClass","_results","_input","blur","focus","select","_closeIfOpen","results","wrap","form","input","type","setAttribute","_geocode","_autocomplete","_form","err","resp","fire","error","features","length","feature","_displayResults","i","l","Math","min","name","place_name","r","text","outof","result","bbox","fitBounds","lbounds","center","setView","undefined","getZoom","max","value","query","_legends","_update","addLegend","removeLegend","hasOwnProperty","div","urlhelper","request","FeatureGroup","filter","popupOptions","closeButton","_layers","idUrl","setGeoJSON","_geojson","clearLayers","_initialize","getGeoJSON","loadURL","_request","abort","json","log","loadID","id","setFilter","getFilter","len","isArray","geometries","geometry","opts","pointToLayer","latlon","layer","GeoJSON","geometryToLayer","popupHtml","createPopup","setStyle","bindPopup","addLayer","_loadTileJSON","_setTileJSON","_tilejson","_modal","_mask","_content","_shareClick","_clickOut","_sharing","tilejson","encodeURIComponent","webpage","image","getCenter","lng","lat","embed","twitter","facebook","pinterest","share","replace","embedValue","embedLabel","label","close","target","formats","scalePrefix","prototype","call","strict_oneof","setFormat","redraw","setUrl","tiles","attribution","minZoom","minzoom","maxZoom","maxzoom","tms","scheme","bounds","getTileUrl","tilePoint","index","floor","abs","x","y","templated","retina","_info","console","warn","_showInfo","getAttribution","addInfo","_onLayerAdd","_onLayerRemove","removeInfo","_active","_hidecontent","info","push","join","withAccessToken","mapboxLogoControl","LMap","element","attributionControl","setPrefix","compact","offsetWidth","addControl","_mapboxLogoControl","_updateMapFeedbackLink","whenReady","_updateLayer","legend","_loaded","zoom","_controlContainer","getElementsByClassName","hash","toFixed","key","_onLayerReady","setTimeout","addAttribution","stamp","_zoomBoundLayers","_updateZoomLevels","grid","_mouseOn","_cache","grids","active","addTo","_move","getData","latlng","callback","point","project","tileSize","resolution","crs","scale","_getTile","gridX","gridY","_getTileURL","urls","getPixelBounds","z","tileBounds","divideBy","_floor","_tileShouldBeLoaded","callbacks","nwPoint","multiplyBy","sePoint","add","Point","nw","unproject","se","LatLngBounds","intersects","icon","fp","sizes","small","medium","large","size","symbol","color","iconUrl","charAt","iconSize","iconAnchor","popupAnchor","f","properties","strip_tags","popup","description","indexOf","queryURL","parts","record","geocoding","res","reverseQuery","normalize","lon","q","pts","fallback","a","b","c","k","remap","mapping","defaults","stroke","stroke-width","stroke-opacity","fill","fill-opacity","HTTP_URL","HTTPS_URL","FORCE_HTTPS","REQUIRE_ACCESS_TOKEN","Feedback","contains","item","list","t","Error","klass","values","path","tileJSON","urlOrMapID","corslite","onload","JSON","parse","responseText","match","XMLHttpRequest","MapboxLogoControl","mapbox_logo","utfDecode","idx","charCodeAt","keys","oldL","define","amd","noConflict","dest","j","src","sources","Array","slice","arguments","obj","args","apply","lastId","invokeEach","method","context","concat","limitExecByInterval","time","lock","execOnUnlock","wrapperFn","falseFn","formatNum","num","digits","pow","round","trim","str","splitWords","split","getParamString","existingUrl","uppercase","params","toUpperCase","Object","toString","emptyImageUrl","getPrefixed","prefixes","timeoutDefer","Date","timeToCall","lastTime","requestFn","requestAnimationFrame","cancelFn","cancelAnimationFrame","clearTimeout","requestAnimFrame","immediate","cancelAnimFrame","props","NewClass","_initHooks","callInitHooks","F","proto","constructor","statics","parent","__super__","_initHooksCalled","include","mergeOptions","addInitHook","init","eventsKey","addEventListener","types","event","indexKey","indexLenKey","typeIndex","events","contextId","action","hasEventListeners","removeEventListener","clearAllEventListeners","listeners","removed","splice","fireEvent","addOneTimeEventListener","handler","once","ie","ielt9","ua","navigator","userAgent","toLowerCase","webkit","chrome","phantomjs","android","android23","gecko","mobile","orientation","msPointer","msPointerEnabled","msMaxTouchPoints","PointerEvent","pointer","pointerEnabled","maxTouchPoints","devicePixelRatio","matchMedia","matches","doc","documentElement","ie3d","webkit3d","WebKitCSSMatrix","gecko3d","opera3d","any3d","L_DISABLE_3D","L_NO_TOUCH","startName","createElement","supported","removeAttribute","opera","mobileWebkit","mobileWebkit3d","mobileOpera","clone","_add","subtract","_subtract","_divideBy","_multiplyBy","_round","distanceTo","sqrt","equals","Bounds","points","getBottomLeft","getTopRight","getSize","min2","max2","xIntersects","yIntersects","isValid","Transformation","_a","_b","_c","_d","transform","_transform","untransform","get","getElementById","getStyle","el","currentStyle","defaultView","css","getComputedStyle","getViewportOffset","pos","left","docBody","body","docEl","offsetTop","offsetLeft","parseInt","offsetParent","scrollTop","scrollLeft","width","maxWidth","getBoundingClientRect","clientLeft","parentNode","documentIsLtr","_docIsLtrCached","_docIsLtr","tagName","classList","_getClass","RegExp","test","classes","_setClass","remove","baseVal","setOpacity","opacity","filterName","filters","Enabled","Opacity","testProp","getTranslateString","is3d","open","getScaleString","origin","preTranslateStr","scaleStr","setPosition","disable3D","_leaflet_pos","TRANSFORM","getPosition","TRANSITION","TRANSITION_END","disableTextSelection","enableTextSelection","userSelectProperty","_userSelect","disableImageDrag","enableImageDrag","LatLng","alt","parseFloat","isNaN","DEG_TO_RAD","PI","RAD_TO_DEG","MAX_MARGIN","margin","precision","other","R","d2r","dLat","dLon","lat1","lat2","sin1","sin","sin2","cos","atan2","southWest","northEast","latlngs","latLngBounds","_southWest","_northEast","pad","bufferRatio","sw","ne","heightBuffer","widthBuffer","getSouthWest","getNorthEast","getNorthWest","getNorth","getWest","getSouthEast","getSouth","getEast","sw2","ne2","latIntersects","lngIntersects","toBBoxString","Projection","SphericalMercator","MAX_LATITUDE","tan","atan","exp","LonLat","CRS","latLngToPoint","projectedPoint","projection","transformation","pointToLatLng","untransformedPoint","s","Simple","EPSG3857","code","earthRadius","EPSG900913","EPSG4326","fadeAnimation","trackResize","markerZoomAnimation","_initContainer","_initLayout","_onResize","_initEvents","maxBounds","setMaxBounds","reset","_handlers","_tileLayersNum","_addLayers","layers","_resetView","_limitZoom","setZoom","_zoom","zoomIn","delta","zoomOut","setZoomAround","getZoomScale","viewHalf","containerPoint","latLngToContainerPoint","centerOffset","newCenter","containerPointToLatLng","getBounds","paddingTL","paddingTopLeft","padding","paddingBR","paddingBottomRight","getBoundsZoom","paddingOffset","swPoint","nePoint","fitWorld","panTo","pan","panBy","offset","_rawPanBy","_panInsideMaxBounds","panInsideBounds","_limitCenter","zoomAnimation","_tileLayersToLoad","_onTileLayerLoad","_layerAdd","removeLayer","hasLayer","eachLayer","invalidateSize","animate","oldSize","_sizeChanged","_initialCenter","newSize","oldCenter","debounceMoveend","_sizeTimer","addHandler","HandlerClass","enable","_leaflet","_clearPanes","_clearControlPos","_clearHandlers","_checkIfLoaded","_moved","layerPointToLatLng","_getCenterLayerPoint","getMinZoom","_layersMinZoom","getMaxZoom","_layersMaxZoom","Infinity","inside","boundsSize","zoomNotFound","_size","clientWidth","clientHeight","topLeftPoint","_getTopLeftPoint","getPixelOrigin","_initialTopLeftPoint","getPanes","_panes","getContainer","toZoom","getScaleZoom","LN2","latLngToLayerPoint","containerPointToLayerPoint","_getMapPanePos","layerPointToContainerPoint","layerPoint","mouseEventToContainerPoint","getMousePosition","mouseEventToLayerPoint","mouseEventToLatLng","_initPanes","_initControlPos","panes","_mapPane","mapPane","_createPane","_tilePane","tilePane","objectsPane","shadowPane","overlayPane","markerPane","popupPane","zoomHide","removeChild","preserveMapOffset","afterZoomAnim","zoomChanged","_getNewTopLeftPoint","loading","hard","_getZoomSpan","oldZoomSpan","onOff","_onMouseClick","_fireMouseEvent","_resizeRequest","_simulated","dragging","moved","boxZoom","_skipped","originalEvent","disable","_latLngToNewLayerPoint","newZoom","topLeft","_getCenterOffset","centerPoint","viewBounds","_getBoundsOffset","_limitOffset","newBounds","pxBounds","nwOffset","seOffset","dx","_rebound","dy","right","ceil","Mercator","R_MINOR","R_MAJOR","r2","tmp","eccent","con","ts","phi","numIter","tol","dphi","EPSG3395","m","subdomains","errorTileUrl","zoomOffset","unloadInvisibleTiles","updateWhenIdle","detectRetina","_url","_animated","_zoomAnimated","viewreset","_reset","moveend","zoomanim","_animateZoom","zoomend","_endZoomAnim","_limitedUpdate","bringToFront","pane","_setAutoZIndex","bringToBack","insertBefore","firstChild","_updateOpacity","setZIndex","zIndex","_updateZIndex","noRedraw","compare","children","edgeZIndex","isFinite","_tiles","_bgBuffer","_tileContainer","tile","_tilesToLoad","reuseTiles","_unusedTiles","_clearBgBuffer","_getTileSize","zoomN","maxNativeZoom","_addTilesFromCenterOut","_removeOtherTiles","queue","tilesToLoad","sort","fragment","createDocumentFragment","_addTile","continuousWorld","limit","_getWrapTileNum","noWrap","kArr","_removeTile","tilePos","_getTilePos","_loadTile","_getZoomForUrl","zoomReverse","_getSubdomain","_adjustTilePoint","pop","_resetTile","_createTile","height","galleryimg","onselectstart","onmousemove","WebkitBackfaceVisibility","_tileOnLoad","onerror","_tileOnError","_tileLoaded","_clearBgBufferTimer","newUrl","WMS","defaultWmsParams","service","styles","transparent","wmsParams","_crs","_wmsVersion","projectionKey","setParams","wms","Canvas","async","_redrawTile","drawTile","_tilePoint","tileDrawn","canvas","ImageOverlay","_bounds","_image","_initImage","_onImageLoad","imageOverlay","createIcon","oldIcon","_createIcon","createShadow","_getIconUrl","img","_createImg","_setIconStyles","anchor","shadowAnchor","marginLeft","marginTop","shadowSize","scripts","getElementsByTagName","leafletRe","Marker","clickable","draggable","keyboard","zIndexOffset","riseOnHover","riseOffset","_latlng","update","_initIcon","_removeIcon","_removeShadow","getLatLng","setZIndexOffset","setIcon","_icon","_setPos","animation","classToAdd","addIcon","tabIndex","_initInteraction","_bringToFront","_resetZIndex","newShadow","_shadow","addShadow","_zIndex","opt","_onKeyPress","Handler","MarkerDrag","wasDragged","_enabled","keyCode","DivIcon","html","bgPos","backgroundPosition","divIcon","closePopupOnClick","minWidth","autoPanPadding","keepInView","source","_source","_isOpen","animFade","_getEvents","openPopup","_updatePosition","_adjustPan","getContent","visibility","_updateContent","_updateLayout","_zoomAnimation","preclick","_close","prefix","containerClass","_closeButton","_onCloseButtonClick","wrapper","_wrapper","_contentNode","disableScrollPropagation","_tipContainer","_tip","hasChildNodes","whiteSpace","offsetHeight","maxHeight","scrolledClass","_containerWidth","animated","_containerBottom","_containerLeft","bottom","containerHeight","containerWidth","layerPos","containerPos","autoPanPaddingTopLeft","autoPanPaddingBottomRight","togglePopup","_popupHandlersAdded","_movePopup","setPopupContent","unbindPopup","getPopup","LayerGroup","getLayerId","invoke","methodName","getLayer","getLayers","layerGroup","EVENTS","_propagateEvent","_popupContent","_popupOptions","featureGroup","Path","CLIP_PADDING","outerWidth","outerHeight","dashArray","lineCap","lineJoin","weight","fillColor","fillOpacity","_initElements","projectLatlngs","_updatePath","_pathRoot","vml","_stroke","_fill","_updateStyle","_updatePathViewport","p","panePos","_pathViewport","SVG_NS","svg","createElementNS","createSVGRect","SVG","root","lastChild","first","getPathString","_createElement","_initPathRoot","_initPath","_initStyle","_path","pointerEvents","_animatePathZoom","_endPathZoom","_updateSvgViewport","_pathZooming","vp","_openPopup","_latlngs","shape","behavior","adj","VML","namespaces","coordsize","stroked","filled","endcap","dashStyle","joinstyle","v","getContext","L_PREFER_CANVAS","CANVAS","_requestUpdate","_onClick","_onMouseMove","_updateRequest","_fireMapMoveEnd","_ctx","_canvasCtx","lineWidth","strokeStyle","fillStyle","_drawPath","len2","drawMethod","beginPath","_parts","Polygon","closePath","_checkIfEmpty","ctx","save","globalAlpha","restore","_containsPoint","_animatingZoom","cursor","_mouseInside","_updateCanvasViewport","translate","LineUtil","simplify","tolerance","sqTolerance","_reducePoints","_simplifyDP","pointToSegmentDistance","p1","p2","_sqClosestPointOnSegment","closestPointOnSegment","ArrayConstructor","Uint8Array","markers","_simplifyDPStep","newPoints","last","sqDist","maxSqDist","reducedPoints","prev","_sqDist","clipSegment","useLastCode","codeOut","newCode","codeA","_lastCode","_getBitCode","codeB","_getEdgeIntersection","dot","Polyline","_convertLatLngs","smoothFactor","noClip","_originalPoints","_getPathPartStr","getLatLngs","setLatLngs","addLatLng","spliceLatLngs","closestLayerPoint","minDistance","minPoint","jLen","distance","overwrite","_clipPoints","segment","lu","_simplifyPoints","polyline","PolyUtil","clipPolygon","clippedPoints","edge","edges","_code","_initWithHoles","hole","_holes","_holePoints","newParts","clipped","polygon","createMulti","Klass","_options","MultiPolyline","MultiPolygon","multiPolyline","multiPolygon","Rectangle","_boundsToLatLngs","setBounds","rectangle","Circle","radius","_mRadius","setRadius","lngRadius","_getLngRadius","pointLeft","_point","_radius","latRadius","getRadius","_getLatRadius","circle","CircleMarker","circleMarker","closed","dist","part","w","arc","w2","geojson","addData","coordinates","coordsToLatLng","asFeature","defaultOptions","resetStyle","onEachFeature","_setLayerStyle","vectorOptions","coords","coordsToLatLngs","levelsDeep","latLngToCoords","latLngsToCoords","latLngs","getFeature","newGeometry","geoJSON","PointToGeoJSON","toGeoJSON","multiToGeoJSON","jsons","isGeometryCollection","geoJson","originalHandler","newType","_getEvent","addPointerListener","addDoubleTapListener","_checkMouse","_filterClick","attachEvent","removeListener","removePointerListener","removeDoubleTapListener","detachEvent","cancelBubble","Draggable","START","_fakeStop","returnValue","clientX","clientY","rect","clientTop","getWheelDelta","wheelDelta","detail","_skipEvents","skipped","related","relatedTarget","caller","callee","Event","timeStamp","elapsed","_lastClick","_simulatedClick","END","mousedown","touchstart","pointerdown","MSPointerDown","MOVE","dragStartTarget","_element","_dragStartTarget","_onDown","shiftKey","which","button","touches","_disabled","_moving","_startPoint","_startPos","_newPos","_onMove","_onUp","newPoint","_lastTarget","srcElement","_animRequest","addHooks","removeHooks","enabled","inertia","inertiaDeceleration","inertiaMaxSpeed","inertiaThreshold","easeLinearity","worldCopyJump","Drag","_draggable","dragstart","_onDragStart","drag","_onDrag","dragend","_onDragEnd","_onPreDrag","_onViewReset","_panAnim","_positions","_times","_lastTime","_lastPos","shift","pxCenter","pxWorldCenter","_initialWorldOffset","_worldWidth","worldWidth","halfWidth","newX1","newX2","newX","delay","noInertia","direction","duration","ease","speedVector","speed","limitedSpeed","limitedSpeedVector","decelerationDuration","noMoveStart","doubleClickZoom","DoubleClickZoom","_onDoubleClick","scrollWheelZoom","ScrollWheelZoom","_onWheelScroll","_delta","_lastMousePos","_startTime","_timer","_performZoom","_touchstart","_touchend","onTouchStart","count","trackedTouches","pointerId","now","doubleTap","onTouchEnd","prop","newTouch","pre","touchend","endElement","POINTER_CANCEL","POINTER_DOWN","POINTER_MOVE","POINTER_UP","_pointers","_pointerDocumentListener","addPointerListenerStart","addPointerListenerEnd","addPointerListenerMove","pointers","cb","alreadyInArray","changedTouches","internalCb","pointerType","MSPOINTER_TYPE_MOUSE","buttons","touchZoom","bounceAtZoomLimits","TouchZoom","_onTouchStart","_zooming","viewCenter","_startCenter","_startDist","_centerOffset","_onTouchMove","_onTouchEnd","_scale","_updateOnMove","_getScaleOrigin","oldZoom","floatZoomDelta","roundZoomDelta","tap","tapTolerance","Tap","_fireClick","_holdTimeout","_isTapValid","_simulateEvent","simulatedEvent","createEvent","initMouseEvent","screenX","screenY","dispatchEvent","BoxZoom","_pane","_onMouseDown","_startLayerPoint","_onMouseUp","_onKeyDown","_box","startPoint","box","newPos","_finish","boxZoomBounds","keyboardPanOffset","keyboardZoomOffset","Keyboard","keyCodes","down","up","_setPanOffset","_setZoomOffset","_onFocus","_onBlur","_addHooks","_removeHooks","_focused","scrollTo","_panKeys","codes","_zoomKeys","_inProgress","_marker","shadow","iconPos","removeControl","corner","_controlCorners","removeFrom","_refocusOnMap","control","createCorner","vSide","hSide","corners","Zoom","zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","zoomName","_zoomInButton","_createButton","_zoomIn","_zoomOutButton","_zoomOut","_updateDisabled","zoomControl","Attribution","_attributions","removeAttribution","attribs","prefixAndAttribs","Scale","metric","imperial","_addScales","_mScale","_iScale","centerLat","halfWorldMeters","maxMeters","_updateScales","_updateMetric","_updateImperial","meters","_getRoundNum","_getScaleWidth","maxMiles","miles","feet","maxFeet","ratio","pow10","Layers","collapsed","autoZIndex","baseLayers","overlays","_lastZIndex","_handlingClick","_addLayer","_onLayerChange","addBaseLayer","addOverlay","_expand","_collapse","_layersLink","_onInputClick","_baseLayersList","_separator","_overlaysList","overlay","baseLayersPresent","overlaysPresent","_addItem","_createRadioElement","checked","radioHtml","radioFragment","defaultChecked","layerId","inputs","inputsLen","PosAnimation","run","_el","_onTransitionEnd","_stepTimer","setInterval","_onStep","_getPos","stepPos","_transformRe","clearInterval","_tryAnimatedZoom","_tryAnimatedPan","step","_onPanTransitionStep","end","_onPanTransitionEnd","_duration","_easeOutPower","_offset","_animate","_step","_complete","_animId","_runFrame","_easeOut","progress","zoomAnimationThreshold","_catchTransitionEnd","propertyName","_onZoomTransitionEnd","_nothingToAnimate","backwards","forTouchZoom","_animateToCenter","_animateToZoom","_animating","_prepareBgBuffer","bg","initialTransform","front","bgLoaded","_getLoadedTilesPercentage","frontLoaded","_stopLoadingImages","complete","_defaultLocateOptions","watch","timeout","maximumAge","enableHighAccuracy","locate","_locateOptions","geolocation","_handleGeolocationError","message","onResponse","_handleGeolocationResponse","onError","_locationWatchId","watchPosition","getCurrentPosition","stopLocate","clearWatch","latitude","longitude","latAccuracy","accuracy","lngAccuracy","timestamp","cleanUrl","getScheme","getPath","cleanId","html_sanitize","factory","mustache","testRegExp","re","string","RegExp_test","isWhitespace","nonSpaceRe","isFunction","object","escapeRegExp","escapeHtml","String","entityMap","Scanner","tail","Context","view",".","Writer","clearCache","renderTokens","tokens","writer","subRender","render","token","tokenValue","buffer","lookup","jlen","getPartial","escape","nestTokens","tree","collector","sections","section","squashTokens","lastToken","squashedTokens","escapeTags","tags","parseTemplate","stripSpace","hasTag","nonSpace","spaces","spaceRe","start","chr","openSection","tagRes","scanner","eos","scanUntil","scan","tagRe","whiteRe","eqRe","curlyRe","Object_toString","&","<",">","\"","'","/","substring","make","names","_partialCache","compile","compileTokens","compilePartial","_loadPartial","self","partials","defaultWriter","send","URI","uriStr","URI_RE_","nullIfAbsent","credentials","domain","port","uri","encodeIfExists2","URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_","encodeIfExists","URI_DISALLOWED_IN_PATH_","setRawQuery","encodeOne","setAllParameters","unescapedPart","extra","encodeURI","ch","n","normPath","collapse_dots","PARENT_DIRECTORY_HANDLER_RE","resolve","baseUri","relativeUri","absoluteUri","overridden","hasScheme","setRawScheme","getRawScheme","hasCredentials","setRawCredentials","getRawCredentials","hasDomain","setRawDomain","getRawDomain","hasPort","rawPath","getRawPath","simplifiedPath","setPort","getPort","EXTRA_PARENT_PATHS_RE","absRawPath","slash","lastIndexOf","setRawPath","hasQuery","getRawQuery","hasFragment","setRawFragment","getRawFragment","rawScheme","rawCredentials","rawDomain","rawQuery","rawFragment","scheme_","credentials_","domain_","port_","path_","query_","fragment_","paramCache_","matchPart","PARENT_DIRECTORY_HANDLER","out","decodeURIComponent","setScheme","newScheme","getCredentials","setCredentials","newCredentials","getDomain","setDomain","newDomain","newPort","Number","setPath","newPath","hasPath","getQuery","setQuery","newQuery","newParams","queryBuf","separator","checkParameterCache_","cgiParams","setParameterValues","newValueIndex","pc","removeParameter","getAllParameters","getParameterValues","paramNameUnescaped","getParameterMap","paramMap","getParameterValue","getFragment","setFragment","newFragment","utils","mimeTypeOf","uriObj","base","html4","atype","NONE","URI_FRAGMENT","SCRIPT","STYLE","HTML","ID","IDREF","IDREFS","GLOBAL_NAME","LOCAL_NAME","CLASSES","FRAME_TARGET","MEDIA_QUERY","ATTRIBS","*::class","*::dir","*::draggable","*::hidden","*::id","*::inert","*::itemprop","*::itemref","*::itemscope","*::lang","*::onblur","*::onchange","*::onclick","*::ondblclick","*::onfocus","*::onkeydown","*::onkeypress","*::onkeyup","*::onload","*::onmousedown","*::onmousemove","*::onmouseout","*::onmouseover","*::onmouseup","*::onreset","*::onscroll","*::onselect","*::onsubmit","*::onunload","*::spellcheck","*::style","*::title","*::translate","a::accesskey","a::coords","a::href","a::hreflang","a::name","a::onblur","a::onfocus","a::shape","a::tabindex","a::target","a::type","area::accesskey","area::alt","area::coords","area::href","area::nohref","area::onblur","area::onfocus","area::shape","area::tabindex","area::target","audio::controls","audio::loop","audio::mediagroup","audio::muted","audio::preload","bdo::dir","blockquote::cite","br::clear","button::accesskey","button::disabled","button::name","button::onblur","button::onfocus","button::tabindex","button::type","button::value","canvas::height","canvas::width","caption::align","col::align","col::char","col::charoff","col::span","col::valign","col::width","colgroup::align","colgroup::char","colgroup::charoff","colgroup::span","colgroup::valign","colgroup::width","command::checked","command::command","command::disabled","command::icon","command::label","command::radiogroup","command::type","data::value","del::cite","del::datetime","details::open","dir::compact","div::align","dl::compact","fieldset::disabled","font::color","font::face","font::size","form::accept","form::action","form::autocomplete","form::enctype","form::method","form::name","form::novalidate","form::onreset","form::onsubmit","form::target","h1::align","h2::align","h3::align","h4::align","h5::align","h6::align","hr::align","hr::noshade","hr::size","hr::width","iframe::align","iframe::frameborder","iframe::height","iframe::marginheight","iframe::marginwidth","iframe::width","img::align","img::alt","img::border","img::height","img::hspace","img::ismap","img::name","img::src","img::usemap","img::vspace","img::width","input::accept","input::accesskey","input::align","input::alt","input::autocomplete","input::checked","input::disabled","input::inputmode","input::ismap","input::list","input::max","input::maxlength","input::min","input::multiple","input::name","input::onblur","input::onchange","input::onfocus","input::onselect","input::placeholder","input::readonly","input::required","input::size","input::src","input::step","input::tabindex","input::type","input::usemap","input::value","ins::cite","ins::datetime","label::accesskey","label::for","label::onblur","label::onfocus","legend::accesskey","legend::align","li::type","li::value","map::name","menu::compact","menu::label","menu::type","meter::high","meter::low","meter::max","meter::min","meter::value","ol::compact","ol::reversed","ol::start","ol::type","optgroup::disabled","optgroup::label","option::disabled","option::label","option::selected","option::value","output::for","output::name","p::align","pre::width","progress::max","progress::min","progress::value","q::cite","select::autocomplete","select::disabled","select::multiple","select::name","select::onblur","select::onchange","select::onfocus","select::required","select::size","select::tabindex","source::type","table::align","table::bgcolor","table::border","table::cellpadding","table::cellspacing","table::frame","table::rules","table::summary","table::width","tbody::align","tbody::char","tbody::charoff","tbody::valign","td::abbr","td::align","td::axis","td::bgcolor","td::char","td::charoff","td::colspan","td::headers","td::height","td::nowrap","td::rowspan","td::scope","td::valign","td::width","textarea::accesskey","textarea::autocomplete","textarea::cols","textarea::disabled","textarea::inputmode","textarea::name","textarea::onblur","textarea::onchange","textarea::onfocus","textarea::onselect","textarea::placeholder","textarea::readonly","textarea::required","textarea::rows","textarea::tabindex","textarea::wrap","tfoot::align","tfoot::char","tfoot::charoff","tfoot::valign","th::abbr","th::align","th::axis","th::bgcolor","th::char","th::charoff","th::colspan","th::headers","th::height","th::nowrap","th::rowspan","th::scope","th::valign","th::width","thead::align","thead::char","thead::charoff","thead::valign","tr::align","tr::bgcolor","tr::char","tr::charoff","tr::valign","track::default","track::kind","track::label","track::srclang","ul::compact","ul::type","video::controls","video::height","video::loop","video::mediagroup","video::muted","video::poster","video::preload","video::width","eflags","OPTIONAL_ENDTAG","EMPTY","CDATA","RCDATA","UNSAFE","FOLDABLE","VIRTUALIZED","ELEMENTS","abbr","acronym","address","applet","area","article","aside","audio","basefont","bdi","bdo","big","blockquote","br","caption","cite","col","colgroup","command","datalist","dd","del","details","dfn","dialog","dir","dl","dt","em","fieldset","figcaption","figure","font","footer","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","iframe","ins","isindex","kbd","keygen","li","mark","menu","meta","meter","nav","nobr","noembed","noframes","noscript","ol","optgroup","option","output","param","samp","script","span","strike","strong","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","tr","track","tt","u","ul","var","video","wbr","ELEMENT_DOM_INTERFACES","ueffects","NOT_LOADED","SAME_DOCUMENT","NEW_DOCUMENT","URIEFFECTS","ltypes","UNSANDBOXED","SANDBOXED","DATA","LOADERTYPES","lookupEntity","ENTITIES","decimalEscapeRe","fromCharCode","hexEscapeRe","entityLookupElement","safeEntityNameRe","textContent","decodeOneEntity","stripNULs","nulRe","unescapeEntities","ENTITY_RE_1","escapeAttrib","ampRe","ltRe","gtRe","quotRe","normalizeRCData","rcdata","looseAmpRe","makeSaxParser","hcopy","cdata","comment","endDoc","endTag","pcdata","startDoc","startTag","htmlText","htmlSplit","state","noMoreGT","noMoreEndComments","parseCPS","continuationMaker","h","initial","current","next","ENTITY_RE_2","continuationMarker","exec","parseEndTag","EFLAGS_TEXT","tag","parseText","parseStartTag","substr","splitWillCapture","lastPos","parseTagAndAttrs","attrs","endTagRe","buf","ATTR_RE","quote","sawQuote","abuf","aName","aValue","decodeValue","makeHtmlSanitizer","tagPolicy","stack","ignoring","emit","tagNameOrig","eflagsOrig","decision","eflagsRep","tagNameRep","onStack","orig","rep","attribName","stackElOrigTag","stackElRepTag","safeUri","effect","ltype","hints","naiveUriRewriter","parsed","ALLOWED_URI_SCHEMES","safe","logger","oldValue","newValue","change","changed","lookupAttribute","attribKey","getLoaderType","getUriEffect","sanitizeAttribs","opt_naiveUriRewriter","opt_nmTokenPolicy","opt_logger","parseCssDeclarations","sanitizedDeclarations","declaration","property","normProp","schema","cssSchema","sanitizeCssProperty","TYPE","CSS_PROP","XML_ATTR","XML_TAG","makeTagPolicy","sanitizeWithPolicy","inputHtml","outputArray","lt","LT","gt","GT","amp","AMP","quot","apos","nbsp","cors","isSuccessful","status","loaded","sent","XDomainRequest","original","that","onreadystatechange","readyState","evt","onprogress","ontimeout","onabort"],"mappings":"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","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","module.exports={\"author\":\"Mapbox\",\"name\":\"mapbox.js\",\"description\":\"mapbox javascript api\",\"version\":\"2.1.5\",\"homepage\":\"http://mapbox.com/\",\"repository\":{\"type\":\"git\",\"url\":\"git://github.com/mapbox/mapbox.js.git\"},\"main\":\"src/index.js\",\"dependencies\":{\"leaflet\":\"0.7.3\",\"mustache\":\"0.7.3\",\"corslite\":\"0.0.6\",\"sanitize-caja\":\"0.1.2\"},\"scripts\":{\"test\":\"jshint src/*.js && mocha-phantomjs test/index.html\"},\"devDependencies\":{\"browserify\":\"^6.3.2\",\"clean-css\":\"~2.0.7\",\"expect.js\":\"0.3.1\",\"happen\":\"0.1.3\",\"jshint\":\"2.4.4\",\"leaflet-fullscreen\":\"0.0.4\",\"leaflet-hash\":\"0.2.1\",\"marked\":\"~0.3.0\",\"minifyify\":\"^6.1.0\",\"minimist\":\"0.0.5\",\"mocha\":\"1.17.1\",\"mocha-phantomjs\":\"3.1.6\",\"sinon\":\"1.10.2\"},\"optionalDependencies\":{},\"engines\":{\"node\":\"*\"}}","require('./leaflet');\nrequire('./mapbox');\n","'use strict';\n\nvar geocoderControl = require('./geocoder_control'),\n    gridControl = require('./grid_control'),\n    featureLayer = require('./feature_layer'),\n    legendControl = require('./legend_control'),\n    shareControl = require('./share_control'),\n    tileLayer = require('./tile_layer'),\n    infoControl = require('./info_control'),\n    map = require('./map'),\n    gridLayer = require('./grid_layer');\n\nL.mapbox = module.exports = {\n    VERSION: require('../package.json').version,\n    geocoder: require('./geocoder'),\n    marker: require('./marker'),\n    simplestyle: require('./simplestyle'),\n    tileLayer: tileLayer.tileLayer,\n    TileLayer: tileLayer.TileLayer,\n    infoControl: infoControl.infoControl,\n    InfoControl: infoControl.InfoControl,\n    shareControl: shareControl.shareControl,\n    ShareControl: shareControl.ShareControl,\n    legendControl: legendControl.legendControl,\n    LegendControl: legendControl.LegendControl,\n    geocoderControl: geocoderControl.geocoderControl,\n    GeocoderControl: geocoderControl.GeocoderControl,\n    gridControl: gridControl.gridControl,\n    GridControl: gridControl.GridControl,\n    gridLayer: gridLayer.gridLayer,\n    GridLayer: gridLayer.GridLayer,\n    featureLayer: featureLayer.featureLayer,\n    FeatureLayer: featureLayer.FeatureLayer,\n    map: map.map,\n    Map: map.Map,\n    config: require('./config'),\n    sanitize: require('sanitize-caja'),\n    template: require('mustache').to_html,\n    feedback: require('./feedback')\n};\n\n\n// Hardcode image path, because Leaflet's autodetection\n// fails, because mapbox.js is not named leaflet.js\nwindow.L.Icon.Default.imagePath =\n    // Detect bad-news protocols like file:// and hardcode\n    // to https if they're detected.\n    ((document.location.protocol == 'https:' ||\n    document.location.protocol == 'http:') ? '' : 'https:') +\n    '//api.tiles.mapbox.com/mapbox.js/' + 'v' +\n    require('../package.json').version + '/images';\n","window.L = require('leaflet/dist/leaflet-src');\n","'use strict';\n\nvar util = require('./util'),\n    Mustache = require('mustache');\n\nvar GridControl = L.Control.extend({\n\n    options: {\n        pinnable: true,\n        follow: false,\n        sanitizer: require('sanitize-caja'),\n        touchTeaser: true,\n        location: true\n    },\n\n    _currentContent: '',\n\n    // pinned means that this control is on a feature and the user has likely\n    // clicked. pinned will not become false unless the user clicks off\n    // of the feature onto another or clicks x\n    _pinned: false,\n\n    initialize: function(_, options) {\n        L.Util.setOptions(this, options);\n        util.strict_instance(_, L.Class, 'L.mapbox.gridLayer');\n        this._layer = _;\n    },\n\n    setTemplate: function(template) {\n        util.strict(template, 'string');\n        this.options.template = template;\n        return this;\n    },\n\n    _template: function(format, data) {\n        if (!data) return;\n        var template = this.options.template || this._layer.getTileJSON().template;\n        if (template) {\n            var d = {};\n            d['__' + format + '__'] = true;\n            return this.options.sanitizer(\n                Mustache.to_html(template, L.extend(d, data)));\n        }\n    },\n\n    // change the content of the tooltip HTML if it has changed, otherwise\n    // noop\n    _show: function(content, o) {\n        if (content === this._currentContent) return;\n\n        this._currentContent = content;\n\n        if (this.options.follow) {\n            this._popup.setContent(content)\n                .setLatLng(o.latLng);\n            if (this._map._popup !== this._popup) this._popup.openOn(this._map);\n        } else {\n            this._container.style.display = 'block';\n            this._contentWrapper.innerHTML = content;\n        }\n    },\n\n    hide: function() {\n        this._pinned = false;\n        this._currentContent = '';\n\n        this._map.closePopup();\n        this._container.style.display = 'none';\n        this._contentWrapper.innerHTML = '';\n\n        L.DomUtil.removeClass(this._container, 'closable');\n\n        return this;\n    },\n\n    _mouseover: function(o) {\n        if (o.data) {\n            L.DomUtil.addClass(this._map._container, 'map-clickable');\n        } else {\n            L.DomUtil.removeClass(this._map._container, 'map-clickable');\n        }\n\n        if (this._pinned) return;\n\n        var content = this._template('teaser', o.data);\n        if (content) {\n            this._show(content, o);\n        } else {\n            this.hide();\n        }\n    },\n\n    _mousemove: function(o) {\n        if (this._pinned) return;\n        if (!this.options.follow) return;\n\n        this._popup.setLatLng(o.latLng);\n    },\n\n    _navigateTo: function(url) {\n        window.top.location.href = url;\n    },\n\n    _click: function(o) {\n\n        var location_formatted = this._template('location', o.data);\n        if (this.options.location && location_formatted &&\n            location_formatted.search(/^https?:/) === 0) {\n            return this._navigateTo(this._template('location', o.data));\n        }\n\n        if (!this.options.pinnable) return;\n\n        var content = this._template('full', o.data);\n\n        if (!content && this.options.touchTeaser && L.Browser.touch) {\n            content = this._template('teaser', o.data);\n        }\n\n        if (content) {\n            L.DomUtil.addClass(this._container, 'closable');\n            this._pinned = true;\n            this._show(content, o);\n        } else if (this._pinned) {\n            L.DomUtil.removeClass(this._container, 'closable');\n            this._pinned = false;\n            this.hide();\n        }\n    },\n\n    _onPopupClose: function() {\n        this._currentContent = null;\n        this._pinned = false;\n    },\n\n    _createClosebutton: function(container, fn) {\n        var link = L.DomUtil.create('a', 'close', container);\n\n        link.innerHTML = 'close';\n        link.href = '#';\n        link.title = 'close';\n\n        L.DomEvent\n            .on(link, 'click', L.DomEvent.stopPropagation)\n            .on(link, 'mousedown', L.DomEvent.stopPropagation)\n            .on(link, 'dblclick', L.DomEvent.stopPropagation)\n            .on(link, 'click', L.DomEvent.preventDefault)\n            .on(link, 'click', fn, this);\n\n        return link;\n    },\n\n    onAdd: function(map) {\n        this._map = map;\n\n        var className = 'leaflet-control-grid map-tooltip',\n            container = L.DomUtil.create('div', className),\n            contentWrapper = L.DomUtil.create('div', 'map-tooltip-content');\n\n        // hide the container element initially\n        container.style.display = 'none';\n        this._createClosebutton(container, this.hide);\n        container.appendChild(contentWrapper);\n\n        this._contentWrapper = contentWrapper;\n        this._popup = new L.Popup({ autoPan: false, closeOnClick: false });\n\n        map.on('popupclose', this._onPopupClose, this);\n\n        L.DomEvent\n            .disableClickPropagation(container)\n            // allow people to scroll tooltips with mousewheel\n            .addListener(container, 'mousewheel', L.DomEvent.stopPropagation);\n\n        this._layer\n            .on('mouseover', this._mouseover, this)\n            .on('mousemove', this._mousemove, this)\n            .on('click', this._click, this);\n\n        return container;\n    },\n\n    onRemove: function (map) {\n\n        map.off('popupclose', this._onPopupClose, this);\n\n        this._layer\n            .off('mouseover', this._mouseover, this)\n            .off('mousemove', this._mousemove, this)\n            .off('click', this._click, this);\n    }\n});\n\nmodule.exports.GridControl = GridControl;\n\nmodule.exports.gridControl = function(_, options) {\n    return new GridControl(_, options);\n};\n","'use strict';\n\nvar geocoder = require('./geocoder'),\n    util = require('./util');\n\nvar GeocoderControl = L.Control.extend({\n    includes: L.Mixin.Events,\n\n    options: {\n        position: 'topleft',\n        pointZoom: 16,\n        keepOpen: false,\n        autocomplete: false\n    },\n\n    initialize: function(_, options) {\n        L.Util.setOptions(this, options);\n        this.setURL(_);\n        this._updateSubmit = L.bind(this._updateSubmit, this);\n        this._updateAutocomplete = L.bind(this._updateAutocomplete, this);\n        this._chooseResult = L.bind(this._chooseResult, this);\n    },\n\n    setURL: function(_) {\n        this.geocoder = geocoder(_, {accessToken: this.options.accessToken});\n        return this;\n    },\n\n    getURL: function() {\n        return this.geocoder.getURL();\n    },\n\n    setID: function(_) {\n        return this.setURL(_);\n    },\n\n    setTileJSON: function(_) {\n        return this.setURL(_.geocoder);\n    },\n\n    _toggle: function(e) {\n        if (e) L.DomEvent.stop(e);\n        if (L.DomUtil.hasClass(this._container, 'active')) {\n            L.DomUtil.removeClass(this._container, 'active');\n            this._results.innerHTML = '';\n            this._input.blur();\n        } else {\n            L.DomUtil.addClass(this._container, 'active');\n            this._input.focus();\n            this._input.select();\n        }\n    },\n\n    _closeIfOpen: function(e) {\n        if (L.DomUtil.hasClass(this._container, 'active') &&\n            !this.options.keepOpen) {\n            L.DomUtil.removeClass(this._container, 'active');\n            this._results.innerHTML = '';\n            this._input.blur();\n        }\n    },\n\n    onAdd: function(map) {\n\n        var container = L.DomUtil.create('div', 'leaflet-control-mapbox-geocoder leaflet-bar leaflet-control'),\n            link = L.DomUtil.create('a', 'leaflet-control-mapbox-geocoder-toggle mapbox-icon mapbox-icon-geocoder', container),\n            results = L.DomUtil.create('div', 'leaflet-control-mapbox-geocoder-results', container),\n            wrap = L.DomUtil.create('div', 'leaflet-control-mapbox-geocoder-wrap', container),\n            form = L.DomUtil.create('form', 'leaflet-control-mapbox-geocoder-form', wrap),\n            input  = L.DomUtil.create('input', '', form);\n\n        link.href = '#';\n        link.innerHTML = '&nbsp;';\n\n        input.type = 'text';\n        input.setAttribute('placeholder', 'Search');\n\n        L.DomEvent.addListener(form, 'submit', this._geocode, this);\n        L.DomEvent.addListener(input, 'keyup', this._autocomplete, this);\n        L.DomEvent.disableClickPropagation(container);\n\n        this._map = map;\n        this._results = results;\n        this._input = input;\n        this._form = form;\n\n        if (this.options.keepOpen) {\n            L.DomUtil.addClass(container, 'active');\n        } else {\n            this._map.on('click', this._closeIfOpen, this);\n            L.DomEvent.addListener(link, 'click', this._toggle, this);\n        }\n\n        return container;\n    },\n\n    _updateSubmit: function(err, resp) {\n        L.DomUtil.removeClass(this._container, 'searching');\n        this._results.innerHTML = '';\n        if (err || !resp) {\n            this.fire('error', {error: err});\n        } else {\n            var features = [];\n            if (resp.results && resp.results.features) {\n                features = resp.results.features;\n            }\n            if (features.length === 1) {\n                this.fire('autoselect', { feature: features[0] });\n                this.fire('found', {results: resp.results});\n                this._chooseResult(features[0]);\n                this._closeIfOpen();\n            } else if (features.length > 1) {\n                this.fire('found', {results: resp.results});\n                this._displayResults(features);\n            } else {\n                this._displayResults(features);\n            }\n        }\n    },\n\n    _updateAutocomplete: function(err, resp) {\n        this._results.innerHTML = '';\n        if (err || !resp) {\n            this.fire('error', {error: err});\n        } else {\n            var features = [];\n            if (resp.results && resp.results.features) {\n                features = resp.results.features;\n            }\n            if (features.length) {\n                this.fire('found', {results: resp.results});\n            }\n            this._displayResults(features);\n        }\n    },\n\n    _displayResults: function(features) {\n        for (var i = 0, l = Math.min(features.length, 5); i < l; i++) {\n            var feature = features[i];\n            var name = feature.place_name;\n            if (!name.length) continue;\n\n            var r = L.DomUtil.create('a', '', this._results);\n            var text = ('innerText' in r) ? 'innerText' : 'textContent';\n            r[text] = name;\n            r.href = '#';\n\n            (L.bind(function(feature) {\n                L.DomEvent.addListener(r, 'click', function(e) {\n                    this._chooseResult(feature);\n                    L.DomEvent.stop(e);\n                    this.fire('select', { feature: feature });\n                }, this);\n            }, this))(feature);\n        }\n        if (features.length > 5) {\n            var outof = L.DomUtil.create('span', '', this._results);\n            outof.innerHTML = 'Top 5 of ' + features.length + '  results';\n        }\n    },\n\n    _chooseResult: function(result) {\n        if (result.bbox) {\n            this._map.fitBounds(util.lbounds(result.bbox));\n        } else if (result.center) {\n            this._map.setView([result.center[1], result.center[0]], (this._map.getZoom() === undefined) ?\n                this.options.pointZoom :\n                Math.max(this._map.getZoom(), this.options.pointZoom));\n        }\n    },\n\n    _geocode: function(e) {\n        L.DomEvent.preventDefault(e);\n        if (this._input.value === '') return this._updateSubmit();\n        L.DomUtil.addClass(this._container, 'searching');\n        this.geocoder.query(this._input.value, this._updateSubmit);\n    },\n\n    _autocomplete: function(e) {\n        if (!this.options.autocomplete) return;\n        if (this._input.value === '') return this._updateAutocomplete();\n        this.geocoder.query(this._input.value, this._updateAutocomplete);\n    }\n});\n\nmodule.exports.GeocoderControl = GeocoderControl;\n\nmodule.exports.geocoderControl = function(_, options) {\n    return new GeocoderControl(_, options);\n};\n","'use strict';\n\nvar LegendControl = L.Control.extend({\n\n    options: {\n        position: 'bottomright',\n        sanitizer: require('sanitize-caja')\n    },\n\n    initialize: function(options) {\n        L.setOptions(this, options);\n        this._legends = {};\n    },\n\n    onAdd: function(map) {\n        this._container = L.DomUtil.create('div', 'map-legends wax-legends');\n        L.DomEvent.disableClickPropagation(this._container);\n\n        this._update();\n\n        return this._container;\n    },\n\n    addLegend: function(text) {\n        if (!text) { return this; }\n\n        if (!this._legends[text]) {\n            this._legends[text] = 0;\n        }\n\n        this._legends[text]++;\n        return this._update();\n    },\n\n    removeLegend: function(text) {\n        if (!text) { return this; }\n        if (this._legends[text]) this._legends[text]--;\n        return this._update();\n    },\n\n    _update: function() {\n        if (!this._map) { return this; }\n\n        this._container.innerHTML = '';\n        var hide = 'none';\n\n        for (var i in this._legends) {\n            if (this._legends.hasOwnProperty(i) && this._legends[i]) {\n                var div = L.DomUtil.create('div', 'map-legend wax-legend', this._container);\n                div.innerHTML = this.options.sanitizer(i);\n                hide = 'block';\n            }\n        }\n\n        // hide the control entirely unless there is at least one legend;\n        // otherwise there will be a small grey blemish on the map.\n        this._container.style.display = hide;\n\n        return this;\n    }\n});\n\nmodule.exports.LegendControl = LegendControl;\n\nmodule.exports.legendControl = function(options) {\n    return new LegendControl(options);\n};\n","'use strict';\n\nvar util = require('./util'),\n    urlhelper = require('./url'),\n    request = require('./request'),\n    marker = require('./marker'),\n    simplestyle = require('./simplestyle');\n\n// # featureLayer\n//\n// A layer of features, loaded from Mapbox or else. Adds the ability\n// to reset features, filter them, and load them from a GeoJSON URL.\nvar FeatureLayer = L.FeatureGroup.extend({\n    options: {\n        filter: function() { return true; },\n        sanitizer: require('sanitize-caja'),\n        style: simplestyle.style,\n        popupOptions: { closeButton: false }\n    },\n\n    initialize: function(_, options) {\n        L.setOptions(this, options);\n\n        this._layers = {};\n\n        if (typeof _ === 'string') {\n            util.idUrl(_, this);\n        // javascript object of TileJSON data\n        } else if (_ && typeof _ === 'object') {\n            this.setGeoJSON(_);\n        }\n    },\n\n    setGeoJSON: function(_) {\n        this._geojson = _;\n        this.clearLayers();\n        this._initialize(_);\n        return this;\n    },\n\n    getGeoJSON: function() {\n        return this._geojson;\n    },\n\n    loadURL: function(url) {\n        if (this._request && 'abort' in this._request) this._request.abort();\n        this._request = request(url, L.bind(function(err, json) {\n            this._request = null;\n            if (err && err.type !== 'abort') {\n                util.log('could not load features at ' + url);\n                this.fire('error', {error: err});\n            } else if (json) {\n                this.setGeoJSON(json);\n                this.fire('ready');\n            }\n        }, this));\n        return this;\n    },\n\n    loadID: function(id) {\n        return this.loadURL(urlhelper('/' + id + '/features.json', this.options.accessToken));\n    },\n\n    setFilter: function(_) {\n        this.options.filter = _;\n        if (this._geojson) {\n            this.clearLayers();\n            this._initialize(this._geojson);\n        }\n        return this;\n    },\n\n    getFilter: function() {\n        return this.options.filter;\n    },\n\n    _initialize: function(json) {\n        var features = L.Util.isArray(json) ? json : json.features,\n            i, len;\n\n        if (features) {\n            for (i = 0, len = features.length; i < len; i++) {\n                // Only add this if geometry or geometries are set and not null\n                if (features[i].geometries || features[i].geometry || features[i].features) {\n                    this._initialize(features[i]);\n                }\n            }\n        } else if (this.options.filter(json)) {\n\n            var opts = {accessToken: this.options.accessToken},\n                pointToLayer = this.options.pointToLayer || function(feature, latlon) {\n                  return marker.style(feature, latlon, opts);\n                },\n                layer = L.GeoJSON.geometryToLayer(json, pointToLayer),\n                popupHtml = marker.createPopup(json, this.options.sanitizer);\n\n            if ('setStyle' in layer) {\n                layer.setStyle(simplestyle.style(json));\n            }\n\n            layer.feature = json;\n\n            if (popupHtml) {\n                layer.bindPopup(popupHtml, this.options.popupOptions);\n            }\n\n            this.addLayer(layer);\n        }\n    }\n});\n\nmodule.exports.FeatureLayer = FeatureLayer;\n\nmodule.exports.featureLayer = function(_, options) {\n    return new FeatureLayer(_, options);\n};\n","'use strict';\n\nvar urlhelper = require('./url');\n\nvar ShareControl = L.Control.extend({\n    includes: [require('./load_tilejson')],\n\n    options: {\n        position: 'topleft',\n        url: ''\n    },\n\n    initialize: function(_, options) {\n        L.setOptions(this, options);\n        this._loadTileJSON(_);\n    },\n\n    _setTileJSON: function(json) {\n        this._tilejson = json;\n    },\n\n    onAdd: function(map) {\n        this._map = map;\n\n        var container = L.DomUtil.create('div', 'leaflet-control-mapbox-share leaflet-bar');\n        var link = L.DomUtil.create('a', 'mapbox-share mapbox-icon mapbox-icon-share', container);\n        link.href = '#';\n\n        this._modal = L.DomUtil.create('div', 'mapbox-modal', this._map._container);\n        this._mask = L.DomUtil.create('div', 'mapbox-modal-mask', this._modal);\n        this._content = L.DomUtil.create('div', 'mapbox-modal-content', this._modal);\n\n        L.DomEvent.addListener(link, 'click', this._shareClick, this);\n        L.DomEvent.disableClickPropagation(container);\n\n        this._map.on('mousedown', this._clickOut, this);\n\n        return container;\n    },\n\n    _clickOut: function(e) {\n        if (this._sharing) {\n            L.DomEvent.preventDefault(e);\n            L.DomUtil.removeClass(this._modal, 'active');\n            this._content.innerHTML = '';\n            this._sharing = null;\n            return;\n        }\n    },\n\n    _shareClick: function(e) {\n        L.DomEvent.stop(e);\n        if (this._sharing) return this._clickOut(e);\n\n        var tilejson = this._tilejson || this._map._tilejson || {},\n            url = encodeURIComponent(this.options.url || tilejson.webpage || window.location),\n            name = encodeURIComponent(tilejson.name),\n            image = urlhelper('/' + tilejson.id + '/' + this._map.getCenter().lng + ',' + this._map.getCenter().lat + ',' + this._map.getZoom() + '/600x600.png', this.options.accessToken),\n            embed = urlhelper('/' + tilejson.id + '.html', this.options.accessToken),\n            twitter = '//twitter.com/intent/tweet?status=' + name + ' ' + url,\n            facebook = '//www.facebook.com/sharer.php?u=' + url + '&t=' + encodeURIComponent(tilejson.name),\n            pinterest = '//www.pinterest.com/pin/create/button/?url=' + url + '&media=' + image + '&description=' + tilejson.name,\n            share = (\"<h3>Share this map</h3>\" +\n                    \"<div class='mapbox-share-buttons'><a class='mapbox-button mapbox-button-icon mapbox-icon-facebook' target='_blank' href='{{facebook}}'>Facebook</a>\" +\n                    \"<a class='mapbox-button mapbox-button-icon mapbox-icon-twitter' target='_blank' href='{{twitter}}'>Twitter</a>\" +\n                    \"<a class='mapbox-button mapbox-button-icon mapbox-icon-pinterest' target='_blank' href='{{pinterest}}'>Pinterest</a></div>\")\n                    .replace('{{twitter}}', twitter)\n                    .replace('{{facebook}}', facebook)\n                    .replace('{{pinterest}}', pinterest),\n            embedValue = '<iframe width=\"100%\" height=\"500px\" frameBorder=\"0\" src=\"{{embed}}\"></iframe>'.replace('{{embed}}', embed),\n            embedLabel = 'Copy and paste this <strong>HTML code</strong> into documents to embed this map on web pages.';\n\n        L.DomUtil.addClass(this._modal, 'active');\n\n        this._sharing = L.DomUtil.create('div', 'mapbox-modal-body', this._content);\n        this._sharing.innerHTML = share;\n\n        var input = L.DomUtil.create('input', 'mapbox-embed', this._sharing);\n        input.type = 'text';\n        input.value = embedValue;\n\n        var label = L.DomUtil.create('label', 'mapbox-embed-description', this._sharing);\n        label.innerHTML = embedLabel;\n\n        var close = L.DomUtil.create('a', 'leaflet-popup-close-button', this._sharing);\n        close.href = '#';\n\n        L.DomEvent.disableClickPropagation(this._sharing);\n        L.DomEvent.addListener(close, 'click', this._clickOut, this);\n        L.DomEvent.addListener(input, 'click', function(e) {\n            e.target.focus();\n            e.target.select();\n        });\n    }\n});\n\nmodule.exports.ShareControl = ShareControl;\n\nmodule.exports.shareControl = function(_, options) {\n    return new ShareControl(_, options);\n};\n","'use strict';\n\nvar util = require('./util');\n\nvar TileLayer = L.TileLayer.extend({\n    includes: [require('./load_tilejson')],\n\n    options: {\n        format: 'png'\n    },\n\n    // http://mapbox.com/developers/api/#image_quality\n    formats: [\n        'png',\n        // PNG\n        'png32', 'png64', 'png128', 'png256',\n        // JPG\n        'jpg70', 'jpg80', 'jpg90'],\n\n    scalePrefix: '@2x.',\n\n    initialize: function(_, options) {\n        L.TileLayer.prototype.initialize.call(this, undefined, options);\n\n        this._tilejson = {};\n\n        if (options && options.format) {\n            util.strict_oneof(options.format, this.formats);\n        }\n\n        this._loadTileJSON(_);\n    },\n\n    setFormat: function(_) {\n        util.strict(_, 'string');\n        this.options.format = _;\n        this.redraw();\n        return this;\n    },\n\n    // disable the setUrl function, which is not available on mapbox tilelayers\n    setUrl: null,\n\n    _setTileJSON: function(json) {\n        util.strict(json, 'object');\n\n        L.extend(this.options, {\n            tiles: json.tiles,\n            attribution: json.attribution,\n            minZoom: json.minzoom || 0,\n            maxZoom: json.maxzoom || 18,\n            tms: json.scheme === 'tms',\n            bounds: json.bounds && util.lbounds(json.bounds)\n        });\n\n        this._tilejson = json;\n        this.redraw();\n        return this;\n    },\n\n    getTileJSON: function() {\n        return this._tilejson;\n    },\n\n    // this is an exception to mapbox.js naming rules because it's called\n    // by `L.map`\n    getTileUrl: function(tilePoint) {\n        var tiles = this.options.tiles,\n            index = Math.floor(Math.abs(tilePoint.x + tilePoint.y) % tiles.length),\n            url = tiles[index];\n\n        var templated = L.Util.template(url, tilePoint);\n        if (!templated) {\n            return templated;\n        } else {\n            return templated.replace('.png',\n                (L.Browser.retina ? this.scalePrefix : '.') + this.options.format);\n        }\n    },\n\n    // TileJSON.TileLayers are added to the map immediately, so that they get\n    // the desired z-index, but do not update until the TileJSON has been loaded.\n    _update: function() {\n        if (this.options.tiles) {\n            L.TileLayer.prototype._update.call(this);\n        }\n    }\n});\n\nmodule.exports.TileLayer = TileLayer;\n\nmodule.exports.tileLayer = function(_, options) {\n    return new TileLayer(_, options);\n};\n","'use strict';\n\nvar InfoControl = L.Control.extend({\n    options: {\n        position: 'bottomright',\n        sanitizer: require('sanitize-caja')\n    },\n\n    initialize: function(options) {\n        L.setOptions(this, options);\n        this._info = {};\n        console.warn('infoControl has been deprecated and will be removed in mapbox.js v3.0.0. Use the default attribution control instead, which is now responsive.');\n    },\n\n    onAdd: function(map) {\n        this._container = L.DomUtil.create('div', 'mapbox-control-info mapbox-small');\n        this._content = L.DomUtil.create('div', 'map-info-container', this._container);\n\n        var link = L.DomUtil.create('a', 'mapbox-info-toggle mapbox-icon mapbox-icon-info', this._container);\n        link.href = '#';\n\n        L.DomEvent.addListener(link, 'click', this._showInfo, this);\n        L.DomEvent.disableClickPropagation(this._container);\n\n        for (var i in map._layers) {\n            if (map._layers[i].getAttribution) {\n                this.addInfo(map._layers[i].getAttribution());\n            }\n        }\n\n        map\n            .on('layeradd', this._onLayerAdd, this)\n            .on('layerremove', this._onLayerRemove, this);\n\n        this._update();\n        return this._container;\n    },\n\n    onRemove: function(map) {\n        map\n            .off('layeradd', this._onLayerAdd, this)\n            .off('layerremove', this._onLayerRemove, this);\n    },\n\n    addInfo: function(text) {\n        if (!text) return this;\n        if (!this._info[text]) this._info[text] = 0;\n        this._info[text] = true;\n        return this._update();\n    },\n\n    removeInfo: function (text) {\n        if (!text) return this;\n        if (this._info[text]) this._info[text] = false;\n        return this._update();\n    },\n\n    _showInfo: function(e) {\n        L.DomEvent.preventDefault(e);\n        if (this._active === true) return this._hidecontent();\n\n        L.DomUtil.addClass(this._container, 'active');\n        this._active = true;\n        this._update();\n    },\n\n    _hidecontent: function() {\n        this._content.innerHTML = '';\n        this._active = false;\n        L.DomUtil.removeClass(this._container, 'active');\n        return;\n    },\n\n    _update: function() {\n        if (!this._map) { return this; }\n        this._content.innerHTML = '';\n        var hide = 'none';\n        var info = [];\n\n        for (var i in this._info) {\n            if (this._info.hasOwnProperty(i) && this._info[i]) {\n                info.push(this.options.sanitizer(i));\n                hide = 'block';\n            }\n        }\n\n        this._content.innerHTML += info.join(' | ');\n\n        // If there are no results in _info then hide this.\n        this._container.style.display = hide;\n        return this;\n    },\n\n    _onLayerAdd: function(e) {\n        if (e.layer.getAttribution && e.layer.getAttribution()) {\n            this.addInfo(e.layer.getAttribution());\n        } else if ('on' in e.layer && e.layer.getAttribution) {\n            e.layer.on('ready', L.bind(function() {\n                this.addInfo(e.layer.getAttribution());\n            }, this));\n        }\n    },\n\n    _onLayerRemove: function (e) {\n        if (e.layer.getAttribution) {\n            this.removeInfo(e.layer.getAttribution());\n        }\n    }\n});\n\nmodule.exports.InfoControl = InfoControl;\n\nmodule.exports.infoControl = function(options) {\n    return new InfoControl(options);\n};\n","'use strict';\n\nvar util = require('./util'),\n    tileLayer = require('./tile_layer').tileLayer,\n    featureLayer = require('./feature_layer').featureLayer,\n    gridLayer = require('./grid_layer').gridLayer,\n    gridControl = require('./grid_control').gridControl,\n    infoControl = require('./info_control').infoControl,\n    shareControl = require('./share_control').shareControl,\n    legendControl = require('./legend_control').legendControl,\n    mapboxLogoControl = require('./mapbox_logo').mapboxLogoControl,\n    feedback = require('./feedback');\n\nfunction withAccessToken(options, accessToken) {\n    if (!accessToken || options.accessToken)\n        return options;\n    return L.extend({accessToken: accessToken}, options);\n}\n\nvar LMap = L.Map.extend({\n    includes: [require('./load_tilejson')],\n\n    options: {\n        tileLayer: {},\n        featureLayer: {},\n        gridLayer: {},\n        legendControl: {},\n        gridControl: {},\n        infoControl: false,\n        shareControl: false\n    },\n\n    _tilejson: {},\n\n    initialize: function(element, _, options) {\n\n        L.Map.prototype.initialize.call(this, element,\n            L.extend({}, L.Map.prototype.options, options));\n\n        // Disable the default 'Leaflet' text\n        if (this.attributionControl) {\n            this.attributionControl.setPrefix('');\n\n            var compact =  this.options.attributionControl.compact;\n            // Set a compact display if map container width is < 640 or\n            // compact is set to `true` in attributionControl options.\n            if (compact || (compact !== false && this._container.offsetWidth <= 640)) {\n                L.DomUtil.addClass(this.attributionControl._container, 'leaflet-compact-attribution');\n            }\n\n            if (compact === undefined) {\n                this.on('resize', function() {\n                    if (this._container.offsetWidth > 640) {\n                        L.DomUtil.removeClass(this.attributionControl._container, 'leaflet-compact-attribution');\n                    } else {\n                        L.DomUtil.addClass(this.attributionControl._container, 'leaflet-compact-attribution');\n                    }\n                });\n            }\n        }\n\n        if (this.options.tileLayer) {\n            this.tileLayer = tileLayer(undefined,\n                withAccessToken(this.options.tileLayer, this.options.accessToken));\n            this.addLayer(this.tileLayer);\n        }\n\n        if (this.options.featureLayer) {\n            this.featureLayer = featureLayer(undefined,\n                withAccessToken(this.options.featureLayer, this.options.accessToken));\n            this.addLayer(this.featureLayer);\n        }\n\n        if (this.options.gridLayer) {\n            this.gridLayer = gridLayer(undefined,\n                withAccessToken(this.options.gridLayer, this.options.accessToken));\n            this.addLayer(this.gridLayer);\n        }\n\n        if (this.options.gridLayer && this.options.gridControl) {\n            this.gridControl = gridControl(this.gridLayer, this.options.gridControl);\n            this.addControl(this.gridControl);\n        }\n\n        if (this.options.infoControl) {\n            this.infoControl = infoControl(this.options.infoControl);\n            this.addControl(this.infoControl);\n        }\n\n        if (this.options.legendControl) {\n            this.legendControl = legendControl(this.options.legendControl);\n            this.addControl(this.legendControl);\n        }\n\n        if (this.options.shareControl) {\n            this.shareControl = shareControl(undefined,\n                withAccessToken(this.options.shareControl, this.options.accessToken));\n            this.addControl(this.shareControl);\n        }\n\n        this._mapboxLogoControl = mapboxLogoControl(this.options.mapboxLogoControl);\n        this.addControl(this._mapboxLogoControl);\n\n        this._loadTileJSON(_);\n\n        this.on('layeradd', this._onLayerAdd, this)\n            .on('layerremove', this._onLayerRemove, this)\n            .on('moveend', this._updateMapFeedbackLink, this);\n\n        this.whenReady(function () {\n            feedback.on('change', this._updateMapFeedbackLink, this);\n        });\n\n        this.on('unload', function () {\n            feedback.off('change', this._updateMapFeedbackLink, this);\n        });\n    },\n\n    // use a javascript object of tilejson data to configure this layer\n    _setTileJSON: function(_) {\n        this._tilejson = _;\n        this._initialize(_);\n        return this;\n    },\n\n    getTileJSON: function() {\n        return this._tilejson;\n    },\n\n    _initialize: function(json) {\n        if (this.tileLayer) {\n            this.tileLayer._setTileJSON(json);\n            this._updateLayer(this.tileLayer);\n        }\n\n        if (this.featureLayer && !this.featureLayer.getGeoJSON() && json.data && json.data[0]) {\n            this.featureLayer.loadURL(json.data[0]);\n        }\n\n        if (this.gridLayer) {\n            this.gridLayer._setTileJSON(json);\n            this._updateLayer(this.gridLayer);\n        }\n\n        if (this.infoControl && json.attribution) {\n            this.infoControl.addInfo(json.attribution);\n            this._updateMapFeedbackLink();\n        }\n\n        if (this.legendControl && json.legend) {\n            this.legendControl.addLegend(json.legend);\n        }\n\n        if (this.shareControl) {\n            this.shareControl._setTileJSON(json);\n        }\n\n        this._mapboxLogoControl._setTileJSON(json);\n\n        if (!this._loaded && json.center) {\n            var zoom = this.getZoom() !== undefined ? this.getZoom() : json.center[2],\n                center = L.latLng(json.center[1], json.center[0]);\n\n            this.setView(center, zoom);\n        }\n    },\n\n    _updateMapFeedbackLink: function() {\n        if (!this._controlContainer.getElementsByClassName) return;\n        var link = this._controlContainer.getElementsByClassName('mapbox-improve-map');\n        if (link.length && this._loaded) {\n            var center = this.getCenter().wrap();\n            var tilejson = this._tilejson || {};\n            var id = tilejson.id || '';\n\n            var hash = '#' + id + '/' +\n                center.lng.toFixed(3) + '/' +\n                center.lat.toFixed(3) + '/' +\n                this.getZoom();\n\n            for (var key in feedback.data) {\n                hash += '/' + key + '=' + feedback.data[key];\n            }\n\n            for (var i = 0; i < link.length; i++) {\n                link[i].hash = hash;\n            }\n        }\n    },\n\n    _onLayerAdd: function(e) {\n        if ('on' in e.layer) {\n            e.layer.on('ready', this._onLayerReady, this);\n        }\n        window.setTimeout(L.bind(this._updateMapFeedbackLink, this), 0); // Update after attribution control resets the HTML.\n    },\n\n    _onLayerRemove: function(e) {\n        if ('on' in e.layer) {\n            e.layer.off('ready', this._onLayerReady, this);\n        }\n        window.setTimeout(L.bind(this._updateMapFeedbackLink, this), 0); // Update after attribution control resets the HTML.\n    },\n\n    _onLayerReady: function(e) {\n        this._updateLayer(e.target);\n    },\n\n    _updateLayer: function(layer) {\n        if (!layer.options) return;\n\n        if (this.infoControl && this._loaded) {\n            this.infoControl.addInfo(layer.options.infoControl);\n        }\n\n        if (this.attributionControl && this._loaded && layer.getAttribution) {\n            this.attributionControl.addAttribution(layer.getAttribution());\n        }\n\n        if (!(L.stamp(layer) in this._zoomBoundLayers) &&\n                (layer.options.maxZoom || layer.options.minZoom)) {\n            this._zoomBoundLayers[L.stamp(layer)] = layer;\n        }\n\n        this._updateMapFeedbackLink();\n        this._updateZoomLevels();\n    }\n});\n\nmodule.exports.Map = LMap;\n\nmodule.exports.map = function(element, _, options) {\n    return new LMap(element, _, options);\n};\n","'use strict';\n\nvar util = require('./util'),\n    request = require('./request'),\n    grid = require('./grid');\n\n// forked from danzel/L.UTFGrid\nvar GridLayer = L.Class.extend({\n    includes: [L.Mixin.Events, require('./load_tilejson')],\n\n    options: {\n        template: function() { return ''; }\n    },\n\n    _mouseOn: null,\n    _tilejson: {},\n    _cache: {},\n\n    initialize: function(_, options) {\n        L.Util.setOptions(this, options);\n        this._loadTileJSON(_);\n    },\n\n    _setTileJSON: function(json) {\n        util.strict(json, 'object');\n\n        L.extend(this.options, {\n            grids: json.grids,\n            minZoom: json.minzoom,\n            maxZoom: json.maxzoom,\n            bounds: json.bounds && util.lbounds(json.bounds)\n        });\n\n        this._tilejson = json;\n        this._cache = {};\n        this._update();\n\n        return this;\n    },\n\n    getTileJSON: function() {\n        return this._tilejson;\n    },\n\n    active: function() {\n        return !!(this._map && this.options.grids && this.options.grids.length);\n    },\n\n    addTo: function (map) {\n        map.addLayer(this);\n        return this;\n    },\n\n    onAdd: function(map) {\n        this._map = map;\n        this._update();\n\n        this._map\n            .on('click', this._click, this)\n            .on('mousemove', this._move, this)\n            .on('moveend', this._update, this);\n    },\n\n    onRemove: function() {\n        this._map\n            .off('click', this._click, this)\n            .off('mousemove', this._move, this)\n            .off('moveend', this._update, this);\n    },\n\n    getData: function(latlng, callback) {\n        if (!this.active()) return;\n\n        var map = this._map,\n            point = map.project(latlng.wrap()),\n            tileSize = 256,\n            resolution = 4,\n            x = Math.floor(point.x / tileSize),\n            y = Math.floor(point.y / tileSize),\n            max = map.options.crs.scale(map.getZoom()) / tileSize;\n\n        x = (x + max) % max;\n        y = (y + max) % max;\n\n        this._getTile(map.getZoom(), x, y, function(grid) {\n            var gridX = Math.floor((point.x - (x * tileSize)) / resolution),\n                gridY = Math.floor((point.y - (y * tileSize)) / resolution);\n\n            callback(grid(gridX, gridY));\n        });\n\n        return this;\n    },\n\n    _click: function(e) {\n        this.getData(e.latlng, L.bind(function(data) {\n            this.fire('click', {\n                latLng: e.latlng,\n                data: data\n            });\n        }, this));\n    },\n\n    _move: function(e) {\n        this.getData(e.latlng, L.bind(function(data) {\n            if (data !== this._mouseOn) {\n                if (this._mouseOn) {\n                    this.fire('mouseout', {\n                        latLng: e.latlng,\n                        data: this._mouseOn\n                    });\n                }\n\n                this.fire('mouseover', {\n                    latLng: e.latlng,\n                    data: data\n                });\n\n                this._mouseOn = data;\n            } else {\n                this.fire('mousemove', {\n                    latLng: e.latlng,\n                    data: data\n                });\n            }\n        }, this));\n    },\n\n    _getTileURL: function(tilePoint) {\n        var urls = this.options.grids,\n            index = (tilePoint.x + tilePoint.y) % urls.length,\n            url = urls[index];\n\n        return L.Util.template(url, tilePoint);\n    },\n\n    // Load up all required json grid files\n    _update: function() {\n        if (!this.active()) return;\n\n        var bounds = this._map.getPixelBounds(),\n            z = this._map.getZoom(),\n            tileSize = 256;\n\n        if (z > this.options.maxZoom || z < this.options.minZoom) return;\n\n        var tileBounds = L.bounds(\n                bounds.min.divideBy(tileSize)._floor(),\n                bounds.max.divideBy(tileSize)._floor()),\n            max = this._map.options.crs.scale(z) / tileSize;\n\n        for (var x = tileBounds.min.x; x <= tileBounds.max.x; x++) {\n            for (var y = tileBounds.min.y; y <= tileBounds.max.y; y++) {\n                // x wrapped\n                this._getTile(z, ((x % max) + max) % max, ((y % max) + max) % max);\n            }\n        }\n    },\n\n    _getTile: function(z, x, y, callback) {\n        var key = z + '_' + x + '_' + y,\n            tilePoint = L.point(x, y);\n\n        tilePoint.z = z;\n\n        if (!this._tileShouldBeLoaded(tilePoint)) {\n            return;\n        }\n\n        if (key in this._cache) {\n            if (!callback) return;\n\n            if (typeof this._cache[key] === 'function') {\n                callback(this._cache[key]); // Already loaded\n            } else {\n                this._cache[key].push(callback); // Pending\n            }\n\n            return;\n        }\n\n        this._cache[key] = [];\n\n        if (callback) {\n            this._cache[key].push(callback);\n        }\n\n        request(this._getTileURL(tilePoint), L.bind(function(err, json) {\n            var callbacks = this._cache[key];\n            this._cache[key] = grid(json);\n            for (var i = 0; i < callbacks.length; ++i) {\n                callbacks[i](this._cache[key]);\n            }\n        }, this));\n    },\n\n    _tileShouldBeLoaded: function(tilePoint) {\n        if (tilePoint.z > this.options.maxZoom || tilePoint.z < this.options.minZoom) {\n            return false;\n        }\n\n        if (this.options.bounds) {\n            var tileSize = 256,\n                nwPoint = tilePoint.multiplyBy(tileSize),\n                sePoint = nwPoint.add(new L.Point(tileSize, tileSize)),\n                nw = this._map.unproject(nwPoint),\n                se = this._map.unproject(sePoint),\n                bounds = new L.LatLngBounds([nw, se]);\n\n            if (!this.options.bounds.intersects(bounds)) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n});\n\nmodule.exports.GridLayer = GridLayer;\n\nmodule.exports.gridLayer = function(_, options) {\n    return new GridLayer(_, options);\n};\n","'use strict';\n\nvar url = require('./url'),\n    util = require('./util'),\n    sanitize = require('sanitize-caja');\n\n// mapbox-related markers functionality\n// provide an icon from mapbox's simple-style spec and hosted markers\n// service\nfunction icon(fp, options) {\n    fp = fp || {};\n\n    var sizes = {\n            small: [20, 50],\n            medium: [30, 70],\n            large: [35, 90]\n        },\n        size = fp['marker-size'] || 'medium',\n        symbol = ('marker-symbol' in fp && fp['marker-symbol'] !== '') ? '-' + fp['marker-symbol'] : '',\n        color = (fp['marker-color'] || '7e7e7e').replace('#', '');\n\n    return L.icon({\n        iconUrl: url('/marker/' +\n            'pin-' + size.charAt(0) + symbol + '+' + color +\n            // detect and use retina markers, which are x2 resolution\n            (L.Browser.retina ? '@2x' : '') + '.png', options && options.accessToken),\n        iconSize: sizes[size],\n        iconAnchor: [sizes[size][0] / 2, sizes[size][1] / 2],\n        popupAnchor: [0, -sizes[size][1] / 2]\n    });\n}\n\n// a factory that provides markers for Leaflet from Mapbox's\n// [simple-style specification](https://github.com/mapbox/simplestyle-spec)\n// and [Markers API](http://mapbox.com/developers/api/#markers).\nfunction style(f, latlon, options) {\n    return L.marker(latlon, {\n        icon: icon(f.properties, options),\n        title: util.strip_tags(\n            sanitize((f.properties && f.properties.title) || ''))\n    });\n}\n\n// Sanitize and format properties of a GeoJSON Feature object in order\n// to form the HTML string used as the argument for `L.createPopup`\nfunction createPopup(f, sanitizer) {\n    if (!f || !f.properties) return '';\n    var popup = '';\n\n    if (f.properties.title) {\n        popup += '<div class=\"marker-title\">' + f.properties.title + '</div>';\n    }\n\n    if (f.properties.description) {\n        popup += '<div class=\"marker-description\">' + f.properties.description + '</div>';\n    }\n\n    return (sanitizer || sanitize)(popup);\n}\n\nmodule.exports = {\n    icon: icon,\n    style: style,\n    createPopup: createPopup\n};\n","'use strict';\n\nvar util = require('./util'),\n    urlhelper = require('./url'),\n    feedback = require('./feedback'),\n    request = require('./request');\n\n// Low-level geocoding interface - wraps specific API calls and their\n// return values.\nmodule.exports = function(url, options) {\n\n    var geocoder = {};\n\n    util.strict(url, 'string');\n\n    if (url.indexOf('/') === -1) {\n        url = urlhelper('/geocode/' + url + '/{query}.json', options && options.accessToken);\n    }\n\n    geocoder.getURL = function() {\n        return url;\n    };\n\n    geocoder.queryURL = function(_) {\n        var query;\n\n        if (typeof _ !== 'string') {\n            var parts = [];\n            for (var i = 0; i < _.length; i++) {\n                parts[i] = encodeURIComponent(_[i]);\n            }\n            query = parts.join(';');\n        } else {\n            query = encodeURIComponent(_);\n        }\n\n        feedback.record({geocoding: query});\n        return L.Util.template(geocoder.getURL(), {query: query});\n    };\n\n    geocoder.query = function(_, callback) {\n        util.strict(callback, 'function');\n        request(geocoder.queryURL(_), function(err, json) {\n            if (json && (json.length || json.features)) {\n                var res = {\n                    results: json\n                };\n                if (json.features && json.features.length) {\n                    res.latlng = [\n                        json.features[0].center[1],\n                        json.features[0].center[0]];\n\n                    if (json.features[0].bbox) {\n                        res.bounds = json.features[0].bbox;\n                        res.lbounds = util.lbounds(res.bounds);\n                    }\n                }\n                callback(null, res);\n            } else callback(err || true);\n        });\n\n        return geocoder;\n    };\n\n    // a reverse geocode:\n    //\n    //  geocoder.reverseQuery([80, 20])\n    geocoder.reverseQuery = function(_, callback) {\n        var q = '';\n\n        // sort through different ways people represent lat and lon pairs\n        function normalize(x) {\n            if (x.lat !== undefined && x.lng !== undefined) {\n                return x.lng + ',' + x.lat;\n            } else if (x.lat !== undefined && x.lon !== undefined) {\n                return x.lon + ',' + x.lat;\n            } else {\n                return x[0] + ',' + x[1];\n            }\n        }\n\n        if (_.length && _[0].length) {\n            for (var i = 0, pts = []; i < _.length; i++) {\n                pts.push(normalize(_[i]));\n            }\n            q = pts.join(';');\n        } else {\n            q = normalize(_);\n        }\n\n        request(geocoder.queryURL(q), function(err, json) {\n            callback(err, json);\n        });\n\n        return geocoder;\n    };\n\n    return geocoder;\n};\n","'use strict';\n\n// an implementation of the simplestyle spec for polygon and linestring features\n// https://github.com/mapbox/simplestyle-spec\nvar defaults = {\n    stroke: '#555555',\n    'stroke-width': 2,\n    'stroke-opacity': 1,\n    fill: '#555555',\n    'fill-opacity': 0.5\n};\n\nvar mapping = [\n    ['stroke', 'color'],\n    ['stroke-width', 'weight'],\n    ['stroke-opacity', 'opacity'],\n    ['fill', 'fillColor'],\n    ['fill-opacity', 'fillOpacity']\n];\n\nfunction fallback(a, b) {\n    var c = {};\n    for (var k in b) {\n        if (a[k] === undefined) c[k] = b[k];\n        else c[k] = a[k];\n    }\n    return c;\n}\n\nfunction remap(a) {\n    var d = {};\n    for (var i = 0; i < mapping.length; i++) {\n        d[mapping[i][1]] = a[mapping[i][0]];\n    }\n    return d;\n}\n\nfunction style(feature) {\n    return remap(fallback(feature.properties || {}, defaults));\n}\n\nmodule.exports = {\n    style: style,\n    defaults: defaults\n};\n","'use strict';\n\nmodule.exports = {\n    HTTP_URL: 'http://a.tiles.mapbox.com/v4',\n    HTTPS_URL: 'https://a.tiles.mapbox.com/v4',\n    FORCE_HTTPS: false,\n    REQUIRE_ACCESS_TOKEN: true\n};\n","'use strict';\n\nvar Feedback = L.Class.extend({\n    includes: L.Mixin.Events,\n    data: {},\n    record: function(data) {\n        L.extend(this.data, data);\n        this.fire('change');\n    }\n});\n\nmodule.exports = new Feedback();\n","'use strict';\n\nmodule.exports = {\n    idUrl: function(_, t) {\n        if (_.indexOf('/') == -1) t.loadID(_);\n        else t.loadURL(_);\n    },\n    log: function(_) {\n        if (typeof console === 'object' &&\n            typeof console.error === 'function') {\n            console.error(_);\n        }\n    },\n    strict: function(_, type) {\n        if (typeof _ !== type) {\n            throw new Error('Invalid argument: ' + type + ' expected');\n        }\n    },\n    strict_instance: function(_, klass, name) {\n        if (!(_ instanceof klass)) {\n            throw new Error('Invalid argument: ' + name + ' expected');\n        }\n    },\n    strict_oneof: function(_, values) {\n        if (!contains(_, values)) {\n            throw new Error('Invalid argument: ' + _ + ' given, valid values are ' +\n                values.join(', '));\n        }\n    },\n    strip_tags: function(_) {\n        return _.replace(/<[^<]+>/g, '');\n    },\n    lbounds: function(_) {\n        // leaflet-compatible bounds, since leaflet does not do geojson\n        return new L.LatLngBounds([[_[1], _[0]], [_[3], _[2]]]);\n    }\n};\n\nfunction contains(item, list) {\n    if (!list || !list.length) return false;\n    for (var i = 0; i < list.length; i++) {\n        if (list[i] == item) return true;\n    }\n    return false;\n}\n","'use strict';\n\nvar config = require('./config'),\n    version = require('../package.json').version;\n\nmodule.exports = function(path, accessToken) {\n    accessToken = accessToken || L.mapbox.accessToken;\n\n    if (!accessToken && config.REQUIRE_ACCESS_TOKEN) {\n        throw new Error('An API access token is required to use Mapbox.js. ' +\n            'See https://www.mapbox.com/mapbox.js/api/v' + version + '/api-access-tokens/');\n    }\n\n    var url = ('https:' === document.location.protocol || config.FORCE_HTTPS) ? config.HTTPS_URL : config.HTTP_URL;\n    url += path;\n    url += url.indexOf('?') !== -1 ? '&access_token=' : '?access_token=';\n\n    if (config.REQUIRE_ACCESS_TOKEN) {\n        if (accessToken[0] === 's') {\n            throw new Error('Use a public access token (pk.*) with Mapbox.js, not a secret access token (sk.*). ' +\n                'See https://www.mapbox.com/mapbox.js/api/v' + version + '/api-access-tokens/');\n        }\n\n        url += accessToken;\n    }\n\n    return url;\n};\n\nmodule.exports.tileJSON = function(urlOrMapID, accessToken) {\n    if (urlOrMapID.indexOf('/') !== -1)\n        return urlOrMapID;\n\n    var url = module.exports('/' + urlOrMapID + '.json', accessToken);\n\n    // TileJSON requests need a secure flag appended to their URLs so\n    // that the server knows to send SSL-ified resource references.\n    if (url.indexOf('https') === 0)\n        url += '&secure';\n\n    return url;\n};\n","'use strict';\n\nvar corslite = require('corslite'),\n    strict = require('./util').strict,\n    config = require('./config'),\n    protocol = /^(https?:)?(?=\\/\\/(.|api)\\.tiles\\.mapbox\\.com\\/)/;\n\nmodule.exports = function(url, callback) {\n    strict(url, 'string');\n    strict(callback, 'function');\n\n    url = url.replace(protocol, function(match, protocol) {\n        if (!('withCredentials' in new window.XMLHttpRequest())) {\n            // XDomainRequest in use; doesn't support cross-protocol requests\n            return document.location.protocol;\n        } else if ('https:' === protocol || 'https:' === document.location.protocol || config.FORCE_HTTPS) {\n            return 'https:';\n        } else {\n            return 'http:';\n        }\n    });\n\n    return corslite(url, onload);\n    function onload(err, resp) {\n        if (!err && resp) {\n            resp = JSON.parse(resp.responseText);\n        }\n        callback(err, resp);\n    }\n};\n","'use strict';\n\nvar request = require('./request'),\n    url = require('./url'),\n    util = require('./util');\n\nmodule.exports = {\n    _loadTileJSON: function(_) {\n        if (typeof _ === 'string') {\n            _ = url.tileJSON(_, this.options && this.options.accessToken);\n            request(_, L.bind(function(err, json) {\n                if (err) {\n                    util.log('could not load TileJSON at ' + _);\n                    this.fire('error', {error: err});\n                } else if (json) {\n                    this._setTileJSON(json);\n                    this.fire('ready');\n                }\n            }, this));\n        } else if (_ && typeof _ === 'object') {\n            this._setTileJSON(_);\n        }\n    }\n};\n","'use strict';\n\nvar MapboxLogoControl = L.Control.extend({\n\n    options: {\n        position: 'bottomleft',\n    },\n\n    initialize: function(options) {\n        L.setOptions(this, options);\n    },\n\n    onAdd: function(map) {\n        this._container = L.DomUtil.create('div', 'mapbox-logo');\n        return this._container;\n    },\n\n    _setTileJSON: function(json) {\n        // Check if account referenced by the accessToken\n        // is asscociated with the Mapbox Logo\n        // as determined by mapbox-maps.\n        if (json.mapbox_logo) {\n            L.DomUtil.addClass(this._container, 'mapbox-logo-true');\n        }\n    }\n});\n\nmodule.exports.MapboxLogoControl = MapboxLogoControl;\n\nmodule.exports.mapboxLogoControl = function(options) {\n    return new MapboxLogoControl(options);\n};\n","'use strict';\n\nfunction utfDecode(c) {\n    if (c >= 93) c--;\n    if (c >= 35) c--;\n    return c - 32;\n}\n\nmodule.exports = function(data) {\n    return function(x, y) {\n        if (!data) return;\n        var idx = utfDecode(data.grid[y].charCodeAt(x)),\n            key = data.keys[idx];\n        return data.data[key];\n    };\n};\n","/*\n Leaflet, a JavaScript library for mobile-friendly interactive maps. http://leafletjs.com\n (c) 2010-2013, Vladimir Agafonkin\n (c) 2010-2011, CloudMade\n*/\n(function (window, document, undefined) {\r\nvar oldL = window.L,\r\n    L = {};\r\n\r\nL.version = '0.7.2';\r\n\r\n// define Leaflet for Node module pattern loaders, including Browserify\r\nif (typeof module === 'object' && typeof module.exports === 'object') {\r\n\tmodule.exports = L;\r\n\r\n// define Leaflet as an AMD module\r\n} else if (typeof define === 'function' && define.amd) {\r\n\tdefine(L);\r\n}\r\n\r\n// define Leaflet as a global L variable, saving the original L to restore later if needed\r\n\r\nL.noConflict = function () {\r\n\twindow.L = oldL;\r\n\treturn this;\r\n};\r\n\r\nwindow.L = L;\r\n\n\n/*\r\n * L.Util contains various utility functions used throughout Leaflet code.\r\n */\r\n\r\nL.Util = {\r\n\textend: function (dest) { // (Object[, Object, ...]) ->\r\n\t\tvar sources = Array.prototype.slice.call(arguments, 1),\r\n\t\t    i, j, len, src;\r\n\r\n\t\tfor (j = 0, len = sources.length; j < len; j++) {\r\n\t\t\tsrc = sources[j] || {};\r\n\t\t\tfor (i in src) {\r\n\t\t\t\tif (src.hasOwnProperty(i)) {\r\n\t\t\t\t\tdest[i] = src[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn dest;\r\n\t},\r\n\r\n\tbind: function (fn, obj) { // (Function, Object) -> Function\r\n\t\tvar args = arguments.length > 2 ? Array.prototype.slice.call(arguments, 2) : null;\r\n\t\treturn function () {\r\n\t\t\treturn fn.apply(obj, args || arguments);\r\n\t\t};\r\n\t},\r\n\r\n\tstamp: (function () {\r\n\t\tvar lastId = 0,\r\n\t\t    key = '_leaflet_id';\r\n\t\treturn function (obj) {\r\n\t\t\tobj[key] = obj[key] || ++lastId;\r\n\t\t\treturn obj[key];\r\n\t\t};\r\n\t}()),\r\n\r\n\tinvokeEach: function (obj, method, context) {\r\n\t\tvar i, args;\r\n\r\n\t\tif (typeof obj === 'object') {\r\n\t\t\targs = Array.prototype.slice.call(arguments, 3);\r\n\r\n\t\t\tfor (i in obj) {\r\n\t\t\t\tmethod.apply(context, [i, obj[i]].concat(args));\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t},\r\n\r\n\tlimitExecByInterval: function (fn, time, context) {\r\n\t\tvar lock, execOnUnlock;\r\n\r\n\t\treturn function wrapperFn() {\r\n\t\t\tvar args = arguments;\r\n\r\n\t\t\tif (lock) {\r\n\t\t\t\texecOnUnlock = true;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlock = true;\r\n\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\tlock = false;\r\n\r\n\t\t\t\tif (execOnUnlock) {\r\n\t\t\t\t\twrapperFn.apply(context, args);\r\n\t\t\t\t\texecOnUnlock = false;\r\n\t\t\t\t}\r\n\t\t\t}, time);\r\n\r\n\t\t\tfn.apply(context, args);\r\n\t\t};\r\n\t},\r\n\r\n\tfalseFn: function () {\r\n\t\treturn false;\r\n\t},\r\n\r\n\tformatNum: function (num, digits) {\r\n\t\tvar pow = Math.pow(10, digits || 5);\r\n\t\treturn Math.round(num * pow) / pow;\r\n\t},\r\n\r\n\ttrim: function (str) {\r\n\t\treturn str.trim ? str.trim() : str.replace(/^\\s+|\\s+$/g, '');\r\n\t},\r\n\r\n\tsplitWords: function (str) {\r\n\t\treturn L.Util.trim(str).split(/\\s+/);\r\n\t},\r\n\r\n\tsetOptions: function (obj, options) {\r\n\t\tobj.options = L.extend({}, obj.options, options);\r\n\t\treturn obj.options;\r\n\t},\r\n\r\n\tgetParamString: function (obj, existingUrl, uppercase) {\r\n\t\tvar params = [];\r\n\t\tfor (var i in obj) {\r\n\t\t\tparams.push(encodeURIComponent(uppercase ? i.toUpperCase() : i) + '=' + encodeURIComponent(obj[i]));\r\n\t\t}\r\n\t\treturn ((!existingUrl || existingUrl.indexOf('?') === -1) ? '?' : '&') + params.join('&');\r\n\t},\r\n\ttemplate: function (str, data) {\r\n\t\treturn str.replace(/\\{ *([\\w_]+) *\\}/g, function (str, key) {\r\n\t\t\tvar value = data[key];\r\n\t\t\tif (value === undefined) {\r\n\t\t\t\tthrow new Error('No value provided for variable ' + str);\r\n\t\t\t} else if (typeof value === 'function') {\r\n\t\t\t\tvalue = value(data);\r\n\t\t\t}\r\n\t\t\treturn value;\r\n\t\t});\r\n\t},\r\n\r\n\tisArray: Array.isArray || function (obj) {\r\n\t\treturn (Object.prototype.toString.call(obj) === '[object Array]');\r\n\t},\r\n\r\n\temptyImageUrl: 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs='\r\n};\r\n\r\n(function () {\r\n\r\n\t// inspired by http://paulirish.com/2011/requestanimationframe-for-smart-animating/\r\n\r\n\tfunction getPrefixed(name) {\r\n\t\tvar i, fn,\r\n\t\t    prefixes = ['webkit', 'moz', 'o', 'ms'];\r\n\r\n\t\tfor (i = 0; i < prefixes.length && !fn; i++) {\r\n\t\t\tfn = window[prefixes[i] + name];\r\n\t\t}\r\n\r\n\t\treturn fn;\r\n\t}\r\n\r\n\tvar lastTime = 0;\r\n\r\n\tfunction timeoutDefer(fn) {\r\n\t\tvar time = +new Date(),\r\n\t\t    timeToCall = Math.max(0, 16 - (time - lastTime));\r\n\r\n\t\tlastTime = time + timeToCall;\r\n\t\treturn window.setTimeout(fn, timeToCall);\r\n\t}\r\n\r\n\tvar requestFn = window.requestAnimationFrame ||\r\n\t        getPrefixed('RequestAnimationFrame') || timeoutDefer;\r\n\r\n\tvar cancelFn = window.cancelAnimationFrame ||\r\n\t        getPrefixed('CancelAnimationFrame') ||\r\n\t        getPrefixed('CancelRequestAnimationFrame') ||\r\n\t        function (id) { window.clearTimeout(id); };\r\n\r\n\r\n\tL.Util.requestAnimFrame = function (fn, context, immediate, element) {\r\n\t\tfn = L.bind(fn, context);\r\n\r\n\t\tif (immediate && requestFn === timeoutDefer) {\r\n\t\t\tfn();\r\n\t\t} else {\r\n\t\t\treturn requestFn.call(window, fn, element);\r\n\t\t}\r\n\t};\r\n\r\n\tL.Util.cancelAnimFrame = function (id) {\r\n\t\tif (id) {\r\n\t\t\tcancelFn.call(window, id);\r\n\t\t}\r\n\t};\r\n\r\n}());\r\n\r\n// shortcuts for most used utility functions\r\nL.extend = L.Util.extend;\r\nL.bind = L.Util.bind;\r\nL.stamp = L.Util.stamp;\r\nL.setOptions = L.Util.setOptions;\r\n\n\n/*\r\n * L.Class powers the OOP facilities of the library.\r\n * Thanks to John Resig and Dean Edwards for inspiration!\r\n */\r\n\r\nL.Class = function () {};\r\n\r\nL.Class.extend = function (props) {\r\n\r\n\t// extended class with the new prototype\r\n\tvar NewClass = function () {\r\n\r\n\t\t// call the constructor\r\n\t\tif (this.initialize) {\r\n\t\t\tthis.initialize.apply(this, arguments);\r\n\t\t}\r\n\r\n\t\t// call all constructor hooks\r\n\t\tif (this._initHooks) {\r\n\t\t\tthis.callInitHooks();\r\n\t\t}\r\n\t};\r\n\r\n\t// instantiate class without calling constructor\r\n\tvar F = function () {};\r\n\tF.prototype = this.prototype;\r\n\r\n\tvar proto = new F();\r\n\tproto.constructor = NewClass;\r\n\r\n\tNewClass.prototype = proto;\r\n\r\n\t//inherit parent's statics\r\n\tfor (var i in this) {\r\n\t\tif (this.hasOwnProperty(i) && i !== 'prototype') {\r\n\t\t\tNewClass[i] = this[i];\r\n\t\t}\r\n\t}\r\n\r\n\t// mix static properties into the class\r\n\tif (props.statics) {\r\n\t\tL.extend(NewClass, props.statics);\r\n\t\tdelete props.statics;\r\n\t}\r\n\r\n\t// mix includes into the prototype\r\n\tif (props.includes) {\r\n\t\tL.Util.extend.apply(null, [proto].concat(props.includes));\r\n\t\tdelete props.includes;\r\n\t}\r\n\r\n\t// merge options\r\n\tif (props.options && proto.options) {\r\n\t\tprops.options = L.extend({}, proto.options, props.options);\r\n\t}\r\n\r\n\t// mix given properties into the prototype\r\n\tL.extend(proto, props);\r\n\r\n\tproto._initHooks = [];\r\n\r\n\tvar parent = this;\r\n\t// jshint camelcase: false\r\n\tNewClass.__super__ = parent.prototype;\r\n\r\n\t// add method for calling all hooks\r\n\tproto.callInitHooks = function () {\r\n\r\n\t\tif (this._initHooksCalled) { return; }\r\n\r\n\t\tif (parent.prototype.callInitHooks) {\r\n\t\t\tparent.prototype.callInitHooks.call(this);\r\n\t\t}\r\n\r\n\t\tthis._initHooksCalled = true;\r\n\r\n\t\tfor (var i = 0, len = proto._initHooks.length; i < len; i++) {\r\n\t\t\tproto._initHooks[i].call(this);\r\n\t\t}\r\n\t};\r\n\r\n\treturn NewClass;\r\n};\r\n\r\n\r\n// method for adding properties to prototype\r\nL.Class.include = function (props) {\r\n\tL.extend(this.prototype, props);\r\n};\r\n\r\n// merge new default options to the Class\r\nL.Class.mergeOptions = function (options) {\r\n\tL.extend(this.prototype.options, options);\r\n};\r\n\r\n// add a constructor hook\r\nL.Class.addInitHook = function (fn) { // (Function) || (String, args...)\r\n\tvar args = Array.prototype.slice.call(arguments, 1);\r\n\r\n\tvar init = typeof fn === 'function' ? fn : function () {\r\n\t\tthis[fn].apply(this, args);\r\n\t};\r\n\r\n\tthis.prototype._initHooks = this.prototype._initHooks || [];\r\n\tthis.prototype._initHooks.push(init);\r\n};\r\n\n\n/*\r\n * L.Mixin.Events is used to add custom events functionality to Leaflet classes.\r\n */\r\n\r\nvar eventsKey = '_leaflet_events';\r\n\r\nL.Mixin = {};\r\n\r\nL.Mixin.Events = {\r\n\r\n\taddEventListener: function (types, fn, context) { // (String, Function[, Object]) or (Object[, Object])\r\n\r\n\t\t// types can be a map of types/handlers\r\n\t\tif (L.Util.invokeEach(types, this.addEventListener, this, fn, context)) { return this; }\r\n\r\n\t\tvar events = this[eventsKey] = this[eventsKey] || {},\r\n\t\t    contextId = context && context !== this && L.stamp(context),\r\n\t\t    i, len, event, type, indexKey, indexLenKey, typeIndex;\r\n\r\n\t\t// types can be a string of space-separated words\r\n\t\ttypes = L.Util.splitWords(types);\r\n\r\n\t\tfor (i = 0, len = types.length; i < len; i++) {\r\n\t\t\tevent = {\r\n\t\t\t\taction: fn,\r\n\t\t\t\tcontext: context || this\r\n\t\t\t};\r\n\t\t\ttype = types[i];\r\n\r\n\t\t\tif (contextId) {\r\n\t\t\t\t// store listeners of a particular context in a separate hash (if it has an id)\r\n\t\t\t\t// gives a major performance boost when removing thousands of map layers\r\n\r\n\t\t\t\tindexKey = type + '_idx';\r\n\t\t\t\tindexLenKey = indexKey + '_len';\r\n\r\n\t\t\t\ttypeIndex = events[indexKey] = events[indexKey] || {};\r\n\r\n\t\t\t\tif (!typeIndex[contextId]) {\r\n\t\t\t\t\ttypeIndex[contextId] = [];\r\n\r\n\t\t\t\t\t// keep track of the number of keys in the index to quickly check if it's empty\r\n\t\t\t\t\tevents[indexLenKey] = (events[indexLenKey] || 0) + 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttypeIndex[contextId].push(event);\r\n\r\n\r\n\t\t\t} else {\r\n\t\t\t\tevents[type] = events[type] || [];\r\n\t\t\t\tevents[type].push(event);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\thasEventListeners: function (type) { // (String) -> Boolean\r\n\t\tvar events = this[eventsKey];\r\n\t\treturn !!events && ((type in events && events[type].length > 0) ||\r\n\t\t                    (type + '_idx' in events && events[type + '_idx_len'] > 0));\r\n\t},\r\n\r\n\tremoveEventListener: function (types, fn, context) { // ([String, Function, Object]) or (Object[, Object])\r\n\r\n\t\tif (!this[eventsKey]) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tif (!types) {\r\n\t\t\treturn this.clearAllEventListeners();\r\n\t\t}\r\n\r\n\t\tif (L.Util.invokeEach(types, this.removeEventListener, this, fn, context)) { return this; }\r\n\r\n\t\tvar events = this[eventsKey],\r\n\t\t    contextId = context && context !== this && L.stamp(context),\r\n\t\t    i, len, type, listeners, j, indexKey, indexLenKey, typeIndex, removed;\r\n\r\n\t\ttypes = L.Util.splitWords(types);\r\n\r\n\t\tfor (i = 0, len = types.length; i < len; i++) {\r\n\t\t\ttype = types[i];\r\n\t\t\tindexKey = type + '_idx';\r\n\t\t\tindexLenKey = indexKey + '_len';\r\n\r\n\t\t\ttypeIndex = events[indexKey];\r\n\r\n\t\t\tif (!fn) {\r\n\t\t\t\t// clear all listeners for a type if function isn't specified\r\n\t\t\t\tdelete events[type];\r\n\t\t\t\tdelete events[indexKey];\r\n\t\t\t\tdelete events[indexLenKey];\r\n\r\n\t\t\t} else {\r\n\t\t\t\tlisteners = contextId && typeIndex ? typeIndex[contextId] : events[type];\r\n\r\n\t\t\t\tif (listeners) {\r\n\t\t\t\t\tfor (j = listeners.length - 1; j >= 0; j--) {\r\n\t\t\t\t\t\tif ((listeners[j].action === fn) && (!context || (listeners[j].context === context))) {\r\n\t\t\t\t\t\t\tremoved = listeners.splice(j, 1);\r\n\t\t\t\t\t\t\t// set the old action to a no-op, because it is possible\r\n\t\t\t\t\t\t\t// that the listener is being iterated over as part of a dispatch\r\n\t\t\t\t\t\t\tremoved[0].action = L.Util.falseFn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (context && typeIndex && (listeners.length === 0)) {\r\n\t\t\t\t\t\tdelete typeIndex[contextId];\r\n\t\t\t\t\t\tevents[indexLenKey]--;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tclearAllEventListeners: function () {\r\n\t\tdelete this[eventsKey];\r\n\t\treturn this;\r\n\t},\r\n\r\n\tfireEvent: function (type, data) { // (String[, Object])\r\n\t\tif (!this.hasEventListeners(type)) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tvar event = L.Util.extend({}, data, { type: type, target: this });\r\n\r\n\t\tvar events = this[eventsKey],\r\n\t\t    listeners, i, len, typeIndex, contextId;\r\n\r\n\t\tif (events[type]) {\r\n\t\t\t// make sure adding/removing listeners inside other listeners won't cause infinite loop\r\n\t\t\tlisteners = events[type].slice();\r\n\r\n\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\tlisteners[i].action.call(listeners[i].context, event);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// fire event for the context-indexed listeners as well\r\n\t\ttypeIndex = events[type + '_idx'];\r\n\r\n\t\tfor (contextId in typeIndex) {\r\n\t\t\tlisteners = typeIndex[contextId].slice();\r\n\r\n\t\t\tif (listeners) {\r\n\t\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\t\tlisteners[i].action.call(listeners[i].context, event);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\taddOneTimeEventListener: function (types, fn, context) {\r\n\r\n\t\tif (L.Util.invokeEach(types, this.addOneTimeEventListener, this, fn, context)) { return this; }\r\n\r\n\t\tvar handler = L.bind(function () {\r\n\t\t\tthis\r\n\t\t\t    .removeEventListener(types, fn, context)\r\n\t\t\t    .removeEventListener(types, handler, context);\r\n\t\t}, this);\r\n\r\n\t\treturn this\r\n\t\t    .addEventListener(types, fn, context)\r\n\t\t    .addEventListener(types, handler, context);\r\n\t}\r\n};\r\n\r\nL.Mixin.Events.on = L.Mixin.Events.addEventListener;\r\nL.Mixin.Events.off = L.Mixin.Events.removeEventListener;\r\nL.Mixin.Events.once = L.Mixin.Events.addOneTimeEventListener;\r\nL.Mixin.Events.fire = L.Mixin.Events.fireEvent;\r\n\n\n/*\r\n * L.Browser handles different browser and feature detections for internal Leaflet use.\r\n */\r\n\r\n(function () {\r\n\r\n\tvar ie = 'ActiveXObject' in window,\r\n\t\tielt9 = ie && !document.addEventListener,\r\n\r\n\t    // terrible browser detection to work around Safari / iOS / Android browser bugs\r\n\t    ua = navigator.userAgent.toLowerCase(),\r\n\t    webkit = ua.indexOf('webkit') !== -1,\r\n\t    chrome = ua.indexOf('chrome') !== -1,\r\n\t    phantomjs = ua.indexOf('phantom') !== -1,\r\n\t    android = ua.indexOf('android') !== -1,\r\n\t    android23 = ua.search('android [23]') !== -1,\r\n\t\tgecko = ua.indexOf('gecko') !== -1,\r\n\r\n\t    mobile = typeof orientation !== undefined + '',\r\n\t    msPointer = window.navigator && window.navigator.msPointerEnabled &&\r\n\t              window.navigator.msMaxTouchPoints && !window.PointerEvent,\r\n\t\tpointer = (window.PointerEvent && window.navigator.pointerEnabled && window.navigator.maxTouchPoints) ||\r\n\t\t\t\t  msPointer,\r\n\t    retina = ('devicePixelRatio' in window && window.devicePixelRatio > 1) ||\r\n\t             ('matchMedia' in window && window.matchMedia('(min-resolution:144dpi)') &&\r\n\t              window.matchMedia('(min-resolution:144dpi)').matches),\r\n\r\n\t    doc = document.documentElement,\r\n\t    ie3d = ie && ('transition' in doc.style),\r\n\t    webkit3d = ('WebKitCSSMatrix' in window) && ('m11' in new window.WebKitCSSMatrix()) && !android23,\r\n\t    gecko3d = 'MozPerspective' in doc.style,\r\n\t    opera3d = 'OTransition' in doc.style,\r\n\t    any3d = !window.L_DISABLE_3D && (ie3d || webkit3d || gecko3d || opera3d) && !phantomjs;\r\n\r\n\r\n\t// PhantomJS has 'ontouchstart' in document.documentElement, but doesn't actually support touch.\r\n\t// https://github.com/Leaflet/Leaflet/pull/1434#issuecomment-13843151\r\n\r\n\tvar touch = !window.L_NO_TOUCH && !phantomjs && (function () {\r\n\r\n\t\tvar startName = 'ontouchstart';\r\n\r\n\t\t// IE10+ (We simulate these into touch* events in L.DomEvent and L.DomEvent.Pointer) or WebKit, etc.\r\n\t\tif (pointer || (startName in doc)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t// Firefox/Gecko\r\n\t\tvar div = document.createElement('div'),\r\n\t\t    supported = false;\r\n\r\n\t\tif (!div.setAttribute) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tdiv.setAttribute(startName, 'return;');\r\n\r\n\t\tif (typeof div[startName] === 'function') {\r\n\t\t\tsupported = true;\r\n\t\t}\r\n\r\n\t\tdiv.removeAttribute(startName);\r\n\t\tdiv = null;\r\n\r\n\t\treturn supported;\r\n\t}());\r\n\r\n\r\n\tL.Browser = {\r\n\t\tie: ie,\r\n\t\tielt9: ielt9,\r\n\t\twebkit: webkit,\r\n\t\tgecko: gecko && !webkit && !window.opera && !ie,\r\n\r\n\t\tandroid: android,\r\n\t\tandroid23: android23,\r\n\r\n\t\tchrome: chrome,\r\n\r\n\t\tie3d: ie3d,\r\n\t\twebkit3d: webkit3d,\r\n\t\tgecko3d: gecko3d,\r\n\t\topera3d: opera3d,\r\n\t\tany3d: any3d,\r\n\r\n\t\tmobile: mobile,\r\n\t\tmobileWebkit: mobile && webkit,\r\n\t\tmobileWebkit3d: mobile && webkit3d,\r\n\t\tmobileOpera: mobile && window.opera,\r\n\r\n\t\ttouch: touch,\r\n\t\tmsPointer: msPointer,\r\n\t\tpointer: pointer,\r\n\r\n\t\tretina: retina\r\n\t};\r\n\r\n}());\r\n\n\n/*\r\n * L.Point represents a point with x and y coordinates.\r\n */\r\n\r\nL.Point = function (/*Number*/ x, /*Number*/ y, /*Boolean*/ round) {\r\n\tthis.x = (round ? Math.round(x) : x);\r\n\tthis.y = (round ? Math.round(y) : y);\r\n};\r\n\r\nL.Point.prototype = {\r\n\r\n\tclone: function () {\r\n\t\treturn new L.Point(this.x, this.y);\r\n\t},\r\n\r\n\t// non-destructive, returns a new point\r\n\tadd: function (point) {\r\n\t\treturn this.clone()._add(L.point(point));\r\n\t},\r\n\r\n\t// destructive, used directly for performance in situations where it's safe to modify existing point\r\n\t_add: function (point) {\r\n\t\tthis.x += point.x;\r\n\t\tthis.y += point.y;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsubtract: function (point) {\r\n\t\treturn this.clone()._subtract(L.point(point));\r\n\t},\r\n\r\n\t_subtract: function (point) {\r\n\t\tthis.x -= point.x;\r\n\t\tthis.y -= point.y;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tdivideBy: function (num) {\r\n\t\treturn this.clone()._divideBy(num);\r\n\t},\r\n\r\n\t_divideBy: function (num) {\r\n\t\tthis.x /= num;\r\n\t\tthis.y /= num;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tmultiplyBy: function (num) {\r\n\t\treturn this.clone()._multiplyBy(num);\r\n\t},\r\n\r\n\t_multiplyBy: function (num) {\r\n\t\tthis.x *= num;\r\n\t\tthis.y *= num;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tround: function () {\r\n\t\treturn this.clone()._round();\r\n\t},\r\n\r\n\t_round: function () {\r\n\t\tthis.x = Math.round(this.x);\r\n\t\tthis.y = Math.round(this.y);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tfloor: function () {\r\n\t\treturn this.clone()._floor();\r\n\t},\r\n\r\n\t_floor: function () {\r\n\t\tthis.x = Math.floor(this.x);\r\n\t\tthis.y = Math.floor(this.y);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tdistanceTo: function (point) {\r\n\t\tpoint = L.point(point);\r\n\r\n\t\tvar x = point.x - this.x,\r\n\t\t    y = point.y - this.y;\r\n\r\n\t\treturn Math.sqrt(x * x + y * y);\r\n\t},\r\n\r\n\tequals: function (point) {\r\n\t\tpoint = L.point(point);\r\n\r\n\t\treturn point.x === this.x &&\r\n\t\t       point.y === this.y;\r\n\t},\r\n\r\n\tcontains: function (point) {\r\n\t\tpoint = L.point(point);\r\n\r\n\t\treturn Math.abs(point.x) <= Math.abs(this.x) &&\r\n\t\t       Math.abs(point.y) <= Math.abs(this.y);\r\n\t},\r\n\r\n\ttoString: function () {\r\n\t\treturn 'Point(' +\r\n\t\t        L.Util.formatNum(this.x) + ', ' +\r\n\t\t        L.Util.formatNum(this.y) + ')';\r\n\t}\r\n};\r\n\r\nL.point = function (x, y, round) {\r\n\tif (x instanceof L.Point) {\r\n\t\treturn x;\r\n\t}\r\n\tif (L.Util.isArray(x)) {\r\n\t\treturn new L.Point(x[0], x[1]);\r\n\t}\r\n\tif (x === undefined || x === null) {\r\n\t\treturn x;\r\n\t}\r\n\treturn new L.Point(x, y, round);\r\n};\r\n\n\n/*\r\n * L.Bounds represents a rectangular area on the screen in pixel coordinates.\r\n */\r\n\r\nL.Bounds = function (a, b) { //(Point, Point) or Point[]\r\n\tif (!a) { return; }\r\n\r\n\tvar points = b ? [a, b] : a;\r\n\r\n\tfor (var i = 0, len = points.length; i < len; i++) {\r\n\t\tthis.extend(points[i]);\r\n\t}\r\n};\r\n\r\nL.Bounds.prototype = {\r\n\t// extend the bounds to contain the given point\r\n\textend: function (point) { // (Point)\r\n\t\tpoint = L.point(point);\r\n\r\n\t\tif (!this.min && !this.max) {\r\n\t\t\tthis.min = point.clone();\r\n\t\t\tthis.max = point.clone();\r\n\t\t} else {\r\n\t\t\tthis.min.x = Math.min(point.x, this.min.x);\r\n\t\t\tthis.max.x = Math.max(point.x, this.max.x);\r\n\t\t\tthis.min.y = Math.min(point.y, this.min.y);\r\n\t\t\tthis.max.y = Math.max(point.y, this.max.y);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetCenter: function (round) { // (Boolean) -> Point\r\n\t\treturn new L.Point(\r\n\t\t        (this.min.x + this.max.x) / 2,\r\n\t\t        (this.min.y + this.max.y) / 2, round);\r\n\t},\r\n\r\n\tgetBottomLeft: function () { // -> Point\r\n\t\treturn new L.Point(this.min.x, this.max.y);\r\n\t},\r\n\r\n\tgetTopRight: function () { // -> Point\r\n\t\treturn new L.Point(this.max.x, this.min.y);\r\n\t},\r\n\r\n\tgetSize: function () {\r\n\t\treturn this.max.subtract(this.min);\r\n\t},\r\n\r\n\tcontains: function (obj) { // (Bounds) or (Point) -> Boolean\r\n\t\tvar min, max;\r\n\r\n\t\tif (typeof obj[0] === 'number' || obj instanceof L.Point) {\r\n\t\t\tobj = L.point(obj);\r\n\t\t} else {\r\n\t\t\tobj = L.bounds(obj);\r\n\t\t}\r\n\r\n\t\tif (obj instanceof L.Bounds) {\r\n\t\t\tmin = obj.min;\r\n\t\t\tmax = obj.max;\r\n\t\t} else {\r\n\t\t\tmin = max = obj;\r\n\t\t}\r\n\r\n\t\treturn (min.x >= this.min.x) &&\r\n\t\t       (max.x <= this.max.x) &&\r\n\t\t       (min.y >= this.min.y) &&\r\n\t\t       (max.y <= this.max.y);\r\n\t},\r\n\r\n\tintersects: function (bounds) { // (Bounds) -> Boolean\r\n\t\tbounds = L.bounds(bounds);\r\n\r\n\t\tvar min = this.min,\r\n\t\t    max = this.max,\r\n\t\t    min2 = bounds.min,\r\n\t\t    max2 = bounds.max,\r\n\t\t    xIntersects = (max2.x >= min.x) && (min2.x <= max.x),\r\n\t\t    yIntersects = (max2.y >= min.y) && (min2.y <= max.y);\r\n\r\n\t\treturn xIntersects && yIntersects;\r\n\t},\r\n\r\n\tisValid: function () {\r\n\t\treturn !!(this.min && this.max);\r\n\t}\r\n};\r\n\r\nL.bounds = function (a, b) { // (Bounds) or (Point, Point) or (Point[])\r\n\tif (!a || a instanceof L.Bounds) {\r\n\t\treturn a;\r\n\t}\r\n\treturn new L.Bounds(a, b);\r\n};\r\n\n\n/*\r\n * L.Transformation is an utility class to perform simple point transformations through a 2d-matrix.\r\n */\r\n\r\nL.Transformation = function (a, b, c, d) {\r\n\tthis._a = a;\r\n\tthis._b = b;\r\n\tthis._c = c;\r\n\tthis._d = d;\r\n};\r\n\r\nL.Transformation.prototype = {\r\n\ttransform: function (point, scale) { // (Point, Number) -> Point\r\n\t\treturn this._transform(point.clone(), scale);\r\n\t},\r\n\r\n\t// destructive transform (faster)\r\n\t_transform: function (point, scale) {\r\n\t\tscale = scale || 1;\r\n\t\tpoint.x = scale * (this._a * point.x + this._b);\r\n\t\tpoint.y = scale * (this._c * point.y + this._d);\r\n\t\treturn point;\r\n\t},\r\n\r\n\tuntransform: function (point, scale) {\r\n\t\tscale = scale || 1;\r\n\t\treturn new L.Point(\r\n\t\t        (point.x / scale - this._b) / this._a,\r\n\t\t        (point.y / scale - this._d) / this._c);\r\n\t}\r\n};\r\n\n\n/*\r\n * L.DomUtil contains various utility functions for working with DOM.\r\n */\r\n\r\nL.DomUtil = {\r\n\tget: function (id) {\r\n\t\treturn (typeof id === 'string' ? document.getElementById(id) : id);\r\n\t},\r\n\r\n\tgetStyle: function (el, style) {\r\n\r\n\t\tvar value = el.style[style];\r\n\r\n\t\tif (!value && el.currentStyle) {\r\n\t\t\tvalue = el.currentStyle[style];\r\n\t\t}\r\n\r\n\t\tif ((!value || value === 'auto') && document.defaultView) {\r\n\t\t\tvar css = document.defaultView.getComputedStyle(el, null);\r\n\t\t\tvalue = css ? css[style] : null;\r\n\t\t}\r\n\r\n\t\treturn value === 'auto' ? null : value;\r\n\t},\r\n\r\n\tgetViewportOffset: function (element) {\r\n\r\n\t\tvar top = 0,\r\n\t\t    left = 0,\r\n\t\t    el = element,\r\n\t\t    docBody = document.body,\r\n\t\t    docEl = document.documentElement,\r\n\t\t    pos;\r\n\r\n\t\tdo {\r\n\t\t\ttop  += el.offsetTop  || 0;\r\n\t\t\tleft += el.offsetLeft || 0;\r\n\r\n\t\t\t//add borders\r\n\t\t\ttop += parseInt(L.DomUtil.getStyle(el, 'borderTopWidth'), 10) || 0;\r\n\t\t\tleft += parseInt(L.DomUtil.getStyle(el, 'borderLeftWidth'), 10) || 0;\r\n\r\n\t\t\tpos = L.DomUtil.getStyle(el, 'position');\r\n\r\n\t\t\tif (el.offsetParent === docBody && pos === 'absolute') { break; }\r\n\r\n\t\t\tif (pos === 'fixed') {\r\n\t\t\t\ttop  += docBody.scrollTop  || docEl.scrollTop  || 0;\r\n\t\t\t\tleft += docBody.scrollLeft || docEl.scrollLeft || 0;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (pos === 'relative' && !el.offsetLeft) {\r\n\t\t\t\tvar width = L.DomUtil.getStyle(el, 'width'),\r\n\t\t\t\t    maxWidth = L.DomUtil.getStyle(el, 'max-width'),\r\n\t\t\t\t    r = el.getBoundingClientRect();\r\n\r\n\t\t\t\tif (width !== 'none' || maxWidth !== 'none') {\r\n\t\t\t\t\tleft += r.left + el.clientLeft;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//calculate full y offset since we're breaking out of the loop\r\n\t\t\t\ttop += r.top + (docBody.scrollTop  || docEl.scrollTop  || 0);\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tel = el.offsetParent;\r\n\r\n\t\t} while (el);\r\n\r\n\t\tel = element;\r\n\r\n\t\tdo {\r\n\t\t\tif (el === docBody) { break; }\r\n\r\n\t\t\ttop  -= el.scrollTop  || 0;\r\n\t\t\tleft -= el.scrollLeft || 0;\r\n\r\n\t\t\tel = el.parentNode;\r\n\t\t} while (el);\r\n\r\n\t\treturn new L.Point(left, top);\r\n\t},\r\n\r\n\tdocumentIsLtr: function () {\r\n\t\tif (!L.DomUtil._docIsLtrCached) {\r\n\t\t\tL.DomUtil._docIsLtrCached = true;\r\n\t\t\tL.DomUtil._docIsLtr = L.DomUtil.getStyle(document.body, 'direction') === 'ltr';\r\n\t\t}\r\n\t\treturn L.DomUtil._docIsLtr;\r\n\t},\r\n\r\n\tcreate: function (tagName, className, container) {\r\n\r\n\t\tvar el = document.createElement(tagName);\r\n\t\tel.className = className;\r\n\r\n\t\tif (container) {\r\n\t\t\tcontainer.appendChild(el);\r\n\t\t}\r\n\r\n\t\treturn el;\r\n\t},\r\n\r\n\thasClass: function (el, name) {\r\n\t\tif (el.classList !== undefined) {\r\n\t\t\treturn el.classList.contains(name);\r\n\t\t}\r\n\t\tvar className = L.DomUtil._getClass(el);\r\n\t\treturn className.length > 0 && new RegExp('(^|\\\\s)' + name + '(\\\\s|$)').test(className);\r\n\t},\r\n\r\n\taddClass: function (el, name) {\r\n\t\tif (el.classList !== undefined) {\r\n\t\t\tvar classes = L.Util.splitWords(name);\r\n\t\t\tfor (var i = 0, len = classes.length; i < len; i++) {\r\n\t\t\t\tel.classList.add(classes[i]);\r\n\t\t\t}\r\n\t\t} else if (!L.DomUtil.hasClass(el, name)) {\r\n\t\t\tvar className = L.DomUtil._getClass(el);\r\n\t\t\tL.DomUtil._setClass(el, (className ? className + ' ' : '') + name);\r\n\t\t}\r\n\t},\r\n\r\n\tremoveClass: function (el, name) {\r\n\t\tif (el.classList !== undefined) {\r\n\t\t\tel.classList.remove(name);\r\n\t\t} else {\r\n\t\t\tL.DomUtil._setClass(el, L.Util.trim((' ' + L.DomUtil._getClass(el) + ' ').replace(' ' + name + ' ', ' ')));\r\n\t\t}\r\n\t},\r\n\r\n\t_setClass: function (el, name) {\r\n\t\tif (el.className.baseVal === undefined) {\r\n\t\t\tel.className = name;\r\n\t\t} else {\r\n\t\t\t// in case of SVG element\r\n\t\t\tel.className.baseVal = name;\r\n\t\t}\r\n\t},\r\n\r\n\t_getClass: function (el) {\r\n\t\treturn el.className.baseVal === undefined ? el.className : el.className.baseVal;\r\n\t},\r\n\r\n\tsetOpacity: function (el, value) {\r\n\r\n\t\tif ('opacity' in el.style) {\r\n\t\t\tel.style.opacity = value;\r\n\r\n\t\t} else if ('filter' in el.style) {\r\n\r\n\t\t\tvar filter = false,\r\n\t\t\t    filterName = 'DXImageTransform.Microsoft.Alpha';\r\n\r\n\t\t\t// filters collection throws an error if we try to retrieve a filter that doesn't exist\r\n\t\t\ttry {\r\n\t\t\t\tfilter = el.filters.item(filterName);\r\n\t\t\t} catch (e) {\r\n\t\t\t\t// don't set opacity to 1 if we haven't already set an opacity,\r\n\t\t\t\t// it isn't needed and breaks transparent pngs.\r\n\t\t\t\tif (value === 1) { return; }\r\n\t\t\t}\r\n\r\n\t\t\tvalue = Math.round(value * 100);\r\n\r\n\t\t\tif (filter) {\r\n\t\t\t\tfilter.Enabled = (value !== 100);\r\n\t\t\t\tfilter.Opacity = value;\r\n\t\t\t} else {\r\n\t\t\t\tel.style.filter += ' progid:' + filterName + '(opacity=' + value + ')';\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\ttestProp: function (props) {\r\n\r\n\t\tvar style = document.documentElement.style;\r\n\r\n\t\tfor (var i = 0; i < props.length; i++) {\r\n\t\t\tif (props[i] in style) {\r\n\t\t\t\treturn props[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\tgetTranslateString: function (point) {\r\n\t\t// on WebKit browsers (Chrome/Safari/iOS Safari/Android) using translate3d instead of translate\r\n\t\t// makes animation smoother as it ensures HW accel is used. Firefox 13 doesn't care\r\n\t\t// (same speed either way), Opera 12 doesn't support translate3d\r\n\r\n\t\tvar is3d = L.Browser.webkit3d,\r\n\t\t    open = 'translate' + (is3d ? '3d' : '') + '(',\r\n\t\t    close = (is3d ? ',0' : '') + ')';\r\n\r\n\t\treturn open + point.x + 'px,' + point.y + 'px' + close;\r\n\t},\r\n\r\n\tgetScaleString: function (scale, origin) {\r\n\r\n\t\tvar preTranslateStr = L.DomUtil.getTranslateString(origin.add(origin.multiplyBy(-1 * scale))),\r\n\t\t    scaleStr = ' scale(' + scale + ') ';\r\n\r\n\t\treturn preTranslateStr + scaleStr;\r\n\t},\r\n\r\n\tsetPosition: function (el, point, disable3D) { // (HTMLElement, Point[, Boolean])\r\n\r\n\t\t// jshint camelcase: false\r\n\t\tel._leaflet_pos = point;\r\n\r\n\t\tif (!disable3D && L.Browser.any3d) {\r\n\t\t\tel.style[L.DomUtil.TRANSFORM] =  L.DomUtil.getTranslateString(point);\r\n\t\t} else {\r\n\t\t\tel.style.left = point.x + 'px';\r\n\t\t\tel.style.top = point.y + 'px';\r\n\t\t}\r\n\t},\r\n\r\n\tgetPosition: function (el) {\r\n\t\t// this method is only used for elements previously positioned using setPosition,\r\n\t\t// so it's safe to cache the position for performance\r\n\r\n\t\t// jshint camelcase: false\r\n\t\treturn el._leaflet_pos;\r\n\t}\r\n};\r\n\r\n\r\n// prefix style property names\r\n\r\nL.DomUtil.TRANSFORM = L.DomUtil.testProp(\r\n        ['transform', 'WebkitTransform', 'OTransform', 'MozTransform', 'msTransform']);\r\n\r\n// webkitTransition comes first because some browser versions that drop vendor prefix don't do\r\n// the same for the transitionend event, in particular the Android 4.1 stock browser\r\n\r\nL.DomUtil.TRANSITION = L.DomUtil.testProp(\r\n        ['webkitTransition', 'transition', 'OTransition', 'MozTransition', 'msTransition']);\r\n\r\nL.DomUtil.TRANSITION_END =\r\n        L.DomUtil.TRANSITION === 'webkitTransition' || L.DomUtil.TRANSITION === 'OTransition' ?\r\n        L.DomUtil.TRANSITION + 'End' : 'transitionend';\r\n\r\n(function () {\r\n    if ('onselectstart' in document) {\r\n        L.extend(L.DomUtil, {\r\n            disableTextSelection: function () {\r\n                L.DomEvent.on(window, 'selectstart', L.DomEvent.preventDefault);\r\n            },\r\n\r\n            enableTextSelection: function () {\r\n                L.DomEvent.off(window, 'selectstart', L.DomEvent.preventDefault);\r\n            }\r\n        });\r\n    } else {\r\n        var userSelectProperty = L.DomUtil.testProp(\r\n            ['userSelect', 'WebkitUserSelect', 'OUserSelect', 'MozUserSelect', 'msUserSelect']);\r\n\r\n        L.extend(L.DomUtil, {\r\n            disableTextSelection: function () {\r\n                if (userSelectProperty) {\r\n                    var style = document.documentElement.style;\r\n                    this._userSelect = style[userSelectProperty];\r\n                    style[userSelectProperty] = 'none';\r\n                }\r\n            },\r\n\r\n            enableTextSelection: function () {\r\n                if (userSelectProperty) {\r\n                    document.documentElement.style[userSelectProperty] = this._userSelect;\r\n                    delete this._userSelect;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n\tL.extend(L.DomUtil, {\r\n\t\tdisableImageDrag: function () {\r\n\t\t\tL.DomEvent.on(window, 'dragstart', L.DomEvent.preventDefault);\r\n\t\t},\r\n\r\n\t\tenableImageDrag: function () {\r\n\t\t\tL.DomEvent.off(window, 'dragstart', L.DomEvent.preventDefault);\r\n\t\t}\r\n\t});\r\n})();\r\n\n\n/*\r\n * L.LatLng represents a geographical point with latitude and longitude coordinates.\r\n */\r\n\r\nL.LatLng = function (lat, lng, alt) { // (Number, Number, Number)\r\n\tlat = parseFloat(lat);\r\n\tlng = parseFloat(lng);\r\n\r\n\tif (isNaN(lat) || isNaN(lng)) {\r\n\t\tthrow new Error('Invalid LatLng object: (' + lat + ', ' + lng + ')');\r\n\t}\r\n\r\n\tthis.lat = lat;\r\n\tthis.lng = lng;\r\n\r\n\tif (alt !== undefined) {\r\n\t\tthis.alt = parseFloat(alt);\r\n\t}\r\n};\r\n\r\nL.extend(L.LatLng, {\r\n\tDEG_TO_RAD: Math.PI / 180,\r\n\tRAD_TO_DEG: 180 / Math.PI,\r\n\tMAX_MARGIN: 1.0E-9 // max margin of error for the \"equals\" check\r\n});\r\n\r\nL.LatLng.prototype = {\r\n\tequals: function (obj) { // (LatLng) -> Boolean\r\n\t\tif (!obj) { return false; }\r\n\r\n\t\tobj = L.latLng(obj);\r\n\r\n\t\tvar margin = Math.max(\r\n\t\t        Math.abs(this.lat - obj.lat),\r\n\t\t        Math.abs(this.lng - obj.lng));\r\n\r\n\t\treturn margin <= L.LatLng.MAX_MARGIN;\r\n\t},\r\n\r\n\ttoString: function (precision) { // (Number) -> String\r\n\t\treturn 'LatLng(' +\r\n\t\t        L.Util.formatNum(this.lat, precision) + ', ' +\r\n\t\t        L.Util.formatNum(this.lng, precision) + ')';\r\n\t},\r\n\r\n\t// Haversine distance formula, see http://en.wikipedia.org/wiki/Haversine_formula\r\n\t// TODO move to projection code, LatLng shouldn't know about Earth\r\n\tdistanceTo: function (other) { // (LatLng) -> Number\r\n\t\tother = L.latLng(other);\r\n\r\n\t\tvar R = 6378137, // earth radius in meters\r\n\t\t    d2r = L.LatLng.DEG_TO_RAD,\r\n\t\t    dLat = (other.lat - this.lat) * d2r,\r\n\t\t    dLon = (other.lng - this.lng) * d2r,\r\n\t\t    lat1 = this.lat * d2r,\r\n\t\t    lat2 = other.lat * d2r,\r\n\t\t    sin1 = Math.sin(dLat / 2),\r\n\t\t    sin2 = Math.sin(dLon / 2);\r\n\r\n\t\tvar a = sin1 * sin1 + sin2 * sin2 * Math.cos(lat1) * Math.cos(lat2);\r\n\r\n\t\treturn R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n\t},\r\n\r\n\twrap: function (a, b) { // (Number, Number) -> LatLng\r\n\t\tvar lng = this.lng;\r\n\r\n\t\ta = a || -180;\r\n\t\tb = b ||  180;\r\n\r\n\t\tlng = (lng + b) % (b - a) + (lng < a || lng === b ? b : a);\r\n\r\n\t\treturn new L.LatLng(this.lat, lng);\r\n\t}\r\n};\r\n\r\nL.latLng = function (a, b) { // (LatLng) or ([Number, Number]) or (Number, Number)\r\n\tif (a instanceof L.LatLng) {\r\n\t\treturn a;\r\n\t}\r\n\tif (L.Util.isArray(a)) {\r\n\t\tif (typeof a[0] === 'number' || typeof a[0] === 'string') {\r\n\t\t\treturn new L.LatLng(a[0], a[1], a[2]);\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\tif (a === undefined || a === null) {\r\n\t\treturn a;\r\n\t}\r\n\tif (typeof a === 'object' && 'lat' in a) {\r\n\t\treturn new L.LatLng(a.lat, 'lng' in a ? a.lng : a.lon);\r\n\t}\r\n\tif (b === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\treturn new L.LatLng(a, b);\r\n};\r\n\r\n\n\n/*\r\n * L.LatLngBounds represents a rectangular area on the map in geographical coordinates.\r\n */\r\n\r\nL.LatLngBounds = function (southWest, northEast) { // (LatLng, LatLng) or (LatLng[])\r\n\tif (!southWest) { return; }\r\n\r\n\tvar latlngs = northEast ? [southWest, northEast] : southWest;\r\n\r\n\tfor (var i = 0, len = latlngs.length; i < len; i++) {\r\n\t\tthis.extend(latlngs[i]);\r\n\t}\r\n};\r\n\r\nL.LatLngBounds.prototype = {\r\n\t// extend the bounds to contain the given point or bounds\r\n\textend: function (obj) { // (LatLng) or (LatLngBounds)\r\n\t\tif (!obj) { return this; }\r\n\r\n\t\tvar latLng = L.latLng(obj);\r\n\t\tif (latLng !== null) {\r\n\t\t\tobj = latLng;\r\n\t\t} else {\r\n\t\t\tobj = L.latLngBounds(obj);\r\n\t\t}\r\n\r\n\t\tif (obj instanceof L.LatLng) {\r\n\t\t\tif (!this._southWest && !this._northEast) {\r\n\t\t\t\tthis._southWest = new L.LatLng(obj.lat, obj.lng);\r\n\t\t\t\tthis._northEast = new L.LatLng(obj.lat, obj.lng);\r\n\t\t\t} else {\r\n\t\t\t\tthis._southWest.lat = Math.min(obj.lat, this._southWest.lat);\r\n\t\t\t\tthis._southWest.lng = Math.min(obj.lng, this._southWest.lng);\r\n\r\n\t\t\t\tthis._northEast.lat = Math.max(obj.lat, this._northEast.lat);\r\n\t\t\t\tthis._northEast.lng = Math.max(obj.lng, this._northEast.lng);\r\n\t\t\t}\r\n\t\t} else if (obj instanceof L.LatLngBounds) {\r\n\t\t\tthis.extend(obj._southWest);\r\n\t\t\tthis.extend(obj._northEast);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// extend the bounds by a percentage\r\n\tpad: function (bufferRatio) { // (Number) -> LatLngBounds\r\n\t\tvar sw = this._southWest,\r\n\t\t    ne = this._northEast,\r\n\t\t    heightBuffer = Math.abs(sw.lat - ne.lat) * bufferRatio,\r\n\t\t    widthBuffer = Math.abs(sw.lng - ne.lng) * bufferRatio;\r\n\r\n\t\treturn new L.LatLngBounds(\r\n\t\t        new L.LatLng(sw.lat - heightBuffer, sw.lng - widthBuffer),\r\n\t\t        new L.LatLng(ne.lat + heightBuffer, ne.lng + widthBuffer));\r\n\t},\r\n\r\n\tgetCenter: function () { // -> LatLng\r\n\t\treturn new L.LatLng(\r\n\t\t        (this._southWest.lat + this._northEast.lat) / 2,\r\n\t\t        (this._southWest.lng + this._northEast.lng) / 2);\r\n\t},\r\n\r\n\tgetSouthWest: function () {\r\n\t\treturn this._southWest;\r\n\t},\r\n\r\n\tgetNorthEast: function () {\r\n\t\treturn this._northEast;\r\n\t},\r\n\r\n\tgetNorthWest: function () {\r\n\t\treturn new L.LatLng(this.getNorth(), this.getWest());\r\n\t},\r\n\r\n\tgetSouthEast: function () {\r\n\t\treturn new L.LatLng(this.getSouth(), this.getEast());\r\n\t},\r\n\r\n\tgetWest: function () {\r\n\t\treturn this._southWest.lng;\r\n\t},\r\n\r\n\tgetSouth: function () {\r\n\t\treturn this._southWest.lat;\r\n\t},\r\n\r\n\tgetEast: function () {\r\n\t\treturn this._northEast.lng;\r\n\t},\r\n\r\n\tgetNorth: function () {\r\n\t\treturn this._northEast.lat;\r\n\t},\r\n\r\n\tcontains: function (obj) { // (LatLngBounds) or (LatLng) -> Boolean\r\n\t\tif (typeof obj[0] === 'number' || obj instanceof L.LatLng) {\r\n\t\t\tobj = L.latLng(obj);\r\n\t\t} else {\r\n\t\t\tobj = L.latLngBounds(obj);\r\n\t\t}\r\n\r\n\t\tvar sw = this._southWest,\r\n\t\t    ne = this._northEast,\r\n\t\t    sw2, ne2;\r\n\r\n\t\tif (obj instanceof L.LatLngBounds) {\r\n\t\t\tsw2 = obj.getSouthWest();\r\n\t\t\tne2 = obj.getNorthEast();\r\n\t\t} else {\r\n\t\t\tsw2 = ne2 = obj;\r\n\t\t}\r\n\r\n\t\treturn (sw2.lat >= sw.lat) && (ne2.lat <= ne.lat) &&\r\n\t\t       (sw2.lng >= sw.lng) && (ne2.lng <= ne.lng);\r\n\t},\r\n\r\n\tintersects: function (bounds) { // (LatLngBounds)\r\n\t\tbounds = L.latLngBounds(bounds);\r\n\r\n\t\tvar sw = this._southWest,\r\n\t\t    ne = this._northEast,\r\n\t\t    sw2 = bounds.getSouthWest(),\r\n\t\t    ne2 = bounds.getNorthEast(),\r\n\r\n\t\t    latIntersects = (ne2.lat >= sw.lat) && (sw2.lat <= ne.lat),\r\n\t\t    lngIntersects = (ne2.lng >= sw.lng) && (sw2.lng <= ne.lng);\r\n\r\n\t\treturn latIntersects && lngIntersects;\r\n\t},\r\n\r\n\ttoBBoxString: function () {\r\n\t\treturn [this.getWest(), this.getSouth(), this.getEast(), this.getNorth()].join(',');\r\n\t},\r\n\r\n\tequals: function (bounds) { // (LatLngBounds)\r\n\t\tif (!bounds) { return false; }\r\n\r\n\t\tbounds = L.latLngBounds(bounds);\r\n\r\n\t\treturn this._southWest.equals(bounds.getSouthWest()) &&\r\n\t\t       this._northEast.equals(bounds.getNorthEast());\r\n\t},\r\n\r\n\tisValid: function () {\r\n\t\treturn !!(this._southWest && this._northEast);\r\n\t}\r\n};\r\n\r\n//TODO International date line?\r\n\r\nL.latLngBounds = function (a, b) { // (LatLngBounds) or (LatLng, LatLng)\r\n\tif (!a || a instanceof L.LatLngBounds) {\r\n\t\treturn a;\r\n\t}\r\n\treturn new L.LatLngBounds(a, b);\r\n};\r\n\n\n/*\r\n * L.Projection contains various geographical projections used by CRS classes.\r\n */\r\n\r\nL.Projection = {};\r\n\n\n/*\r\n * Spherical Mercator is the most popular map projection, used by EPSG:3857 CRS used by default.\r\n */\r\n\r\nL.Projection.SphericalMercator = {\r\n\tMAX_LATITUDE: 85.0511287798,\r\n\r\n\tproject: function (latlng) { // (LatLng) -> Point\r\n\t\tvar d = L.LatLng.DEG_TO_RAD,\r\n\t\t    max = this.MAX_LATITUDE,\r\n\t\t    lat = Math.max(Math.min(max, latlng.lat), -max),\r\n\t\t    x = latlng.lng * d,\r\n\t\t    y = lat * d;\r\n\r\n\t\ty = Math.log(Math.tan((Math.PI / 4) + (y / 2)));\r\n\r\n\t\treturn new L.Point(x, y);\r\n\t},\r\n\r\n\tunproject: function (point) { // (Point, Boolean) -> LatLng\r\n\t\tvar d = L.LatLng.RAD_TO_DEG,\r\n\t\t    lng = point.x * d,\r\n\t\t    lat = (2 * Math.atan(Math.exp(point.y)) - (Math.PI / 2)) * d;\r\n\r\n\t\treturn new L.LatLng(lat, lng);\r\n\t}\r\n};\r\n\n\n/*\r\n * Simple equirectangular (Plate Carree) projection, used by CRS like EPSG:4326 and Simple.\r\n */\r\n\r\nL.Projection.LonLat = {\r\n\tproject: function (latlng) {\r\n\t\treturn new L.Point(latlng.lng, latlng.lat);\r\n\t},\r\n\r\n\tunproject: function (point) {\r\n\t\treturn new L.LatLng(point.y, point.x);\r\n\t}\r\n};\r\n\n\n/*\r\n * L.CRS is a base object for all defined CRS (Coordinate Reference Systems) in Leaflet.\r\n */\r\n\r\nL.CRS = {\r\n\tlatLngToPoint: function (latlng, zoom) { // (LatLng, Number) -> Point\r\n\t\tvar projectedPoint = this.projection.project(latlng),\r\n\t\t    scale = this.scale(zoom);\r\n\r\n\t\treturn this.transformation._transform(projectedPoint, scale);\r\n\t},\r\n\r\n\tpointToLatLng: function (point, zoom) { // (Point, Number[, Boolean]) -> LatLng\r\n\t\tvar scale = this.scale(zoom),\r\n\t\t    untransformedPoint = this.transformation.untransform(point, scale);\r\n\r\n\t\treturn this.projection.unproject(untransformedPoint);\r\n\t},\r\n\r\n\tproject: function (latlng) {\r\n\t\treturn this.projection.project(latlng);\r\n\t},\r\n\r\n\tscale: function (zoom) {\r\n\t\treturn 256 * Math.pow(2, zoom);\r\n\t},\r\n\r\n\tgetSize: function (zoom) {\r\n\t\tvar s = this.scale(zoom);\r\n\t\treturn L.point(s, s);\r\n\t}\r\n};\r\n\n\n/*\n * A simple CRS that can be used for flat non-Earth maps like panoramas or game maps.\n */\n\nL.CRS.Simple = L.extend({}, L.CRS, {\n\tprojection: L.Projection.LonLat,\n\ttransformation: new L.Transformation(1, 0, -1, 0),\n\n\tscale: function (zoom) {\n\t\treturn Math.pow(2, zoom);\n\t}\n});\n\n\n/*\r\n * L.CRS.EPSG3857 (Spherical Mercator) is the most common CRS for web mapping\r\n * and is used by Leaflet by default.\r\n */\r\n\r\nL.CRS.EPSG3857 = L.extend({}, L.CRS, {\r\n\tcode: 'EPSG:3857',\r\n\r\n\tprojection: L.Projection.SphericalMercator,\r\n\ttransformation: new L.Transformation(0.5 / Math.PI, 0.5, -0.5 / Math.PI, 0.5),\r\n\r\n\tproject: function (latlng) { // (LatLng) -> Point\r\n\t\tvar projectedPoint = this.projection.project(latlng),\r\n\t\t    earthRadius = 6378137;\r\n\t\treturn projectedPoint.multiplyBy(earthRadius);\r\n\t}\r\n});\r\n\r\nL.CRS.EPSG900913 = L.extend({}, L.CRS.EPSG3857, {\r\n\tcode: 'EPSG:900913'\r\n});\r\n\n\n/*\r\n * L.CRS.EPSG4326 is a CRS popular among advanced GIS specialists.\r\n */\r\n\r\nL.CRS.EPSG4326 = L.extend({}, L.CRS, {\r\n\tcode: 'EPSG:4326',\r\n\r\n\tprojection: L.Projection.LonLat,\r\n\ttransformation: new L.Transformation(1 / 360, 0.5, -1 / 360, 0.5)\r\n});\r\n\n\n/*\r\n * L.Map is the central class of the API - it is used to create a map.\r\n */\r\n\r\nL.Map = L.Class.extend({\r\n\r\n\tincludes: L.Mixin.Events,\r\n\r\n\toptions: {\r\n\t\tcrs: L.CRS.EPSG3857,\r\n\r\n\t\t/*\r\n\t\tcenter: LatLng,\r\n\t\tzoom: Number,\r\n\t\tlayers: Array,\r\n\t\t*/\r\n\r\n\t\tfadeAnimation: L.DomUtil.TRANSITION && !L.Browser.android23,\r\n\t\ttrackResize: true,\r\n\t\tmarkerZoomAnimation: L.DomUtil.TRANSITION && L.Browser.any3d\r\n\t},\r\n\r\n\tinitialize: function (id, options) { // (HTMLElement or String, Object)\r\n\t\toptions = L.setOptions(this, options);\r\n\r\n\r\n\t\tthis._initContainer(id);\r\n\t\tthis._initLayout();\r\n\r\n\t\t// hack for https://github.com/Leaflet/Leaflet/issues/1980\r\n\t\tthis._onResize = L.bind(this._onResize, this);\r\n\r\n\t\tthis._initEvents();\r\n\r\n\t\tif (options.maxBounds) {\r\n\t\t\tthis.setMaxBounds(options.maxBounds);\r\n\t\t}\r\n\r\n\t\tif (options.center && options.zoom !== undefined) {\r\n\t\t\tthis.setView(L.latLng(options.center), options.zoom, {reset: true});\r\n\t\t}\r\n\r\n\t\tthis._handlers = [];\r\n\r\n\t\tthis._layers = {};\r\n\t\tthis._zoomBoundLayers = {};\r\n\t\tthis._tileLayersNum = 0;\r\n\r\n\t\tthis.callInitHooks();\r\n\r\n\t\tthis._addLayers(options.layers);\r\n\t},\r\n\r\n\r\n\t// public methods that modify map state\r\n\r\n\t// replaced by animation-powered implementation in Map.PanAnimation.js\r\n\tsetView: function (center, zoom) {\r\n\t\tzoom = zoom === undefined ? this.getZoom() : zoom;\r\n\t\tthis._resetView(L.latLng(center), this._limitZoom(zoom));\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetZoom: function (zoom, options) {\r\n\t\tif (!this._loaded) {\r\n\t\t\tthis._zoom = this._limitZoom(zoom);\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\treturn this.setView(this.getCenter(), zoom, {zoom: options});\r\n\t},\r\n\r\n\tzoomIn: function (delta, options) {\r\n\t\treturn this.setZoom(this._zoom + (delta || 1), options);\r\n\t},\r\n\r\n\tzoomOut: function (delta, options) {\r\n\t\treturn this.setZoom(this._zoom - (delta || 1), options);\r\n\t},\r\n\r\n\tsetZoomAround: function (latlng, zoom, options) {\r\n\t\tvar scale = this.getZoomScale(zoom),\r\n\t\t    viewHalf = this.getSize().divideBy(2),\r\n\t\t    containerPoint = latlng instanceof L.Point ? latlng : this.latLngToContainerPoint(latlng),\r\n\r\n\t\t    centerOffset = containerPoint.subtract(viewHalf).multiplyBy(1 - 1 / scale),\r\n\t\t    newCenter = this.containerPointToLatLng(viewHalf.add(centerOffset));\r\n\r\n\t\treturn this.setView(newCenter, zoom, {zoom: options});\r\n\t},\r\n\r\n\tfitBounds: function (bounds, options) {\r\n\r\n\t\toptions = options || {};\r\n\t\tbounds = bounds.getBounds ? bounds.getBounds() : L.latLngBounds(bounds);\r\n\r\n\t\tvar paddingTL = L.point(options.paddingTopLeft || options.padding || [0, 0]),\r\n\t\t    paddingBR = L.point(options.paddingBottomRight || options.padding || [0, 0]),\r\n\r\n\t\t    zoom = this.getBoundsZoom(bounds, false, paddingTL.add(paddingBR)),\r\n\t\t    paddingOffset = paddingBR.subtract(paddingTL).divideBy(2),\r\n\r\n\t\t    swPoint = this.project(bounds.getSouthWest(), zoom),\r\n\t\t    nePoint = this.project(bounds.getNorthEast(), zoom),\r\n\t\t    center = this.unproject(swPoint.add(nePoint).divideBy(2).add(paddingOffset), zoom);\r\n\r\n\t\tzoom = options && options.maxZoom ? Math.min(options.maxZoom, zoom) : zoom;\r\n\r\n\t\treturn this.setView(center, zoom, options);\r\n\t},\r\n\r\n\tfitWorld: function (options) {\r\n\t\treturn this.fitBounds([[-90, -180], [90, 180]], options);\r\n\t},\r\n\r\n\tpanTo: function (center, options) { // (LatLng)\r\n\t\treturn this.setView(center, this._zoom, {pan: options});\r\n\t},\r\n\r\n\tpanBy: function (offset) { // (Point)\r\n\t\t// replaced with animated panBy in Map.PanAnimation.js\r\n\t\tthis.fire('movestart');\r\n\r\n\t\tthis._rawPanBy(L.point(offset));\r\n\r\n\t\tthis.fire('move');\r\n\t\treturn this.fire('moveend');\r\n\t},\r\n\r\n\tsetMaxBounds: function (bounds) {\r\n\t\tbounds = L.latLngBounds(bounds);\r\n\r\n\t\tthis.options.maxBounds = bounds;\r\n\r\n\t\tif (!bounds) {\r\n\t\t\treturn this.off('moveend', this._panInsideMaxBounds, this);\r\n\t\t}\r\n\r\n\t\tif (this._loaded) {\r\n\t\t\tthis._panInsideMaxBounds();\r\n\t\t}\r\n\r\n\t\treturn this.on('moveend', this._panInsideMaxBounds, this);\r\n\t},\r\n\r\n\tpanInsideBounds: function (bounds, options) {\r\n\t\tvar center = this.getCenter(),\r\n\t\t\tnewCenter = this._limitCenter(center, this._zoom, bounds);\r\n\r\n\t\tif (center.equals(newCenter)) { return this; }\r\n\r\n\t\treturn this.panTo(newCenter, options);\r\n\t},\r\n\r\n\taddLayer: function (layer) {\r\n\t\t// TODO method is too big, refactor\r\n\r\n\t\tvar id = L.stamp(layer);\r\n\r\n\t\tif (this._layers[id]) { return this; }\r\n\r\n\t\tthis._layers[id] = layer;\r\n\r\n\t\t// TODO getMaxZoom, getMinZoom in ILayer (instead of options)\r\n\t\tif (layer.options && (!isNaN(layer.options.maxZoom) || !isNaN(layer.options.minZoom))) {\r\n\t\t\tthis._zoomBoundLayers[id] = layer;\r\n\t\t\tthis._updateZoomLevels();\r\n\t\t}\r\n\r\n\t\t// TODO looks ugly, refactor!!!\r\n\t\tif (this.options.zoomAnimation && L.TileLayer && (layer instanceof L.TileLayer)) {\r\n\t\t\tthis._tileLayersNum++;\r\n\t\t\tthis._tileLayersToLoad++;\r\n\t\t\tlayer.on('load', this._onTileLayerLoad, this);\r\n\t\t}\r\n\r\n\t\tif (this._loaded) {\r\n\t\t\tthis._layerAdd(layer);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveLayer: function (layer) {\r\n\t\tvar id = L.stamp(layer);\r\n\r\n\t\tif (!this._layers[id]) { return this; }\r\n\r\n\t\tif (this._loaded) {\r\n\t\t\tlayer.onRemove(this);\r\n\t\t}\r\n\r\n\t\tdelete this._layers[id];\r\n\r\n\t\tif (this._loaded) {\r\n\t\t\tthis.fire('layerremove', {layer: layer});\r\n\t\t}\r\n\r\n\t\tif (this._zoomBoundLayers[id]) {\r\n\t\t\tdelete this._zoomBoundLayers[id];\r\n\t\t\tthis._updateZoomLevels();\r\n\t\t}\r\n\r\n\t\t// TODO looks ugly, refactor\r\n\t\tif (this.options.zoomAnimation && L.TileLayer && (layer instanceof L.TileLayer)) {\r\n\t\t\tthis._tileLayersNum--;\r\n\t\t\tthis._tileLayersToLoad--;\r\n\t\t\tlayer.off('load', this._onTileLayerLoad, this);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\thasLayer: function (layer) {\r\n\t\tif (!layer) { return false; }\r\n\r\n\t\treturn (L.stamp(layer) in this._layers);\r\n\t},\r\n\r\n\teachLayer: function (method, context) {\r\n\t\tfor (var i in this._layers) {\r\n\t\t\tmethod.call(context, this._layers[i]);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tinvalidateSize: function (options) {\r\n\t\tif (!this._loaded) { return this; }\r\n\r\n\t\toptions = L.extend({\r\n\t\t\tanimate: false,\r\n\t\t\tpan: true\r\n\t\t}, options === true ? {animate: true} : options);\r\n\r\n\t\tvar oldSize = this.getSize();\r\n\t\tthis._sizeChanged = true;\r\n\t\tthis._initialCenter = null;\r\n\r\n\t\tvar newSize = this.getSize(),\r\n\t\t    oldCenter = oldSize.divideBy(2).round(),\r\n\t\t    newCenter = newSize.divideBy(2).round(),\r\n\t\t    offset = oldCenter.subtract(newCenter);\r\n\r\n\t\tif (!offset.x && !offset.y) { return this; }\r\n\r\n\t\tif (options.animate && options.pan) {\r\n\t\t\tthis.panBy(offset);\r\n\r\n\t\t} else {\r\n\t\t\tif (options.pan) {\r\n\t\t\t\tthis._rawPanBy(offset);\r\n\t\t\t}\r\n\r\n\t\t\tthis.fire('move');\r\n\r\n\t\t\tif (options.debounceMoveend) {\r\n\t\t\t\tclearTimeout(this._sizeTimer);\r\n\t\t\t\tthis._sizeTimer = setTimeout(L.bind(this.fire, this, 'moveend'), 200);\r\n\t\t\t} else {\r\n\t\t\t\tthis.fire('moveend');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this.fire('resize', {\r\n\t\t\toldSize: oldSize,\r\n\t\t\tnewSize: newSize\r\n\t\t});\r\n\t},\r\n\r\n\t// TODO handler.addTo\r\n\taddHandler: function (name, HandlerClass) {\r\n\t\tif (!HandlerClass) { return this; }\r\n\r\n\t\tvar handler = this[name] = new HandlerClass(this);\r\n\r\n\t\tthis._handlers.push(handler);\r\n\r\n\t\tif (this.options[name]) {\r\n\t\t\thandler.enable();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremove: function () {\r\n\t\tif (this._loaded) {\r\n\t\t\tthis.fire('unload');\r\n\t\t}\r\n\r\n\t\tthis._initEvents('off');\r\n\r\n\t\ttry {\r\n\t\t\t// throws error in IE6-8\r\n\t\t\tdelete this._container._leaflet;\r\n\t\t} catch (e) {\r\n\t\t\tthis._container._leaflet = undefined;\r\n\t\t}\r\n\r\n\t\tthis._clearPanes();\r\n\t\tif (this._clearControlPos) {\r\n\t\t\tthis._clearControlPos();\r\n\t\t}\r\n\r\n\t\tthis._clearHandlers();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\r\n\t// public methods for getting map state\r\n\r\n\tgetCenter: function () { // (Boolean) -> LatLng\r\n\t\tthis._checkIfLoaded();\r\n\r\n\t\tif (this._initialCenter && !this._moved()) {\r\n\t\t\treturn this._initialCenter;\r\n\t\t}\r\n\t\treturn this.layerPointToLatLng(this._getCenterLayerPoint());\r\n\t},\r\n\r\n\tgetZoom: function () {\r\n\t\treturn this._zoom;\r\n\t},\r\n\r\n\tgetBounds: function () {\r\n\t\tvar bounds = this.getPixelBounds(),\r\n\t\t    sw = this.unproject(bounds.getBottomLeft()),\r\n\t\t    ne = this.unproject(bounds.getTopRight());\r\n\r\n\t\treturn new L.LatLngBounds(sw, ne);\r\n\t},\r\n\r\n\tgetMinZoom: function () {\r\n\t\treturn this.options.minZoom === undefined ?\r\n\t\t\t(this._layersMinZoom === undefined ? 0 : this._layersMinZoom) :\r\n\t\t\tthis.options.minZoom;\r\n\t},\r\n\r\n\tgetMaxZoom: function () {\r\n\t\treturn this.options.maxZoom === undefined ?\r\n\t\t\t(this._layersMaxZoom === undefined ? Infinity : this._layersMaxZoom) :\r\n\t\t\tthis.options.maxZoom;\r\n\t},\r\n\r\n\tgetBoundsZoom: function (bounds, inside, padding) { // (LatLngBounds[, Boolean, Point]) -> Number\r\n\t\tbounds = L.latLngBounds(bounds);\r\n\r\n\t\tvar zoom = this.getMinZoom() - (inside ? 1 : 0),\r\n\t\t    maxZoom = this.getMaxZoom(),\r\n\t\t    size = this.getSize(),\r\n\r\n\t\t    nw = bounds.getNorthWest(),\r\n\t\t    se = bounds.getSouthEast(),\r\n\r\n\t\t    zoomNotFound = true,\r\n\t\t    boundsSize;\r\n\r\n\t\tpadding = L.point(padding || [0, 0]);\r\n\r\n\t\tdo {\r\n\t\t\tzoom++;\r\n\t\t\tboundsSize = this.project(se, zoom).subtract(this.project(nw, zoom)).add(padding);\r\n\t\t\tzoomNotFound = !inside ? size.contains(boundsSize) : boundsSize.x < size.x || boundsSize.y < size.y;\r\n\r\n\t\t} while (zoomNotFound && zoom <= maxZoom);\r\n\r\n\t\tif (zoomNotFound && inside) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn inside ? zoom : zoom - 1;\r\n\t},\r\n\r\n\tgetSize: function () {\r\n\t\tif (!this._size || this._sizeChanged) {\r\n\t\t\tthis._size = new L.Point(\r\n\t\t\t\tthis._container.clientWidth,\r\n\t\t\t\tthis._container.clientHeight);\r\n\r\n\t\t\tthis._sizeChanged = false;\r\n\t\t}\r\n\t\treturn this._size.clone();\r\n\t},\r\n\r\n\tgetPixelBounds: function () {\r\n\t\tvar topLeftPoint = this._getTopLeftPoint();\r\n\t\treturn new L.Bounds(topLeftPoint, topLeftPoint.add(this.getSize()));\r\n\t},\r\n\r\n\tgetPixelOrigin: function () {\r\n\t\tthis._checkIfLoaded();\r\n\t\treturn this._initialTopLeftPoint;\r\n\t},\r\n\r\n\tgetPanes: function () {\r\n\t\treturn this._panes;\r\n\t},\r\n\r\n\tgetContainer: function () {\r\n\t\treturn this._container;\r\n\t},\r\n\r\n\r\n\t// TODO replace with universal implementation after refactoring projections\r\n\r\n\tgetZoomScale: function (toZoom) {\r\n\t\tvar crs = this.options.crs;\r\n\t\treturn crs.scale(toZoom) / crs.scale(this._zoom);\r\n\t},\r\n\r\n\tgetScaleZoom: function (scale) {\r\n\t\treturn this._zoom + (Math.log(scale) / Math.LN2);\r\n\t},\r\n\r\n\r\n\t// conversion methods\r\n\r\n\tproject: function (latlng, zoom) { // (LatLng[, Number]) -> Point\r\n\t\tzoom = zoom === undefined ? this._zoom : zoom;\r\n\t\treturn this.options.crs.latLngToPoint(L.latLng(latlng), zoom);\r\n\t},\r\n\r\n\tunproject: function (point, zoom) { // (Point[, Number]) -> LatLng\r\n\t\tzoom = zoom === undefined ? this._zoom : zoom;\r\n\t\treturn this.options.crs.pointToLatLng(L.point(point), zoom);\r\n\t},\r\n\r\n\tlayerPointToLatLng: function (point) { // (Point)\r\n\t\tvar projectedPoint = L.point(point).add(this.getPixelOrigin());\r\n\t\treturn this.unproject(projectedPoint);\r\n\t},\r\n\r\n\tlatLngToLayerPoint: function (latlng) { // (LatLng)\r\n\t\tvar projectedPoint = this.project(L.latLng(latlng))._round();\r\n\t\treturn projectedPoint._subtract(this.getPixelOrigin());\r\n\t},\r\n\r\n\tcontainerPointToLayerPoint: function (point) { // (Point)\r\n\t\treturn L.point(point).subtract(this._getMapPanePos());\r\n\t},\r\n\r\n\tlayerPointToContainerPoint: function (point) { // (Point)\r\n\t\treturn L.point(point).add(this._getMapPanePos());\r\n\t},\r\n\r\n\tcontainerPointToLatLng: function (point) {\r\n\t\tvar layerPoint = this.containerPointToLayerPoint(L.point(point));\r\n\t\treturn this.layerPointToLatLng(layerPoint);\r\n\t},\r\n\r\n\tlatLngToContainerPoint: function (latlng) {\r\n\t\treturn this.layerPointToContainerPoint(this.latLngToLayerPoint(L.latLng(latlng)));\r\n\t},\r\n\r\n\tmouseEventToContainerPoint: function (e) { // (MouseEvent)\r\n\t\treturn L.DomEvent.getMousePosition(e, this._container);\r\n\t},\r\n\r\n\tmouseEventToLayerPoint: function (e) { // (MouseEvent)\r\n\t\treturn this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e));\r\n\t},\r\n\r\n\tmouseEventToLatLng: function (e) { // (MouseEvent)\r\n\t\treturn this.layerPointToLatLng(this.mouseEventToLayerPoint(e));\r\n\t},\r\n\r\n\r\n\t// map initialization methods\r\n\r\n\t_initContainer: function (id) {\r\n\t\tvar container = this._container = L.DomUtil.get(id);\r\n\r\n\t\tif (!container) {\r\n\t\t\tthrow new Error('Map container not found.');\r\n\t\t} else if (container._leaflet) {\r\n\t\t\tthrow new Error('Map container is already initialized.');\r\n\t\t}\r\n\r\n\t\tcontainer._leaflet = true;\r\n\t},\r\n\r\n\t_initLayout: function () {\r\n\t\tvar container = this._container;\r\n\r\n\t\tL.DomUtil.addClass(container, 'leaflet-container' +\r\n\t\t\t(L.Browser.touch ? ' leaflet-touch' : '') +\r\n\t\t\t(L.Browser.retina ? ' leaflet-retina' : '') +\r\n\t\t\t(L.Browser.ielt9 ? ' leaflet-oldie' : '') +\r\n\t\t\t(this.options.fadeAnimation ? ' leaflet-fade-anim' : ''));\r\n\r\n\t\tvar position = L.DomUtil.getStyle(container, 'position');\r\n\r\n\t\tif (position !== 'absolute' && position !== 'relative' && position !== 'fixed') {\r\n\t\t\tcontainer.style.position = 'relative';\r\n\t\t}\r\n\r\n\t\tthis._initPanes();\r\n\r\n\t\tif (this._initControlPos) {\r\n\t\t\tthis._initControlPos();\r\n\t\t}\r\n\t},\r\n\r\n\t_initPanes: function () {\r\n\t\tvar panes = this._panes = {};\r\n\r\n\t\tthis._mapPane = panes.mapPane = this._createPane('leaflet-map-pane', this._container);\r\n\r\n\t\tthis._tilePane = panes.tilePane = this._createPane('leaflet-tile-pane', this._mapPane);\r\n\t\tpanes.objectsPane = this._createPane('leaflet-objects-pane', this._mapPane);\r\n\t\tpanes.shadowPane = this._createPane('leaflet-shadow-pane');\r\n\t\tpanes.overlayPane = this._createPane('leaflet-overlay-pane');\r\n\t\tpanes.markerPane = this._createPane('leaflet-marker-pane');\r\n\t\tpanes.popupPane = this._createPane('leaflet-popup-pane');\r\n\r\n\t\tvar zoomHide = ' leaflet-zoom-hide';\r\n\r\n\t\tif (!this.options.markerZoomAnimation) {\r\n\t\t\tL.DomUtil.addClass(panes.markerPane, zoomHide);\r\n\t\t\tL.DomUtil.addClass(panes.shadowPane, zoomHide);\r\n\t\t\tL.DomUtil.addClass(panes.popupPane, zoomHide);\r\n\t\t}\r\n\t},\r\n\r\n\t_createPane: function (className, container) {\r\n\t\treturn L.DomUtil.create('div', className, container || this._panes.objectsPane);\r\n\t},\r\n\r\n\t_clearPanes: function () {\r\n\t\tthis._container.removeChild(this._mapPane);\r\n\t},\r\n\r\n\t_addLayers: function (layers) {\r\n\t\tlayers = layers ? (L.Util.isArray(layers) ? layers : [layers]) : [];\r\n\r\n\t\tfor (var i = 0, len = layers.length; i < len; i++) {\r\n\t\t\tthis.addLayer(layers[i]);\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// private methods that modify map state\r\n\r\n\t_resetView: function (center, zoom, preserveMapOffset, afterZoomAnim) {\r\n\r\n\t\tvar zoomChanged = (this._zoom !== zoom);\r\n\r\n\t\tif (!afterZoomAnim) {\r\n\t\t\tthis.fire('movestart');\r\n\r\n\t\t\tif (zoomChanged) {\r\n\t\t\t\tthis.fire('zoomstart');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._zoom = zoom;\r\n\t\tthis._initialCenter = center;\r\n\r\n\t\tthis._initialTopLeftPoint = this._getNewTopLeftPoint(center);\r\n\r\n\t\tif (!preserveMapOffset) {\r\n\t\t\tL.DomUtil.setPosition(this._mapPane, new L.Point(0, 0));\r\n\t\t} else {\r\n\t\t\tthis._initialTopLeftPoint._add(this._getMapPanePos());\r\n\t\t}\r\n\r\n\t\tthis._tileLayersToLoad = this._tileLayersNum;\r\n\r\n\t\tvar loading = !this._loaded;\r\n\t\tthis._loaded = true;\r\n\r\n\t\tthis.fire('viewreset', {hard: !preserveMapOffset});\r\n\r\n\t\tif (loading) {\r\n\t\t\tthis.fire('load');\r\n\t\t\tthis.eachLayer(this._layerAdd, this);\r\n\t\t}\r\n\r\n\t\tthis.fire('move');\r\n\r\n\t\tif (zoomChanged || afterZoomAnim) {\r\n\t\t\tthis.fire('zoomend');\r\n\t\t}\r\n\r\n\t\tthis.fire('moveend', {hard: !preserveMapOffset});\r\n\t},\r\n\r\n\t_rawPanBy: function (offset) {\r\n\t\tL.DomUtil.setPosition(this._mapPane, this._getMapPanePos().subtract(offset));\r\n\t},\r\n\r\n\t_getZoomSpan: function () {\r\n\t\treturn this.getMaxZoom() - this.getMinZoom();\r\n\t},\r\n\r\n\t_updateZoomLevels: function () {\r\n\t\tvar i,\r\n\t\t\tminZoom = Infinity,\r\n\t\t\tmaxZoom = -Infinity,\r\n\t\t\toldZoomSpan = this._getZoomSpan();\r\n\r\n\t\tfor (i in this._zoomBoundLayers) {\r\n\t\t\tvar layer = this._zoomBoundLayers[i];\r\n\t\t\tif (!isNaN(layer.options.minZoom)) {\r\n\t\t\t\tminZoom = Math.min(minZoom, layer.options.minZoom);\r\n\t\t\t}\r\n\t\t\tif (!isNaN(layer.options.maxZoom)) {\r\n\t\t\t\tmaxZoom = Math.max(maxZoom, layer.options.maxZoom);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (i === undefined) { // we have no tilelayers\r\n\t\t\tthis._layersMaxZoom = this._layersMinZoom = undefined;\r\n\t\t} else {\r\n\t\t\tthis._layersMaxZoom = maxZoom;\r\n\t\t\tthis._layersMinZoom = minZoom;\r\n\t\t}\r\n\r\n\t\tif (oldZoomSpan !== this._getZoomSpan()) {\r\n\t\t\tthis.fire('zoomlevelschange');\r\n\t\t}\r\n\t},\r\n\r\n\t_panInsideMaxBounds: function () {\r\n\t\tthis.panInsideBounds(this.options.maxBounds);\r\n\t},\r\n\r\n\t_checkIfLoaded: function () {\r\n\t\tif (!this._loaded) {\r\n\t\t\tthrow new Error('Set map center and zoom first.');\r\n\t\t}\r\n\t},\r\n\r\n\t// map events\r\n\r\n\t_initEvents: function (onOff) {\r\n\t\tif (!L.DomEvent) { return; }\r\n\r\n\t\tonOff = onOff || 'on';\r\n\r\n\t\tL.DomEvent[onOff](this._container, 'click', this._onMouseClick, this);\r\n\r\n\t\tvar events = ['dblclick', 'mousedown', 'mouseup', 'mouseenter',\r\n\t\t              'mouseleave', 'mousemove', 'contextmenu'],\r\n\t\t    i, len;\r\n\r\n\t\tfor (i = 0, len = events.length; i < len; i++) {\r\n\t\t\tL.DomEvent[onOff](this._container, events[i], this._fireMouseEvent, this);\r\n\t\t}\r\n\r\n\t\tif (this.options.trackResize) {\r\n\t\t\tL.DomEvent[onOff](window, 'resize', this._onResize, this);\r\n\t\t}\r\n\t},\r\n\r\n\t_onResize: function () {\r\n\t\tL.Util.cancelAnimFrame(this._resizeRequest);\r\n\t\tthis._resizeRequest = L.Util.requestAnimFrame(\r\n\t\t        function () { this.invalidateSize({debounceMoveend: true}); }, this, false, this._container);\r\n\t},\r\n\r\n\t_onMouseClick: function (e) {\r\n\t\tif (!this._loaded || (!e._simulated &&\r\n\t\t        ((this.dragging && this.dragging.moved()) ||\r\n\t\t         (this.boxZoom  && this.boxZoom.moved()))) ||\r\n\t\t            L.DomEvent._skipped(e)) { return; }\r\n\r\n\t\tthis.fire('preclick');\r\n\t\tthis._fireMouseEvent(e);\r\n\t},\r\n\r\n\t_fireMouseEvent: function (e) {\r\n\t\tif (!this._loaded || L.DomEvent._skipped(e)) { return; }\r\n\r\n\t\tvar type = e.type;\r\n\r\n\t\ttype = (type === 'mouseenter' ? 'mouseover' : (type === 'mouseleave' ? 'mouseout' : type));\r\n\r\n\t\tif (!this.hasEventListeners(type)) { return; }\r\n\r\n\t\tif (type === 'contextmenu') {\r\n\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t}\r\n\r\n\t\tvar containerPoint = this.mouseEventToContainerPoint(e),\r\n\t\t    layerPoint = this.containerPointToLayerPoint(containerPoint),\r\n\t\t    latlng = this.layerPointToLatLng(layerPoint);\r\n\r\n\t\tthis.fire(type, {\r\n\t\t\tlatlng: latlng,\r\n\t\t\tlayerPoint: layerPoint,\r\n\t\t\tcontainerPoint: containerPoint,\r\n\t\t\toriginalEvent: e\r\n\t\t});\r\n\t},\r\n\r\n\t_onTileLayerLoad: function () {\r\n\t\tthis._tileLayersToLoad--;\r\n\t\tif (this._tileLayersNum && !this._tileLayersToLoad) {\r\n\t\t\tthis.fire('tilelayersload');\r\n\t\t}\r\n\t},\r\n\r\n\t_clearHandlers: function () {\r\n\t\tfor (var i = 0, len = this._handlers.length; i < len; i++) {\r\n\t\t\tthis._handlers[i].disable();\r\n\t\t}\r\n\t},\r\n\r\n\twhenReady: function (callback, context) {\r\n\t\tif (this._loaded) {\r\n\t\t\tcallback.call(context || this, this);\r\n\t\t} else {\r\n\t\t\tthis.on('load', callback, context);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_layerAdd: function (layer) {\r\n\t\tlayer.onAdd(this);\r\n\t\tthis.fire('layeradd', {layer: layer});\r\n\t},\r\n\r\n\r\n\t// private methods for getting map state\r\n\r\n\t_getMapPanePos: function () {\r\n\t\treturn L.DomUtil.getPosition(this._mapPane);\r\n\t},\r\n\r\n\t_moved: function () {\r\n\t\tvar pos = this._getMapPanePos();\r\n\t\treturn pos && !pos.equals([0, 0]);\r\n\t},\r\n\r\n\t_getTopLeftPoint: function () {\r\n\t\treturn this.getPixelOrigin().subtract(this._getMapPanePos());\r\n\t},\r\n\r\n\t_getNewTopLeftPoint: function (center, zoom) {\r\n\t\tvar viewHalf = this.getSize()._divideBy(2);\r\n\t\t// TODO round on display, not calculation to increase precision?\r\n\t\treturn this.project(center, zoom)._subtract(viewHalf)._round();\r\n\t},\r\n\r\n\t_latLngToNewLayerPoint: function (latlng, newZoom, newCenter) {\r\n\t\tvar topLeft = this._getNewTopLeftPoint(newCenter, newZoom).add(this._getMapPanePos());\r\n\t\treturn this.project(latlng, newZoom)._subtract(topLeft);\r\n\t},\r\n\r\n\t// layer point of the current center\r\n\t_getCenterLayerPoint: function () {\r\n\t\treturn this.containerPointToLayerPoint(this.getSize()._divideBy(2));\r\n\t},\r\n\r\n\t// offset of the specified place to the current center in pixels\r\n\t_getCenterOffset: function (latlng) {\r\n\t\treturn this.latLngToLayerPoint(latlng).subtract(this._getCenterLayerPoint());\r\n\t},\r\n\r\n\t// adjust center for view to get inside bounds\r\n\t_limitCenter: function (center, zoom, bounds) {\r\n\r\n\t\tif (!bounds) { return center; }\r\n\r\n\t\tvar centerPoint = this.project(center, zoom),\r\n\t\t    viewHalf = this.getSize().divideBy(2),\r\n\t\t    viewBounds = new L.Bounds(centerPoint.subtract(viewHalf), centerPoint.add(viewHalf)),\r\n\t\t    offset = this._getBoundsOffset(viewBounds, bounds, zoom);\r\n\r\n\t\treturn this.unproject(centerPoint.add(offset), zoom);\r\n\t},\r\n\r\n\t// adjust offset for view to get inside bounds\r\n\t_limitOffset: function (offset, bounds) {\r\n\t\tif (!bounds) { return offset; }\r\n\r\n\t\tvar viewBounds = this.getPixelBounds(),\r\n\t\t    newBounds = new L.Bounds(viewBounds.min.add(offset), viewBounds.max.add(offset));\r\n\r\n\t\treturn offset.add(this._getBoundsOffset(newBounds, bounds));\r\n\t},\r\n\r\n\t// returns offset needed for pxBounds to get inside maxBounds at a specified zoom\r\n\t_getBoundsOffset: function (pxBounds, maxBounds, zoom) {\r\n\t\tvar nwOffset = this.project(maxBounds.getNorthWest(), zoom).subtract(pxBounds.min),\r\n\t\t    seOffset = this.project(maxBounds.getSouthEast(), zoom).subtract(pxBounds.max),\r\n\r\n\t\t    dx = this._rebound(nwOffset.x, -seOffset.x),\r\n\t\t    dy = this._rebound(nwOffset.y, -seOffset.y);\r\n\r\n\t\treturn new L.Point(dx, dy);\r\n\t},\r\n\r\n\t_rebound: function (left, right) {\r\n\t\treturn left + right > 0 ?\r\n\t\t\tMath.round(left - right) / 2 :\r\n\t\t\tMath.max(0, Math.ceil(left)) - Math.max(0, Math.floor(right));\r\n\t},\r\n\r\n\t_limitZoom: function (zoom) {\r\n\t\tvar min = this.getMinZoom(),\r\n\t\t    max = this.getMaxZoom();\r\n\r\n\t\treturn Math.max(min, Math.min(max, zoom));\r\n\t}\r\n});\r\n\r\nL.map = function (id, options) {\r\n\treturn new L.Map(id, options);\r\n};\r\n\n\n/*\r\n * Mercator projection that takes into account that the Earth is not a perfect sphere.\r\n * Less popular than spherical mercator; used by projections like EPSG:3395.\r\n */\r\n\r\nL.Projection.Mercator = {\r\n\tMAX_LATITUDE: 85.0840591556,\r\n\r\n\tR_MINOR: 6356752.314245179,\r\n\tR_MAJOR: 6378137,\r\n\r\n\tproject: function (latlng) { // (LatLng) -> Point\r\n\t\tvar d = L.LatLng.DEG_TO_RAD,\r\n\t\t    max = this.MAX_LATITUDE,\r\n\t\t    lat = Math.max(Math.min(max, latlng.lat), -max),\r\n\t\t    r = this.R_MAJOR,\r\n\t\t    r2 = this.R_MINOR,\r\n\t\t    x = latlng.lng * d * r,\r\n\t\t    y = lat * d,\r\n\t\t    tmp = r2 / r,\r\n\t\t    eccent = Math.sqrt(1.0 - tmp * tmp),\r\n\t\t    con = eccent * Math.sin(y);\r\n\r\n\t\tcon = Math.pow((1 - con) / (1 + con), eccent * 0.5);\r\n\r\n\t\tvar ts = Math.tan(0.5 * ((Math.PI * 0.5) - y)) / con;\r\n\t\ty = -r * Math.log(ts);\r\n\r\n\t\treturn new L.Point(x, y);\r\n\t},\r\n\r\n\tunproject: function (point) { // (Point, Boolean) -> LatLng\r\n\t\tvar d = L.LatLng.RAD_TO_DEG,\r\n\t\t    r = this.R_MAJOR,\r\n\t\t    r2 = this.R_MINOR,\r\n\t\t    lng = point.x * d / r,\r\n\t\t    tmp = r2 / r,\r\n\t\t    eccent = Math.sqrt(1 - (tmp * tmp)),\r\n\t\t    ts = Math.exp(- point.y / r),\r\n\t\t    phi = (Math.PI / 2) - 2 * Math.atan(ts),\r\n\t\t    numIter = 15,\r\n\t\t    tol = 1e-7,\r\n\t\t    i = numIter,\r\n\t\t    dphi = 0.1,\r\n\t\t    con;\r\n\r\n\t\twhile ((Math.abs(dphi) > tol) && (--i > 0)) {\r\n\t\t\tcon = eccent * Math.sin(phi);\r\n\t\t\tdphi = (Math.PI / 2) - 2 * Math.atan(ts *\r\n\t\t\t            Math.pow((1.0 - con) / (1.0 + con), 0.5 * eccent)) - phi;\r\n\t\t\tphi += dphi;\r\n\t\t}\r\n\r\n\t\treturn new L.LatLng(phi * d, lng);\r\n\t}\r\n};\r\n\n\n\r\nL.CRS.EPSG3395 = L.extend({}, L.CRS, {\r\n\tcode: 'EPSG:3395',\r\n\r\n\tprojection: L.Projection.Mercator,\r\n\r\n\ttransformation: (function () {\r\n\t\tvar m = L.Projection.Mercator,\r\n\t\t    r = m.R_MAJOR,\r\n\t\t    scale = 0.5 / (Math.PI * r);\r\n\r\n\t\treturn new L.Transformation(scale, 0.5, -scale, 0.5);\r\n\t}())\r\n});\r\n\n\n/*\r\n * L.TileLayer is used for standard xyz-numbered tile layers.\r\n */\r\n\r\nL.TileLayer = L.Class.extend({\r\n\tincludes: L.Mixin.Events,\r\n\r\n\toptions: {\r\n\t\tminZoom: 0,\r\n\t\tmaxZoom: 18,\r\n\t\ttileSize: 256,\r\n\t\tsubdomains: 'abc',\r\n\t\terrorTileUrl: '',\r\n\t\tattribution: '',\r\n\t\tzoomOffset: 0,\r\n\t\topacity: 1,\r\n\t\t/*\r\n\t\tmaxNativeZoom: null,\r\n\t\tzIndex: null,\r\n\t\ttms: false,\r\n\t\tcontinuousWorld: false,\r\n\t\tnoWrap: false,\r\n\t\tzoomReverse: false,\r\n\t\tdetectRetina: false,\r\n\t\treuseTiles: false,\r\n\t\tbounds: false,\r\n\t\t*/\r\n\t\tunloadInvisibleTiles: L.Browser.mobile,\r\n\t\tupdateWhenIdle: L.Browser.mobile\r\n\t},\r\n\r\n\tinitialize: function (url, options) {\r\n\t\toptions = L.setOptions(this, options);\r\n\r\n\t\t// detecting retina displays, adjusting tileSize and zoom levels\r\n\t\tif (options.detectRetina && L.Browser.retina && options.maxZoom > 0) {\r\n\r\n\t\t\toptions.tileSize = Math.floor(options.tileSize / 2);\r\n\t\t\toptions.zoomOffset++;\r\n\r\n\t\t\tif (options.minZoom > 0) {\r\n\t\t\t\toptions.minZoom--;\r\n\t\t\t}\r\n\t\t\tthis.options.maxZoom--;\r\n\t\t}\r\n\r\n\t\tif (options.bounds) {\r\n\t\t\toptions.bounds = L.latLngBounds(options.bounds);\r\n\t\t}\r\n\r\n\t\tthis._url = url;\r\n\r\n\t\tvar subdomains = this.options.subdomains;\r\n\r\n\t\tif (typeof subdomains === 'string') {\r\n\t\t\tthis.options.subdomains = subdomains.split('');\r\n\t\t}\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\t\tthis._animated = map._zoomAnimated;\r\n\r\n\t\t// create a container div for tiles\r\n\t\tthis._initContainer();\r\n\r\n\t\t// set up events\r\n\t\tmap.on({\r\n\t\t\t'viewreset': this._reset,\r\n\t\t\t'moveend': this._update\r\n\t\t}, this);\r\n\r\n\t\tif (this._animated) {\r\n\t\t\tmap.on({\r\n\t\t\t\t'zoomanim': this._animateZoom,\r\n\t\t\t\t'zoomend': this._endZoomAnim\r\n\t\t\t}, this);\r\n\t\t}\r\n\r\n\t\tif (!this.options.updateWhenIdle) {\r\n\t\t\tthis._limitedUpdate = L.Util.limitExecByInterval(this._update, 150, this);\r\n\t\t\tmap.on('move', this._limitedUpdate, this);\r\n\t\t}\r\n\r\n\t\tthis._reset();\r\n\t\tthis._update();\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tmap.addLayer(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tthis._container.parentNode.removeChild(this._container);\r\n\r\n\t\tmap.off({\r\n\t\t\t'viewreset': this._reset,\r\n\t\t\t'moveend': this._update\r\n\t\t}, this);\r\n\r\n\t\tif (this._animated) {\r\n\t\t\tmap.off({\r\n\t\t\t\t'zoomanim': this._animateZoom,\r\n\t\t\t\t'zoomend': this._endZoomAnim\r\n\t\t\t}, this);\r\n\t\t}\r\n\r\n\t\tif (!this.options.updateWhenIdle) {\r\n\t\t\tmap.off('move', this._limitedUpdate, this);\r\n\t\t}\r\n\r\n\t\tthis._container = null;\r\n\t\tthis._map = null;\r\n\t},\r\n\r\n\tbringToFront: function () {\r\n\t\tvar pane = this._map._panes.tilePane;\r\n\r\n\t\tif (this._container) {\r\n\t\t\tpane.appendChild(this._container);\r\n\t\t\tthis._setAutoZIndex(pane, Math.max);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tbringToBack: function () {\r\n\t\tvar pane = this._map._panes.tilePane;\r\n\r\n\t\tif (this._container) {\r\n\t\t\tpane.insertBefore(this._container, pane.firstChild);\r\n\t\t\tthis._setAutoZIndex(pane, Math.min);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetAttribution: function () {\r\n\t\treturn this.options.attribution;\r\n\t},\r\n\r\n\tgetContainer: function () {\r\n\t\treturn this._container;\r\n\t},\r\n\r\n\tsetOpacity: function (opacity) {\r\n\t\tthis.options.opacity = opacity;\r\n\r\n\t\tif (this._map) {\r\n\t\t\tthis._updateOpacity();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetZIndex: function (zIndex) {\r\n\t\tthis.options.zIndex = zIndex;\r\n\t\tthis._updateZIndex();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetUrl: function (url, noRedraw) {\r\n\t\tthis._url = url;\r\n\r\n\t\tif (!noRedraw) {\r\n\t\t\tthis.redraw();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tredraw: function () {\r\n\t\tif (this._map) {\r\n\t\t\tthis._reset({hard: true});\r\n\t\t\tthis._update();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_updateZIndex: function () {\r\n\t\tif (this._container && this.options.zIndex !== undefined) {\r\n\t\t\tthis._container.style.zIndex = this.options.zIndex;\r\n\t\t}\r\n\t},\r\n\r\n\t_setAutoZIndex: function (pane, compare) {\r\n\r\n\t\tvar layers = pane.children,\r\n\t\t    edgeZIndex = -compare(Infinity, -Infinity), // -Infinity for max, Infinity for min\r\n\t\t    zIndex, i, len;\r\n\r\n\t\tfor (i = 0, len = layers.length; i < len; i++) {\r\n\r\n\t\t\tif (layers[i] !== this._container) {\r\n\t\t\t\tzIndex = parseInt(layers[i].style.zIndex, 10);\r\n\r\n\t\t\t\tif (!isNaN(zIndex)) {\r\n\t\t\t\t\tedgeZIndex = compare(edgeZIndex, zIndex);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.options.zIndex = this._container.style.zIndex =\r\n\t\t        (isFinite(edgeZIndex) ? edgeZIndex : 0) + compare(1, -1);\r\n\t},\r\n\r\n\t_updateOpacity: function () {\r\n\t\tvar i,\r\n\t\t    tiles = this._tiles;\r\n\r\n\t\tif (L.Browser.ielt9) {\r\n\t\t\tfor (i in tiles) {\r\n\t\t\t\tL.DomUtil.setOpacity(tiles[i], this.options.opacity);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tL.DomUtil.setOpacity(this._container, this.options.opacity);\r\n\t\t}\r\n\t},\r\n\r\n\t_initContainer: function () {\r\n\t\tvar tilePane = this._map._panes.tilePane;\r\n\r\n\t\tif (!this._container) {\r\n\t\t\tthis._container = L.DomUtil.create('div', 'leaflet-layer');\r\n\r\n\t\t\tthis._updateZIndex();\r\n\r\n\t\t\tif (this._animated) {\r\n\t\t\t\tvar className = 'leaflet-tile-container';\r\n\r\n\t\t\t\tthis._bgBuffer = L.DomUtil.create('div', className, this._container);\r\n\t\t\t\tthis._tileContainer = L.DomUtil.create('div', className, this._container);\r\n\r\n\t\t\t} else {\r\n\t\t\t\tthis._tileContainer = this._container;\r\n\t\t\t}\r\n\r\n\t\t\ttilePane.appendChild(this._container);\r\n\r\n\t\t\tif (this.options.opacity < 1) {\r\n\t\t\t\tthis._updateOpacity();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_reset: function (e) {\r\n\t\tfor (var key in this._tiles) {\r\n\t\t\tthis.fire('tileunload', {tile: this._tiles[key]});\r\n\t\t}\r\n\r\n\t\tthis._tiles = {};\r\n\t\tthis._tilesToLoad = 0;\r\n\r\n\t\tif (this.options.reuseTiles) {\r\n\t\t\tthis._unusedTiles = [];\r\n\t\t}\r\n\r\n\t\tthis._tileContainer.innerHTML = '';\r\n\r\n\t\tif (this._animated && e && e.hard) {\r\n\t\t\tthis._clearBgBuffer();\r\n\t\t}\r\n\r\n\t\tthis._initContainer();\r\n\t},\r\n\r\n\t_getTileSize: function () {\r\n\t\tvar map = this._map,\r\n\t\t    zoom = map.getZoom() + this.options.zoomOffset,\r\n\t\t    zoomN = this.options.maxNativeZoom,\r\n\t\t    tileSize = this.options.tileSize;\r\n\r\n\t\tif (zoomN && zoom > zoomN) {\r\n\t\t\ttileSize = Math.round(map.getZoomScale(zoom) / map.getZoomScale(zoomN) * tileSize);\r\n\t\t}\r\n\r\n\t\treturn tileSize;\r\n\t},\r\n\r\n\t_update: function () {\r\n\r\n\t\tif (!this._map) { return; }\r\n\r\n\t\tvar map = this._map,\r\n\t\t    bounds = map.getPixelBounds(),\r\n\t\t    zoom = map.getZoom(),\r\n\t\t    tileSize = this._getTileSize();\r\n\r\n\t\tif (zoom > this.options.maxZoom || zoom < this.options.minZoom) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar tileBounds = L.bounds(\r\n\t\t        bounds.min.divideBy(tileSize)._floor(),\r\n\t\t        bounds.max.divideBy(tileSize)._floor());\r\n\r\n\t\tthis._addTilesFromCenterOut(tileBounds);\r\n\r\n\t\tif (this.options.unloadInvisibleTiles || this.options.reuseTiles) {\r\n\t\t\tthis._removeOtherTiles(tileBounds);\r\n\t\t}\r\n\t},\r\n\r\n\t_addTilesFromCenterOut: function (bounds) {\r\n\t\tvar queue = [],\r\n\t\t    center = bounds.getCenter();\r\n\r\n\t\tvar j, i, point;\r\n\r\n\t\tfor (j = bounds.min.y; j <= bounds.max.y; j++) {\r\n\t\t\tfor (i = bounds.min.x; i <= bounds.max.x; i++) {\r\n\t\t\t\tpoint = new L.Point(i, j);\r\n\r\n\t\t\t\tif (this._tileShouldBeLoaded(point)) {\r\n\t\t\t\t\tqueue.push(point);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar tilesToLoad = queue.length;\r\n\r\n\t\tif (tilesToLoad === 0) { return; }\r\n\r\n\t\t// load tiles in order of their distance to center\r\n\t\tqueue.sort(function (a, b) {\r\n\t\t\treturn a.distanceTo(center) - b.distanceTo(center);\r\n\t\t});\r\n\r\n\t\tvar fragment = document.createDocumentFragment();\r\n\r\n\t\t// if its the first batch of tiles to load\r\n\t\tif (!this._tilesToLoad) {\r\n\t\t\tthis.fire('loading');\r\n\t\t}\r\n\r\n\t\tthis._tilesToLoad += tilesToLoad;\r\n\r\n\t\tfor (i = 0; i < tilesToLoad; i++) {\r\n\t\t\tthis._addTile(queue[i], fragment);\r\n\t\t}\r\n\r\n\t\tthis._tileContainer.appendChild(fragment);\r\n\t},\r\n\r\n\t_tileShouldBeLoaded: function (tilePoint) {\r\n\t\tif ((tilePoint.x + ':' + tilePoint.y) in this._tiles) {\r\n\t\t\treturn false; // already loaded\r\n\t\t}\r\n\r\n\t\tvar options = this.options;\r\n\r\n\t\tif (!options.continuousWorld) {\r\n\t\t\tvar limit = this._getWrapTileNum();\r\n\r\n\t\t\t// don't load if exceeds world bounds\r\n\t\t\tif ((options.noWrap && (tilePoint.x < 0 || tilePoint.x >= limit.x)) ||\r\n\t\t\t\ttilePoint.y < 0 || tilePoint.y >= limit.y) { return false; }\r\n\t\t}\r\n\r\n\t\tif (options.bounds) {\r\n\t\t\tvar tileSize = options.tileSize,\r\n\t\t\t    nwPoint = tilePoint.multiplyBy(tileSize),\r\n\t\t\t    sePoint = nwPoint.add([tileSize, tileSize]),\r\n\t\t\t    nw = this._map.unproject(nwPoint),\r\n\t\t\t    se = this._map.unproject(sePoint);\r\n\r\n\t\t\t// TODO temporary hack, will be removed after refactoring projections\r\n\t\t\t// https://github.com/Leaflet/Leaflet/issues/1618\r\n\t\t\tif (!options.continuousWorld && !options.noWrap) {\r\n\t\t\t\tnw = nw.wrap();\r\n\t\t\t\tse = se.wrap();\r\n\t\t\t}\r\n\r\n\t\t\tif (!options.bounds.intersects([nw, se])) { return false; }\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\t_removeOtherTiles: function (bounds) {\r\n\t\tvar kArr, x, y, key;\r\n\r\n\t\tfor (key in this._tiles) {\r\n\t\t\tkArr = key.split(':');\r\n\t\t\tx = parseInt(kArr[0], 10);\r\n\t\t\ty = parseInt(kArr[1], 10);\r\n\r\n\t\t\t// remove tile if it's out of bounds\r\n\t\t\tif (x < bounds.min.x || x > bounds.max.x || y < bounds.min.y || y > bounds.max.y) {\r\n\t\t\t\tthis._removeTile(key);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_removeTile: function (key) {\r\n\t\tvar tile = this._tiles[key];\r\n\r\n\t\tthis.fire('tileunload', {tile: tile, url: tile.src});\r\n\r\n\t\tif (this.options.reuseTiles) {\r\n\t\t\tL.DomUtil.removeClass(tile, 'leaflet-tile-loaded');\r\n\t\t\tthis._unusedTiles.push(tile);\r\n\r\n\t\t} else if (tile.parentNode === this._tileContainer) {\r\n\t\t\tthis._tileContainer.removeChild(tile);\r\n\t\t}\r\n\r\n\t\t// for https://github.com/CloudMade/Leaflet/issues/137\r\n\t\tif (!L.Browser.android) {\r\n\t\t\ttile.onload = null;\r\n\t\t\ttile.src = L.Util.emptyImageUrl;\r\n\t\t}\r\n\r\n\t\tdelete this._tiles[key];\r\n\t},\r\n\r\n\t_addTile: function (tilePoint, container) {\r\n\t\tvar tilePos = this._getTilePos(tilePoint);\r\n\r\n\t\t// get unused tile - or create a new tile\r\n\t\tvar tile = this._getTile();\r\n\r\n\t\t/*\r\n\t\tChrome 20 layouts much faster with top/left (verify with timeline, frames)\r\n\t\tAndroid 4 browser has display issues with top/left and requires transform instead\r\n\t\t(other browsers don't currently care) - see debug/hacks/jitter.html for an example\r\n\t\t*/\r\n\t\tL.DomUtil.setPosition(tile, tilePos, L.Browser.chrome);\r\n\r\n\t\tthis._tiles[tilePoint.x + ':' + tilePoint.y] = tile;\r\n\r\n\t\tthis._loadTile(tile, tilePoint);\r\n\r\n\t\tif (tile.parentNode !== this._tileContainer) {\r\n\t\t\tcontainer.appendChild(tile);\r\n\t\t}\r\n\t},\r\n\r\n\t_getZoomForUrl: function () {\r\n\r\n\t\tvar options = this.options,\r\n\t\t    zoom = this._map.getZoom();\r\n\r\n\t\tif (options.zoomReverse) {\r\n\t\t\tzoom = options.maxZoom - zoom;\r\n\t\t}\r\n\r\n\t\tzoom += options.zoomOffset;\r\n\r\n\t\treturn options.maxNativeZoom ? Math.min(zoom, options.maxNativeZoom) : zoom;\r\n\t},\r\n\r\n\t_getTilePos: function (tilePoint) {\r\n\t\tvar origin = this._map.getPixelOrigin(),\r\n\t\t    tileSize = this._getTileSize();\r\n\r\n\t\treturn tilePoint.multiplyBy(tileSize).subtract(origin);\r\n\t},\r\n\r\n\t// image-specific code (override to implement e.g. Canvas or SVG tile layer)\r\n\r\n\tgetTileUrl: function (tilePoint) {\r\n\t\treturn L.Util.template(this._url, L.extend({\r\n\t\t\ts: this._getSubdomain(tilePoint),\r\n\t\t\tz: tilePoint.z,\r\n\t\t\tx: tilePoint.x,\r\n\t\t\ty: tilePoint.y\r\n\t\t}, this.options));\r\n\t},\r\n\r\n\t_getWrapTileNum: function () {\r\n\t\tvar crs = this._map.options.crs,\r\n\t\t    size = crs.getSize(this._map.getZoom());\r\n\t\treturn size.divideBy(this._getTileSize())._floor();\r\n\t},\r\n\r\n\t_adjustTilePoint: function (tilePoint) {\r\n\r\n\t\tvar limit = this._getWrapTileNum();\r\n\r\n\t\t// wrap tile coordinates\r\n\t\tif (!this.options.continuousWorld && !this.options.noWrap) {\r\n\t\t\ttilePoint.x = ((tilePoint.x % limit.x) + limit.x) % limit.x;\r\n\t\t}\r\n\r\n\t\tif (this.options.tms) {\r\n\t\t\ttilePoint.y = limit.y - tilePoint.y - 1;\r\n\t\t}\r\n\r\n\t\ttilePoint.z = this._getZoomForUrl();\r\n\t},\r\n\r\n\t_getSubdomain: function (tilePoint) {\r\n\t\tvar index = Math.abs(tilePoint.x + tilePoint.y) % this.options.subdomains.length;\r\n\t\treturn this.options.subdomains[index];\r\n\t},\r\n\r\n\t_getTile: function () {\r\n\t\tif (this.options.reuseTiles && this._unusedTiles.length > 0) {\r\n\t\t\tvar tile = this._unusedTiles.pop();\r\n\t\t\tthis._resetTile(tile);\r\n\t\t\treturn tile;\r\n\t\t}\r\n\t\treturn this._createTile();\r\n\t},\r\n\r\n\t// Override if data stored on a tile needs to be cleaned up before reuse\r\n\t_resetTile: function (/*tile*/) {},\r\n\r\n\t_createTile: function () {\r\n\t\tvar tile = L.DomUtil.create('img', 'leaflet-tile');\r\n\t\ttile.style.width = tile.style.height = this._getTileSize() + 'px';\r\n\t\ttile.galleryimg = 'no';\r\n\r\n\t\ttile.onselectstart = tile.onmousemove = L.Util.falseFn;\r\n\r\n\t\tif (L.Browser.ielt9 && this.options.opacity !== undefined) {\r\n\t\t\tL.DomUtil.setOpacity(tile, this.options.opacity);\r\n\t\t}\r\n\t\t// without this hack, tiles disappear after zoom on Chrome for Android\r\n\t\t// https://github.com/Leaflet/Leaflet/issues/2078\r\n\t\tif (L.Browser.mobileWebkit3d) {\r\n\t\t\ttile.style.WebkitBackfaceVisibility = 'hidden';\r\n\t\t}\r\n\t\treturn tile;\r\n\t},\r\n\r\n\t_loadTile: function (tile, tilePoint) {\r\n\t\ttile._layer  = this;\r\n\t\ttile.onload  = this._tileOnLoad;\r\n\t\ttile.onerror = this._tileOnError;\r\n\r\n\t\tthis._adjustTilePoint(tilePoint);\r\n\t\ttile.src     = this.getTileUrl(tilePoint);\r\n\r\n\t\tthis.fire('tileloadstart', {\r\n\t\t\ttile: tile,\r\n\t\t\turl: tile.src\r\n\t\t});\r\n\t},\r\n\r\n\t_tileLoaded: function () {\r\n\t\tthis._tilesToLoad--;\r\n\r\n\t\tif (this._animated) {\r\n\t\t\tL.DomUtil.addClass(this._tileContainer, 'leaflet-zoom-animated');\r\n\t\t}\r\n\r\n\t\tif (!this._tilesToLoad) {\r\n\t\t\tthis.fire('load');\r\n\r\n\t\t\tif (this._animated) {\r\n\t\t\t\t// clear scaled tiles after all new tiles are loaded (for performance)\r\n\t\t\t\tclearTimeout(this._clearBgBufferTimer);\r\n\t\t\t\tthis._clearBgBufferTimer = setTimeout(L.bind(this._clearBgBuffer, this), 500);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_tileOnLoad: function () {\r\n\t\tvar layer = this._layer;\r\n\r\n\t\t//Only if we are loading an actual image\r\n\t\tif (this.src !== L.Util.emptyImageUrl) {\r\n\t\t\tL.DomUtil.addClass(this, 'leaflet-tile-loaded');\r\n\r\n\t\t\tlayer.fire('tileload', {\r\n\t\t\t\ttile: this,\r\n\t\t\t\turl: this.src\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tlayer._tileLoaded();\r\n\t},\r\n\r\n\t_tileOnError: function () {\r\n\t\tvar layer = this._layer;\r\n\r\n\t\tlayer.fire('tileerror', {\r\n\t\t\ttile: this,\r\n\t\t\turl: this.src\r\n\t\t});\r\n\r\n\t\tvar newUrl = layer.options.errorTileUrl;\r\n\t\tif (newUrl) {\r\n\t\t\tthis.src = newUrl;\r\n\t\t}\r\n\r\n\t\tlayer._tileLoaded();\r\n\t}\r\n});\r\n\r\nL.tileLayer = function (url, options) {\r\n\treturn new L.TileLayer(url, options);\r\n};\r\n\n\n/*\r\n * L.TileLayer.WMS is used for putting WMS tile layers on the map.\r\n */\r\n\r\nL.TileLayer.WMS = L.TileLayer.extend({\r\n\r\n\tdefaultWmsParams: {\r\n\t\tservice: 'WMS',\r\n\t\trequest: 'GetMap',\r\n\t\tversion: '1.1.1',\r\n\t\tlayers: '',\r\n\t\tstyles: '',\r\n\t\tformat: 'image/jpeg',\r\n\t\ttransparent: false\r\n\t},\r\n\r\n\tinitialize: function (url, options) { // (String, Object)\r\n\r\n\t\tthis._url = url;\r\n\r\n\t\tvar wmsParams = L.extend({}, this.defaultWmsParams),\r\n\t\t    tileSize = options.tileSize || this.options.tileSize;\r\n\r\n\t\tif (options.detectRetina && L.Browser.retina) {\r\n\t\t\twmsParams.width = wmsParams.height = tileSize * 2;\r\n\t\t} else {\r\n\t\t\twmsParams.width = wmsParams.height = tileSize;\r\n\t\t}\r\n\r\n\t\tfor (var i in options) {\r\n\t\t\t// all keys that are not TileLayer options go to WMS params\r\n\t\t\tif (!this.options.hasOwnProperty(i) && i !== 'crs') {\r\n\t\t\t\twmsParams[i] = options[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.wmsParams = wmsParams;\r\n\r\n\t\tL.setOptions(this, options);\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\r\n\t\tthis._crs = this.options.crs || map.options.crs;\r\n\r\n\t\tthis._wmsVersion = parseFloat(this.wmsParams.version);\r\n\r\n\t\tvar projectionKey = this._wmsVersion >= 1.3 ? 'crs' : 'srs';\r\n\t\tthis.wmsParams[projectionKey] = this._crs.code;\r\n\r\n\t\tL.TileLayer.prototype.onAdd.call(this, map);\r\n\t},\r\n\r\n\tgetTileUrl: function (tilePoint) { // (Point, Number) -> String\r\n\r\n\t\tvar map = this._map,\r\n\t\t    tileSize = this.options.tileSize,\r\n\r\n\t\t    nwPoint = tilePoint.multiplyBy(tileSize),\r\n\t\t    sePoint = nwPoint.add([tileSize, tileSize]),\r\n\r\n\t\t    nw = this._crs.project(map.unproject(nwPoint, tilePoint.z)),\r\n\t\t    se = this._crs.project(map.unproject(sePoint, tilePoint.z)),\r\n\t\t    bbox = this._wmsVersion >= 1.3 && this._crs === L.CRS.EPSG4326 ?\r\n\t\t        [se.y, nw.x, nw.y, se.x].join(',') :\r\n\t\t        [nw.x, se.y, se.x, nw.y].join(','),\r\n\r\n\t\t    url = L.Util.template(this._url, {s: this._getSubdomain(tilePoint)});\r\n\r\n\t\treturn url + L.Util.getParamString(this.wmsParams, url, true) + '&BBOX=' + bbox;\r\n\t},\r\n\r\n\tsetParams: function (params, noRedraw) {\r\n\r\n\t\tL.extend(this.wmsParams, params);\r\n\r\n\t\tif (!noRedraw) {\r\n\t\t\tthis.redraw();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n});\r\n\r\nL.tileLayer.wms = function (url, options) {\r\n\treturn new L.TileLayer.WMS(url, options);\r\n};\r\n\n\n/*\r\n * L.TileLayer.Canvas is a class that you can use as a base for creating\r\n * dynamically drawn Canvas-based tile layers.\r\n */\r\n\r\nL.TileLayer.Canvas = L.TileLayer.extend({\r\n\toptions: {\r\n\t\tasync: false\r\n\t},\r\n\r\n\tinitialize: function (options) {\r\n\t\tL.setOptions(this, options);\r\n\t},\r\n\r\n\tredraw: function () {\r\n\t\tif (this._map) {\r\n\t\t\tthis._reset({hard: true});\r\n\t\t\tthis._update();\r\n\t\t}\r\n\r\n\t\tfor (var i in this._tiles) {\r\n\t\t\tthis._redrawTile(this._tiles[i]);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_redrawTile: function (tile) {\r\n\t\tthis.drawTile(tile, tile._tilePoint, this._map._zoom);\r\n\t},\r\n\r\n\t_createTile: function () {\r\n\t\tvar tile = L.DomUtil.create('canvas', 'leaflet-tile');\r\n\t\ttile.width = tile.height = this.options.tileSize;\r\n\t\ttile.onselectstart = tile.onmousemove = L.Util.falseFn;\r\n\t\treturn tile;\r\n\t},\r\n\r\n\t_loadTile: function (tile, tilePoint) {\r\n\t\ttile._layer = this;\r\n\t\ttile._tilePoint = tilePoint;\r\n\r\n\t\tthis._redrawTile(tile);\r\n\r\n\t\tif (!this.options.async) {\r\n\t\t\tthis.tileDrawn(tile);\r\n\t\t}\r\n\t},\r\n\r\n\tdrawTile: function (/*tile, tilePoint*/) {\r\n\t\t// override with rendering code\r\n\t},\r\n\r\n\ttileDrawn: function (tile) {\r\n\t\tthis._tileOnLoad.call(tile);\r\n\t}\r\n});\r\n\r\n\r\nL.tileLayer.canvas = function (options) {\r\n\treturn new L.TileLayer.Canvas(options);\r\n};\r\n\n\n/*\r\n * L.ImageOverlay is used to overlay images over the map (to specific geographical bounds).\r\n */\r\n\r\nL.ImageOverlay = L.Class.extend({\r\n\tincludes: L.Mixin.Events,\r\n\r\n\toptions: {\r\n\t\topacity: 1\r\n\t},\r\n\r\n\tinitialize: function (url, bounds, options) { // (String, LatLngBounds, Object)\r\n\t\tthis._url = url;\r\n\t\tthis._bounds = L.latLngBounds(bounds);\r\n\r\n\t\tL.setOptions(this, options);\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tif (!this._image) {\r\n\t\t\tthis._initImage();\r\n\t\t}\r\n\r\n\t\tmap._panes.overlayPane.appendChild(this._image);\r\n\r\n\t\tmap.on('viewreset', this._reset, this);\r\n\r\n\t\tif (map.options.zoomAnimation && L.Browser.any3d) {\r\n\t\t\tmap.on('zoomanim', this._animateZoom, this);\r\n\t\t}\r\n\r\n\t\tthis._reset();\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap.getPanes().overlayPane.removeChild(this._image);\r\n\r\n\t\tmap.off('viewreset', this._reset, this);\r\n\r\n\t\tif (map.options.zoomAnimation) {\r\n\t\t\tmap.off('zoomanim', this._animateZoom, this);\r\n\t\t}\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tmap.addLayer(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetOpacity: function (opacity) {\r\n\t\tthis.options.opacity = opacity;\r\n\t\tthis._updateOpacity();\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// TODO remove bringToFront/bringToBack duplication from TileLayer/Path\r\n\tbringToFront: function () {\r\n\t\tif (this._image) {\r\n\t\t\tthis._map._panes.overlayPane.appendChild(this._image);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tbringToBack: function () {\r\n\t\tvar pane = this._map._panes.overlayPane;\r\n\t\tif (this._image) {\r\n\t\t\tpane.insertBefore(this._image, pane.firstChild);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetUrl: function (url) {\r\n\t\tthis._url = url;\r\n\t\tthis._image.src = this._url;\r\n\t},\r\n\r\n\tgetAttribution: function () {\r\n\t\treturn this.options.attribution;\r\n\t},\r\n\r\n\t_initImage: function () {\r\n\t\tthis._image = L.DomUtil.create('img', 'leaflet-image-layer');\r\n\r\n\t\tif (this._map.options.zoomAnimation && L.Browser.any3d) {\r\n\t\t\tL.DomUtil.addClass(this._image, 'leaflet-zoom-animated');\r\n\t\t} else {\r\n\t\t\tL.DomUtil.addClass(this._image, 'leaflet-zoom-hide');\r\n\t\t}\r\n\r\n\t\tthis._updateOpacity();\r\n\r\n\t\t//TODO createImage util method to remove duplication\r\n\t\tL.extend(this._image, {\r\n\t\t\tgalleryimg: 'no',\r\n\t\t\tonselectstart: L.Util.falseFn,\r\n\t\t\tonmousemove: L.Util.falseFn,\r\n\t\t\tonload: L.bind(this._onImageLoad, this),\r\n\t\t\tsrc: this._url\r\n\t\t});\r\n\t},\r\n\r\n\t_animateZoom: function (e) {\r\n\t\tvar map = this._map,\r\n\t\t    image = this._image,\r\n\t\t    scale = map.getZoomScale(e.zoom),\r\n\t\t    nw = this._bounds.getNorthWest(),\r\n\t\t    se = this._bounds.getSouthEast(),\r\n\r\n\t\t    topLeft = map._latLngToNewLayerPoint(nw, e.zoom, e.center),\r\n\t\t    size = map._latLngToNewLayerPoint(se, e.zoom, e.center)._subtract(topLeft),\r\n\t\t    origin = topLeft._add(size._multiplyBy((1 / 2) * (1 - 1 / scale)));\r\n\r\n\t\timage.style[L.DomUtil.TRANSFORM] =\r\n\t\t        L.DomUtil.getTranslateString(origin) + ' scale(' + scale + ') ';\r\n\t},\r\n\r\n\t_reset: function () {\r\n\t\tvar image   = this._image,\r\n\t\t    topLeft = this._map.latLngToLayerPoint(this._bounds.getNorthWest()),\r\n\t\t    size = this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(topLeft);\r\n\r\n\t\tL.DomUtil.setPosition(image, topLeft);\r\n\r\n\t\timage.style.width  = size.x + 'px';\r\n\t\timage.style.height = size.y + 'px';\r\n\t},\r\n\r\n\t_onImageLoad: function () {\r\n\t\tthis.fire('load');\r\n\t},\r\n\r\n\t_updateOpacity: function () {\r\n\t\tL.DomUtil.setOpacity(this._image, this.options.opacity);\r\n\t}\r\n});\r\n\r\nL.imageOverlay = function (url, bounds, options) {\r\n\treturn new L.ImageOverlay(url, bounds, options);\r\n};\r\n\n\n/*\r\n * L.Icon is an image-based icon class that you can use with L.Marker for custom markers.\r\n */\r\n\r\nL.Icon = L.Class.extend({\r\n\toptions: {\r\n\t\t/*\r\n\t\ticonUrl: (String) (required)\r\n\t\ticonRetinaUrl: (String) (optional, used for retina devices if detected)\r\n\t\ticonSize: (Point) (can be set through CSS)\r\n\t\ticonAnchor: (Point) (centered by default, can be set in CSS with negative margins)\r\n\t\tpopupAnchor: (Point) (if not specified, popup opens in the anchor point)\r\n\t\tshadowUrl: (String) (no shadow by default)\r\n\t\tshadowRetinaUrl: (String) (optional, used for retina devices if detected)\r\n\t\tshadowSize: (Point)\r\n\t\tshadowAnchor: (Point)\r\n\t\t*/\r\n\t\tclassName: ''\r\n\t},\r\n\r\n\tinitialize: function (options) {\r\n\t\tL.setOptions(this, options);\r\n\t},\r\n\r\n\tcreateIcon: function (oldIcon) {\r\n\t\treturn this._createIcon('icon', oldIcon);\r\n\t},\r\n\r\n\tcreateShadow: function (oldIcon) {\r\n\t\treturn this._createIcon('shadow', oldIcon);\r\n\t},\r\n\r\n\t_createIcon: function (name, oldIcon) {\r\n\t\tvar src = this._getIconUrl(name);\r\n\r\n\t\tif (!src) {\r\n\t\t\tif (name === 'icon') {\r\n\t\t\t\tthrow new Error('iconUrl not set in Icon options (see the docs).');\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tvar img;\r\n\t\tif (!oldIcon || oldIcon.tagName !== 'IMG') {\r\n\t\t\timg = this._createImg(src);\r\n\t\t} else {\r\n\t\t\timg = this._createImg(src, oldIcon);\r\n\t\t}\r\n\t\tthis._setIconStyles(img, name);\r\n\r\n\t\treturn img;\r\n\t},\r\n\r\n\t_setIconStyles: function (img, name) {\r\n\t\tvar options = this.options,\r\n\t\t    size = L.point(options[name + 'Size']),\r\n\t\t    anchor;\r\n\r\n\t\tif (name === 'shadow') {\r\n\t\t\tanchor = L.point(options.shadowAnchor || options.iconAnchor);\r\n\t\t} else {\r\n\t\t\tanchor = L.point(options.iconAnchor);\r\n\t\t}\r\n\r\n\t\tif (!anchor && size) {\r\n\t\t\tanchor = size.divideBy(2, true);\r\n\t\t}\r\n\r\n\t\timg.className = 'leaflet-marker-' + name + ' ' + options.className;\r\n\r\n\t\tif (anchor) {\r\n\t\t\timg.style.marginLeft = (-anchor.x) + 'px';\r\n\t\t\timg.style.marginTop  = (-anchor.y) + 'px';\r\n\t\t}\r\n\r\n\t\tif (size) {\r\n\t\t\timg.style.width  = size.x + 'px';\r\n\t\t\timg.style.height = size.y + 'px';\r\n\t\t}\r\n\t},\r\n\r\n\t_createImg: function (src, el) {\r\n\t\tel = el || document.createElement('img');\r\n\t\tel.src = src;\r\n\t\treturn el;\r\n\t},\r\n\r\n\t_getIconUrl: function (name) {\r\n\t\tif (L.Browser.retina && this.options[name + 'RetinaUrl']) {\r\n\t\t\treturn this.options[name + 'RetinaUrl'];\r\n\t\t}\r\n\t\treturn this.options[name + 'Url'];\r\n\t}\r\n});\r\n\r\nL.icon = function (options) {\r\n\treturn new L.Icon(options);\r\n};\r\n\n\n/*\n * L.Icon.Default is the blue marker icon used by default in Leaflet.\n */\n\nL.Icon.Default = L.Icon.extend({\n\n\toptions: {\n\t\ticonSize: [25, 41],\n\t\ticonAnchor: [12, 41],\n\t\tpopupAnchor: [1, -34],\n\n\t\tshadowSize: [41, 41]\n\t},\n\n\t_getIconUrl: function (name) {\n\t\tvar key = name + 'Url';\n\n\t\tif (this.options[key]) {\n\t\t\treturn this.options[key];\n\t\t}\n\n\t\tif (L.Browser.retina && name === 'icon') {\n\t\t\tname += '-2x';\n\t\t}\n\n\t\tvar path = L.Icon.Default.imagePath;\n\n\t\tif (!path) {\n\t\t\tthrow new Error('Couldn\\'t autodetect L.Icon.Default.imagePath, set it manually.');\n\t\t}\n\n\t\treturn path + '/marker-' + name + '.png';\n\t}\n});\n\nL.Icon.Default.imagePath = (function () {\n\tvar scripts = document.getElementsByTagName('script'),\n\t    leafletRe = /[\\/^]leaflet[\\-\\._]?([\\w\\-\\._]*)\\.js\\??/;\n\n\tvar i, len, src, matches, path;\n\n\tfor (i = 0, len = scripts.length; i < len; i++) {\n\t\tsrc = scripts[i].src;\n\t\tmatches = src.match(leafletRe);\n\n\t\tif (matches) {\n\t\t\tpath = src.split(leafletRe)[0];\n\t\t\treturn (path ? path + '/' : '') + 'images';\n\t\t}\n\t}\n}());\n\n\n/*\r\n * L.Marker is used to display clickable/draggable icons on the map.\r\n */\r\n\r\nL.Marker = L.Class.extend({\r\n\r\n\tincludes: L.Mixin.Events,\r\n\r\n\toptions: {\r\n\t\ticon: new L.Icon.Default(),\r\n\t\ttitle: '',\r\n\t\talt: '',\r\n\t\tclickable: true,\r\n\t\tdraggable: false,\r\n\t\tkeyboard: true,\r\n\t\tzIndexOffset: 0,\r\n\t\topacity: 1,\r\n\t\triseOnHover: false,\r\n\t\triseOffset: 250\r\n\t},\r\n\r\n\tinitialize: function (latlng, options) {\r\n\t\tL.setOptions(this, options);\r\n\t\tthis._latlng = L.latLng(latlng);\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tmap.on('viewreset', this.update, this);\r\n\r\n\t\tthis._initIcon();\r\n\t\tthis.update();\r\n\t\tthis.fire('add');\r\n\r\n\t\tif (map.options.zoomAnimation && map.options.markerZoomAnimation) {\r\n\t\t\tmap.on('zoomanim', this._animateZoom, this);\r\n\t\t}\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tmap.addLayer(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tif (this.dragging) {\r\n\t\t\tthis.dragging.disable();\r\n\t\t}\r\n\r\n\t\tthis._removeIcon();\r\n\t\tthis._removeShadow();\r\n\r\n\t\tthis.fire('remove');\r\n\r\n\t\tmap.off({\r\n\t\t\t'viewreset': this.update,\r\n\t\t\t'zoomanim': this._animateZoom\r\n\t\t}, this);\r\n\r\n\t\tthis._map = null;\r\n\t},\r\n\r\n\tgetLatLng: function () {\r\n\t\treturn this._latlng;\r\n\t},\r\n\r\n\tsetLatLng: function (latlng) {\r\n\t\tthis._latlng = L.latLng(latlng);\r\n\r\n\t\tthis.update();\r\n\r\n\t\treturn this.fire('move', { latlng: this._latlng });\r\n\t},\r\n\r\n\tsetZIndexOffset: function (offset) {\r\n\t\tthis.options.zIndexOffset = offset;\r\n\t\tthis.update();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetIcon: function (icon) {\r\n\r\n\t\tthis.options.icon = icon;\r\n\r\n\t\tif (this._map) {\r\n\t\t\tthis._initIcon();\r\n\t\t\tthis.update();\r\n\t\t}\r\n\r\n\t\tif (this._popup) {\r\n\t\t\tthis.bindPopup(this._popup);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tupdate: function () {\r\n\t\tif (this._icon) {\r\n\t\t\tvar pos = this._map.latLngToLayerPoint(this._latlng).round();\r\n\t\t\tthis._setPos(pos);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_initIcon: function () {\r\n\t\tvar options = this.options,\r\n\t\t    map = this._map,\r\n\t\t    animation = (map.options.zoomAnimation && map.options.markerZoomAnimation),\r\n\t\t    classToAdd = animation ? 'leaflet-zoom-animated' : 'leaflet-zoom-hide';\r\n\r\n\t\tvar icon = options.icon.createIcon(this._icon),\r\n\t\t\taddIcon = false;\r\n\r\n\t\t// if we're not reusing the icon, remove the old one and init new one\r\n\t\tif (icon !== this._icon) {\r\n\t\t\tif (this._icon) {\r\n\t\t\t\tthis._removeIcon();\r\n\t\t\t}\r\n\t\t\taddIcon = true;\r\n\r\n\t\t\tif (options.title) {\r\n\t\t\t\ticon.title = options.title;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (options.alt) {\r\n\t\t\t\ticon.alt = options.alt;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tL.DomUtil.addClass(icon, classToAdd);\r\n\r\n\t\tif (options.keyboard) {\r\n\t\t\ticon.tabIndex = '0';\r\n\t\t}\r\n\r\n\t\tthis._icon = icon;\r\n\r\n\t\tthis._initInteraction();\r\n\r\n\t\tif (options.riseOnHover) {\r\n\t\t\tL.DomEvent\r\n\t\t\t\t.on(icon, 'mouseover', this._bringToFront, this)\r\n\t\t\t\t.on(icon, 'mouseout', this._resetZIndex, this);\r\n\t\t}\r\n\r\n\t\tvar newShadow = options.icon.createShadow(this._shadow),\r\n\t\t\taddShadow = false;\r\n\r\n\t\tif (newShadow !== this._shadow) {\r\n\t\t\tthis._removeShadow();\r\n\t\t\taddShadow = true;\r\n\t\t}\r\n\r\n\t\tif (newShadow) {\r\n\t\t\tL.DomUtil.addClass(newShadow, classToAdd);\r\n\t\t}\r\n\t\tthis._shadow = newShadow;\r\n\r\n\r\n\t\tif (options.opacity < 1) {\r\n\t\t\tthis._updateOpacity();\r\n\t\t}\r\n\r\n\r\n\t\tvar panes = this._map._panes;\r\n\r\n\t\tif (addIcon) {\r\n\t\t\tpanes.markerPane.appendChild(this._icon);\r\n\t\t}\r\n\r\n\t\tif (newShadow && addShadow) {\r\n\t\t\tpanes.shadowPane.appendChild(this._shadow);\r\n\t\t}\r\n\t},\r\n\r\n\t_removeIcon: function () {\r\n\t\tif (this.options.riseOnHover) {\r\n\t\t\tL.DomEvent\r\n\t\t\t    .off(this._icon, 'mouseover', this._bringToFront)\r\n\t\t\t    .off(this._icon, 'mouseout', this._resetZIndex);\r\n\t\t}\r\n\r\n\t\tthis._map._panes.markerPane.removeChild(this._icon);\r\n\r\n\t\tthis._icon = null;\r\n\t},\r\n\r\n\t_removeShadow: function () {\r\n\t\tif (this._shadow) {\r\n\t\t\tthis._map._panes.shadowPane.removeChild(this._shadow);\r\n\t\t}\r\n\t\tthis._shadow = null;\r\n\t},\r\n\r\n\t_setPos: function (pos) {\r\n\t\tL.DomUtil.setPosition(this._icon, pos);\r\n\r\n\t\tif (this._shadow) {\r\n\t\t\tL.DomUtil.setPosition(this._shadow, pos);\r\n\t\t}\r\n\r\n\t\tthis._zIndex = pos.y + this.options.zIndexOffset;\r\n\r\n\t\tthis._resetZIndex();\r\n\t},\r\n\r\n\t_updateZIndex: function (offset) {\r\n\t\tthis._icon.style.zIndex = this._zIndex + offset;\r\n\t},\r\n\r\n\t_animateZoom: function (opt) {\r\n\t\tvar pos = this._map._latLngToNewLayerPoint(this._latlng, opt.zoom, opt.center).round();\r\n\r\n\t\tthis._setPos(pos);\r\n\t},\r\n\r\n\t_initInteraction: function () {\r\n\r\n\t\tif (!this.options.clickable) { return; }\r\n\r\n\t\t// TODO refactor into something shared with Map/Path/etc. to DRY it up\r\n\r\n\t\tvar icon = this._icon,\r\n\t\t    events = ['dblclick', 'mousedown', 'mouseover', 'mouseout', 'contextmenu'];\r\n\r\n\t\tL.DomUtil.addClass(icon, 'leaflet-clickable');\r\n\t\tL.DomEvent.on(icon, 'click', this._onMouseClick, this);\r\n\t\tL.DomEvent.on(icon, 'keypress', this._onKeyPress, this);\r\n\r\n\t\tfor (var i = 0; i < events.length; i++) {\r\n\t\t\tL.DomEvent.on(icon, events[i], this._fireMouseEvent, this);\r\n\t\t}\r\n\r\n\t\tif (L.Handler.MarkerDrag) {\r\n\t\t\tthis.dragging = new L.Handler.MarkerDrag(this);\r\n\r\n\t\t\tif (this.options.draggable) {\r\n\t\t\t\tthis.dragging.enable();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_onMouseClick: function (e) {\r\n\t\tvar wasDragged = this.dragging && this.dragging.moved();\r\n\r\n\t\tif (this.hasEventListeners(e.type) || wasDragged) {\r\n\t\t\tL.DomEvent.stopPropagation(e);\r\n\t\t}\r\n\r\n\t\tif (wasDragged) { return; }\r\n\r\n\t\tif ((!this.dragging || !this.dragging._enabled) && this._map.dragging && this._map.dragging.moved()) { return; }\r\n\r\n\t\tthis.fire(e.type, {\r\n\t\t\toriginalEvent: e,\r\n\t\t\tlatlng: this._latlng\r\n\t\t});\r\n\t},\r\n\r\n\t_onKeyPress: function (e) {\r\n\t\tif (e.keyCode === 13) {\r\n\t\t\tthis.fire('click', {\r\n\t\t\t\toriginalEvent: e,\r\n\t\t\t\tlatlng: this._latlng\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\t_fireMouseEvent: function (e) {\r\n\r\n\t\tthis.fire(e.type, {\r\n\t\t\toriginalEvent: e,\r\n\t\t\tlatlng: this._latlng\r\n\t\t});\r\n\r\n\t\t// TODO proper custom event propagation\r\n\t\t// this line will always be called if marker is in a FeatureGroup\r\n\t\tif (e.type === 'contextmenu' && this.hasEventListeners(e.type)) {\r\n\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t}\r\n\t\tif (e.type !== 'mousedown') {\r\n\t\t\tL.DomEvent.stopPropagation(e);\r\n\t\t} else {\r\n\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t}\r\n\t},\r\n\r\n\tsetOpacity: function (opacity) {\r\n\t\tthis.options.opacity = opacity;\r\n\t\tif (this._map) {\r\n\t\t\tthis._updateOpacity();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_updateOpacity: function () {\r\n\t\tL.DomUtil.setOpacity(this._icon, this.options.opacity);\r\n\t\tif (this._shadow) {\r\n\t\t\tL.DomUtil.setOpacity(this._shadow, this.options.opacity);\r\n\t\t}\r\n\t},\r\n\r\n\t_bringToFront: function () {\r\n\t\tthis._updateZIndex(this.options.riseOffset);\r\n\t},\r\n\r\n\t_resetZIndex: function () {\r\n\t\tthis._updateZIndex(0);\r\n\t}\r\n});\r\n\r\nL.marker = function (latlng, options) {\r\n\treturn new L.Marker(latlng, options);\r\n};\r\n\n\n/*\n * L.DivIcon is a lightweight HTML-based icon class (as opposed to the image-based L.Icon)\n * to use with L.Marker.\n */\n\nL.DivIcon = L.Icon.extend({\n\toptions: {\n\t\ticonSize: [12, 12], // also can be set through CSS\n\t\t/*\n\t\ticonAnchor: (Point)\n\t\tpopupAnchor: (Point)\n\t\thtml: (String)\n\t\tbgPos: (Point)\n\t\t*/\n\t\tclassName: 'leaflet-div-icon',\n\t\thtml: false\n\t},\n\n\tcreateIcon: function (oldIcon) {\n\t\tvar div = (oldIcon && oldIcon.tagName === 'DIV') ? oldIcon : document.createElement('div'),\n\t\t    options = this.options;\n\n\t\tif (options.html !== false) {\n\t\t\tdiv.innerHTML = options.html;\n\t\t} else {\n\t\t\tdiv.innerHTML = '';\n\t\t}\n\n\t\tif (options.bgPos) {\n\t\t\tdiv.style.backgroundPosition =\n\t\t\t        (-options.bgPos.x) + 'px ' + (-options.bgPos.y) + 'px';\n\t\t}\n\n\t\tthis._setIconStyles(div, 'icon');\n\t\treturn div;\n\t},\n\n\tcreateShadow: function () {\n\t\treturn null;\n\t}\n});\n\nL.divIcon = function (options) {\n\treturn new L.DivIcon(options);\n};\n\n\n/*\r\n * L.Popup is used for displaying popups on the map.\r\n */\r\n\r\nL.Map.mergeOptions({\r\n\tclosePopupOnClick: true\r\n});\r\n\r\nL.Popup = L.Class.extend({\r\n\tincludes: L.Mixin.Events,\r\n\r\n\toptions: {\r\n\t\tminWidth: 50,\r\n\t\tmaxWidth: 300,\r\n\t\t// maxHeight: null,\r\n\t\tautoPan: true,\r\n\t\tcloseButton: true,\r\n\t\toffset: [0, 7],\r\n\t\tautoPanPadding: [5, 5],\r\n\t\t// autoPanPaddingTopLeft: null,\r\n\t\t// autoPanPaddingBottomRight: null,\r\n\t\tkeepInView: false,\r\n\t\tclassName: '',\r\n\t\tzoomAnimation: true\r\n\t},\r\n\r\n\tinitialize: function (options, source) {\r\n\t\tL.setOptions(this, options);\r\n\r\n\t\tthis._source = source;\r\n\t\tthis._animated = L.Browser.any3d && this.options.zoomAnimation;\r\n\t\tthis._isOpen = false;\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tif (!this._container) {\r\n\t\t\tthis._initLayout();\r\n\t\t}\r\n\r\n\t\tvar animFade = map.options.fadeAnimation;\r\n\r\n\t\tif (animFade) {\r\n\t\t\tL.DomUtil.setOpacity(this._container, 0);\r\n\t\t}\r\n\t\tmap._panes.popupPane.appendChild(this._container);\r\n\r\n\t\tmap.on(this._getEvents(), this);\r\n\r\n\t\tthis.update();\r\n\r\n\t\tif (animFade) {\r\n\t\t\tL.DomUtil.setOpacity(this._container, 1);\r\n\t\t}\r\n\r\n\t\tthis.fire('open');\r\n\r\n\t\tmap.fire('popupopen', {popup: this});\r\n\r\n\t\tif (this._source) {\r\n\t\t\tthis._source.fire('popupopen', {popup: this});\r\n\t\t}\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tmap.addLayer(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\topenOn: function (map) {\r\n\t\tmap.openPopup(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap._panes.popupPane.removeChild(this._container);\r\n\r\n\t\tL.Util.falseFn(this._container.offsetWidth); // force reflow\r\n\r\n\t\tmap.off(this._getEvents(), this);\r\n\r\n\t\tif (map.options.fadeAnimation) {\r\n\t\t\tL.DomUtil.setOpacity(this._container, 0);\r\n\t\t}\r\n\r\n\t\tthis._map = null;\r\n\r\n\t\tthis.fire('close');\r\n\r\n\t\tmap.fire('popupclose', {popup: this});\r\n\r\n\t\tif (this._source) {\r\n\t\t\tthis._source.fire('popupclose', {popup: this});\r\n\t\t}\r\n\t},\r\n\r\n\tgetLatLng: function () {\r\n\t\treturn this._latlng;\r\n\t},\r\n\r\n\tsetLatLng: function (latlng) {\r\n\t\tthis._latlng = L.latLng(latlng);\r\n\t\tif (this._map) {\r\n\t\t\tthis._updatePosition();\r\n\t\t\tthis._adjustPan();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetContent: function () {\r\n\t\treturn this._content;\r\n\t},\r\n\r\n\tsetContent: function (content) {\r\n\t\tthis._content = content;\r\n\t\tthis.update();\r\n\t\treturn this;\r\n\t},\r\n\r\n\tupdate: function () {\r\n\t\tif (!this._map) { return; }\r\n\r\n\t\tthis._container.style.visibility = 'hidden';\r\n\r\n\t\tthis._updateContent();\r\n\t\tthis._updateLayout();\r\n\t\tthis._updatePosition();\r\n\r\n\t\tthis._container.style.visibility = '';\r\n\r\n\t\tthis._adjustPan();\r\n\t},\r\n\r\n\t_getEvents: function () {\r\n\t\tvar events = {\r\n\t\t\tviewreset: this._updatePosition\r\n\t\t};\r\n\r\n\t\tif (this._animated) {\r\n\t\t\tevents.zoomanim = this._zoomAnimation;\r\n\t\t}\r\n\t\tif ('closeOnClick' in this.options ? this.options.closeOnClick : this._map.options.closePopupOnClick) {\r\n\t\t\tevents.preclick = this._close;\r\n\t\t}\r\n\t\tif (this.options.keepInView) {\r\n\t\t\tevents.moveend = this._adjustPan;\r\n\t\t}\r\n\r\n\t\treturn events;\r\n\t},\r\n\r\n\t_close: function () {\r\n\t\tif (this._map) {\r\n\t\t\tthis._map.closePopup(this);\r\n\t\t}\r\n\t},\r\n\r\n\t_initLayout: function () {\r\n\t\tvar prefix = 'leaflet-popup',\r\n\t\t\tcontainerClass = prefix + ' ' + this.options.className + ' leaflet-zoom-' +\r\n\t\t\t        (this._animated ? 'animated' : 'hide'),\r\n\t\t\tcontainer = this._container = L.DomUtil.create('div', containerClass),\r\n\t\t\tcloseButton;\r\n\r\n\t\tif (this.options.closeButton) {\r\n\t\t\tcloseButton = this._closeButton =\r\n\t\t\t        L.DomUtil.create('a', prefix + '-close-button', container);\r\n\t\t\tcloseButton.href = '#close';\r\n\t\t\tcloseButton.innerHTML = '&#215;';\r\n\t\t\tL.DomEvent.disableClickPropagation(closeButton);\r\n\r\n\t\t\tL.DomEvent.on(closeButton, 'click', this._onCloseButtonClick, this);\r\n\t\t}\r\n\r\n\t\tvar wrapper = this._wrapper =\r\n\t\t        L.DomUtil.create('div', prefix + '-content-wrapper', container);\r\n\t\tL.DomEvent.disableClickPropagation(wrapper);\r\n\r\n\t\tthis._contentNode = L.DomUtil.create('div', prefix + '-content', wrapper);\r\n\r\n\t\tL.DomEvent.disableScrollPropagation(this._contentNode);\r\n\t\tL.DomEvent.on(wrapper, 'contextmenu', L.DomEvent.stopPropagation);\r\n\r\n\t\tthis._tipContainer = L.DomUtil.create('div', prefix + '-tip-container', container);\r\n\t\tthis._tip = L.DomUtil.create('div', prefix + '-tip', this._tipContainer);\r\n\t},\r\n\r\n\t_updateContent: function () {\r\n\t\tif (!this._content) { return; }\r\n\r\n\t\tif (typeof this._content === 'string') {\r\n\t\t\tthis._contentNode.innerHTML = this._content;\r\n\t\t} else {\r\n\t\t\twhile (this._contentNode.hasChildNodes()) {\r\n\t\t\t\tthis._contentNode.removeChild(this._contentNode.firstChild);\r\n\t\t\t}\r\n\t\t\tthis._contentNode.appendChild(this._content);\r\n\t\t}\r\n\t\tthis.fire('contentupdate');\r\n\t},\r\n\r\n\t_updateLayout: function () {\r\n\t\tvar container = this._contentNode,\r\n\t\t    style = container.style;\r\n\r\n\t\tstyle.width = '';\r\n\t\tstyle.whiteSpace = 'nowrap';\r\n\r\n\t\tvar width = container.offsetWidth;\r\n\t\twidth = Math.min(width, this.options.maxWidth);\r\n\t\twidth = Math.max(width, this.options.minWidth);\r\n\r\n\t\tstyle.width = (width + 1) + 'px';\r\n\t\tstyle.whiteSpace = '';\r\n\r\n\t\tstyle.height = '';\r\n\r\n\t\tvar height = container.offsetHeight,\r\n\t\t    maxHeight = this.options.maxHeight,\r\n\t\t    scrolledClass = 'leaflet-popup-scrolled';\r\n\r\n\t\tif (maxHeight && height > maxHeight) {\r\n\t\t\tstyle.height = maxHeight + 'px';\r\n\t\t\tL.DomUtil.addClass(container, scrolledClass);\r\n\t\t} else {\r\n\t\t\tL.DomUtil.removeClass(container, scrolledClass);\r\n\t\t}\r\n\r\n\t\tthis._containerWidth = this._container.offsetWidth;\r\n\t},\r\n\r\n\t_updatePosition: function () {\r\n\t\tif (!this._map) { return; }\r\n\r\n\t\tvar pos = this._map.latLngToLayerPoint(this._latlng),\r\n\t\t    animated = this._animated,\r\n\t\t    offset = L.point(this.options.offset);\r\n\r\n\t\tif (animated) {\r\n\t\t\tL.DomUtil.setPosition(this._container, pos);\r\n\t\t}\r\n\r\n\t\tthis._containerBottom = -offset.y - (animated ? 0 : pos.y);\r\n\t\tthis._containerLeft = -Math.round(this._containerWidth / 2) + offset.x + (animated ? 0 : pos.x);\r\n\r\n\t\t// bottom position the popup in case the height of the popup changes (images loading etc)\r\n\t\tthis._container.style.bottom = this._containerBottom + 'px';\r\n\t\tthis._container.style.left = this._containerLeft + 'px';\r\n\t},\r\n\r\n\t_zoomAnimation: function (opt) {\r\n\t\tvar pos = this._map._latLngToNewLayerPoint(this._latlng, opt.zoom, opt.center);\r\n\r\n\t\tL.DomUtil.setPosition(this._container, pos);\r\n\t},\r\n\r\n\t_adjustPan: function () {\r\n\t\tif (!this.options.autoPan) { return; }\r\n\r\n\t\tvar map = this._map,\r\n\t\t    containerHeight = this._container.offsetHeight,\r\n\t\t    containerWidth = this._containerWidth,\r\n\r\n\t\t    layerPos = new L.Point(this._containerLeft, -containerHeight - this._containerBottom);\r\n\r\n\t\tif (this._animated) {\r\n\t\t\tlayerPos._add(L.DomUtil.getPosition(this._container));\r\n\t\t}\r\n\r\n\t\tvar containerPos = map.layerPointToContainerPoint(layerPos),\r\n\t\t    padding = L.point(this.options.autoPanPadding),\r\n\t\t    paddingTL = L.point(this.options.autoPanPaddingTopLeft || padding),\r\n\t\t    paddingBR = L.point(this.options.autoPanPaddingBottomRight || padding),\r\n\t\t    size = map.getSize(),\r\n\t\t    dx = 0,\r\n\t\t    dy = 0;\r\n\r\n\t\tif (containerPos.x + containerWidth + paddingBR.x > size.x) { // right\r\n\t\t\tdx = containerPos.x + containerWidth - size.x + paddingBR.x;\r\n\t\t}\r\n\t\tif (containerPos.x - dx - paddingTL.x < 0) { // left\r\n\t\t\tdx = containerPos.x - paddingTL.x;\r\n\t\t}\r\n\t\tif (containerPos.y + containerHeight + paddingBR.y > size.y) { // bottom\r\n\t\t\tdy = containerPos.y + containerHeight - size.y + paddingBR.y;\r\n\t\t}\r\n\t\tif (containerPos.y - dy - paddingTL.y < 0) { // top\r\n\t\t\tdy = containerPos.y - paddingTL.y;\r\n\t\t}\r\n\r\n\t\tif (dx || dy) {\r\n\t\t\tmap\r\n\t\t\t    .fire('autopanstart')\r\n\t\t\t    .panBy([dx, dy]);\r\n\t\t}\r\n\t},\r\n\r\n\t_onCloseButtonClick: function (e) {\r\n\t\tthis._close();\r\n\t\tL.DomEvent.stop(e);\r\n\t}\r\n});\r\n\r\nL.popup = function (options, source) {\r\n\treturn new L.Popup(options, source);\r\n};\r\n\r\n\r\nL.Map.include({\r\n\topenPopup: function (popup, latlng, options) { // (Popup) or (String || HTMLElement, LatLng[, Object])\r\n\t\tthis.closePopup();\r\n\r\n\t\tif (!(popup instanceof L.Popup)) {\r\n\t\t\tvar content = popup;\r\n\r\n\t\t\tpopup = new L.Popup(options)\r\n\t\t\t    .setLatLng(latlng)\r\n\t\t\t    .setContent(content);\r\n\t\t}\r\n\t\tpopup._isOpen = true;\r\n\r\n\t\tthis._popup = popup;\r\n\t\treturn this.addLayer(popup);\r\n\t},\r\n\r\n\tclosePopup: function (popup) {\r\n\t\tif (!popup || popup === this._popup) {\r\n\t\t\tpopup = this._popup;\r\n\t\t\tthis._popup = null;\r\n\t\t}\r\n\t\tif (popup) {\r\n\t\t\tthis.removeLayer(popup);\r\n\t\t\tpopup._isOpen = false;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n});\r\n\n\n/*\r\n * Popup extension to L.Marker, adding popup-related methods.\r\n */\r\n\r\nL.Marker.include({\r\n\topenPopup: function () {\r\n\t\tif (this._popup && this._map && !this._map.hasLayer(this._popup)) {\r\n\t\t\tthis._popup.setLatLng(this._latlng);\r\n\t\t\tthis._map.openPopup(this._popup);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tclosePopup: function () {\r\n\t\tif (this._popup) {\r\n\t\t\tthis._popup._close();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\ttogglePopup: function () {\r\n\t\tif (this._popup) {\r\n\t\t\tif (this._popup._isOpen) {\r\n\t\t\t\tthis.closePopup();\r\n\t\t\t} else {\r\n\t\t\t\tthis.openPopup();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tbindPopup: function (content, options) {\r\n\t\tvar anchor = L.point(this.options.icon.options.popupAnchor || [0, 0]);\r\n\r\n\t\tanchor = anchor.add(L.Popup.prototype.options.offset);\r\n\r\n\t\tif (options && options.offset) {\r\n\t\t\tanchor = anchor.add(options.offset);\r\n\t\t}\r\n\r\n\t\toptions = L.extend({offset: anchor}, options);\r\n\r\n\t\tif (!this._popupHandlersAdded) {\r\n\t\t\tthis\r\n\t\t\t    .on('click', this.togglePopup, this)\r\n\t\t\t    .on('remove', this.closePopup, this)\r\n\t\t\t    .on('move', this._movePopup, this);\r\n\t\t\tthis._popupHandlersAdded = true;\r\n\t\t}\r\n\r\n\t\tif (content instanceof L.Popup) {\r\n\t\t\tL.setOptions(content, options);\r\n\t\t\tthis._popup = content;\r\n\t\t} else {\r\n\t\t\tthis._popup = new L.Popup(options, this)\r\n\t\t\t\t.setContent(content);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetPopupContent: function (content) {\r\n\t\tif (this._popup) {\r\n\t\t\tthis._popup.setContent(content);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tunbindPopup: function () {\r\n\t\tif (this._popup) {\r\n\t\t\tthis._popup = null;\r\n\t\t\tthis\r\n\t\t\t    .off('click', this.togglePopup, this)\r\n\t\t\t    .off('remove', this.closePopup, this)\r\n\t\t\t    .off('move', this._movePopup, this);\r\n\t\t\tthis._popupHandlersAdded = false;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetPopup: function () {\r\n\t\treturn this._popup;\r\n\t},\r\n\r\n\t_movePopup: function (e) {\r\n\t\tthis._popup.setLatLng(e.latlng);\r\n\t}\r\n});\r\n\n\n/*\r\n * L.LayerGroup is a class to combine several layers into one so that\r\n * you can manipulate the group (e.g. add/remove it) as one layer.\r\n */\r\n\r\nL.LayerGroup = L.Class.extend({\r\n\tinitialize: function (layers) {\r\n\t\tthis._layers = {};\r\n\r\n\t\tvar i, len;\r\n\r\n\t\tif (layers) {\r\n\t\t\tfor (i = 0, len = layers.length; i < len; i++) {\r\n\t\t\t\tthis.addLayer(layers[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\taddLayer: function (layer) {\r\n\t\tvar id = this.getLayerId(layer);\r\n\r\n\t\tthis._layers[id] = layer;\r\n\r\n\t\tif (this._map) {\r\n\t\t\tthis._map.addLayer(layer);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveLayer: function (layer) {\r\n\t\tvar id = layer in this._layers ? layer : this.getLayerId(layer);\r\n\r\n\t\tif (this._map && this._layers[id]) {\r\n\t\t\tthis._map.removeLayer(this._layers[id]);\r\n\t\t}\r\n\r\n\t\tdelete this._layers[id];\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\thasLayer: function (layer) {\r\n\t\tif (!layer) { return false; }\r\n\r\n\t\treturn (layer in this._layers || this.getLayerId(layer) in this._layers);\r\n\t},\r\n\r\n\tclearLayers: function () {\r\n\t\tthis.eachLayer(this.removeLayer, this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tinvoke: function (methodName) {\r\n\t\tvar args = Array.prototype.slice.call(arguments, 1),\r\n\t\t    i, layer;\r\n\r\n\t\tfor (i in this._layers) {\r\n\t\t\tlayer = this._layers[i];\r\n\r\n\t\t\tif (layer[methodName]) {\r\n\t\t\t\tlayer[methodName].apply(layer, args);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\t\tthis.eachLayer(map.addLayer, map);\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tthis.eachLayer(map.removeLayer, map);\r\n\t\tthis._map = null;\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tmap.addLayer(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\teachLayer: function (method, context) {\r\n\t\tfor (var i in this._layers) {\r\n\t\t\tmethod.call(context, this._layers[i]);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetLayer: function (id) {\r\n\t\treturn this._layers[id];\r\n\t},\r\n\r\n\tgetLayers: function () {\r\n\t\tvar layers = [];\r\n\r\n\t\tfor (var i in this._layers) {\r\n\t\t\tlayers.push(this._layers[i]);\r\n\t\t}\r\n\t\treturn layers;\r\n\t},\r\n\r\n\tsetZIndex: function (zIndex) {\r\n\t\treturn this.invoke('setZIndex', zIndex);\r\n\t},\r\n\r\n\tgetLayerId: function (layer) {\r\n\t\treturn L.stamp(layer);\r\n\t}\r\n});\r\n\r\nL.layerGroup = function (layers) {\r\n\treturn new L.LayerGroup(layers);\r\n};\r\n\n\n/*\r\n * L.FeatureGroup extends L.LayerGroup by introducing mouse events and additional methods\r\n * shared between a group of interactive layers (like vectors or markers).\r\n */\r\n\r\nL.FeatureGroup = L.LayerGroup.extend({\r\n\tincludes: L.Mixin.Events,\r\n\r\n\tstatics: {\r\n\t\tEVENTS: 'click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose'\r\n\t},\r\n\r\n\taddLayer: function (layer) {\r\n\t\tif (this.hasLayer(layer)) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tif ('on' in layer) {\r\n\t\t\tlayer.on(L.FeatureGroup.EVENTS, this._propagateEvent, this);\r\n\t\t}\r\n\r\n\t\tL.LayerGroup.prototype.addLayer.call(this, layer);\r\n\r\n\t\tif (this._popupContent && layer.bindPopup) {\r\n\t\t\tlayer.bindPopup(this._popupContent, this._popupOptions);\r\n\t\t}\r\n\r\n\t\treturn this.fire('layeradd', {layer: layer});\r\n\t},\r\n\r\n\tremoveLayer: function (layer) {\r\n\t\tif (!this.hasLayer(layer)) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tif (layer in this._layers) {\r\n\t\t\tlayer = this._layers[layer];\r\n\t\t}\r\n\r\n\t\tlayer.off(L.FeatureGroup.EVENTS, this._propagateEvent, this);\r\n\r\n\t\tL.LayerGroup.prototype.removeLayer.call(this, layer);\r\n\r\n\t\tif (this._popupContent) {\r\n\t\t\tthis.invoke('unbindPopup');\r\n\t\t}\r\n\r\n\t\treturn this.fire('layerremove', {layer: layer});\r\n\t},\r\n\r\n\tbindPopup: function (content, options) {\r\n\t\tthis._popupContent = content;\r\n\t\tthis._popupOptions = options;\r\n\t\treturn this.invoke('bindPopup', content, options);\r\n\t},\r\n\r\n\topenPopup: function (latlng) {\r\n\t\t// open popup on the first layer\r\n\t\tfor (var id in this._layers) {\r\n\t\t\tthis._layers[id].openPopup(latlng);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetStyle: function (style) {\r\n\t\treturn this.invoke('setStyle', style);\r\n\t},\r\n\r\n\tbringToFront: function () {\r\n\t\treturn this.invoke('bringToFront');\r\n\t},\r\n\r\n\tbringToBack: function () {\r\n\t\treturn this.invoke('bringToBack');\r\n\t},\r\n\r\n\tgetBounds: function () {\r\n\t\tvar bounds = new L.LatLngBounds();\r\n\r\n\t\tthis.eachLayer(function (layer) {\r\n\t\t\tbounds.extend(layer instanceof L.Marker ? layer.getLatLng() : layer.getBounds());\r\n\t\t});\r\n\r\n\t\treturn bounds;\r\n\t},\r\n\r\n\t_propagateEvent: function (e) {\r\n\t\te = L.extend({\r\n\t\t\tlayer: e.target,\r\n\t\t\ttarget: this\r\n\t\t}, e);\r\n\t\tthis.fire(e.type, e);\r\n\t}\r\n});\r\n\r\nL.featureGroup = function (layers) {\r\n\treturn new L.FeatureGroup(layers);\r\n};\r\n\n\n/*\r\n * L.Path is a base class for rendering vector paths on a map. Inherited by Polyline, Circle, etc.\r\n */\r\n\r\nL.Path = L.Class.extend({\r\n\tincludes: [L.Mixin.Events],\r\n\r\n\tstatics: {\r\n\t\t// how much to extend the clip area around the map view\r\n\t\t// (relative to its size, e.g. 0.5 is half the screen in each direction)\r\n\t\t// set it so that SVG element doesn't exceed 1280px (vectors flicker on dragend if it is)\r\n\t\tCLIP_PADDING: (function () {\r\n\t\t\tvar max = L.Browser.mobile ? 1280 : 2000,\r\n\t\t\t    target = (max / Math.max(window.outerWidth, window.outerHeight) - 1) / 2;\r\n\t\t\treturn Math.max(0, Math.min(0.5, target));\r\n\t\t})()\r\n\t},\r\n\r\n\toptions: {\r\n\t\tstroke: true,\r\n\t\tcolor: '#0033ff',\r\n\t\tdashArray: null,\r\n\t\tlineCap: null,\r\n\t\tlineJoin: null,\r\n\t\tweight: 5,\r\n\t\topacity: 0.5,\r\n\r\n\t\tfill: false,\r\n\t\tfillColor: null, //same as color by default\r\n\t\tfillOpacity: 0.2,\r\n\r\n\t\tclickable: true\r\n\t},\r\n\r\n\tinitialize: function (options) {\r\n\t\tL.setOptions(this, options);\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tif (!this._container) {\r\n\t\t\tthis._initElements();\r\n\t\t\tthis._initEvents();\r\n\t\t}\r\n\r\n\t\tthis.projectLatlngs();\r\n\t\tthis._updatePath();\r\n\r\n\t\tif (this._container) {\r\n\t\t\tthis._map._pathRoot.appendChild(this._container);\r\n\t\t}\r\n\r\n\t\tthis.fire('add');\r\n\r\n\t\tmap.on({\r\n\t\t\t'viewreset': this.projectLatlngs,\r\n\t\t\t'moveend': this._updatePath\r\n\t\t}, this);\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tmap.addLayer(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap._pathRoot.removeChild(this._container);\r\n\r\n\t\t// Need to fire remove event before we set _map to null as the event hooks might need the object\r\n\t\tthis.fire('remove');\r\n\t\tthis._map = null;\r\n\r\n\t\tif (L.Browser.vml) {\r\n\t\t\tthis._container = null;\r\n\t\t\tthis._stroke = null;\r\n\t\t\tthis._fill = null;\r\n\t\t}\r\n\r\n\t\tmap.off({\r\n\t\t\t'viewreset': this.projectLatlngs,\r\n\t\t\t'moveend': this._updatePath\r\n\t\t}, this);\r\n\t},\r\n\r\n\tprojectLatlngs: function () {\r\n\t\t// do all projection stuff here\r\n\t},\r\n\r\n\tsetStyle: function (style) {\r\n\t\tL.setOptions(this, style);\r\n\r\n\t\tif (this._container) {\r\n\t\t\tthis._updateStyle();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tredraw: function () {\r\n\t\tif (this._map) {\r\n\t\t\tthis.projectLatlngs();\r\n\t\t\tthis._updatePath();\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n});\r\n\r\nL.Map.include({\r\n\t_updatePathViewport: function () {\r\n\t\tvar p = L.Path.CLIP_PADDING,\r\n\t\t    size = this.getSize(),\r\n\t\t    panePos = L.DomUtil.getPosition(this._mapPane),\r\n\t\t    min = panePos.multiplyBy(-1)._subtract(size.multiplyBy(p)._round()),\r\n\t\t    max = min.add(size.multiplyBy(1 + p * 2)._round());\r\n\r\n\t\tthis._pathViewport = new L.Bounds(min, max);\r\n\t}\r\n});\r\n\n\n/*\r\n * Extends L.Path with SVG-specific rendering code.\r\n */\r\n\r\nL.Path.SVG_NS = 'http://www.w3.org/2000/svg';\r\n\r\nL.Browser.svg = !!(document.createElementNS && document.createElementNS(L.Path.SVG_NS, 'svg').createSVGRect);\r\n\r\nL.Path = L.Path.extend({\r\n\tstatics: {\r\n\t\tSVG: L.Browser.svg\r\n\t},\r\n\r\n\tbringToFront: function () {\r\n\t\tvar root = this._map._pathRoot,\r\n\t\t    path = this._container;\r\n\r\n\t\tif (path && root.lastChild !== path) {\r\n\t\t\troot.appendChild(path);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tbringToBack: function () {\r\n\t\tvar root = this._map._pathRoot,\r\n\t\t    path = this._container,\r\n\t\t    first = root.firstChild;\r\n\r\n\t\tif (path && first !== path) {\r\n\t\t\troot.insertBefore(path, first);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetPathString: function () {\r\n\t\t// form path string here\r\n\t},\r\n\r\n\t_createElement: function (name) {\r\n\t\treturn document.createElementNS(L.Path.SVG_NS, name);\r\n\t},\r\n\r\n\t_initElements: function () {\r\n\t\tthis._map._initPathRoot();\r\n\t\tthis._initPath();\r\n\t\tthis._initStyle();\r\n\t},\r\n\r\n\t_initPath: function () {\r\n\t\tthis._container = this._createElement('g');\r\n\r\n\t\tthis._path = this._createElement('path');\r\n\r\n\t\tif (this.options.className) {\r\n\t\t\tL.DomUtil.addClass(this._path, this.options.className);\r\n\t\t}\r\n\r\n\t\tthis._container.appendChild(this._path);\r\n\t},\r\n\r\n\t_initStyle: function () {\r\n\t\tif (this.options.stroke) {\r\n\t\t\tthis._path.setAttribute('stroke-linejoin', 'round');\r\n\t\t\tthis._path.setAttribute('stroke-linecap', 'round');\r\n\t\t}\r\n\t\tif (this.options.fill) {\r\n\t\t\tthis._path.setAttribute('fill-rule', 'evenodd');\r\n\t\t}\r\n\t\tif (this.options.pointerEvents) {\r\n\t\t\tthis._path.setAttribute('pointer-events', this.options.pointerEvents);\r\n\t\t}\r\n\t\tif (!this.options.clickable && !this.options.pointerEvents) {\r\n\t\t\tthis._path.setAttribute('pointer-events', 'none');\r\n\t\t}\r\n\t\tthis._updateStyle();\r\n\t},\r\n\r\n\t_updateStyle: function () {\r\n\t\tif (this.options.stroke) {\r\n\t\t\tthis._path.setAttribute('stroke', this.options.color);\r\n\t\t\tthis._path.setAttribute('stroke-opacity', this.options.opacity);\r\n\t\t\tthis._path.setAttribute('stroke-width', this.options.weight);\r\n\t\t\tif (this.options.dashArray) {\r\n\t\t\t\tthis._path.setAttribute('stroke-dasharray', this.options.dashArray);\r\n\t\t\t} else {\r\n\t\t\t\tthis._path.removeAttribute('stroke-dasharray');\r\n\t\t\t}\r\n\t\t\tif (this.options.lineCap) {\r\n\t\t\t\tthis._path.setAttribute('stroke-linecap', this.options.lineCap);\r\n\t\t\t}\r\n\t\t\tif (this.options.lineJoin) {\r\n\t\t\t\tthis._path.setAttribute('stroke-linejoin', this.options.lineJoin);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis._path.setAttribute('stroke', 'none');\r\n\t\t}\r\n\t\tif (this.options.fill) {\r\n\t\t\tthis._path.setAttribute('fill', this.options.fillColor || this.options.color);\r\n\t\t\tthis._path.setAttribute('fill-opacity', this.options.fillOpacity);\r\n\t\t} else {\r\n\t\t\tthis._path.setAttribute('fill', 'none');\r\n\t\t}\r\n\t},\r\n\r\n\t_updatePath: function () {\r\n\t\tvar str = this.getPathString();\r\n\t\tif (!str) {\r\n\t\t\t// fix webkit empty string parsing bug\r\n\t\t\tstr = 'M0 0';\r\n\t\t}\r\n\t\tthis._path.setAttribute('d', str);\r\n\t},\r\n\r\n\t// TODO remove duplication with L.Map\r\n\t_initEvents: function () {\r\n\t\tif (this.options.clickable) {\r\n\t\t\tif (L.Browser.svg || !L.Browser.vml) {\r\n\t\t\t\tL.DomUtil.addClass(this._path, 'leaflet-clickable');\r\n\t\t\t}\r\n\r\n\t\t\tL.DomEvent.on(this._container, 'click', this._onMouseClick, this);\r\n\r\n\t\t\tvar events = ['dblclick', 'mousedown', 'mouseover',\r\n\t\t\t              'mouseout', 'mousemove', 'contextmenu'];\r\n\t\t\tfor (var i = 0; i < events.length; i++) {\r\n\t\t\t\tL.DomEvent.on(this._container, events[i], this._fireMouseEvent, this);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_onMouseClick: function (e) {\r\n\t\tif (this._map.dragging && this._map.dragging.moved()) { return; }\r\n\r\n\t\tthis._fireMouseEvent(e);\r\n\t},\r\n\r\n\t_fireMouseEvent: function (e) {\r\n\t\tif (!this.hasEventListeners(e.type)) { return; }\r\n\r\n\t\tvar map = this._map,\r\n\t\t    containerPoint = map.mouseEventToContainerPoint(e),\r\n\t\t    layerPoint = map.containerPointToLayerPoint(containerPoint),\r\n\t\t    latlng = map.layerPointToLatLng(layerPoint);\r\n\r\n\t\tthis.fire(e.type, {\r\n\t\t\tlatlng: latlng,\r\n\t\t\tlayerPoint: layerPoint,\r\n\t\t\tcontainerPoint: containerPoint,\r\n\t\t\toriginalEvent: e\r\n\t\t});\r\n\r\n\t\tif (e.type === 'contextmenu') {\r\n\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t}\r\n\t\tif (e.type !== 'mousemove') {\r\n\t\t\tL.DomEvent.stopPropagation(e);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.Map.include({\r\n\t_initPathRoot: function () {\r\n\t\tif (!this._pathRoot) {\r\n\t\t\tthis._pathRoot = L.Path.prototype._createElement('svg');\r\n\t\t\tthis._panes.overlayPane.appendChild(this._pathRoot);\r\n\r\n\t\t\tif (this.options.zoomAnimation && L.Browser.any3d) {\r\n\t\t\t\tL.DomUtil.addClass(this._pathRoot, 'leaflet-zoom-animated');\r\n\r\n\t\t\t\tthis.on({\r\n\t\t\t\t\t'zoomanim': this._animatePathZoom,\r\n\t\t\t\t\t'zoomend': this._endPathZoom\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tL.DomUtil.addClass(this._pathRoot, 'leaflet-zoom-hide');\r\n\t\t\t}\r\n\r\n\t\t\tthis.on('moveend', this._updateSvgViewport);\r\n\t\t\tthis._updateSvgViewport();\r\n\t\t}\r\n\t},\r\n\r\n\t_animatePathZoom: function (e) {\r\n\t\tvar scale = this.getZoomScale(e.zoom),\r\n\t\t    offset = this._getCenterOffset(e.center)._multiplyBy(-scale)._add(this._pathViewport.min);\r\n\r\n\t\tthis._pathRoot.style[L.DomUtil.TRANSFORM] =\r\n\t\t        L.DomUtil.getTranslateString(offset) + ' scale(' + scale + ') ';\r\n\r\n\t\tthis._pathZooming = true;\r\n\t},\r\n\r\n\t_endPathZoom: function () {\r\n\t\tthis._pathZooming = false;\r\n\t},\r\n\r\n\t_updateSvgViewport: function () {\r\n\r\n\t\tif (this._pathZooming) {\r\n\t\t\t// Do not update SVGs while a zoom animation is going on otherwise the animation will break.\r\n\t\t\t// When the zoom animation ends we will be updated again anyway\r\n\t\t\t// This fixes the case where you do a momentum move and zoom while the move is still ongoing.\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._updatePathViewport();\r\n\r\n\t\tvar vp = this._pathViewport,\r\n\t\t    min = vp.min,\r\n\t\t    max = vp.max,\r\n\t\t    width = max.x - min.x,\r\n\t\t    height = max.y - min.y,\r\n\t\t    root = this._pathRoot,\r\n\t\t    pane = this._panes.overlayPane;\r\n\r\n\t\t// Hack to make flicker on drag end on mobile webkit less irritating\r\n\t\tif (L.Browser.mobileWebkit) {\r\n\t\t\tpane.removeChild(root);\r\n\t\t}\r\n\r\n\t\tL.DomUtil.setPosition(root, min);\r\n\t\troot.setAttribute('width', width);\r\n\t\troot.setAttribute('height', height);\r\n\t\troot.setAttribute('viewBox', [min.x, min.y, width, height].join(' '));\r\n\r\n\t\tif (L.Browser.mobileWebkit) {\r\n\t\t\tpane.appendChild(root);\r\n\t\t}\r\n\t}\r\n});\r\n\n\n/*\r\n * Popup extension to L.Path (polylines, polygons, circles), adding popup-related methods.\r\n */\r\n\r\nL.Path.include({\r\n\r\n\tbindPopup: function (content, options) {\r\n\r\n\t\tif (content instanceof L.Popup) {\r\n\t\t\tthis._popup = content;\r\n\t\t} else {\r\n\t\t\tif (!this._popup || options) {\r\n\t\t\t\tthis._popup = new L.Popup(options, this);\r\n\t\t\t}\r\n\t\t\tthis._popup.setContent(content);\r\n\t\t}\r\n\r\n\t\tif (!this._popupHandlersAdded) {\r\n\t\t\tthis\r\n\t\t\t    .on('click', this._openPopup, this)\r\n\t\t\t    .on('remove', this.closePopup, this);\r\n\r\n\t\t\tthis._popupHandlersAdded = true;\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tunbindPopup: function () {\r\n\t\tif (this._popup) {\r\n\t\t\tthis._popup = null;\r\n\t\t\tthis\r\n\t\t\t    .off('click', this._openPopup)\r\n\t\t\t    .off('remove', this.closePopup);\r\n\r\n\t\t\tthis._popupHandlersAdded = false;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\topenPopup: function (latlng) {\r\n\r\n\t\tif (this._popup) {\r\n\t\t\t// open the popup from one of the path's points if not specified\r\n\t\t\tlatlng = latlng || this._latlng ||\r\n\t\t\t         this._latlngs[Math.floor(this._latlngs.length / 2)];\r\n\r\n\t\t\tthis._openPopup({latlng: latlng});\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tclosePopup: function () {\r\n\t\tif (this._popup) {\r\n\t\t\tthis._popup._close();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_openPopup: function (e) {\r\n\t\tthis._popup.setLatLng(e.latlng);\r\n\t\tthis._map.openPopup(this._popup);\r\n\t}\r\n});\r\n\n\n/*\r\n * Vector rendering for IE6-8 through VML.\r\n * Thanks to Dmitry Baranovsky and his Raphael library for inspiration!\r\n */\r\n\r\nL.Browser.vml = !L.Browser.svg && (function () {\r\n\ttry {\r\n\t\tvar div = document.createElement('div');\r\n\t\tdiv.innerHTML = '<v:shape adj=\"1\"/>';\r\n\r\n\t\tvar shape = div.firstChild;\r\n\t\tshape.style.behavior = 'url(#default#VML)';\r\n\r\n\t\treturn shape && (typeof shape.adj === 'object');\r\n\r\n\t} catch (e) {\r\n\t\treturn false;\r\n\t}\r\n}());\r\n\r\nL.Path = L.Browser.svg || !L.Browser.vml ? L.Path : L.Path.extend({\r\n\tstatics: {\r\n\t\tVML: true,\r\n\t\tCLIP_PADDING: 0.02\r\n\t},\r\n\r\n\t_createElement: (function () {\r\n\t\ttry {\r\n\t\t\tdocument.namespaces.add('lvml', 'urn:schemas-microsoft-com:vml');\r\n\t\t\treturn function (name) {\r\n\t\t\t\treturn document.createElement('<lvml:' + name + ' class=\"lvml\">');\r\n\t\t\t};\r\n\t\t} catch (e) {\r\n\t\t\treturn function (name) {\r\n\t\t\t\treturn document.createElement(\r\n\t\t\t\t        '<' + name + ' xmlns=\"urn:schemas-microsoft.com:vml\" class=\"lvml\">');\r\n\t\t\t};\r\n\t\t}\r\n\t}()),\r\n\r\n\t_initPath: function () {\r\n\t\tvar container = this._container = this._createElement('shape');\r\n\r\n\t\tL.DomUtil.addClass(container, 'leaflet-vml-shape' +\r\n\t\t\t(this.options.className ? ' ' + this.options.className : ''));\r\n\r\n\t\tif (this.options.clickable) {\r\n\t\t\tL.DomUtil.addClass(container, 'leaflet-clickable');\r\n\t\t}\r\n\r\n\t\tcontainer.coordsize = '1 1';\r\n\r\n\t\tthis._path = this._createElement('path');\r\n\t\tcontainer.appendChild(this._path);\r\n\r\n\t\tthis._map._pathRoot.appendChild(container);\r\n\t},\r\n\r\n\t_initStyle: function () {\r\n\t\tthis._updateStyle();\r\n\t},\r\n\r\n\t_updateStyle: function () {\r\n\t\tvar stroke = this._stroke,\r\n\t\t    fill = this._fill,\r\n\t\t    options = this.options,\r\n\t\t    container = this._container;\r\n\r\n\t\tcontainer.stroked = options.stroke;\r\n\t\tcontainer.filled = options.fill;\r\n\r\n\t\tif (options.stroke) {\r\n\t\t\tif (!stroke) {\r\n\t\t\t\tstroke = this._stroke = this._createElement('stroke');\r\n\t\t\t\tstroke.endcap = 'round';\r\n\t\t\t\tcontainer.appendChild(stroke);\r\n\t\t\t}\r\n\t\t\tstroke.weight = options.weight + 'px';\r\n\t\t\tstroke.color = options.color;\r\n\t\t\tstroke.opacity = options.opacity;\r\n\r\n\t\t\tif (options.dashArray) {\r\n\t\t\t\tstroke.dashStyle = L.Util.isArray(options.dashArray) ?\r\n\t\t\t\t    options.dashArray.join(' ') :\r\n\t\t\t\t    options.dashArray.replace(/( *, *)/g, ' ');\r\n\t\t\t} else {\r\n\t\t\t\tstroke.dashStyle = '';\r\n\t\t\t}\r\n\t\t\tif (options.lineCap) {\r\n\t\t\t\tstroke.endcap = options.lineCap.replace('butt', 'flat');\r\n\t\t\t}\r\n\t\t\tif (options.lineJoin) {\r\n\t\t\t\tstroke.joinstyle = options.lineJoin;\r\n\t\t\t}\r\n\r\n\t\t} else if (stroke) {\r\n\t\t\tcontainer.removeChild(stroke);\r\n\t\t\tthis._stroke = null;\r\n\t\t}\r\n\r\n\t\tif (options.fill) {\r\n\t\t\tif (!fill) {\r\n\t\t\t\tfill = this._fill = this._createElement('fill');\r\n\t\t\t\tcontainer.appendChild(fill);\r\n\t\t\t}\r\n\t\t\tfill.color = options.fillColor || options.color;\r\n\t\t\tfill.opacity = options.fillOpacity;\r\n\r\n\t\t} else if (fill) {\r\n\t\t\tcontainer.removeChild(fill);\r\n\t\t\tthis._fill = null;\r\n\t\t}\r\n\t},\r\n\r\n\t_updatePath: function () {\r\n\t\tvar style = this._container.style;\r\n\r\n\t\tstyle.display = 'none';\r\n\t\tthis._path.v = this.getPathString() + ' '; // the space fixes IE empty path string bug\r\n\t\tstyle.display = '';\r\n\t}\r\n});\r\n\r\nL.Map.include(L.Browser.svg || !L.Browser.vml ? {} : {\r\n\t_initPathRoot: function () {\r\n\t\tif (this._pathRoot) { return; }\r\n\r\n\t\tvar root = this._pathRoot = document.createElement('div');\r\n\t\troot.className = 'leaflet-vml-container';\r\n\t\tthis._panes.overlayPane.appendChild(root);\r\n\r\n\t\tthis.on('moveend', this._updatePathViewport);\r\n\t\tthis._updatePathViewport();\r\n\t}\r\n});\r\n\n\n/*\r\n * Vector rendering for all browsers that support canvas.\r\n */\r\n\r\nL.Browser.canvas = (function () {\r\n\treturn !!document.createElement('canvas').getContext;\r\n}());\r\n\r\nL.Path = (L.Path.SVG && !window.L_PREFER_CANVAS) || !L.Browser.canvas ? L.Path : L.Path.extend({\r\n\tstatics: {\r\n\t\t//CLIP_PADDING: 0.02, // not sure if there's a need to set it to a small value\r\n\t\tCANVAS: true,\r\n\t\tSVG: false\r\n\t},\r\n\r\n\tredraw: function () {\r\n\t\tif (this._map) {\r\n\t\t\tthis.projectLatlngs();\r\n\t\t\tthis._requestUpdate();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetStyle: function (style) {\r\n\t\tL.setOptions(this, style);\r\n\r\n\t\tif (this._map) {\r\n\t\t\tthis._updateStyle();\r\n\t\t\tthis._requestUpdate();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap\r\n\t\t    .off('viewreset', this.projectLatlngs, this)\r\n\t\t    .off('moveend', this._updatePath, this);\r\n\r\n\t\tif (this.options.clickable) {\r\n\t\t\tthis._map.off('click', this._onClick, this);\r\n\t\t\tthis._map.off('mousemove', this._onMouseMove, this);\r\n\t\t}\r\n\r\n\t\tthis._requestUpdate();\r\n\t\t\r\n\t\tthis.fire('remove');\r\n\t\tthis._map = null;\r\n\t},\r\n\r\n\t_requestUpdate: function () {\r\n\t\tif (this._map && !L.Path._updateRequest) {\r\n\t\t\tL.Path._updateRequest = L.Util.requestAnimFrame(this._fireMapMoveEnd, this._map);\r\n\t\t}\r\n\t},\r\n\r\n\t_fireMapMoveEnd: function () {\r\n\t\tL.Path._updateRequest = null;\r\n\t\tthis.fire('moveend');\r\n\t},\r\n\r\n\t_initElements: function () {\r\n\t\tthis._map._initPathRoot();\r\n\t\tthis._ctx = this._map._canvasCtx;\r\n\t},\r\n\r\n\t_updateStyle: function () {\r\n\t\tvar options = this.options;\r\n\r\n\t\tif (options.stroke) {\r\n\t\t\tthis._ctx.lineWidth = options.weight;\r\n\t\t\tthis._ctx.strokeStyle = options.color;\r\n\t\t}\r\n\t\tif (options.fill) {\r\n\t\t\tthis._ctx.fillStyle = options.fillColor || options.color;\r\n\t\t}\r\n\t},\r\n\r\n\t_drawPath: function () {\r\n\t\tvar i, j, len, len2, point, drawMethod;\r\n\r\n\t\tthis._ctx.beginPath();\r\n\r\n\t\tfor (i = 0, len = this._parts.length; i < len; i++) {\r\n\t\t\tfor (j = 0, len2 = this._parts[i].length; j < len2; j++) {\r\n\t\t\t\tpoint = this._parts[i][j];\r\n\t\t\t\tdrawMethod = (j === 0 ? 'move' : 'line') + 'To';\r\n\r\n\t\t\t\tthis._ctx[drawMethod](point.x, point.y);\r\n\t\t\t}\r\n\t\t\t// TODO refactor ugly hack\r\n\t\t\tif (this instanceof L.Polygon) {\r\n\t\t\t\tthis._ctx.closePath();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_checkIfEmpty: function () {\r\n\t\treturn !this._parts.length;\r\n\t},\r\n\r\n\t_updatePath: function () {\r\n\t\tif (this._checkIfEmpty()) { return; }\r\n\r\n\t\tvar ctx = this._ctx,\r\n\t\t    options = this.options;\r\n\r\n\t\tthis._drawPath();\r\n\t\tctx.save();\r\n\t\tthis._updateStyle();\r\n\r\n\t\tif (options.fill) {\r\n\t\t\tctx.globalAlpha = options.fillOpacity;\r\n\t\t\tctx.fill();\r\n\t\t}\r\n\r\n\t\tif (options.stroke) {\r\n\t\t\tctx.globalAlpha = options.opacity;\r\n\t\t\tctx.stroke();\r\n\t\t}\r\n\r\n\t\tctx.restore();\r\n\r\n\t\t// TODO optimization: 1 fill/stroke for all features with equal style instead of 1 for each feature\r\n\t},\r\n\r\n\t_initEvents: function () {\r\n\t\tif (this.options.clickable) {\r\n\t\t\t// TODO dblclick\r\n\t\t\tthis._map.on('mousemove', this._onMouseMove, this);\r\n\t\t\tthis._map.on('click', this._onClick, this);\r\n\t\t}\r\n\t},\r\n\r\n\t_onClick: function (e) {\r\n\t\tif (this._containsPoint(e.layerPoint)) {\r\n\t\t\tthis.fire('click', e);\r\n\t\t}\r\n\t},\r\n\r\n\t_onMouseMove: function (e) {\r\n\t\tif (!this._map || this._map._animatingZoom) { return; }\r\n\r\n\t\t// TODO don't do on each move\r\n\t\tif (this._containsPoint(e.layerPoint)) {\r\n\t\t\tthis._ctx.canvas.style.cursor = 'pointer';\r\n\t\t\tthis._mouseInside = true;\r\n\t\t\tthis.fire('mouseover', e);\r\n\r\n\t\t} else if (this._mouseInside) {\r\n\t\t\tthis._ctx.canvas.style.cursor = '';\r\n\t\t\tthis._mouseInside = false;\r\n\t\t\tthis.fire('mouseout', e);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.Map.include((L.Path.SVG && !window.L_PREFER_CANVAS) || !L.Browser.canvas ? {} : {\r\n\t_initPathRoot: function () {\r\n\t\tvar root = this._pathRoot,\r\n\t\t    ctx;\r\n\r\n\t\tif (!root) {\r\n\t\t\troot = this._pathRoot = document.createElement('canvas');\r\n\t\t\troot.style.position = 'absolute';\r\n\t\t\tctx = this._canvasCtx = root.getContext('2d');\r\n\r\n\t\t\tctx.lineCap = 'round';\r\n\t\t\tctx.lineJoin = 'round';\r\n\r\n\t\t\tthis._panes.overlayPane.appendChild(root);\r\n\r\n\t\t\tif (this.options.zoomAnimation) {\r\n\t\t\t\tthis._pathRoot.className = 'leaflet-zoom-animated';\r\n\t\t\t\tthis.on('zoomanim', this._animatePathZoom);\r\n\t\t\t\tthis.on('zoomend', this._endPathZoom);\r\n\t\t\t}\r\n\t\t\tthis.on('moveend', this._updateCanvasViewport);\r\n\t\t\tthis._updateCanvasViewport();\r\n\t\t}\r\n\t},\r\n\r\n\t_updateCanvasViewport: function () {\r\n\t\t// don't redraw while zooming. See _updateSvgViewport for more details\r\n\t\tif (this._pathZooming) { return; }\r\n\t\tthis._updatePathViewport();\r\n\r\n\t\tvar vp = this._pathViewport,\r\n\t\t    min = vp.min,\r\n\t\t    size = vp.max.subtract(min),\r\n\t\t    root = this._pathRoot;\r\n\r\n\t\t//TODO check if this works properly on mobile webkit\r\n\t\tL.DomUtil.setPosition(root, min);\r\n\t\troot.width = size.x;\r\n\t\troot.height = size.y;\r\n\t\troot.getContext('2d').translate(-min.x, -min.y);\r\n\t}\r\n});\r\n\n\n/*\r\n * L.LineUtil contains different utility functions for line segments\r\n * and polylines (clipping, simplification, distances, etc.)\r\n */\r\n\r\n/*jshint bitwise:false */ // allow bitwise operations for this file\r\n\r\nL.LineUtil = {\r\n\r\n\t// Simplify polyline with vertex reduction and Douglas-Peucker simplification.\r\n\t// Improves rendering performance dramatically by lessening the number of points to draw.\r\n\r\n\tsimplify: function (/*Point[]*/ points, /*Number*/ tolerance) {\r\n\t\tif (!tolerance || !points.length) {\r\n\t\t\treturn points.slice();\r\n\t\t}\r\n\r\n\t\tvar sqTolerance = tolerance * tolerance;\r\n\r\n\t\t// stage 1: vertex reduction\r\n\t\tpoints = this._reducePoints(points, sqTolerance);\r\n\r\n\t\t// stage 2: Douglas-Peucker simplification\r\n\t\tpoints = this._simplifyDP(points, sqTolerance);\r\n\r\n\t\treturn points;\r\n\t},\r\n\r\n\t// distance from a point to a segment between two points\r\n\tpointToSegmentDistance:  function (/*Point*/ p, /*Point*/ p1, /*Point*/ p2) {\r\n\t\treturn Math.sqrt(this._sqClosestPointOnSegment(p, p1, p2, true));\r\n\t},\r\n\r\n\tclosestPointOnSegment: function (/*Point*/ p, /*Point*/ p1, /*Point*/ p2) {\r\n\t\treturn this._sqClosestPointOnSegment(p, p1, p2);\r\n\t},\r\n\r\n\t// Douglas-Peucker simplification, see http://en.wikipedia.org/wiki/Douglas-Peucker_algorithm\r\n\t_simplifyDP: function (points, sqTolerance) {\r\n\r\n\t\tvar len = points.length,\r\n\t\t    ArrayConstructor = typeof Uint8Array !== undefined + '' ? Uint8Array : Array,\r\n\t\t    markers = new ArrayConstructor(len);\r\n\r\n\t\tmarkers[0] = markers[len - 1] = 1;\r\n\r\n\t\tthis._simplifyDPStep(points, markers, sqTolerance, 0, len - 1);\r\n\r\n\t\tvar i,\r\n\t\t    newPoints = [];\r\n\r\n\t\tfor (i = 0; i < len; i++) {\r\n\t\t\tif (markers[i]) {\r\n\t\t\t\tnewPoints.push(points[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn newPoints;\r\n\t},\r\n\r\n\t_simplifyDPStep: function (points, markers, sqTolerance, first, last) {\r\n\r\n\t\tvar maxSqDist = 0,\r\n\t\t    index, i, sqDist;\r\n\r\n\t\tfor (i = first + 1; i <= last - 1; i++) {\r\n\t\t\tsqDist = this._sqClosestPointOnSegment(points[i], points[first], points[last], true);\r\n\r\n\t\t\tif (sqDist > maxSqDist) {\r\n\t\t\t\tindex = i;\r\n\t\t\t\tmaxSqDist = sqDist;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (maxSqDist > sqTolerance) {\r\n\t\t\tmarkers[index] = 1;\r\n\r\n\t\t\tthis._simplifyDPStep(points, markers, sqTolerance, first, index);\r\n\t\t\tthis._simplifyDPStep(points, markers, sqTolerance, index, last);\r\n\t\t}\r\n\t},\r\n\r\n\t// reduce points that are too close to each other to a single point\r\n\t_reducePoints: function (points, sqTolerance) {\r\n\t\tvar reducedPoints = [points[0]];\r\n\r\n\t\tfor (var i = 1, prev = 0, len = points.length; i < len; i++) {\r\n\t\t\tif (this._sqDist(points[i], points[prev]) > sqTolerance) {\r\n\t\t\t\treducedPoints.push(points[i]);\r\n\t\t\t\tprev = i;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (prev < len - 1) {\r\n\t\t\treducedPoints.push(points[len - 1]);\r\n\t\t}\r\n\t\treturn reducedPoints;\r\n\t},\r\n\r\n\t// Cohen-Sutherland line clipping algorithm.\r\n\t// Used to avoid rendering parts of a polyline that are not currently visible.\r\n\r\n\tclipSegment: function (a, b, bounds, useLastCode) {\r\n\t\tvar codeA = useLastCode ? this._lastCode : this._getBitCode(a, bounds),\r\n\t\t    codeB = this._getBitCode(b, bounds),\r\n\r\n\t\t    codeOut, p, newCode;\r\n\r\n\t\t// save 2nd code to avoid calculating it on the next segment\r\n\t\tthis._lastCode = codeB;\r\n\r\n\t\twhile (true) {\r\n\t\t\t// if a,b is inside the clip window (trivial accept)\r\n\t\t\tif (!(codeA | codeB)) {\r\n\t\t\t\treturn [a, b];\r\n\t\t\t// if a,b is outside the clip window (trivial reject)\r\n\t\t\t} else if (codeA & codeB) {\r\n\t\t\t\treturn false;\r\n\t\t\t// other cases\r\n\t\t\t} else {\r\n\t\t\t\tcodeOut = codeA || codeB;\r\n\t\t\t\tp = this._getEdgeIntersection(a, b, codeOut, bounds);\r\n\t\t\t\tnewCode = this._getBitCode(p, bounds);\r\n\r\n\t\t\t\tif (codeOut === codeA) {\r\n\t\t\t\t\ta = p;\r\n\t\t\t\t\tcodeA = newCode;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tb = p;\r\n\t\t\t\t\tcodeB = newCode;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_getEdgeIntersection: function (a, b, code, bounds) {\r\n\t\tvar dx = b.x - a.x,\r\n\t\t    dy = b.y - a.y,\r\n\t\t    min = bounds.min,\r\n\t\t    max = bounds.max;\r\n\r\n\t\tif (code & 8) { // top\r\n\t\t\treturn new L.Point(a.x + dx * (max.y - a.y) / dy, max.y);\r\n\t\t} else if (code & 4) { // bottom\r\n\t\t\treturn new L.Point(a.x + dx * (min.y - a.y) / dy, min.y);\r\n\t\t} else if (code & 2) { // right\r\n\t\t\treturn new L.Point(max.x, a.y + dy * (max.x - a.x) / dx);\r\n\t\t} else if (code & 1) { // left\r\n\t\t\treturn new L.Point(min.x, a.y + dy * (min.x - a.x) / dx);\r\n\t\t}\r\n\t},\r\n\r\n\t_getBitCode: function (/*Point*/ p, bounds) {\r\n\t\tvar code = 0;\r\n\r\n\t\tif (p.x < bounds.min.x) { // left\r\n\t\t\tcode |= 1;\r\n\t\t} else if (p.x > bounds.max.x) { // right\r\n\t\t\tcode |= 2;\r\n\t\t}\r\n\t\tif (p.y < bounds.min.y) { // bottom\r\n\t\t\tcode |= 4;\r\n\t\t} else if (p.y > bounds.max.y) { // top\r\n\t\t\tcode |= 8;\r\n\t\t}\r\n\r\n\t\treturn code;\r\n\t},\r\n\r\n\t// square distance (to avoid unnecessary Math.sqrt calls)\r\n\t_sqDist: function (p1, p2) {\r\n\t\tvar dx = p2.x - p1.x,\r\n\t\t    dy = p2.y - p1.y;\r\n\t\treturn dx * dx + dy * dy;\r\n\t},\r\n\r\n\t// return closest point on segment or distance to that point\r\n\t_sqClosestPointOnSegment: function (p, p1, p2, sqDist) {\r\n\t\tvar x = p1.x,\r\n\t\t    y = p1.y,\r\n\t\t    dx = p2.x - x,\r\n\t\t    dy = p2.y - y,\r\n\t\t    dot = dx * dx + dy * dy,\r\n\t\t    t;\r\n\r\n\t\tif (dot > 0) {\r\n\t\t\tt = ((p.x - x) * dx + (p.y - y) * dy) / dot;\r\n\r\n\t\t\tif (t > 1) {\r\n\t\t\t\tx = p2.x;\r\n\t\t\t\ty = p2.y;\r\n\t\t\t} else if (t > 0) {\r\n\t\t\t\tx += dx * t;\r\n\t\t\t\ty += dy * t;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tdx = p.x - x;\r\n\t\tdy = p.y - y;\r\n\r\n\t\treturn sqDist ? dx * dx + dy * dy : new L.Point(x, y);\r\n\t}\r\n};\r\n\n\n/*\r\n * L.Polyline is used to display polylines on a map.\r\n */\r\n\r\nL.Polyline = L.Path.extend({\r\n\tinitialize: function (latlngs, options) {\r\n\t\tL.Path.prototype.initialize.call(this, options);\r\n\r\n\t\tthis._latlngs = this._convertLatLngs(latlngs);\r\n\t},\r\n\r\n\toptions: {\r\n\t\t// how much to simplify the polyline on each zoom level\r\n\t\t// more = better performance and smoother look, less = more accurate\r\n\t\tsmoothFactor: 1.0,\r\n\t\tnoClip: false\r\n\t},\r\n\r\n\tprojectLatlngs: function () {\r\n\t\tthis._originalPoints = [];\r\n\r\n\t\tfor (var i = 0, len = this._latlngs.length; i < len; i++) {\r\n\t\t\tthis._originalPoints[i] = this._map.latLngToLayerPoint(this._latlngs[i]);\r\n\t\t}\r\n\t},\r\n\r\n\tgetPathString: function () {\r\n\t\tfor (var i = 0, len = this._parts.length, str = ''; i < len; i++) {\r\n\t\t\tstr += this._getPathPartStr(this._parts[i]);\r\n\t\t}\r\n\t\treturn str;\r\n\t},\r\n\r\n\tgetLatLngs: function () {\r\n\t\treturn this._latlngs;\r\n\t},\r\n\r\n\tsetLatLngs: function (latlngs) {\r\n\t\tthis._latlngs = this._convertLatLngs(latlngs);\r\n\t\treturn this.redraw();\r\n\t},\r\n\r\n\taddLatLng: function (latlng) {\r\n\t\tthis._latlngs.push(L.latLng(latlng));\r\n\t\treturn this.redraw();\r\n\t},\r\n\r\n\tspliceLatLngs: function () { // (Number index, Number howMany)\r\n\t\tvar removed = [].splice.apply(this._latlngs, arguments);\r\n\t\tthis._convertLatLngs(this._latlngs, true);\r\n\t\tthis.redraw();\r\n\t\treturn removed;\r\n\t},\r\n\r\n\tclosestLayerPoint: function (p) {\r\n\t\tvar minDistance = Infinity, parts = this._parts, p1, p2, minPoint = null;\r\n\r\n\t\tfor (var j = 0, jLen = parts.length; j < jLen; j++) {\r\n\t\t\tvar points = parts[j];\r\n\t\t\tfor (var i = 1, len = points.length; i < len; i++) {\r\n\t\t\t\tp1 = points[i - 1];\r\n\t\t\t\tp2 = points[i];\r\n\t\t\t\tvar sqDist = L.LineUtil._sqClosestPointOnSegment(p, p1, p2, true);\r\n\t\t\t\tif (sqDist < minDistance) {\r\n\t\t\t\t\tminDistance = sqDist;\r\n\t\t\t\t\tminPoint = L.LineUtil._sqClosestPointOnSegment(p, p1, p2);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (minPoint) {\r\n\t\t\tminPoint.distance = Math.sqrt(minDistance);\r\n\t\t}\r\n\t\treturn minPoint;\r\n\t},\r\n\r\n\tgetBounds: function () {\r\n\t\treturn new L.LatLngBounds(this.getLatLngs());\r\n\t},\r\n\r\n\t_convertLatLngs: function (latlngs, overwrite) {\r\n\t\tvar i, len, target = overwrite ? latlngs : [];\r\n\r\n\t\tfor (i = 0, len = latlngs.length; i < len; i++) {\r\n\t\t\tif (L.Util.isArray(latlngs[i]) && typeof latlngs[i][0] !== 'number') {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\ttarget[i] = L.latLng(latlngs[i]);\r\n\t\t}\r\n\t\treturn target;\r\n\t},\r\n\r\n\t_initEvents: function () {\r\n\t\tL.Path.prototype._initEvents.call(this);\r\n\t},\r\n\r\n\t_getPathPartStr: function (points) {\r\n\t\tvar round = L.Path.VML;\r\n\r\n\t\tfor (var j = 0, len2 = points.length, str = '', p; j < len2; j++) {\r\n\t\t\tp = points[j];\r\n\t\t\tif (round) {\r\n\t\t\t\tp._round();\r\n\t\t\t}\r\n\t\t\tstr += (j ? 'L' : 'M') + p.x + ' ' + p.y;\r\n\t\t}\r\n\t\treturn str;\r\n\t},\r\n\r\n\t_clipPoints: function () {\r\n\t\tvar points = this._originalPoints,\r\n\t\t    len = points.length,\r\n\t\t    i, k, segment;\r\n\r\n\t\tif (this.options.noClip) {\r\n\t\t\tthis._parts = [points];\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._parts = [];\r\n\r\n\t\tvar parts = this._parts,\r\n\t\t    vp = this._map._pathViewport,\r\n\t\t    lu = L.LineUtil;\r\n\r\n\t\tfor (i = 0, k = 0; i < len - 1; i++) {\r\n\t\t\tsegment = lu.clipSegment(points[i], points[i + 1], vp, i);\r\n\t\t\tif (!segment) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tparts[k] = parts[k] || [];\r\n\t\t\tparts[k].push(segment[0]);\r\n\r\n\t\t\t// if segment goes out of screen, or it's the last one, it's the end of the line part\r\n\t\t\tif ((segment[1] !== points[i + 1]) || (i === len - 2)) {\r\n\t\t\t\tparts[k].push(segment[1]);\r\n\t\t\t\tk++;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t// simplify each clipped part of the polyline\r\n\t_simplifyPoints: function () {\r\n\t\tvar parts = this._parts,\r\n\t\t    lu = L.LineUtil;\r\n\r\n\t\tfor (var i = 0, len = parts.length; i < len; i++) {\r\n\t\t\tparts[i] = lu.simplify(parts[i], this.options.smoothFactor);\r\n\t\t}\r\n\t},\r\n\r\n\t_updatePath: function () {\r\n\t\tif (!this._map) { return; }\r\n\r\n\t\tthis._clipPoints();\r\n\t\tthis._simplifyPoints();\r\n\r\n\t\tL.Path.prototype._updatePath.call(this);\r\n\t}\r\n});\r\n\r\nL.polyline = function (latlngs, options) {\r\n\treturn new L.Polyline(latlngs, options);\r\n};\r\n\n\n/*\r\n * L.PolyUtil contains utility functions for polygons (clipping, etc.).\r\n */\r\n\r\n/*jshint bitwise:false */ // allow bitwise operations here\r\n\r\nL.PolyUtil = {};\r\n\r\n/*\r\n * Sutherland-Hodgeman polygon clipping algorithm.\r\n * Used to avoid rendering parts of a polygon that are not currently visible.\r\n */\r\nL.PolyUtil.clipPolygon = function (points, bounds) {\r\n\tvar clippedPoints,\r\n\t    edges = [1, 4, 2, 8],\r\n\t    i, j, k,\r\n\t    a, b,\r\n\t    len, edge, p,\r\n\t    lu = L.LineUtil;\r\n\r\n\tfor (i = 0, len = points.length; i < len; i++) {\r\n\t\tpoints[i]._code = lu._getBitCode(points[i], bounds);\r\n\t}\r\n\r\n\t// for each edge (left, bottom, right, top)\r\n\tfor (k = 0; k < 4; k++) {\r\n\t\tedge = edges[k];\r\n\t\tclippedPoints = [];\r\n\r\n\t\tfor (i = 0, len = points.length, j = len - 1; i < len; j = i++) {\r\n\t\t\ta = points[i];\r\n\t\t\tb = points[j];\r\n\r\n\t\t\t// if a is inside the clip window\r\n\t\t\tif (!(a._code & edge)) {\r\n\t\t\t\t// if b is outside the clip window (a->b goes out of screen)\r\n\t\t\t\tif (b._code & edge) {\r\n\t\t\t\t\tp = lu._getEdgeIntersection(b, a, edge, bounds);\r\n\t\t\t\t\tp._code = lu._getBitCode(p, bounds);\r\n\t\t\t\t\tclippedPoints.push(p);\r\n\t\t\t\t}\r\n\t\t\t\tclippedPoints.push(a);\r\n\r\n\t\t\t// else if b is inside the clip window (a->b enters the screen)\r\n\t\t\t} else if (!(b._code & edge)) {\r\n\t\t\t\tp = lu._getEdgeIntersection(b, a, edge, bounds);\r\n\t\t\t\tp._code = lu._getBitCode(p, bounds);\r\n\t\t\t\tclippedPoints.push(p);\r\n\t\t\t}\r\n\t\t}\r\n\t\tpoints = clippedPoints;\r\n\t}\r\n\r\n\treturn points;\r\n};\r\n\n\n/*\r\n * L.Polygon is used to display polygons on a map.\r\n */\r\n\r\nL.Polygon = L.Polyline.extend({\r\n\toptions: {\r\n\t\tfill: true\r\n\t},\r\n\r\n\tinitialize: function (latlngs, options) {\r\n\t\tL.Polyline.prototype.initialize.call(this, latlngs, options);\r\n\t\tthis._initWithHoles(latlngs);\r\n\t},\r\n\r\n\t_initWithHoles: function (latlngs) {\r\n\t\tvar i, len, hole;\r\n\t\tif (latlngs && L.Util.isArray(latlngs[0]) && (typeof latlngs[0][0] !== 'number')) {\r\n\t\t\tthis._latlngs = this._convertLatLngs(latlngs[0]);\r\n\t\t\tthis._holes = latlngs.slice(1);\r\n\r\n\t\t\tfor (i = 0, len = this._holes.length; i < len; i++) {\r\n\t\t\t\thole = this._holes[i] = this._convertLatLngs(this._holes[i]);\r\n\t\t\t\tif (hole[0].equals(hole[hole.length - 1])) {\r\n\t\t\t\t\thole.pop();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// filter out last point if its equal to the first one\r\n\t\tlatlngs = this._latlngs;\r\n\r\n\t\tif (latlngs.length >= 2 && latlngs[0].equals(latlngs[latlngs.length - 1])) {\r\n\t\t\tlatlngs.pop();\r\n\t\t}\r\n\t},\r\n\r\n\tprojectLatlngs: function () {\r\n\t\tL.Polyline.prototype.projectLatlngs.call(this);\r\n\r\n\t\t// project polygon holes points\r\n\t\t// TODO move this logic to Polyline to get rid of duplication\r\n\t\tthis._holePoints = [];\r\n\r\n\t\tif (!this._holes) { return; }\r\n\r\n\t\tvar i, j, len, len2;\r\n\r\n\t\tfor (i = 0, len = this._holes.length; i < len; i++) {\r\n\t\t\tthis._holePoints[i] = [];\r\n\r\n\t\t\tfor (j = 0, len2 = this._holes[i].length; j < len2; j++) {\r\n\t\t\t\tthis._holePoints[i][j] = this._map.latLngToLayerPoint(this._holes[i][j]);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tsetLatLngs: function (latlngs) {\r\n\t\tif (latlngs && L.Util.isArray(latlngs[0]) && (typeof latlngs[0][0] !== 'number')) {\r\n\t\t\tthis._initWithHoles(latlngs);\r\n\t\t\treturn this.redraw();\r\n\t\t} else {\r\n\t\t\treturn L.Polyline.prototype.setLatLngs.call(this, latlngs);\r\n\t\t}\r\n\t},\r\n\r\n\t_clipPoints: function () {\r\n\t\tvar points = this._originalPoints,\r\n\t\t    newParts = [];\r\n\r\n\t\tthis._parts = [points].concat(this._holePoints);\r\n\r\n\t\tif (this.options.noClip) { return; }\r\n\r\n\t\tfor (var i = 0, len = this._parts.length; i < len; i++) {\r\n\t\t\tvar clipped = L.PolyUtil.clipPolygon(this._parts[i], this._map._pathViewport);\r\n\t\t\tif (clipped.length) {\r\n\t\t\t\tnewParts.push(clipped);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._parts = newParts;\r\n\t},\r\n\r\n\t_getPathPartStr: function (points) {\r\n\t\tvar str = L.Polyline.prototype._getPathPartStr.call(this, points);\r\n\t\treturn str + (L.Browser.svg ? 'z' : 'x');\r\n\t}\r\n});\r\n\r\nL.polygon = function (latlngs, options) {\r\n\treturn new L.Polygon(latlngs, options);\r\n};\r\n\n\n/*\r\n * Contains L.MultiPolyline and L.MultiPolygon layers.\r\n */\r\n\r\n(function () {\r\n\tfunction createMulti(Klass) {\r\n\r\n\t\treturn L.FeatureGroup.extend({\r\n\r\n\t\t\tinitialize: function (latlngs, options) {\r\n\t\t\t\tthis._layers = {};\r\n\t\t\t\tthis._options = options;\r\n\t\t\t\tthis.setLatLngs(latlngs);\r\n\t\t\t},\r\n\r\n\t\t\tsetLatLngs: function (latlngs) {\r\n\t\t\t\tvar i = 0,\r\n\t\t\t\t    len = latlngs.length;\r\n\r\n\t\t\t\tthis.eachLayer(function (layer) {\r\n\t\t\t\t\tif (i < len) {\r\n\t\t\t\t\t\tlayer.setLatLngs(latlngs[i++]);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.removeLayer(layer);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, this);\r\n\r\n\t\t\t\twhile (i < len) {\r\n\t\t\t\t\tthis.addLayer(new Klass(latlngs[i++], this._options));\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\tgetLatLngs: function () {\r\n\t\t\t\tvar latlngs = [];\r\n\r\n\t\t\t\tthis.eachLayer(function (layer) {\r\n\t\t\t\t\tlatlngs.push(layer.getLatLngs());\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn latlngs;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tL.MultiPolyline = createMulti(L.Polyline);\r\n\tL.MultiPolygon = createMulti(L.Polygon);\r\n\r\n\tL.multiPolyline = function (latlngs, options) {\r\n\t\treturn new L.MultiPolyline(latlngs, options);\r\n\t};\r\n\r\n\tL.multiPolygon = function (latlngs, options) {\r\n\t\treturn new L.MultiPolygon(latlngs, options);\r\n\t};\r\n}());\r\n\n\n/*\r\n * L.Rectangle extends Polygon and creates a rectangle when passed a LatLngBounds object.\r\n */\r\n\r\nL.Rectangle = L.Polygon.extend({\r\n\tinitialize: function (latLngBounds, options) {\r\n\t\tL.Polygon.prototype.initialize.call(this, this._boundsToLatLngs(latLngBounds), options);\r\n\t},\r\n\r\n\tsetBounds: function (latLngBounds) {\r\n\t\tthis.setLatLngs(this._boundsToLatLngs(latLngBounds));\r\n\t},\r\n\r\n\t_boundsToLatLngs: function (latLngBounds) {\r\n\t\tlatLngBounds = L.latLngBounds(latLngBounds);\r\n\t\treturn [\r\n\t\t\tlatLngBounds.getSouthWest(),\r\n\t\t\tlatLngBounds.getNorthWest(),\r\n\t\t\tlatLngBounds.getNorthEast(),\r\n\t\t\tlatLngBounds.getSouthEast()\r\n\t\t];\r\n\t}\r\n});\r\n\r\nL.rectangle = function (latLngBounds, options) {\r\n\treturn new L.Rectangle(latLngBounds, options);\r\n};\r\n\n\n/*\r\n * L.Circle is a circle overlay (with a certain radius in meters).\r\n */\r\n\r\nL.Circle = L.Path.extend({\r\n\tinitialize: function (latlng, radius, options) {\r\n\t\tL.Path.prototype.initialize.call(this, options);\r\n\r\n\t\tthis._latlng = L.latLng(latlng);\r\n\t\tthis._mRadius = radius;\r\n\t},\r\n\r\n\toptions: {\r\n\t\tfill: true\r\n\t},\r\n\r\n\tsetLatLng: function (latlng) {\r\n\t\tthis._latlng = L.latLng(latlng);\r\n\t\treturn this.redraw();\r\n\t},\r\n\r\n\tsetRadius: function (radius) {\r\n\t\tthis._mRadius = radius;\r\n\t\treturn this.redraw();\r\n\t},\r\n\r\n\tprojectLatlngs: function () {\r\n\t\tvar lngRadius = this._getLngRadius(),\r\n\t\t    latlng = this._latlng,\r\n\t\t    pointLeft = this._map.latLngToLayerPoint([latlng.lat, latlng.lng - lngRadius]);\r\n\r\n\t\tthis._point = this._map.latLngToLayerPoint(latlng);\r\n\t\tthis._radius = Math.max(this._point.x - pointLeft.x, 1);\r\n\t},\r\n\r\n\tgetBounds: function () {\r\n\t\tvar lngRadius = this._getLngRadius(),\r\n\t\t    latRadius = (this._mRadius / 40075017) * 360,\r\n\t\t    latlng = this._latlng;\r\n\r\n\t\treturn new L.LatLngBounds(\r\n\t\t        [latlng.lat - latRadius, latlng.lng - lngRadius],\r\n\t\t        [latlng.lat + latRadius, latlng.lng + lngRadius]);\r\n\t},\r\n\r\n\tgetLatLng: function () {\r\n\t\treturn this._latlng;\r\n\t},\r\n\r\n\tgetPathString: function () {\r\n\t\tvar p = this._point,\r\n\t\t    r = this._radius;\r\n\r\n\t\tif (this._checkIfEmpty()) {\r\n\t\t\treturn '';\r\n\t\t}\r\n\r\n\t\tif (L.Browser.svg) {\r\n\t\t\treturn 'M' + p.x + ',' + (p.y - r) +\r\n\t\t\t       'A' + r + ',' + r + ',0,1,1,' +\r\n\t\t\t       (p.x - 0.1) + ',' + (p.y - r) + ' z';\r\n\t\t} else {\r\n\t\t\tp._round();\r\n\t\t\tr = Math.round(r);\r\n\t\t\treturn 'AL ' + p.x + ',' + p.y + ' ' + r + ',' + r + ' 0,' + (65535 * 360);\r\n\t\t}\r\n\t},\r\n\r\n\tgetRadius: function () {\r\n\t\treturn this._mRadius;\r\n\t},\r\n\r\n\t// TODO Earth hardcoded, move into projection code!\r\n\r\n\t_getLatRadius: function () {\r\n\t\treturn (this._mRadius / 40075017) * 360;\r\n\t},\r\n\r\n\t_getLngRadius: function () {\r\n\t\treturn this._getLatRadius() / Math.cos(L.LatLng.DEG_TO_RAD * this._latlng.lat);\r\n\t},\r\n\r\n\t_checkIfEmpty: function () {\r\n\t\tif (!this._map) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar vp = this._map._pathViewport,\r\n\t\t    r = this._radius,\r\n\t\t    p = this._point;\r\n\r\n\t\treturn p.x - r > vp.max.x || p.y - r > vp.max.y ||\r\n\t\t       p.x + r < vp.min.x || p.y + r < vp.min.y;\r\n\t}\r\n});\r\n\r\nL.circle = function (latlng, radius, options) {\r\n\treturn new L.Circle(latlng, radius, options);\r\n};\r\n\n\n/*\r\n * L.CircleMarker is a circle overlay with a permanent pixel radius.\r\n */\r\n\r\nL.CircleMarker = L.Circle.extend({\r\n\toptions: {\r\n\t\tradius: 10,\r\n\t\tweight: 2\r\n\t},\r\n\r\n\tinitialize: function (latlng, options) {\r\n\t\tL.Circle.prototype.initialize.call(this, latlng, null, options);\r\n\t\tthis._radius = this.options.radius;\r\n\t},\r\n\r\n\tprojectLatlngs: function () {\r\n\t\tthis._point = this._map.latLngToLayerPoint(this._latlng);\r\n\t},\r\n\r\n\t_updateStyle : function () {\r\n\t\tL.Circle.prototype._updateStyle.call(this);\r\n\t\tthis.setRadius(this.options.radius);\r\n\t},\r\n\r\n\tsetLatLng: function (latlng) {\r\n\t\tL.Circle.prototype.setLatLng.call(this, latlng);\r\n\t\tif (this._popup && this._popup._isOpen) {\r\n\t\t\tthis._popup.setLatLng(latlng);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetRadius: function (radius) {\r\n\t\tthis.options.radius = this._radius = radius;\r\n\t\treturn this.redraw();\r\n\t},\r\n\r\n\tgetRadius: function () {\r\n\t\treturn this._radius;\r\n\t}\r\n});\r\n\r\nL.circleMarker = function (latlng, options) {\r\n\treturn new L.CircleMarker(latlng, options);\r\n};\r\n\n\n/*\r\n * Extends L.Polyline to be able to manually detect clicks on Canvas-rendered polylines.\r\n */\r\n\r\nL.Polyline.include(!L.Path.CANVAS ? {} : {\r\n\t_containsPoint: function (p, closed) {\r\n\t\tvar i, j, k, len, len2, dist, part,\r\n\t\t    w = this.options.weight / 2;\r\n\r\n\t\tif (L.Browser.touch) {\r\n\t\t\tw += 10; // polyline click tolerance on touch devices\r\n\t\t}\r\n\r\n\t\tfor (i = 0, len = this._parts.length; i < len; i++) {\r\n\t\t\tpart = this._parts[i];\r\n\t\t\tfor (j = 0, len2 = part.length, k = len2 - 1; j < len2; k = j++) {\r\n\t\t\t\tif (!closed && (j === 0)) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdist = L.LineUtil.pointToSegmentDistance(p, part[k], part[j]);\r\n\r\n\t\t\t\tif (dist <= w) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n});\r\n\n\n/*\r\n * Extends L.Polygon to be able to manually detect clicks on Canvas-rendered polygons.\r\n */\r\n\r\nL.Polygon.include(!L.Path.CANVAS ? {} : {\r\n\t_containsPoint: function (p) {\r\n\t\tvar inside = false,\r\n\t\t    part, p1, p2,\r\n\t\t    i, j, k,\r\n\t\t    len, len2;\r\n\r\n\t\t// TODO optimization: check if within bounds first\r\n\r\n\t\tif (L.Polyline.prototype._containsPoint.call(this, p, true)) {\r\n\t\t\t// click on polygon border\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t// ray casting algorithm for detecting if point is in polygon\r\n\r\n\t\tfor (i = 0, len = this._parts.length; i < len; i++) {\r\n\t\t\tpart = this._parts[i];\r\n\r\n\t\t\tfor (j = 0, len2 = part.length, k = len2 - 1; j < len2; k = j++) {\r\n\t\t\t\tp1 = part[j];\r\n\t\t\t\tp2 = part[k];\r\n\r\n\t\t\t\tif (((p1.y > p.y) !== (p2.y > p.y)) &&\r\n\t\t\t\t\t\t(p.x < (p2.x - p1.x) * (p.y - p1.y) / (p2.y - p1.y) + p1.x)) {\r\n\t\t\t\t\tinside = !inside;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn inside;\r\n\t}\r\n});\r\n\n\n/*\r\n * Extends L.Circle with Canvas-specific code.\r\n */\r\n\r\nL.Circle.include(!L.Path.CANVAS ? {} : {\r\n\t_drawPath: function () {\r\n\t\tvar p = this._point;\r\n\t\tthis._ctx.beginPath();\r\n\t\tthis._ctx.arc(p.x, p.y, this._radius, 0, Math.PI * 2, false);\r\n\t},\r\n\r\n\t_containsPoint: function (p) {\r\n\t\tvar center = this._point,\r\n\t\t    w2 = this.options.stroke ? this.options.weight / 2 : 0;\r\n\r\n\t\treturn (p.distanceTo(center) <= this._radius + w2);\r\n\t}\r\n});\r\n\n\n/*\n * CircleMarker canvas specific drawing parts.\n */\n\nL.CircleMarker.include(!L.Path.CANVAS ? {} : {\n\t_updateStyle: function () {\n\t\tL.Path.prototype._updateStyle.call(this);\n\t}\n});\n\n\n/*\r\n * L.GeoJSON turns any GeoJSON data into a Leaflet layer.\r\n */\r\n\r\nL.GeoJSON = L.FeatureGroup.extend({\r\n\r\n\tinitialize: function (geojson, options) {\r\n\t\tL.setOptions(this, options);\r\n\r\n\t\tthis._layers = {};\r\n\r\n\t\tif (geojson) {\r\n\t\t\tthis.addData(geojson);\r\n\t\t}\r\n\t},\r\n\r\n\taddData: function (geojson) {\r\n\t\tvar features = L.Util.isArray(geojson) ? geojson : geojson.features,\r\n\t\t    i, len, feature;\r\n\r\n\t\tif (features) {\r\n\t\t\tfor (i = 0, len = features.length; i < len; i++) {\r\n\t\t\t\t// Only add this if geometry or geometries are set and not null\r\n\t\t\t\tfeature = features[i];\r\n\t\t\t\tif (feature.geometries || feature.geometry || feature.features || feature.coordinates) {\r\n\t\t\t\t\tthis.addData(features[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tvar options = this.options;\r\n\r\n\t\tif (options.filter && !options.filter(geojson)) { return; }\r\n\r\n\t\tvar layer = L.GeoJSON.geometryToLayer(geojson, options.pointToLayer, options.coordsToLatLng, options);\r\n\t\tlayer.feature = L.GeoJSON.asFeature(geojson);\r\n\r\n\t\tlayer.defaultOptions = layer.options;\r\n\t\tthis.resetStyle(layer);\r\n\r\n\t\tif (options.onEachFeature) {\r\n\t\t\toptions.onEachFeature(geojson, layer);\r\n\t\t}\r\n\r\n\t\treturn this.addLayer(layer);\r\n\t},\r\n\r\n\tresetStyle: function (layer) {\r\n\t\tvar style = this.options.style;\r\n\t\tif (style) {\r\n\t\t\t// reset any custom styles\r\n\t\t\tL.Util.extend(layer.options, layer.defaultOptions);\r\n\r\n\t\t\tthis._setLayerStyle(layer, style);\r\n\t\t}\r\n\t},\r\n\r\n\tsetStyle: function (style) {\r\n\t\tthis.eachLayer(function (layer) {\r\n\t\t\tthis._setLayerStyle(layer, style);\r\n\t\t}, this);\r\n\t},\r\n\r\n\t_setLayerStyle: function (layer, style) {\r\n\t\tif (typeof style === 'function') {\r\n\t\t\tstyle = style(layer.feature);\r\n\t\t}\r\n\t\tif (layer.setStyle) {\r\n\t\t\tlayer.setStyle(style);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.extend(L.GeoJSON, {\r\n\tgeometryToLayer: function (geojson, pointToLayer, coordsToLatLng, vectorOptions) {\r\n\t\tvar geometry = geojson.type === 'Feature' ? geojson.geometry : geojson,\r\n\t\t    coords = geometry.coordinates,\r\n\t\t    layers = [],\r\n\t\t    latlng, latlngs, i, len;\r\n\r\n\t\tcoordsToLatLng = coordsToLatLng || this.coordsToLatLng;\r\n\r\n\t\tswitch (geometry.type) {\r\n\t\tcase 'Point':\r\n\t\t\tlatlng = coordsToLatLng(coords);\r\n\t\t\treturn pointToLayer ? pointToLayer(geojson, latlng) : new L.Marker(latlng);\r\n\r\n\t\tcase 'MultiPoint':\r\n\t\t\tfor (i = 0, len = coords.length; i < len; i++) {\r\n\t\t\t\tlatlng = coordsToLatLng(coords[i]);\r\n\t\t\t\tlayers.push(pointToLayer ? pointToLayer(geojson, latlng) : new L.Marker(latlng));\r\n\t\t\t}\r\n\t\t\treturn new L.FeatureGroup(layers);\r\n\r\n\t\tcase 'LineString':\r\n\t\t\tlatlngs = this.coordsToLatLngs(coords, 0, coordsToLatLng);\r\n\t\t\treturn new L.Polyline(latlngs, vectorOptions);\r\n\r\n\t\tcase 'Polygon':\r\n\t\t\tif (coords.length === 2 && !coords[1].length) {\r\n\t\t\t\tthrow new Error('Invalid GeoJSON object.');\r\n\t\t\t}\r\n\t\t\tlatlngs = this.coordsToLatLngs(coords, 1, coordsToLatLng);\r\n\t\t\treturn new L.Polygon(latlngs, vectorOptions);\r\n\r\n\t\tcase 'MultiLineString':\r\n\t\t\tlatlngs = this.coordsToLatLngs(coords, 1, coordsToLatLng);\r\n\t\t\treturn new L.MultiPolyline(latlngs, vectorOptions);\r\n\r\n\t\tcase 'MultiPolygon':\r\n\t\t\tlatlngs = this.coordsToLatLngs(coords, 2, coordsToLatLng);\r\n\t\t\treturn new L.MultiPolygon(latlngs, vectorOptions);\r\n\r\n\t\tcase 'GeometryCollection':\r\n\t\t\tfor (i = 0, len = geometry.geometries.length; i < len; i++) {\r\n\r\n\t\t\t\tlayers.push(this.geometryToLayer({\r\n\t\t\t\t\tgeometry: geometry.geometries[i],\r\n\t\t\t\t\ttype: 'Feature',\r\n\t\t\t\t\tproperties: geojson.properties\r\n\t\t\t\t}, pointToLayer, coordsToLatLng, vectorOptions));\r\n\t\t\t}\r\n\t\t\treturn new L.FeatureGroup(layers);\r\n\r\n\t\tdefault:\r\n\t\t\tthrow new Error('Invalid GeoJSON object.');\r\n\t\t}\r\n\t},\r\n\r\n\tcoordsToLatLng: function (coords) { // (Array[, Boolean]) -> LatLng\r\n\t\treturn new L.LatLng(coords[1], coords[0], coords[2]);\r\n\t},\r\n\r\n\tcoordsToLatLngs: function (coords, levelsDeep, coordsToLatLng) { // (Array[, Number, Function]) -> Array\r\n\t\tvar latlng, i, len,\r\n\t\t    latlngs = [];\r\n\r\n\t\tfor (i = 0, len = coords.length; i < len; i++) {\r\n\t\t\tlatlng = levelsDeep ?\r\n\t\t\t        this.coordsToLatLngs(coords[i], levelsDeep - 1, coordsToLatLng) :\r\n\t\t\t        (coordsToLatLng || this.coordsToLatLng)(coords[i]);\r\n\r\n\t\t\tlatlngs.push(latlng);\r\n\t\t}\r\n\r\n\t\treturn latlngs;\r\n\t},\r\n\r\n\tlatLngToCoords: function (latlng) {\r\n\t\tvar coords = [latlng.lng, latlng.lat];\r\n\r\n\t\tif (latlng.alt !== undefined) {\r\n\t\t\tcoords.push(latlng.alt);\r\n\t\t}\r\n\t\treturn coords;\r\n\t},\r\n\r\n\tlatLngsToCoords: function (latLngs) {\r\n\t\tvar coords = [];\r\n\r\n\t\tfor (var i = 0, len = latLngs.length; i < len; i++) {\r\n\t\t\tcoords.push(L.GeoJSON.latLngToCoords(latLngs[i]));\r\n\t\t}\r\n\r\n\t\treturn coords;\r\n\t},\r\n\r\n\tgetFeature: function (layer, newGeometry) {\r\n\t\treturn layer.feature ? L.extend({}, layer.feature, {geometry: newGeometry}) : L.GeoJSON.asFeature(newGeometry);\r\n\t},\r\n\r\n\tasFeature: function (geoJSON) {\r\n\t\tif (geoJSON.type === 'Feature') {\r\n\t\t\treturn geoJSON;\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\ttype: 'Feature',\r\n\t\t\tproperties: {},\r\n\t\t\tgeometry: geoJSON\r\n\t\t};\r\n\t}\r\n});\r\n\r\nvar PointToGeoJSON = {\r\n\ttoGeoJSON: function () {\r\n\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\ttype: 'Point',\r\n\t\t\tcoordinates: L.GeoJSON.latLngToCoords(this.getLatLng())\r\n\t\t});\r\n\t}\r\n};\r\n\r\nL.Marker.include(PointToGeoJSON);\r\nL.Circle.include(PointToGeoJSON);\r\nL.CircleMarker.include(PointToGeoJSON);\r\n\r\nL.Polyline.include({\r\n\ttoGeoJSON: function () {\r\n\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\ttype: 'LineString',\r\n\t\t\tcoordinates: L.GeoJSON.latLngsToCoords(this.getLatLngs())\r\n\t\t});\r\n\t}\r\n});\r\n\r\nL.Polygon.include({\r\n\ttoGeoJSON: function () {\r\n\t\tvar coords = [L.GeoJSON.latLngsToCoords(this.getLatLngs())],\r\n\t\t    i, len, hole;\r\n\r\n\t\tcoords[0].push(coords[0][0]);\r\n\r\n\t\tif (this._holes) {\r\n\t\t\tfor (i = 0, len = this._holes.length; i < len; i++) {\r\n\t\t\t\thole = L.GeoJSON.latLngsToCoords(this._holes[i]);\r\n\t\t\t\thole.push(hole[0]);\r\n\t\t\t\tcoords.push(hole);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\ttype: 'Polygon',\r\n\t\t\tcoordinates: coords\r\n\t\t});\r\n\t}\r\n});\r\n\r\n(function () {\r\n\tfunction multiToGeoJSON(type) {\r\n\t\treturn function () {\r\n\t\t\tvar coords = [];\r\n\r\n\t\t\tthis.eachLayer(function (layer) {\r\n\t\t\t\tcoords.push(layer.toGeoJSON().geometry.coordinates);\r\n\t\t\t});\r\n\r\n\t\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\t\ttype: type,\r\n\t\t\t\tcoordinates: coords\r\n\t\t\t});\r\n\t\t};\r\n\t}\r\n\r\n\tL.MultiPolyline.include({toGeoJSON: multiToGeoJSON('MultiLineString')});\r\n\tL.MultiPolygon.include({toGeoJSON: multiToGeoJSON('MultiPolygon')});\r\n\r\n\tL.LayerGroup.include({\r\n\t\ttoGeoJSON: function () {\r\n\r\n\t\t\tvar geometry = this.feature && this.feature.geometry,\r\n\t\t\t\tjsons = [],\r\n\t\t\t\tjson;\r\n\r\n\t\t\tif (geometry && geometry.type === 'MultiPoint') {\r\n\t\t\t\treturn multiToGeoJSON('MultiPoint').call(this);\r\n\t\t\t}\r\n\r\n\t\t\tvar isGeometryCollection = geometry && geometry.type === 'GeometryCollection';\r\n\r\n\t\t\tthis.eachLayer(function (layer) {\r\n\t\t\t\tif (layer.toGeoJSON) {\r\n\t\t\t\t\tjson = layer.toGeoJSON();\r\n\t\t\t\t\tjsons.push(isGeometryCollection ? json.geometry : L.GeoJSON.asFeature(json));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (isGeometryCollection) {\r\n\t\t\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\t\t\tgeometries: jsons,\r\n\t\t\t\t\ttype: 'GeometryCollection'\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\ttype: 'FeatureCollection',\r\n\t\t\t\tfeatures: jsons\r\n\t\t\t};\r\n\t\t}\r\n\t});\r\n}());\r\n\r\nL.geoJson = function (geojson, options) {\r\n\treturn new L.GeoJSON(geojson, options);\r\n};\r\n\n\n/*\r\n * L.DomEvent contains functions for working with DOM events.\r\n */\r\n\r\nL.DomEvent = {\r\n\t/* inspired by John Resig, Dean Edwards and YUI addEvent implementations */\r\n\taddListener: function (obj, type, fn, context) { // (HTMLElement, String, Function[, Object])\r\n\r\n\t\tvar id = L.stamp(fn),\r\n\t\t    key = '_leaflet_' + type + id,\r\n\t\t    handler, originalHandler, newType;\r\n\r\n\t\tif (obj[key]) { return this; }\r\n\r\n\t\thandler = function (e) {\r\n\t\t\treturn fn.call(context || obj, e || L.DomEvent._getEvent());\r\n\t\t};\r\n\r\n\t\tif (L.Browser.pointer && type.indexOf('touch') === 0) {\r\n\t\t\treturn this.addPointerListener(obj, type, handler, id);\r\n\t\t}\r\n\t\tif (L.Browser.touch && (type === 'dblclick') && this.addDoubleTapListener) {\r\n\t\t\tthis.addDoubleTapListener(obj, handler, id);\r\n\t\t}\r\n\r\n\t\tif ('addEventListener' in obj) {\r\n\r\n\t\t\tif (type === 'mousewheel') {\r\n\t\t\t\tobj.addEventListener('DOMMouseScroll', handler, false);\r\n\t\t\t\tobj.addEventListener(type, handler, false);\r\n\r\n\t\t\t} else if ((type === 'mouseenter') || (type === 'mouseleave')) {\r\n\r\n\t\t\t\toriginalHandler = handler;\r\n\t\t\t\tnewType = (type === 'mouseenter' ? 'mouseover' : 'mouseout');\r\n\r\n\t\t\t\thandler = function (e) {\r\n\t\t\t\t\tif (!L.DomEvent._checkMouse(obj, e)) { return; }\r\n\t\t\t\t\treturn originalHandler(e);\r\n\t\t\t\t};\r\n\r\n\t\t\t\tobj.addEventListener(newType, handler, false);\r\n\r\n\t\t\t} else if (type === 'click' && L.Browser.android) {\r\n\t\t\t\toriginalHandler = handler;\r\n\t\t\t\thandler = function (e) {\r\n\t\t\t\t\treturn L.DomEvent._filterClick(e, originalHandler);\r\n\t\t\t\t};\r\n\r\n\t\t\t\tobj.addEventListener(type, handler, false);\r\n\t\t\t} else {\r\n\t\t\t\tobj.addEventListener(type, handler, false);\r\n\t\t\t}\r\n\r\n\t\t} else if ('attachEvent' in obj) {\r\n\t\t\tobj.attachEvent('on' + type, handler);\r\n\t\t}\r\n\r\n\t\tobj[key] = handler;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveListener: function (obj, type, fn) {  // (HTMLElement, String, Function)\r\n\r\n\t\tvar id = L.stamp(fn),\r\n\t\t    key = '_leaflet_' + type + id,\r\n\t\t    handler = obj[key];\r\n\r\n\t\tif (!handler) { return this; }\r\n\r\n\t\tif (L.Browser.pointer && type.indexOf('touch') === 0) {\r\n\t\t\tthis.removePointerListener(obj, type, id);\r\n\t\t} else if (L.Browser.touch && (type === 'dblclick') && this.removeDoubleTapListener) {\r\n\t\t\tthis.removeDoubleTapListener(obj, id);\r\n\r\n\t\t} else if ('removeEventListener' in obj) {\r\n\r\n\t\t\tif (type === 'mousewheel') {\r\n\t\t\t\tobj.removeEventListener('DOMMouseScroll', handler, false);\r\n\t\t\t\tobj.removeEventListener(type, handler, false);\r\n\r\n\t\t\t} else if ((type === 'mouseenter') || (type === 'mouseleave')) {\r\n\t\t\t\tobj.removeEventListener((type === 'mouseenter' ? 'mouseover' : 'mouseout'), handler, false);\r\n\t\t\t} else {\r\n\t\t\t\tobj.removeEventListener(type, handler, false);\r\n\t\t\t}\r\n\t\t} else if ('detachEvent' in obj) {\r\n\t\t\tobj.detachEvent('on' + type, handler);\r\n\t\t}\r\n\r\n\t\tobj[key] = null;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tstopPropagation: function (e) {\r\n\r\n\t\tif (e.stopPropagation) {\r\n\t\t\te.stopPropagation();\r\n\t\t} else {\r\n\t\t\te.cancelBubble = true;\r\n\t\t}\r\n\t\tL.DomEvent._skipped(e);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tdisableScrollPropagation: function (el) {\r\n\t\tvar stop = L.DomEvent.stopPropagation;\r\n\r\n\t\treturn L.DomEvent\r\n\t\t\t.on(el, 'mousewheel', stop)\r\n\t\t\t.on(el, 'MozMousePixelScroll', stop);\r\n\t},\r\n\r\n\tdisableClickPropagation: function (el) {\r\n\t\tvar stop = L.DomEvent.stopPropagation;\r\n\r\n\t\tfor (var i = L.Draggable.START.length - 1; i >= 0; i--) {\r\n\t\t\tL.DomEvent.on(el, L.Draggable.START[i], stop);\r\n\t\t}\r\n\r\n\t\treturn L.DomEvent\r\n\t\t\t.on(el, 'click', L.DomEvent._fakeStop)\r\n\t\t\t.on(el, 'dblclick', stop);\r\n\t},\r\n\r\n\tpreventDefault: function (e) {\r\n\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t} else {\r\n\t\t\te.returnValue = false;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tstop: function (e) {\r\n\t\treturn L.DomEvent\r\n\t\t\t.preventDefault(e)\r\n\t\t\t.stopPropagation(e);\r\n\t},\r\n\r\n\tgetMousePosition: function (e, container) {\r\n\t\tif (!container) {\r\n\t\t\treturn new L.Point(e.clientX, e.clientY);\r\n\t\t}\r\n\r\n\t\tvar rect = container.getBoundingClientRect();\r\n\r\n\t\treturn new L.Point(\r\n\t\t\te.clientX - rect.left - container.clientLeft,\r\n\t\t\te.clientY - rect.top - container.clientTop);\r\n\t},\r\n\r\n\tgetWheelDelta: function (e) {\r\n\r\n\t\tvar delta = 0;\r\n\r\n\t\tif (e.wheelDelta) {\r\n\t\t\tdelta = e.wheelDelta / 120;\r\n\t\t}\r\n\t\tif (e.detail) {\r\n\t\t\tdelta = -e.detail / 3;\r\n\t\t}\r\n\t\treturn delta;\r\n\t},\r\n\r\n\t_skipEvents: {},\r\n\r\n\t_fakeStop: function (e) {\r\n\t\t// fakes stopPropagation by setting a special event flag, checked/reset with L.DomEvent._skipped(e)\r\n\t\tL.DomEvent._skipEvents[e.type] = true;\r\n\t},\r\n\r\n\t_skipped: function (e) {\r\n\t\tvar skipped = this._skipEvents[e.type];\r\n\t\t// reset when checking, as it's only used in map container and propagates outside of the map\r\n\t\tthis._skipEvents[e.type] = false;\r\n\t\treturn skipped;\r\n\t},\r\n\r\n\t// check if element really left/entered the event target (for mouseenter/mouseleave)\r\n\t_checkMouse: function (el, e) {\r\n\r\n\t\tvar related = e.relatedTarget;\r\n\r\n\t\tif (!related) { return true; }\r\n\r\n\t\ttry {\r\n\t\t\twhile (related && (related !== el)) {\r\n\t\t\t\trelated = related.parentNode;\r\n\t\t\t}\r\n\t\t} catch (err) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn (related !== el);\r\n\t},\r\n\r\n\t_getEvent: function () { // evil magic for IE\r\n\t\t/*jshint noarg:false */\r\n\t\tvar e = window.event;\r\n\t\tif (!e) {\r\n\t\t\tvar caller = arguments.callee.caller;\r\n\t\t\twhile (caller) {\r\n\t\t\t\te = caller['arguments'][0];\r\n\t\t\t\tif (e && window.Event === e.constructor) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tcaller = caller.caller;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn e;\r\n\t},\r\n\r\n\t// this is a horrible workaround for a bug in Android where a single touch triggers two click events\r\n\t_filterClick: function (e, handler) {\r\n\t\tvar timeStamp = (e.timeStamp || e.originalEvent.timeStamp),\r\n\t\t\telapsed = L.DomEvent._lastClick && (timeStamp - L.DomEvent._lastClick);\r\n\r\n\t\t// are they closer together than 500ms yet more than 100ms?\r\n\t\t// Android typically triggers them ~300ms apart while multiple listeners\r\n\t\t// on the same event should be triggered far faster;\r\n\t\t// or check if click is simulated on the element, and if it is, reject any non-simulated events\r\n\r\n\t\tif ((elapsed && elapsed > 100 && elapsed < 500) || (e.target._simulatedClick && !e._simulated)) {\r\n\t\t\tL.DomEvent.stop(e);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tL.DomEvent._lastClick = timeStamp;\r\n\r\n\t\treturn handler(e);\r\n\t}\r\n};\r\n\r\nL.DomEvent.on = L.DomEvent.addListener;\r\nL.DomEvent.off = L.DomEvent.removeListener;\r\n\n\n/*\r\n * L.Draggable allows you to add dragging capabilities to any element. Supports mobile devices too.\r\n */\r\n\r\nL.Draggable = L.Class.extend({\r\n\tincludes: L.Mixin.Events,\r\n\r\n\tstatics: {\r\n\t\tSTART: L.Browser.touch ? ['touchstart', 'mousedown'] : ['mousedown'],\r\n\t\tEND: {\r\n\t\t\tmousedown: 'mouseup',\r\n\t\t\ttouchstart: 'touchend',\r\n\t\t\tpointerdown: 'touchend',\r\n\t\t\tMSPointerDown: 'touchend'\r\n\t\t},\r\n\t\tMOVE: {\r\n\t\t\tmousedown: 'mousemove',\r\n\t\t\ttouchstart: 'touchmove',\r\n\t\t\tpointerdown: 'touchmove',\r\n\t\t\tMSPointerDown: 'touchmove'\r\n\t\t}\r\n\t},\r\n\r\n\tinitialize: function (element, dragStartTarget) {\r\n\t\tthis._element = element;\r\n\t\tthis._dragStartTarget = dragStartTarget || element;\r\n\t},\r\n\r\n\tenable: function () {\r\n\t\tif (this._enabled) { return; }\r\n\r\n\t\tfor (var i = L.Draggable.START.length - 1; i >= 0; i--) {\r\n\t\t\tL.DomEvent.on(this._dragStartTarget, L.Draggable.START[i], this._onDown, this);\r\n\t\t}\r\n\r\n\t\tthis._enabled = true;\r\n\t},\r\n\r\n\tdisable: function () {\r\n\t\tif (!this._enabled) { return; }\r\n\r\n\t\tfor (var i = L.Draggable.START.length - 1; i >= 0; i--) {\r\n\t\t\tL.DomEvent.off(this._dragStartTarget, L.Draggable.START[i], this._onDown, this);\r\n\t\t}\r\n\r\n\t\tthis._enabled = false;\r\n\t\tthis._moved = false;\r\n\t},\r\n\r\n\t_onDown: function (e) {\r\n\t\tthis._moved = false;\r\n\r\n\t\tif (e.shiftKey || ((e.which !== 1) && (e.button !== 1) && !e.touches)) { return; }\r\n\r\n\t\tL.DomEvent.stopPropagation(e);\r\n\r\n\t\tif (L.Draggable._disabled) { return; }\r\n\r\n\t\tL.DomUtil.disableImageDrag();\r\n\t\tL.DomUtil.disableTextSelection();\r\n\r\n\t\tif (this._moving) { return; }\r\n\r\n\t\tvar first = e.touches ? e.touches[0] : e;\r\n\r\n\t\tthis._startPoint = new L.Point(first.clientX, first.clientY);\r\n\t\tthis._startPos = this._newPos = L.DomUtil.getPosition(this._element);\r\n\r\n\t\tL.DomEvent\r\n\t\t    .on(document, L.Draggable.MOVE[e.type], this._onMove, this)\r\n\t\t    .on(document, L.Draggable.END[e.type], this._onUp, this);\r\n\t},\r\n\r\n\t_onMove: function (e) {\r\n\t\tif (e.touches && e.touches.length > 1) {\r\n\t\t\tthis._moved = true;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar first = (e.touches && e.touches.length === 1 ? e.touches[0] : e),\r\n\t\t    newPoint = new L.Point(first.clientX, first.clientY),\r\n\t\t    offset = newPoint.subtract(this._startPoint);\r\n\r\n\t\tif (!offset.x && !offset.y) { return; }\r\n\t\tif (L.Browser.touch && Math.abs(offset.x) + Math.abs(offset.y) < 3) { return; }\r\n\r\n\t\tL.DomEvent.preventDefault(e);\r\n\r\n\t\tif (!this._moved) {\r\n\t\t\tthis.fire('dragstart');\r\n\r\n\t\t\tthis._moved = true;\r\n\t\t\tthis._startPos = L.DomUtil.getPosition(this._element).subtract(offset);\r\n\r\n\t\t\tL.DomUtil.addClass(document.body, 'leaflet-dragging');\r\n\t\t\tthis._lastTarget = e.target || e.srcElement;\r\n\t\t\tL.DomUtil.addClass(this._lastTarget, 'leaflet-drag-target');\r\n\t\t}\r\n\r\n\t\tthis._newPos = this._startPos.add(offset);\r\n\t\tthis._moving = true;\r\n\r\n\t\tL.Util.cancelAnimFrame(this._animRequest);\r\n\t\tthis._animRequest = L.Util.requestAnimFrame(this._updatePosition, this, true, this._dragStartTarget);\r\n\t},\r\n\r\n\t_updatePosition: function () {\r\n\t\tthis.fire('predrag');\r\n\t\tL.DomUtil.setPosition(this._element, this._newPos);\r\n\t\tthis.fire('drag');\r\n\t},\r\n\r\n\t_onUp: function () {\r\n\t\tL.DomUtil.removeClass(document.body, 'leaflet-dragging');\r\n\r\n\t\tif (this._lastTarget) {\r\n\t\t\tL.DomUtil.removeClass(this._lastTarget, 'leaflet-drag-target');\r\n\t\t\tthis._lastTarget = null;\r\n\t\t}\r\n\r\n\t\tfor (var i in L.Draggable.MOVE) {\r\n\t\t\tL.DomEvent\r\n\t\t\t    .off(document, L.Draggable.MOVE[i], this._onMove)\r\n\t\t\t    .off(document, L.Draggable.END[i], this._onUp);\r\n\t\t}\r\n\r\n\t\tL.DomUtil.enableImageDrag();\r\n\t\tL.DomUtil.enableTextSelection();\r\n\r\n\t\tif (this._moved && this._moving) {\r\n\t\t\t// ensure drag is not fired after dragend\r\n\t\t\tL.Util.cancelAnimFrame(this._animRequest);\r\n\r\n\t\t\tthis.fire('dragend', {\r\n\t\t\t\tdistance: this._newPos.distanceTo(this._startPos)\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis._moving = false;\r\n\t}\r\n});\r\n\n\n/*\n\tL.Handler is a base class for handler classes that are used internally to inject\n\tinteraction features like dragging to classes like Map and Marker.\n*/\n\nL.Handler = L.Class.extend({\n\tinitialize: function (map) {\n\t\tthis._map = map;\n\t},\n\n\tenable: function () {\n\t\tif (this._enabled) { return; }\n\n\t\tthis._enabled = true;\n\t\tthis.addHooks();\n\t},\n\n\tdisable: function () {\n\t\tif (!this._enabled) { return; }\n\n\t\tthis._enabled = false;\n\t\tthis.removeHooks();\n\t},\n\n\tenabled: function () {\n\t\treturn !!this._enabled;\n\t}\n});\n\n\n/*\n * L.Handler.MapDrag is used to make the map draggable (with panning inertia), enabled by default.\n */\n\nL.Map.mergeOptions({\n\tdragging: true,\n\n\tinertia: !L.Browser.android23,\n\tinertiaDeceleration: 3400, // px/s^2\n\tinertiaMaxSpeed: Infinity, // px/s\n\tinertiaThreshold: L.Browser.touch ? 32 : 18, // ms\n\teaseLinearity: 0.25,\n\n\t// TODO refactor, move to CRS\n\tworldCopyJump: false\n});\n\nL.Map.Drag = L.Handler.extend({\n\taddHooks: function () {\n\t\tif (!this._draggable) {\n\t\t\tvar map = this._map;\n\n\t\t\tthis._draggable = new L.Draggable(map._mapPane, map._container);\n\n\t\t\tthis._draggable.on({\n\t\t\t\t'dragstart': this._onDragStart,\n\t\t\t\t'drag': this._onDrag,\n\t\t\t\t'dragend': this._onDragEnd\n\t\t\t}, this);\n\n\t\t\tif (map.options.worldCopyJump) {\n\t\t\t\tthis._draggable.on('predrag', this._onPreDrag, this);\n\t\t\t\tmap.on('viewreset', this._onViewReset, this);\n\n\t\t\t\tmap.whenReady(this._onViewReset, this);\n\t\t\t}\n\t\t}\n\t\tthis._draggable.enable();\n\t},\n\n\tremoveHooks: function () {\n\t\tthis._draggable.disable();\n\t},\n\n\tmoved: function () {\n\t\treturn this._draggable && this._draggable._moved;\n\t},\n\n\t_onDragStart: function () {\n\t\tvar map = this._map;\n\n\t\tif (map._panAnim) {\n\t\t\tmap._panAnim.stop();\n\t\t}\n\n\t\tmap\n\t\t    .fire('movestart')\n\t\t    .fire('dragstart');\n\n\t\tif (map.options.inertia) {\n\t\t\tthis._positions = [];\n\t\t\tthis._times = [];\n\t\t}\n\t},\n\n\t_onDrag: function () {\n\t\tif (this._map.options.inertia) {\n\t\t\tvar time = this._lastTime = +new Date(),\n\t\t\t    pos = this._lastPos = this._draggable._newPos;\n\n\t\t\tthis._positions.push(pos);\n\t\t\tthis._times.push(time);\n\n\t\t\tif (time - this._times[0] > 200) {\n\t\t\t\tthis._positions.shift();\n\t\t\t\tthis._times.shift();\n\t\t\t}\n\t\t}\n\n\t\tthis._map\n\t\t    .fire('move')\n\t\t    .fire('drag');\n\t},\n\n\t_onViewReset: function () {\n\t\t// TODO fix hardcoded Earth values\n\t\tvar pxCenter = this._map.getSize()._divideBy(2),\n\t\t    pxWorldCenter = this._map.latLngToLayerPoint([0, 0]);\n\n\t\tthis._initialWorldOffset = pxWorldCenter.subtract(pxCenter).x;\n\t\tthis._worldWidth = this._map.project([0, 180]).x;\n\t},\n\n\t_onPreDrag: function () {\n\t\t// TODO refactor to be able to adjust map pane position after zoom\n\t\tvar worldWidth = this._worldWidth,\n\t\t    halfWidth = Math.round(worldWidth / 2),\n\t\t    dx = this._initialWorldOffset,\n\t\t    x = this._draggable._newPos.x,\n\t\t    newX1 = (x - halfWidth + dx) % worldWidth + halfWidth - dx,\n\t\t    newX2 = (x + halfWidth + dx) % worldWidth - halfWidth - dx,\n\t\t    newX = Math.abs(newX1 + dx) < Math.abs(newX2 + dx) ? newX1 : newX2;\n\n\t\tthis._draggable._newPos.x = newX;\n\t},\n\n\t_onDragEnd: function (e) {\n\t\tvar map = this._map,\n\t\t    options = map.options,\n\t\t    delay = +new Date() - this._lastTime,\n\n\t\t    noInertia = !options.inertia || delay > options.inertiaThreshold || !this._positions[0];\n\n\t\tmap.fire('dragend', e);\n\n\t\tif (noInertia) {\n\t\t\tmap.fire('moveend');\n\n\t\t} else {\n\n\t\t\tvar direction = this._lastPos.subtract(this._positions[0]),\n\t\t\t    duration = (this._lastTime + delay - this._times[0]) / 1000,\n\t\t\t    ease = options.easeLinearity,\n\n\t\t\t    speedVector = direction.multiplyBy(ease / duration),\n\t\t\t    speed = speedVector.distanceTo([0, 0]),\n\n\t\t\t    limitedSpeed = Math.min(options.inertiaMaxSpeed, speed),\n\t\t\t    limitedSpeedVector = speedVector.multiplyBy(limitedSpeed / speed),\n\n\t\t\t    decelerationDuration = limitedSpeed / (options.inertiaDeceleration * ease),\n\t\t\t    offset = limitedSpeedVector.multiplyBy(-decelerationDuration / 2).round();\n\n\t\t\tif (!offset.x || !offset.y) {\n\t\t\t\tmap.fire('moveend');\n\n\t\t\t} else {\n\t\t\t\toffset = map._limitOffset(offset, map.options.maxBounds);\n\n\t\t\t\tL.Util.requestAnimFrame(function () {\n\t\t\t\t\tmap.panBy(offset, {\n\t\t\t\t\t\tduration: decelerationDuration,\n\t\t\t\t\t\teaseLinearity: ease,\n\t\t\t\t\t\tnoMoveStart: true\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n\nL.Map.addInitHook('addHandler', 'dragging', L.Map.Drag);\n\n\n/*\n * L.Handler.DoubleClickZoom is used to handle double-click zoom on the map, enabled by default.\n */\n\nL.Map.mergeOptions({\n\tdoubleClickZoom: true\n});\n\nL.Map.DoubleClickZoom = L.Handler.extend({\n\taddHooks: function () {\n\t\tthis._map.on('dblclick', this._onDoubleClick, this);\n\t},\n\n\tremoveHooks: function () {\n\t\tthis._map.off('dblclick', this._onDoubleClick, this);\n\t},\n\n\t_onDoubleClick: function (e) {\n\t\tvar map = this._map,\n\t\t    zoom = map.getZoom() + (e.originalEvent.shiftKey ? -1 : 1);\n\n\t\tif (map.options.doubleClickZoom === 'center') {\n\t\t\tmap.setZoom(zoom);\n\t\t} else {\n\t\t\tmap.setZoomAround(e.containerPoint, zoom);\n\t\t}\n\t}\n});\n\nL.Map.addInitHook('addHandler', 'doubleClickZoom', L.Map.DoubleClickZoom);\n\n\n/*\n * L.Handler.ScrollWheelZoom is used by L.Map to enable mouse scroll wheel zoom on the map.\n */\n\nL.Map.mergeOptions({\n\tscrollWheelZoom: true\n});\n\nL.Map.ScrollWheelZoom = L.Handler.extend({\n\taddHooks: function () {\n\t\tL.DomEvent.on(this._map._container, 'mousewheel', this._onWheelScroll, this);\n\t\tL.DomEvent.on(this._map._container, 'MozMousePixelScroll', L.DomEvent.preventDefault);\n\t\tthis._delta = 0;\n\t},\n\n\tremoveHooks: function () {\n\t\tL.DomEvent.off(this._map._container, 'mousewheel', this._onWheelScroll);\n\t\tL.DomEvent.off(this._map._container, 'MozMousePixelScroll', L.DomEvent.preventDefault);\n\t},\n\n\t_onWheelScroll: function (e) {\n\t\tvar delta = L.DomEvent.getWheelDelta(e);\n\n\t\tthis._delta += delta;\n\t\tthis._lastMousePos = this._map.mouseEventToContainerPoint(e);\n\n\t\tif (!this._startTime) {\n\t\t\tthis._startTime = +new Date();\n\t\t}\n\n\t\tvar left = Math.max(40 - (+new Date() - this._startTime), 0);\n\n\t\tclearTimeout(this._timer);\n\t\tthis._timer = setTimeout(L.bind(this._performZoom, this), left);\n\n\t\tL.DomEvent.preventDefault(e);\n\t\tL.DomEvent.stopPropagation(e);\n\t},\n\n\t_performZoom: function () {\n\t\tvar map = this._map,\n\t\t    delta = this._delta,\n\t\t    zoom = map.getZoom();\n\n\t\tdelta = delta > 0 ? Math.ceil(delta) : Math.floor(delta);\n\t\tdelta = Math.max(Math.min(delta, 4), -4);\n\t\tdelta = map._limitZoom(zoom + delta) - zoom;\n\n\t\tthis._delta = 0;\n\t\tthis._startTime = null;\n\n\t\tif (!delta) { return; }\n\n\t\tif (map.options.scrollWheelZoom === 'center') {\n\t\t\tmap.setZoom(zoom + delta);\n\t\t} else {\n\t\t\tmap.setZoomAround(this._lastMousePos, zoom + delta);\n\t\t}\n\t}\n});\n\nL.Map.addInitHook('addHandler', 'scrollWheelZoom', L.Map.ScrollWheelZoom);\n\n\n/*\r\n * Extends the event handling code with double tap support for mobile browsers.\r\n */\r\n\r\nL.extend(L.DomEvent, {\r\n\r\n\t_touchstart: L.Browser.msPointer ? 'MSPointerDown' : L.Browser.pointer ? 'pointerdown' : 'touchstart',\r\n\t_touchend: L.Browser.msPointer ? 'MSPointerUp' : L.Browser.pointer ? 'pointerup' : 'touchend',\r\n\r\n\t// inspired by Zepto touch code by Thomas Fuchs\r\n\taddDoubleTapListener: function (obj, handler, id) {\r\n\t\tvar last,\r\n\t\t    doubleTap = false,\r\n\t\t    delay = 250,\r\n\t\t    touch,\r\n\t\t    pre = '_leaflet_',\r\n\t\t    touchstart = this._touchstart,\r\n\t\t    touchend = this._touchend,\r\n\t\t    trackedTouches = [];\r\n\r\n\t\tfunction onTouchStart(e) {\r\n\t\t\tvar count;\r\n\r\n\t\t\tif (L.Browser.pointer) {\r\n\t\t\t\ttrackedTouches.push(e.pointerId);\r\n\t\t\t\tcount = trackedTouches.length;\r\n\t\t\t} else {\r\n\t\t\t\tcount = e.touches.length;\r\n\t\t\t}\r\n\t\t\tif (count > 1) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar now = Date.now(),\r\n\t\t\t\tdelta = now - (last || now);\r\n\r\n\t\t\ttouch = e.touches ? e.touches[0] : e;\r\n\t\t\tdoubleTap = (delta > 0 && delta <= delay);\r\n\t\t\tlast = now;\r\n\t\t}\r\n\r\n\t\tfunction onTouchEnd(e) {\r\n\t\t\tif (L.Browser.pointer) {\r\n\t\t\t\tvar idx = trackedTouches.indexOf(e.pointerId);\r\n\t\t\t\tif (idx === -1) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\ttrackedTouches.splice(idx, 1);\r\n\t\t\t}\r\n\r\n\t\t\tif (doubleTap) {\r\n\t\t\t\tif (L.Browser.pointer) {\r\n\t\t\t\t\t// work around .type being readonly with MSPointer* events\r\n\t\t\t\t\tvar newTouch = { },\r\n\t\t\t\t\t\tprop;\r\n\r\n\t\t\t\t\t// jshint forin:false\r\n\t\t\t\t\tfor (var i in touch) {\r\n\t\t\t\t\t\tprop = touch[i];\r\n\t\t\t\t\t\tif (typeof prop === 'function') {\r\n\t\t\t\t\t\t\tnewTouch[i] = prop.bind(touch);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tnewTouch[i] = prop;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttouch = newTouch;\r\n\t\t\t\t}\r\n\t\t\t\ttouch.type = 'dblclick';\r\n\t\t\t\thandler(touch);\r\n\t\t\t\tlast = null;\r\n\t\t\t}\r\n\t\t}\r\n\t\tobj[pre + touchstart + id] = onTouchStart;\r\n\t\tobj[pre + touchend + id] = onTouchEnd;\r\n\r\n\t\t// on pointer we need to listen on the document, otherwise a drag starting on the map and moving off screen\r\n\t\t// will not come through to us, so we will lose track of how many touches are ongoing\r\n\t\tvar endElement = L.Browser.pointer ? document.documentElement : obj;\r\n\r\n\t\tobj.addEventListener(touchstart, onTouchStart, false);\r\n\t\tendElement.addEventListener(touchend, onTouchEnd, false);\r\n\r\n\t\tif (L.Browser.pointer) {\r\n\t\t\tendElement.addEventListener(L.DomEvent.POINTER_CANCEL, onTouchEnd, false);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveDoubleTapListener: function (obj, id) {\r\n\t\tvar pre = '_leaflet_';\r\n\r\n\t\tobj.removeEventListener(this._touchstart, obj[pre + this._touchstart + id], false);\r\n\t\t(L.Browser.pointer ? document.documentElement : obj).removeEventListener(\r\n\t\t        this._touchend, obj[pre + this._touchend + id], false);\r\n\r\n\t\tif (L.Browser.pointer) {\r\n\t\t\tdocument.documentElement.removeEventListener(L.DomEvent.POINTER_CANCEL, obj[pre + this._touchend + id],\r\n\t\t\t\tfalse);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n});\r\n\n\n/*\n * Extends L.DomEvent to provide touch support for Internet Explorer and Windows-based devices.\n */\n\nL.extend(L.DomEvent, {\n\n\t//static\n\tPOINTER_DOWN: L.Browser.msPointer ? 'MSPointerDown' : 'pointerdown',\n\tPOINTER_MOVE: L.Browser.msPointer ? 'MSPointerMove' : 'pointermove',\n\tPOINTER_UP: L.Browser.msPointer ? 'MSPointerUp' : 'pointerup',\n\tPOINTER_CANCEL: L.Browser.msPointer ? 'MSPointerCancel' : 'pointercancel',\n\n\t_pointers: [],\n\t_pointerDocumentListener: false,\n\n\t// Provides a touch events wrapper for (ms)pointer events.\n\t// Based on changes by veproza https://github.com/CloudMade/Leaflet/pull/1019\n\t//ref http://www.w3.org/TR/pointerevents/ https://www.w3.org/Bugs/Public/show_bug.cgi?id=22890\n\n\taddPointerListener: function (obj, type, handler, id) {\n\n\t\tswitch (type) {\n\t\tcase 'touchstart':\n\t\t\treturn this.addPointerListenerStart(obj, type, handler, id);\n\t\tcase 'touchend':\n\t\t\treturn this.addPointerListenerEnd(obj, type, handler, id);\n\t\tcase 'touchmove':\n\t\t\treturn this.addPointerListenerMove(obj, type, handler, id);\n\t\tdefault:\n\t\t\tthrow 'Unknown touch event type';\n\t\t}\n\t},\n\n\taddPointerListenerStart: function (obj, type, handler, id) {\n\t\tvar pre = '_leaflet_',\n\t\t    pointers = this._pointers;\n\n\t\tvar cb = function (e) {\n\n\t\t\tL.DomEvent.preventDefault(e);\n\n\t\t\tvar alreadyInArray = false;\n\t\t\tfor (var i = 0; i < pointers.length; i++) {\n\t\t\t\tif (pointers[i].pointerId === e.pointerId) {\n\t\t\t\t\talreadyInArray = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!alreadyInArray) {\n\t\t\t\tpointers.push(e);\n\t\t\t}\n\n\t\t\te.touches = pointers.slice();\n\t\t\te.changedTouches = [e];\n\n\t\t\thandler(e);\n\t\t};\n\n\t\tobj[pre + 'touchstart' + id] = cb;\n\t\tobj.addEventListener(this.POINTER_DOWN, cb, false);\n\n\t\t// need to also listen for end events to keep the _pointers list accurate\n\t\t// this needs to be on the body and never go away\n\t\tif (!this._pointerDocumentListener) {\n\t\t\tvar internalCb = function (e) {\n\t\t\t\tfor (var i = 0; i < pointers.length; i++) {\n\t\t\t\t\tif (pointers[i].pointerId === e.pointerId) {\n\t\t\t\t\t\tpointers.splice(i, 1);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\t//We listen on the documentElement as any drags that end by moving the touch off the screen get fired there\n\t\t\tdocument.documentElement.addEventListener(this.POINTER_UP, internalCb, false);\n\t\t\tdocument.documentElement.addEventListener(this.POINTER_CANCEL, internalCb, false);\n\n\t\t\tthis._pointerDocumentListener = true;\n\t\t}\n\n\t\treturn this;\n\t},\n\n\taddPointerListenerMove: function (obj, type, handler, id) {\n\t\tvar pre = '_leaflet_',\n\t\t    touches = this._pointers;\n\n\t\tfunction cb(e) {\n\n\t\t\t// don't fire touch moves when mouse isn't down\n\t\t\tif ((e.pointerType === e.MSPOINTER_TYPE_MOUSE || e.pointerType === 'mouse') && e.buttons === 0) { return; }\n\n\t\t\tfor (var i = 0; i < touches.length; i++) {\n\t\t\t\tif (touches[i].pointerId === e.pointerId) {\n\t\t\t\t\ttouches[i] = e;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\te.touches = touches.slice();\n\t\t\te.changedTouches = [e];\n\n\t\t\thandler(e);\n\t\t}\n\n\t\tobj[pre + 'touchmove' + id] = cb;\n\t\tobj.addEventListener(this.POINTER_MOVE, cb, false);\n\n\t\treturn this;\n\t},\n\n\taddPointerListenerEnd: function (obj, type, handler, id) {\n\t\tvar pre = '_leaflet_',\n\t\t    touches = this._pointers;\n\n\t\tvar cb = function (e) {\n\t\t\tfor (var i = 0; i < touches.length; i++) {\n\t\t\t\tif (touches[i].pointerId === e.pointerId) {\n\t\t\t\t\ttouches.splice(i, 1);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\te.touches = touches.slice();\n\t\t\te.changedTouches = [e];\n\n\t\t\thandler(e);\n\t\t};\n\n\t\tobj[pre + 'touchend' + id] = cb;\n\t\tobj.addEventListener(this.POINTER_UP, cb, false);\n\t\tobj.addEventListener(this.POINTER_CANCEL, cb, false);\n\n\t\treturn this;\n\t},\n\n\tremovePointerListener: function (obj, type, id) {\n\t\tvar pre = '_leaflet_',\n\t\t    cb = obj[pre + type + id];\n\n\t\tswitch (type) {\n\t\tcase 'touchstart':\n\t\t\tobj.removeEventListener(this.POINTER_DOWN, cb, false);\n\t\t\tbreak;\n\t\tcase 'touchmove':\n\t\t\tobj.removeEventListener(this.POINTER_MOVE, cb, false);\n\t\t\tbreak;\n\t\tcase 'touchend':\n\t\t\tobj.removeEventListener(this.POINTER_UP, cb, false);\n\t\t\tobj.removeEventListener(this.POINTER_CANCEL, cb, false);\n\t\t\tbreak;\n\t\t}\n\n\t\treturn this;\n\t}\n});\n\n\n/*\n * L.Handler.TouchZoom is used by L.Map to add pinch zoom on supported mobile browsers.\n */\n\nL.Map.mergeOptions({\n\ttouchZoom: L.Browser.touch && !L.Browser.android23,\n\tbounceAtZoomLimits: true\n});\n\nL.Map.TouchZoom = L.Handler.extend({\n\taddHooks: function () {\n\t\tL.DomEvent.on(this._map._container, 'touchstart', this._onTouchStart, this);\n\t},\n\n\tremoveHooks: function () {\n\t\tL.DomEvent.off(this._map._container, 'touchstart', this._onTouchStart, this);\n\t},\n\n\t_onTouchStart: function (e) {\n\t\tvar map = this._map;\n\n\t\tif (!e.touches || e.touches.length !== 2 || map._animatingZoom || this._zooming) { return; }\n\n\t\tvar p1 = map.mouseEventToLayerPoint(e.touches[0]),\n\t\t    p2 = map.mouseEventToLayerPoint(e.touches[1]),\n\t\t    viewCenter = map._getCenterLayerPoint();\n\n\t\tthis._startCenter = p1.add(p2)._divideBy(2);\n\t\tthis._startDist = p1.distanceTo(p2);\n\n\t\tthis._moved = false;\n\t\tthis._zooming = true;\n\n\t\tthis._centerOffset = viewCenter.subtract(this._startCenter);\n\n\t\tif (map._panAnim) {\n\t\t\tmap._panAnim.stop();\n\t\t}\n\n\t\tL.DomEvent\n\t\t    .on(document, 'touchmove', this._onTouchMove, this)\n\t\t    .on(document, 'touchend', this._onTouchEnd, this);\n\n\t\tL.DomEvent.preventDefault(e);\n\t},\n\n\t_onTouchMove: function (e) {\n\t\tvar map = this._map;\n\n\t\tif (!e.touches || e.touches.length !== 2 || !this._zooming) { return; }\n\n\t\tvar p1 = map.mouseEventToLayerPoint(e.touches[0]),\n\t\t    p2 = map.mouseEventToLayerPoint(e.touches[1]);\n\n\t\tthis._scale = p1.distanceTo(p2) / this._startDist;\n\t\tthis._delta = p1._add(p2)._divideBy(2)._subtract(this._startCenter);\n\n\t\tif (this._scale === 1) { return; }\n\n\t\tif (!map.options.bounceAtZoomLimits) {\n\t\t\tif ((map.getZoom() === map.getMinZoom() && this._scale < 1) ||\n\t\t\t    (map.getZoom() === map.getMaxZoom() && this._scale > 1)) { return; }\n\t\t}\n\n\t\tif (!this._moved) {\n\t\t\tL.DomUtil.addClass(map._mapPane, 'leaflet-touching');\n\n\t\t\tmap\n\t\t\t    .fire('movestart')\n\t\t\t    .fire('zoomstart');\n\n\t\t\tthis._moved = true;\n\t\t}\n\n\t\tL.Util.cancelAnimFrame(this._animRequest);\n\t\tthis._animRequest = L.Util.requestAnimFrame(\n\t\t        this._updateOnMove, this, true, this._map._container);\n\n\t\tL.DomEvent.preventDefault(e);\n\t},\n\n\t_updateOnMove: function () {\n\t\tvar map = this._map,\n\t\t    origin = this._getScaleOrigin(),\n\t\t    center = map.layerPointToLatLng(origin),\n\t\t    zoom = map.getScaleZoom(this._scale);\n\n\t\tmap._animateZoom(center, zoom, this._startCenter, this._scale, this._delta, false, true);\n\t},\n\n\t_onTouchEnd: function () {\n\t\tif (!this._moved || !this._zooming) {\n\t\t\tthis._zooming = false;\n\t\t\treturn;\n\t\t}\n\n\t\tvar map = this._map;\n\n\t\tthis._zooming = false;\n\t\tL.DomUtil.removeClass(map._mapPane, 'leaflet-touching');\n\t\tL.Util.cancelAnimFrame(this._animRequest);\n\n\t\tL.DomEvent\n\t\t    .off(document, 'touchmove', this._onTouchMove)\n\t\t    .off(document, 'touchend', this._onTouchEnd);\n\n\t\tvar origin = this._getScaleOrigin(),\n\t\t    center = map.layerPointToLatLng(origin),\n\n\t\t    oldZoom = map.getZoom(),\n\t\t    floatZoomDelta = map.getScaleZoom(this._scale) - oldZoom,\n\t\t    roundZoomDelta = (floatZoomDelta > 0 ?\n\t\t            Math.ceil(floatZoomDelta) : Math.floor(floatZoomDelta)),\n\n\t\t    zoom = map._limitZoom(oldZoom + roundZoomDelta),\n\t\t    scale = map.getZoomScale(zoom) / this._scale;\n\n\t\tmap._animateZoom(center, zoom, origin, scale);\n\t},\n\n\t_getScaleOrigin: function () {\n\t\tvar centerOffset = this._centerOffset.subtract(this._delta).divideBy(this._scale);\n\t\treturn this._startCenter.add(centerOffset);\n\t}\n});\n\nL.Map.addInitHook('addHandler', 'touchZoom', L.Map.TouchZoom);\n\n\n/*\n * L.Map.Tap is used to enable mobile hacks like quick taps and long hold.\n */\n\nL.Map.mergeOptions({\n\ttap: true,\n\ttapTolerance: 15\n});\n\nL.Map.Tap = L.Handler.extend({\n\taddHooks: function () {\n\t\tL.DomEvent.on(this._map._container, 'touchstart', this._onDown, this);\n\t},\n\n\tremoveHooks: function () {\n\t\tL.DomEvent.off(this._map._container, 'touchstart', this._onDown, this);\n\t},\n\n\t_onDown: function (e) {\n\t\tif (!e.touches) { return; }\n\n\t\tL.DomEvent.preventDefault(e);\n\n\t\tthis._fireClick = true;\n\n\t\t// don't simulate click or track longpress if more than 1 touch\n\t\tif (e.touches.length > 1) {\n\t\t\tthis._fireClick = false;\n\t\t\tclearTimeout(this._holdTimeout);\n\t\t\treturn;\n\t\t}\n\n\t\tvar first = e.touches[0],\n\t\t    el = first.target;\n\n\t\tthis._startPos = this._newPos = new L.Point(first.clientX, first.clientY);\n\n\t\t// if touching a link, highlight it\n\t\tif (el.tagName && el.tagName.toLowerCase() === 'a') {\n\t\t\tL.DomUtil.addClass(el, 'leaflet-active');\n\t\t}\n\n\t\t// simulate long hold but setting a timeout\n\t\tthis._holdTimeout = setTimeout(L.bind(function () {\n\t\t\tif (this._isTapValid()) {\n\t\t\t\tthis._fireClick = false;\n\t\t\t\tthis._onUp();\n\t\t\t\tthis._simulateEvent('contextmenu', first);\n\t\t\t}\n\t\t}, this), 1000);\n\n\t\tL.DomEvent\n\t\t\t.on(document, 'touchmove', this._onMove, this)\n\t\t\t.on(document, 'touchend', this._onUp, this);\n\t},\n\n\t_onUp: function (e) {\n\t\tclearTimeout(this._holdTimeout);\n\n\t\tL.DomEvent\n\t\t\t.off(document, 'touchmove', this._onMove, this)\n\t\t\t.off(document, 'touchend', this._onUp, this);\n\n\t\tif (this._fireClick && e && e.changedTouches) {\n\n\t\t\tvar first = e.changedTouches[0],\n\t\t\t    el = first.target;\n\n\t\t\tif (el && el.tagName && el.tagName.toLowerCase() === 'a') {\n\t\t\t\tL.DomUtil.removeClass(el, 'leaflet-active');\n\t\t\t}\n\n\t\t\t// simulate click if the touch didn't move too much\n\t\t\tif (this._isTapValid()) {\n\t\t\t\tthis._simulateEvent('click', first);\n\t\t\t}\n\t\t}\n\t},\n\n\t_isTapValid: function () {\n\t\treturn this._newPos.distanceTo(this._startPos) <= this._map.options.tapTolerance;\n\t},\n\n\t_onMove: function (e) {\n\t\tvar first = e.touches[0];\n\t\tthis._newPos = new L.Point(first.clientX, first.clientY);\n\t},\n\n\t_simulateEvent: function (type, e) {\n\t\tvar simulatedEvent = document.createEvent('MouseEvents');\n\n\t\tsimulatedEvent._simulated = true;\n\t\te.target._simulatedClick = true;\n\n\t\tsimulatedEvent.initMouseEvent(\n\t\t        type, true, true, window, 1,\n\t\t        e.screenX, e.screenY,\n\t\t        e.clientX, e.clientY,\n\t\t        false, false, false, false, 0, null);\n\n\t\te.target.dispatchEvent(simulatedEvent);\n\t}\n});\n\nif (L.Browser.touch && !L.Browser.pointer) {\n\tL.Map.addInitHook('addHandler', 'tap', L.Map.Tap);\n}\n\n\n/*\n * L.Handler.ShiftDragZoom is used to add shift-drag zoom interaction to the map\n  * (zoom to a selected bounding box), enabled by default.\n */\n\nL.Map.mergeOptions({\n\tboxZoom: true\n});\n\nL.Map.BoxZoom = L.Handler.extend({\n\tinitialize: function (map) {\n\t\tthis._map = map;\n\t\tthis._container = map._container;\n\t\tthis._pane = map._panes.overlayPane;\n\t\tthis._moved = false;\n\t},\n\n\taddHooks: function () {\n\t\tL.DomEvent.on(this._container, 'mousedown', this._onMouseDown, this);\n\t},\n\n\tremoveHooks: function () {\n\t\tL.DomEvent.off(this._container, 'mousedown', this._onMouseDown);\n\t\tthis._moved = false;\n\t},\n\n\tmoved: function () {\n\t\treturn this._moved;\n\t},\n\n\t_onMouseDown: function (e) {\n\t\tthis._moved = false;\n\n\t\tif (!e.shiftKey || ((e.which !== 1) && (e.button !== 1))) { return false; }\n\n\t\tL.DomUtil.disableTextSelection();\n\t\tL.DomUtil.disableImageDrag();\n\n\t\tthis._startLayerPoint = this._map.mouseEventToLayerPoint(e);\n\n\t\tL.DomEvent\n\t\t    .on(document, 'mousemove', this._onMouseMove, this)\n\t\t    .on(document, 'mouseup', this._onMouseUp, this)\n\t\t    .on(document, 'keydown', this._onKeyDown, this);\n\t},\n\n\t_onMouseMove: function (e) {\n\t\tif (!this._moved) {\n\t\t\tthis._box = L.DomUtil.create('div', 'leaflet-zoom-box', this._pane);\n\t\t\tL.DomUtil.setPosition(this._box, this._startLayerPoint);\n\n\t\t\t//TODO refactor: move cursor to styles\n\t\t\tthis._container.style.cursor = 'crosshair';\n\t\t\tthis._map.fire('boxzoomstart');\n\t\t}\n\n\t\tvar startPoint = this._startLayerPoint,\n\t\t    box = this._box,\n\n\t\t    layerPoint = this._map.mouseEventToLayerPoint(e),\n\t\t    offset = layerPoint.subtract(startPoint),\n\n\t\t    newPos = new L.Point(\n\t\t        Math.min(layerPoint.x, startPoint.x),\n\t\t        Math.min(layerPoint.y, startPoint.y));\n\n\t\tL.DomUtil.setPosition(box, newPos);\n\n\t\tthis._moved = true;\n\n\t\t// TODO refactor: remove hardcoded 4 pixels\n\t\tbox.style.width  = (Math.max(0, Math.abs(offset.x) - 4)) + 'px';\n\t\tbox.style.height = (Math.max(0, Math.abs(offset.y) - 4)) + 'px';\n\t},\n\n\t_finish: function () {\n\t\tif (this._moved) {\n\t\t\tthis._pane.removeChild(this._box);\n\t\t\tthis._container.style.cursor = '';\n\t\t}\n\n\t\tL.DomUtil.enableTextSelection();\n\t\tL.DomUtil.enableImageDrag();\n\n\t\tL.DomEvent\n\t\t    .off(document, 'mousemove', this._onMouseMove)\n\t\t    .off(document, 'mouseup', this._onMouseUp)\n\t\t    .off(document, 'keydown', this._onKeyDown);\n\t},\n\n\t_onMouseUp: function (e) {\n\n\t\tthis._finish();\n\n\t\tvar map = this._map,\n\t\t    layerPoint = map.mouseEventToLayerPoint(e);\n\n\t\tif (this._startLayerPoint.equals(layerPoint)) { return; }\n\n\t\tvar bounds = new L.LatLngBounds(\n\t\t        map.layerPointToLatLng(this._startLayerPoint),\n\t\t        map.layerPointToLatLng(layerPoint));\n\n\t\tmap.fitBounds(bounds);\n\n\t\tmap.fire('boxzoomend', {\n\t\t\tboxZoomBounds: bounds\n\t\t});\n\t},\n\n\t_onKeyDown: function (e) {\n\t\tif (e.keyCode === 27) {\n\t\t\tthis._finish();\n\t\t}\n\t}\n});\n\nL.Map.addInitHook('addHandler', 'boxZoom', L.Map.BoxZoom);\n\n\n/*\n * L.Map.Keyboard is handling keyboard interaction with the map, enabled by default.\n */\n\nL.Map.mergeOptions({\n\tkeyboard: true,\n\tkeyboardPanOffset: 80,\n\tkeyboardZoomOffset: 1\n});\n\nL.Map.Keyboard = L.Handler.extend({\n\n\tkeyCodes: {\n\t\tleft:    [37],\n\t\tright:   [39],\n\t\tdown:    [40],\n\t\tup:      [38],\n\t\tzoomIn:  [187, 107, 61, 171],\n\t\tzoomOut: [189, 109, 173]\n\t},\n\n\tinitialize: function (map) {\n\t\tthis._map = map;\n\n\t\tthis._setPanOffset(map.options.keyboardPanOffset);\n\t\tthis._setZoomOffset(map.options.keyboardZoomOffset);\n\t},\n\n\taddHooks: function () {\n\t\tvar container = this._map._container;\n\n\t\t// make the container focusable by tabbing\n\t\tif (container.tabIndex === -1) {\n\t\t\tcontainer.tabIndex = '0';\n\t\t}\n\n\t\tL.DomEvent\n\t\t    .on(container, 'focus', this._onFocus, this)\n\t\t    .on(container, 'blur', this._onBlur, this)\n\t\t    .on(container, 'mousedown', this._onMouseDown, this);\n\n\t\tthis._map\n\t\t    .on('focus', this._addHooks, this)\n\t\t    .on('blur', this._removeHooks, this);\n\t},\n\n\tremoveHooks: function () {\n\t\tthis._removeHooks();\n\n\t\tvar container = this._map._container;\n\n\t\tL.DomEvent\n\t\t    .off(container, 'focus', this._onFocus, this)\n\t\t    .off(container, 'blur', this._onBlur, this)\n\t\t    .off(container, 'mousedown', this._onMouseDown, this);\n\n\t\tthis._map\n\t\t    .off('focus', this._addHooks, this)\n\t\t    .off('blur', this._removeHooks, this);\n\t},\n\n\t_onMouseDown: function () {\n\t\tif (this._focused) { return; }\n\n\t\tvar body = document.body,\n\t\t    docEl = document.documentElement,\n\t\t    top = body.scrollTop || docEl.scrollTop,\n\t\t    left = body.scrollLeft || docEl.scrollLeft;\n\n\t\tthis._map._container.focus();\n\n\t\twindow.scrollTo(left, top);\n\t},\n\n\t_onFocus: function () {\n\t\tthis._focused = true;\n\t\tthis._map.fire('focus');\n\t},\n\n\t_onBlur: function () {\n\t\tthis._focused = false;\n\t\tthis._map.fire('blur');\n\t},\n\n\t_setPanOffset: function (pan) {\n\t\tvar keys = this._panKeys = {},\n\t\t    codes = this.keyCodes,\n\t\t    i, len;\n\n\t\tfor (i = 0, len = codes.left.length; i < len; i++) {\n\t\t\tkeys[codes.left[i]] = [-1 * pan, 0];\n\t\t}\n\t\tfor (i = 0, len = codes.right.length; i < len; i++) {\n\t\t\tkeys[codes.right[i]] = [pan, 0];\n\t\t}\n\t\tfor (i = 0, len = codes.down.length; i < len; i++) {\n\t\t\tkeys[codes.down[i]] = [0, pan];\n\t\t}\n\t\tfor (i = 0, len = codes.up.length; i < len; i++) {\n\t\t\tkeys[codes.up[i]] = [0, -1 * pan];\n\t\t}\n\t},\n\n\t_setZoomOffset: function (zoom) {\n\t\tvar keys = this._zoomKeys = {},\n\t\t    codes = this.keyCodes,\n\t\t    i, len;\n\n\t\tfor (i = 0, len = codes.zoomIn.length; i < len; i++) {\n\t\t\tkeys[codes.zoomIn[i]] = zoom;\n\t\t}\n\t\tfor (i = 0, len = codes.zoomOut.length; i < len; i++) {\n\t\t\tkeys[codes.zoomOut[i]] = -zoom;\n\t\t}\n\t},\n\n\t_addHooks: function () {\n\t\tL.DomEvent.on(document, 'keydown', this._onKeyDown, this);\n\t},\n\n\t_removeHooks: function () {\n\t\tL.DomEvent.off(document, 'keydown', this._onKeyDown, this);\n\t},\n\n\t_onKeyDown: function (e) {\n\t\tvar key = e.keyCode,\n\t\t    map = this._map;\n\n\t\tif (key in this._panKeys) {\n\n\t\t\tif (map._panAnim && map._panAnim._inProgress) { return; }\n\n\t\t\tmap.panBy(this._panKeys[key]);\n\n\t\t\tif (map.options.maxBounds) {\n\t\t\t\tmap.panInsideBounds(map.options.maxBounds);\n\t\t\t}\n\n\t\t} else if (key in this._zoomKeys) {\n\t\t\tmap.setZoom(map.getZoom() + this._zoomKeys[key]);\n\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\tL.DomEvent.stop(e);\n\t}\n});\n\nL.Map.addInitHook('addHandler', 'keyboard', L.Map.Keyboard);\n\n\n/*\n * L.Handler.MarkerDrag is used internally by L.Marker to make the markers draggable.\n */\n\nL.Handler.MarkerDrag = L.Handler.extend({\n\tinitialize: function (marker) {\n\t\tthis._marker = marker;\n\t},\n\n\taddHooks: function () {\n\t\tvar icon = this._marker._icon;\n\t\tif (!this._draggable) {\n\t\t\tthis._draggable = new L.Draggable(icon, icon);\n\t\t}\n\n\t\tthis._draggable\n\t\t\t.on('dragstart', this._onDragStart, this)\n\t\t\t.on('drag', this._onDrag, this)\n\t\t\t.on('dragend', this._onDragEnd, this);\n\t\tthis._draggable.enable();\n\t\tL.DomUtil.addClass(this._marker._icon, 'leaflet-marker-draggable');\n\t},\n\n\tremoveHooks: function () {\n\t\tthis._draggable\n\t\t\t.off('dragstart', this._onDragStart, this)\n\t\t\t.off('drag', this._onDrag, this)\n\t\t\t.off('dragend', this._onDragEnd, this);\n\n\t\tthis._draggable.disable();\n\t\tL.DomUtil.removeClass(this._marker._icon, 'leaflet-marker-draggable');\n\t},\n\n\tmoved: function () {\n\t\treturn this._draggable && this._draggable._moved;\n\t},\n\n\t_onDragStart: function () {\n\t\tthis._marker\n\t\t    .closePopup()\n\t\t    .fire('movestart')\n\t\t    .fire('dragstart');\n\t},\n\n\t_onDrag: function () {\n\t\tvar marker = this._marker,\n\t\t    shadow = marker._shadow,\n\t\t    iconPos = L.DomUtil.getPosition(marker._icon),\n\t\t    latlng = marker._map.layerPointToLatLng(iconPos);\n\n\t\t// update shadow position\n\t\tif (shadow) {\n\t\t\tL.DomUtil.setPosition(shadow, iconPos);\n\t\t}\n\n\t\tmarker._latlng = latlng;\n\n\t\tmarker\n\t\t    .fire('move', {latlng: latlng})\n\t\t    .fire('drag');\n\t},\n\n\t_onDragEnd: function (e) {\n\t\tthis._marker\n\t\t    .fire('moveend')\n\t\t    .fire('dragend', e);\n\t}\n});\n\n\n/*\r\n * L.Control is a base class for implementing map controls. Handles positioning.\r\n * All other controls extend from this class.\r\n */\r\n\r\nL.Control = L.Class.extend({\r\n\toptions: {\r\n\t\tposition: 'topright'\r\n\t},\r\n\r\n\tinitialize: function (options) {\r\n\t\tL.setOptions(this, options);\r\n\t},\r\n\r\n\tgetPosition: function () {\r\n\t\treturn this.options.position;\r\n\t},\r\n\r\n\tsetPosition: function (position) {\r\n\t\tvar map = this._map;\r\n\r\n\t\tif (map) {\r\n\t\t\tmap.removeControl(this);\r\n\t\t}\r\n\r\n\t\tthis.options.position = position;\r\n\r\n\t\tif (map) {\r\n\t\t\tmap.addControl(this);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetContainer: function () {\r\n\t\treturn this._container;\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tvar container = this._container = this.onAdd(map),\r\n\t\t    pos = this.getPosition(),\r\n\t\t    corner = map._controlCorners[pos];\r\n\r\n\t\tL.DomUtil.addClass(container, 'leaflet-control');\r\n\r\n\t\tif (pos.indexOf('bottom') !== -1) {\r\n\t\t\tcorner.insertBefore(container, corner.firstChild);\r\n\t\t} else {\r\n\t\t\tcorner.appendChild(container);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveFrom: function (map) {\r\n\t\tvar pos = this.getPosition(),\r\n\t\t    corner = map._controlCorners[pos];\r\n\r\n\t\tcorner.removeChild(this._container);\r\n\t\tthis._map = null;\r\n\r\n\t\tif (this.onRemove) {\r\n\t\t\tthis.onRemove(map);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_refocusOnMap: function () {\r\n\t\tif (this._map) {\r\n\t\t\tthis._map.getContainer().focus();\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.control = function (options) {\r\n\treturn new L.Control(options);\r\n};\r\n\r\n\r\n// adds control-related methods to L.Map\r\n\r\nL.Map.include({\r\n\taddControl: function (control) {\r\n\t\tcontrol.addTo(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveControl: function (control) {\r\n\t\tcontrol.removeFrom(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_initControlPos: function () {\r\n\t\tvar corners = this._controlCorners = {},\r\n\t\t    l = 'leaflet-',\r\n\t\t    container = this._controlContainer =\r\n\t\t            L.DomUtil.create('div', l + 'control-container', this._container);\r\n\r\n\t\tfunction createCorner(vSide, hSide) {\r\n\t\t\tvar className = l + vSide + ' ' + l + hSide;\r\n\r\n\t\t\tcorners[vSide + hSide] = L.DomUtil.create('div', className, container);\r\n\t\t}\r\n\r\n\t\tcreateCorner('top', 'left');\r\n\t\tcreateCorner('top', 'right');\r\n\t\tcreateCorner('bottom', 'left');\r\n\t\tcreateCorner('bottom', 'right');\r\n\t},\r\n\r\n\t_clearControlPos: function () {\r\n\t\tthis._container.removeChild(this._controlContainer);\r\n\t}\r\n});\r\n\n\n/*\r\n * L.Control.Zoom is used for the default zoom buttons on the map.\r\n */\r\n\r\nL.Control.Zoom = L.Control.extend({\r\n\toptions: {\r\n\t\tposition: 'topleft',\r\n\t\tzoomInText: '+',\r\n\t\tzoomInTitle: 'Zoom in',\r\n\t\tzoomOutText: '-',\r\n\t\tzoomOutTitle: 'Zoom out'\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tvar zoomName = 'leaflet-control-zoom',\r\n\t\t    container = L.DomUtil.create('div', zoomName + ' leaflet-bar');\r\n\r\n\t\tthis._map = map;\r\n\r\n\t\tthis._zoomInButton  = this._createButton(\r\n\t\t        this.options.zoomInText, this.options.zoomInTitle,\r\n\t\t        zoomName + '-in',  container, this._zoomIn,  this);\r\n\t\tthis._zoomOutButton = this._createButton(\r\n\t\t        this.options.zoomOutText, this.options.zoomOutTitle,\r\n\t\t        zoomName + '-out', container, this._zoomOut, this);\r\n\r\n\t\tthis._updateDisabled();\r\n\t\tmap.on('zoomend zoomlevelschange', this._updateDisabled, this);\r\n\r\n\t\treturn container;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap.off('zoomend zoomlevelschange', this._updateDisabled, this);\r\n\t},\r\n\r\n\t_zoomIn: function (e) {\r\n\t\tthis._map.zoomIn(e.shiftKey ? 3 : 1);\r\n\t},\r\n\r\n\t_zoomOut: function (e) {\r\n\t\tthis._map.zoomOut(e.shiftKey ? 3 : 1);\r\n\t},\r\n\r\n\t_createButton: function (html, title, className, container, fn, context) {\r\n\t\tvar link = L.DomUtil.create('a', className, container);\r\n\t\tlink.innerHTML = html;\r\n\t\tlink.href = '#';\r\n\t\tlink.title = title;\r\n\r\n\t\tvar stop = L.DomEvent.stopPropagation;\r\n\r\n\t\tL.DomEvent\r\n\t\t    .on(link, 'click', stop)\r\n\t\t    .on(link, 'mousedown', stop)\r\n\t\t    .on(link, 'dblclick', stop)\r\n\t\t    .on(link, 'click', L.DomEvent.preventDefault)\r\n\t\t    .on(link, 'click', fn, context)\r\n\t\t    .on(link, 'click', this._refocusOnMap, context);\r\n\r\n\t\treturn link;\r\n\t},\r\n\r\n\t_updateDisabled: function () {\r\n\t\tvar map = this._map,\r\n\t\t\tclassName = 'leaflet-disabled';\r\n\r\n\t\tL.DomUtil.removeClass(this._zoomInButton, className);\r\n\t\tL.DomUtil.removeClass(this._zoomOutButton, className);\r\n\r\n\t\tif (map._zoom === map.getMinZoom()) {\r\n\t\t\tL.DomUtil.addClass(this._zoomOutButton, className);\r\n\t\t}\r\n\t\tif (map._zoom === map.getMaxZoom()) {\r\n\t\t\tL.DomUtil.addClass(this._zoomInButton, className);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.Map.mergeOptions({\r\n\tzoomControl: true\r\n});\r\n\r\nL.Map.addInitHook(function () {\r\n\tif (this.options.zoomControl) {\r\n\t\tthis.zoomControl = new L.Control.Zoom();\r\n\t\tthis.addControl(this.zoomControl);\r\n\t}\r\n});\r\n\r\nL.control.zoom = function (options) {\r\n\treturn new L.Control.Zoom(options);\r\n};\r\n\r\n\n\n/*\r\n * L.Control.Attribution is used for displaying attribution on the map (added by default).\r\n */\r\n\r\nL.Control.Attribution = L.Control.extend({\r\n\toptions: {\r\n\t\tposition: 'bottomright',\r\n\t\tprefix: '<a href=\"http://leafletjs.com\" title=\"A JS library for interactive maps\">Leaflet</a>'\r\n\t},\r\n\r\n\tinitialize: function (options) {\r\n\t\tL.setOptions(this, options);\r\n\r\n\t\tthis._attributions = {};\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._container = L.DomUtil.create('div', 'leaflet-control-attribution');\r\n\t\tL.DomEvent.disableClickPropagation(this._container);\r\n\r\n\t\tfor (var i in map._layers) {\r\n\t\t\tif (map._layers[i].getAttribution) {\r\n\t\t\t\tthis.addAttribution(map._layers[i].getAttribution());\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tmap\r\n\t\t    .on('layeradd', this._onLayerAdd, this)\r\n\t\t    .on('layerremove', this._onLayerRemove, this);\r\n\r\n\t\tthis._update();\r\n\r\n\t\treturn this._container;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap\r\n\t\t    .off('layeradd', this._onLayerAdd)\r\n\t\t    .off('layerremove', this._onLayerRemove);\r\n\r\n\t},\r\n\r\n\tsetPrefix: function (prefix) {\r\n\t\tthis.options.prefix = prefix;\r\n\t\tthis._update();\r\n\t\treturn this;\r\n\t},\r\n\r\n\taddAttribution: function (text) {\r\n\t\tif (!text) { return; }\r\n\r\n\t\tif (!this._attributions[text]) {\r\n\t\t\tthis._attributions[text] = 0;\r\n\t\t}\r\n\t\tthis._attributions[text]++;\r\n\r\n\t\tthis._update();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveAttribution: function (text) {\r\n\t\tif (!text) { return; }\r\n\r\n\t\tif (this._attributions[text]) {\r\n\t\t\tthis._attributions[text]--;\r\n\t\t\tthis._update();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_update: function () {\r\n\t\tif (!this._map) { return; }\r\n\r\n\t\tvar attribs = [];\r\n\r\n\t\tfor (var i in this._attributions) {\r\n\t\t\tif (this._attributions[i]) {\r\n\t\t\t\tattribs.push(i);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar prefixAndAttribs = [];\r\n\r\n\t\tif (this.options.prefix) {\r\n\t\t\tprefixAndAttribs.push(this.options.prefix);\r\n\t\t}\r\n\t\tif (attribs.length) {\r\n\t\t\tprefixAndAttribs.push(attribs.join(', '));\r\n\t\t}\r\n\r\n\t\tthis._container.innerHTML = prefixAndAttribs.join(' | ');\r\n\t},\r\n\r\n\t_onLayerAdd: function (e) {\r\n\t\tif (e.layer.getAttribution) {\r\n\t\t\tthis.addAttribution(e.layer.getAttribution());\r\n\t\t}\r\n\t},\r\n\r\n\t_onLayerRemove: function (e) {\r\n\t\tif (e.layer.getAttribution) {\r\n\t\t\tthis.removeAttribution(e.layer.getAttribution());\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.Map.mergeOptions({\r\n\tattributionControl: true\r\n});\r\n\r\nL.Map.addInitHook(function () {\r\n\tif (this.options.attributionControl) {\r\n\t\tthis.attributionControl = (new L.Control.Attribution()).addTo(this);\r\n\t}\r\n});\r\n\r\nL.control.attribution = function (options) {\r\n\treturn new L.Control.Attribution(options);\r\n};\r\n\n\n/*\n * L.Control.Scale is used for displaying metric/imperial scale on the map.\n */\n\nL.Control.Scale = L.Control.extend({\n\toptions: {\n\t\tposition: 'bottomleft',\n\t\tmaxWidth: 100,\n\t\tmetric: true,\n\t\timperial: true,\n\t\tupdateWhenIdle: false\n\t},\n\n\tonAdd: function (map) {\n\t\tthis._map = map;\n\n\t\tvar className = 'leaflet-control-scale',\n\t\t    container = L.DomUtil.create('div', className),\n\t\t    options = this.options;\n\n\t\tthis._addScales(options, className, container);\n\n\t\tmap.on(options.updateWhenIdle ? 'moveend' : 'move', this._update, this);\n\t\tmap.whenReady(this._update, this);\n\n\t\treturn container;\n\t},\n\n\tonRemove: function (map) {\n\t\tmap.off(this.options.updateWhenIdle ? 'moveend' : 'move', this._update, this);\n\t},\n\n\t_addScales: function (options, className, container) {\n\t\tif (options.metric) {\n\t\t\tthis._mScale = L.DomUtil.create('div', className + '-line', container);\n\t\t}\n\t\tif (options.imperial) {\n\t\t\tthis._iScale = L.DomUtil.create('div', className + '-line', container);\n\t\t}\n\t},\n\n\t_update: function () {\n\t\tvar bounds = this._map.getBounds(),\n\t\t    centerLat = bounds.getCenter().lat,\n\t\t    halfWorldMeters = 6378137 * Math.PI * Math.cos(centerLat * Math.PI / 180),\n\t\t    dist = halfWorldMeters * (bounds.getNorthEast().lng - bounds.getSouthWest().lng) / 180,\n\n\t\t    size = this._map.getSize(),\n\t\t    options = this.options,\n\t\t    maxMeters = 0;\n\n\t\tif (size.x > 0) {\n\t\t\tmaxMeters = dist * (options.maxWidth / size.x);\n\t\t}\n\n\t\tthis._updateScales(options, maxMeters);\n\t},\n\n\t_updateScales: function (options, maxMeters) {\n\t\tif (options.metric && maxMeters) {\n\t\t\tthis._updateMetric(maxMeters);\n\t\t}\n\n\t\tif (options.imperial && maxMeters) {\n\t\t\tthis._updateImperial(maxMeters);\n\t\t}\n\t},\n\n\t_updateMetric: function (maxMeters) {\n\t\tvar meters = this._getRoundNum(maxMeters);\n\n\t\tthis._mScale.style.width = this._getScaleWidth(meters / maxMeters) + 'px';\n\t\tthis._mScale.innerHTML = meters < 1000 ? meters + ' m' : (meters / 1000) + ' km';\n\t},\n\n\t_updateImperial: function (maxMeters) {\n\t\tvar maxFeet = maxMeters * 3.2808399,\n\t\t    scale = this._iScale,\n\t\t    maxMiles, miles, feet;\n\n\t\tif (maxFeet > 5280) {\n\t\t\tmaxMiles = maxFeet / 5280;\n\t\t\tmiles = this._getRoundNum(maxMiles);\n\n\t\t\tscale.style.width = this._getScaleWidth(miles / maxMiles) + 'px';\n\t\t\tscale.innerHTML = miles + ' mi';\n\n\t\t} else {\n\t\t\tfeet = this._getRoundNum(maxFeet);\n\n\t\t\tscale.style.width = this._getScaleWidth(feet / maxFeet) + 'px';\n\t\t\tscale.innerHTML = feet + ' ft';\n\t\t}\n\t},\n\n\t_getScaleWidth: function (ratio) {\n\t\treturn Math.round(this.options.maxWidth * ratio) - 10;\n\t},\n\n\t_getRoundNum: function (num) {\n\t\tvar pow10 = Math.pow(10, (Math.floor(num) + '').length - 1),\n\t\t    d = num / pow10;\n\n\t\td = d >= 10 ? 10 : d >= 5 ? 5 : d >= 3 ? 3 : d >= 2 ? 2 : 1;\n\n\t\treturn pow10 * d;\n\t}\n});\n\nL.control.scale = function (options) {\n\treturn new L.Control.Scale(options);\n};\n\n\n/*\r\n * L.Control.Layers is a control to allow users to switch between different layers on the map.\r\n */\r\n\r\nL.Control.Layers = L.Control.extend({\r\n\toptions: {\r\n\t\tcollapsed: true,\r\n\t\tposition: 'topright',\r\n\t\tautoZIndex: true\r\n\t},\r\n\r\n\tinitialize: function (baseLayers, overlays, options) {\r\n\t\tL.setOptions(this, options);\r\n\r\n\t\tthis._layers = {};\r\n\t\tthis._lastZIndex = 0;\r\n\t\tthis._handlingClick = false;\r\n\r\n\t\tfor (var i in baseLayers) {\r\n\t\t\tthis._addLayer(baseLayers[i], i);\r\n\t\t}\r\n\r\n\t\tfor (i in overlays) {\r\n\t\t\tthis._addLayer(overlays[i], i, true);\r\n\t\t}\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._initLayout();\r\n\t\tthis._update();\r\n\r\n\t\tmap\r\n\t\t    .on('layeradd', this._onLayerChange, this)\r\n\t\t    .on('layerremove', this._onLayerChange, this);\r\n\r\n\t\treturn this._container;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap\r\n\t\t    .off('layeradd', this._onLayerChange, this)\r\n\t\t    .off('layerremove', this._onLayerChange, this);\r\n\t},\r\n\r\n\taddBaseLayer: function (layer, name) {\r\n\t\tthis._addLayer(layer, name);\r\n\t\tthis._update();\r\n\t\treturn this;\r\n\t},\r\n\r\n\taddOverlay: function (layer, name) {\r\n\t\tthis._addLayer(layer, name, true);\r\n\t\tthis._update();\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveLayer: function (layer) {\r\n\t\tvar id = L.stamp(layer);\r\n\t\tdelete this._layers[id];\r\n\t\tthis._update();\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_initLayout: function () {\r\n\t\tvar className = 'leaflet-control-layers',\r\n\t\t    container = this._container = L.DomUtil.create('div', className);\r\n\r\n\t\t//Makes this work on IE10 Touch devices by stopping it from firing a mouseout event when the touch is released\r\n\t\tcontainer.setAttribute('aria-haspopup', true);\r\n\r\n\t\tif (!L.Browser.touch) {\r\n\t\t\tL.DomEvent\r\n\t\t\t\t.disableClickPropagation(container)\r\n\t\t\t\t.disableScrollPropagation(container);\r\n\t\t} else {\r\n\t\t\tL.DomEvent.on(container, 'click', L.DomEvent.stopPropagation);\r\n\t\t}\r\n\r\n\t\tvar form = this._form = L.DomUtil.create('form', className + '-list');\r\n\r\n\t\tif (this.options.collapsed) {\r\n\t\t\tif (!L.Browser.android) {\r\n\t\t\t\tL.DomEvent\r\n\t\t\t\t    .on(container, 'mouseover', this._expand, this)\r\n\t\t\t\t    .on(container, 'mouseout', this._collapse, this);\r\n\t\t\t}\r\n\t\t\tvar link = this._layersLink = L.DomUtil.create('a', className + '-toggle', container);\r\n\t\t\tlink.href = '#';\r\n\t\t\tlink.title = 'Layers';\r\n\r\n\t\t\tif (L.Browser.touch) {\r\n\t\t\t\tL.DomEvent\r\n\t\t\t\t    .on(link, 'click', L.DomEvent.stop)\r\n\t\t\t\t    .on(link, 'click', this._expand, this);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tL.DomEvent.on(link, 'focus', this._expand, this);\r\n\t\t\t}\r\n\t\t\t//Work around for Firefox android issue https://github.com/Leaflet/Leaflet/issues/2033\r\n\t\t\tL.DomEvent.on(form, 'click', function () {\r\n\t\t\t\tsetTimeout(L.bind(this._onInputClick, this), 0);\r\n\t\t\t}, this);\r\n\r\n\t\t\tthis._map.on('click', this._collapse, this);\r\n\t\t\t// TODO keyboard accessibility\r\n\t\t} else {\r\n\t\t\tthis._expand();\r\n\t\t}\r\n\r\n\t\tthis._baseLayersList = L.DomUtil.create('div', className + '-base', form);\r\n\t\tthis._separator = L.DomUtil.create('div', className + '-separator', form);\r\n\t\tthis._overlaysList = L.DomUtil.create('div', className + '-overlays', form);\r\n\r\n\t\tcontainer.appendChild(form);\r\n\t},\r\n\r\n\t_addLayer: function (layer, name, overlay) {\r\n\t\tvar id = L.stamp(layer);\r\n\r\n\t\tthis._layers[id] = {\r\n\t\t\tlayer: layer,\r\n\t\t\tname: name,\r\n\t\t\toverlay: overlay\r\n\t\t};\r\n\r\n\t\tif (this.options.autoZIndex && layer.setZIndex) {\r\n\t\t\tthis._lastZIndex++;\r\n\t\t\tlayer.setZIndex(this._lastZIndex);\r\n\t\t}\r\n\t},\r\n\r\n\t_update: function () {\r\n\t\tif (!this._container) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._baseLayersList.innerHTML = '';\r\n\t\tthis._overlaysList.innerHTML = '';\r\n\r\n\t\tvar baseLayersPresent = false,\r\n\t\t    overlaysPresent = false,\r\n\t\t    i, obj;\r\n\r\n\t\tfor (i in this._layers) {\r\n\t\t\tobj = this._layers[i];\r\n\t\t\tthis._addItem(obj);\r\n\t\t\toverlaysPresent = overlaysPresent || obj.overlay;\r\n\t\t\tbaseLayersPresent = baseLayersPresent || !obj.overlay;\r\n\t\t}\r\n\r\n\t\tthis._separator.style.display = overlaysPresent && baseLayersPresent ? '' : 'none';\r\n\t},\r\n\r\n\t_onLayerChange: function (e) {\r\n\t\tvar obj = this._layers[L.stamp(e.layer)];\r\n\r\n\t\tif (!obj) { return; }\r\n\r\n\t\tif (!this._handlingClick) {\r\n\t\t\tthis._update();\r\n\t\t}\r\n\r\n\t\tvar type = obj.overlay ?\r\n\t\t\t(e.type === 'layeradd' ? 'overlayadd' : 'overlayremove') :\r\n\t\t\t(e.type === 'layeradd' ? 'baselayerchange' : null);\r\n\r\n\t\tif (type) {\r\n\t\t\tthis._map.fire(type, obj);\r\n\t\t}\r\n\t},\r\n\r\n\t// IE7 bugs out if you create a radio dynamically, so you have to do it this hacky way (see http://bit.ly/PqYLBe)\r\n\t_createRadioElement: function (name, checked) {\r\n\r\n\t\tvar radioHtml = '<input type=\"radio\" class=\"leaflet-control-layers-selector\" name=\"' + name + '\"';\r\n\t\tif (checked) {\r\n\t\t\tradioHtml += ' checked=\"checked\"';\r\n\t\t}\r\n\t\tradioHtml += '/>';\r\n\r\n\t\tvar radioFragment = document.createElement('div');\r\n\t\tradioFragment.innerHTML = radioHtml;\r\n\r\n\t\treturn radioFragment.firstChild;\r\n\t},\r\n\r\n\t_addItem: function (obj) {\r\n\t\tvar label = document.createElement('label'),\r\n\t\t    input,\r\n\t\t    checked = this._map.hasLayer(obj.layer);\r\n\r\n\t\tif (obj.overlay) {\r\n\t\t\tinput = document.createElement('input');\r\n\t\t\tinput.type = 'checkbox';\r\n\t\t\tinput.className = 'leaflet-control-layers-selector';\r\n\t\t\tinput.defaultChecked = checked;\r\n\t\t} else {\r\n\t\t\tinput = this._createRadioElement('leaflet-base-layers', checked);\r\n\t\t}\r\n\r\n\t\tinput.layerId = L.stamp(obj.layer);\r\n\r\n\t\tL.DomEvent.on(input, 'click', this._onInputClick, this);\r\n\r\n\t\tvar name = document.createElement('span');\r\n\t\tname.innerHTML = ' ' + obj.name;\r\n\r\n\t\tlabel.appendChild(input);\r\n\t\tlabel.appendChild(name);\r\n\r\n\t\tvar container = obj.overlay ? this._overlaysList : this._baseLayersList;\r\n\t\tcontainer.appendChild(label);\r\n\r\n\t\treturn label;\r\n\t},\r\n\r\n\t_onInputClick: function () {\r\n\t\tvar i, input, obj,\r\n\t\t    inputs = this._form.getElementsByTagName('input'),\r\n\t\t    inputsLen = inputs.length;\r\n\r\n\t\tthis._handlingClick = true;\r\n\r\n\t\tfor (i = 0; i < inputsLen; i++) {\r\n\t\t\tinput = inputs[i];\r\n\t\t\tobj = this._layers[input.layerId];\r\n\r\n\t\t\tif (input.checked && !this._map.hasLayer(obj.layer)) {\r\n\t\t\t\tthis._map.addLayer(obj.layer);\r\n\r\n\t\t\t} else if (!input.checked && this._map.hasLayer(obj.layer)) {\r\n\t\t\t\tthis._map.removeLayer(obj.layer);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._handlingClick = false;\r\n\r\n\t\tthis._refocusOnMap();\r\n\t},\r\n\r\n\t_expand: function () {\r\n\t\tL.DomUtil.addClass(this._container, 'leaflet-control-layers-expanded');\r\n\t},\r\n\r\n\t_collapse: function () {\r\n\t\tthis._container.className = this._container.className.replace(' leaflet-control-layers-expanded', '');\r\n\t}\r\n});\r\n\r\nL.control.layers = function (baseLayers, overlays, options) {\r\n\treturn new L.Control.Layers(baseLayers, overlays, options);\r\n};\r\n\n\n/*\n * L.PosAnimation is used by Leaflet internally for pan animations.\n */\n\nL.PosAnimation = L.Class.extend({\n\tincludes: L.Mixin.Events,\n\n\trun: function (el, newPos, duration, easeLinearity) { // (HTMLElement, Point[, Number, Number])\n\t\tthis.stop();\n\n\t\tthis._el = el;\n\t\tthis._inProgress = true;\n\t\tthis._newPos = newPos;\n\n\t\tthis.fire('start');\n\n\t\tel.style[L.DomUtil.TRANSITION] = 'all ' + (duration || 0.25) +\n\t\t        's cubic-bezier(0,0,' + (easeLinearity || 0.5) + ',1)';\n\n\t\tL.DomEvent.on(el, L.DomUtil.TRANSITION_END, this._onTransitionEnd, this);\n\t\tL.DomUtil.setPosition(el, newPos);\n\n\t\t// toggle reflow, Chrome flickers for some reason if you don't do this\n\t\tL.Util.falseFn(el.offsetWidth);\n\n\t\t// there's no native way to track value updates of transitioned properties, so we imitate this\n\t\tthis._stepTimer = setInterval(L.bind(this._onStep, this), 50);\n\t},\n\n\tstop: function () {\n\t\tif (!this._inProgress) { return; }\n\n\t\t// if we just removed the transition property, the element would jump to its final position,\n\t\t// so we need to make it stay at the current position\n\n\t\tL.DomUtil.setPosition(this._el, this._getPos());\n\t\tthis._onTransitionEnd();\n\t\tL.Util.falseFn(this._el.offsetWidth); // force reflow in case we are about to start a new animation\n\t},\n\n\t_onStep: function () {\n\t\tvar stepPos = this._getPos();\n\t\tif (!stepPos) {\n\t\t\tthis._onTransitionEnd();\n\t\t\treturn;\n\t\t}\n\t\t// jshint camelcase: false\n\t\t// make L.DomUtil.getPosition return intermediate position value during animation\n\t\tthis._el._leaflet_pos = stepPos;\n\n\t\tthis.fire('step');\n\t},\n\n\t// you can't easily get intermediate values of properties animated with CSS3 Transitions,\n\t// we need to parse computed style (in case of transform it returns matrix string)\n\n\t_transformRe: /([-+]?(?:\\d*\\.)?\\d+)\\D*, ([-+]?(?:\\d*\\.)?\\d+)\\D*\\)/,\n\n\t_getPos: function () {\n\t\tvar left, top, matches,\n\t\t    el = this._el,\n\t\t    style = window.getComputedStyle(el);\n\n\t\tif (L.Browser.any3d) {\n\t\t\tmatches = style[L.DomUtil.TRANSFORM].match(this._transformRe);\n\t\t\tif (!matches) { return; }\n\t\t\tleft = parseFloat(matches[1]);\n\t\t\ttop  = parseFloat(matches[2]);\n\t\t} else {\n\t\t\tleft = parseFloat(style.left);\n\t\t\ttop  = parseFloat(style.top);\n\t\t}\n\n\t\treturn new L.Point(left, top, true);\n\t},\n\n\t_onTransitionEnd: function () {\n\t\tL.DomEvent.off(this._el, L.DomUtil.TRANSITION_END, this._onTransitionEnd, this);\n\n\t\tif (!this._inProgress) { return; }\n\t\tthis._inProgress = false;\n\n\t\tthis._el.style[L.DomUtil.TRANSITION] = '';\n\n\t\t// jshint camelcase: false\n\t\t// make sure L.DomUtil.getPosition returns the final position value after animation\n\t\tthis._el._leaflet_pos = this._newPos;\n\n\t\tclearInterval(this._stepTimer);\n\n\t\tthis.fire('step').fire('end');\n\t}\n\n});\n\n\n/*\n * Extends L.Map to handle panning animations.\n */\n\nL.Map.include({\n\n\tsetView: function (center, zoom, options) {\n\n\t\tzoom = zoom === undefined ? this._zoom : this._limitZoom(zoom);\n\t\tcenter = this._limitCenter(L.latLng(center), zoom, this.options.maxBounds);\n\t\toptions = options || {};\n\n\t\tif (this._panAnim) {\n\t\t\tthis._panAnim.stop();\n\t\t}\n\n\t\tif (this._loaded && !options.reset && options !== true) {\n\n\t\t\tif (options.animate !== undefined) {\n\t\t\t\toptions.zoom = L.extend({animate: options.animate}, options.zoom);\n\t\t\t\toptions.pan = L.extend({animate: options.animate}, options.pan);\n\t\t\t}\n\n\t\t\t// try animating pan or zoom\n\t\t\tvar animated = (this._zoom !== zoom) ?\n\t\t\t\tthis._tryAnimatedZoom && this._tryAnimatedZoom(center, zoom, options.zoom) :\n\t\t\t\tthis._tryAnimatedPan(center, options.pan);\n\n\t\t\tif (animated) {\n\t\t\t\t// prevent resize handler call, the view will refresh after animation anyway\n\t\t\t\tclearTimeout(this._sizeTimer);\n\t\t\t\treturn this;\n\t\t\t}\n\t\t}\n\n\t\t// animation didn't start, just reset the map view\n\t\tthis._resetView(center, zoom);\n\n\t\treturn this;\n\t},\n\n\tpanBy: function (offset, options) {\n\t\toffset = L.point(offset).round();\n\t\toptions = options || {};\n\n\t\tif (!offset.x && !offset.y) {\n\t\t\treturn this;\n\t\t}\n\n\t\tif (!this._panAnim) {\n\t\t\tthis._panAnim = new L.PosAnimation();\n\n\t\t\tthis._panAnim.on({\n\t\t\t\t'step': this._onPanTransitionStep,\n\t\t\t\t'end': this._onPanTransitionEnd\n\t\t\t}, this);\n\t\t}\n\n\t\t// don't fire movestart if animating inertia\n\t\tif (!options.noMoveStart) {\n\t\t\tthis.fire('movestart');\n\t\t}\n\n\t\t// animate pan unless animate: false specified\n\t\tif (options.animate !== false) {\n\t\t\tL.DomUtil.addClass(this._mapPane, 'leaflet-pan-anim');\n\n\t\t\tvar newPos = this._getMapPanePos().subtract(offset);\n\t\t\tthis._panAnim.run(this._mapPane, newPos, options.duration || 0.25, options.easeLinearity);\n\t\t} else {\n\t\t\tthis._rawPanBy(offset);\n\t\t\tthis.fire('move').fire('moveend');\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t_onPanTransitionStep: function () {\n\t\tthis.fire('move');\n\t},\n\n\t_onPanTransitionEnd: function () {\n\t\tL.DomUtil.removeClass(this._mapPane, 'leaflet-pan-anim');\n\t\tthis.fire('moveend');\n\t},\n\n\t_tryAnimatedPan: function (center, options) {\n\t\t// difference between the new and current centers in pixels\n\t\tvar offset = this._getCenterOffset(center)._floor();\n\n\t\t// don't animate too far unless animate: true specified in options\n\t\tif ((options && options.animate) !== true && !this.getSize().contains(offset)) { return false; }\n\n\t\tthis.panBy(offset, options);\n\n\t\treturn true;\n\t}\n});\n\n\n/*\n * L.PosAnimation fallback implementation that powers Leaflet pan animations\n * in browsers that don't support CSS3 Transitions.\n */\n\nL.PosAnimation = L.DomUtil.TRANSITION ? L.PosAnimation : L.PosAnimation.extend({\n\n\trun: function (el, newPos, duration, easeLinearity) { // (HTMLElement, Point[, Number, Number])\n\t\tthis.stop();\n\n\t\tthis._el = el;\n\t\tthis._inProgress = true;\n\t\tthis._duration = duration || 0.25;\n\t\tthis._easeOutPower = 1 / Math.max(easeLinearity || 0.5, 0.2);\n\n\t\tthis._startPos = L.DomUtil.getPosition(el);\n\t\tthis._offset = newPos.subtract(this._startPos);\n\t\tthis._startTime = +new Date();\n\n\t\tthis.fire('start');\n\n\t\tthis._animate();\n\t},\n\n\tstop: function () {\n\t\tif (!this._inProgress) { return; }\n\n\t\tthis._step();\n\t\tthis._complete();\n\t},\n\n\t_animate: function () {\n\t\t// animation loop\n\t\tthis._animId = L.Util.requestAnimFrame(this._animate, this);\n\t\tthis._step();\n\t},\n\n\t_step: function () {\n\t\tvar elapsed = (+new Date()) - this._startTime,\n\t\t    duration = this._duration * 1000;\n\n\t\tif (elapsed < duration) {\n\t\t\tthis._runFrame(this._easeOut(elapsed / duration));\n\t\t} else {\n\t\t\tthis._runFrame(1);\n\t\t\tthis._complete();\n\t\t}\n\t},\n\n\t_runFrame: function (progress) {\n\t\tvar pos = this._startPos.add(this._offset.multiplyBy(progress));\n\t\tL.DomUtil.setPosition(this._el, pos);\n\n\t\tthis.fire('step');\n\t},\n\n\t_complete: function () {\n\t\tL.Util.cancelAnimFrame(this._animId);\n\n\t\tthis._inProgress = false;\n\t\tthis.fire('end');\n\t},\n\n\t_easeOut: function (t) {\n\t\treturn 1 - Math.pow(1 - t, this._easeOutPower);\n\t}\n});\n\n\n/*\n * Extends L.Map to handle zoom animations.\n */\n\nL.Map.mergeOptions({\n\tzoomAnimation: true,\n\tzoomAnimationThreshold: 4\n});\n\nif (L.DomUtil.TRANSITION) {\n\n\tL.Map.addInitHook(function () {\n\t\t// don't animate on browsers without hardware-accelerated transitions or old Android/Opera\n\t\tthis._zoomAnimated = this.options.zoomAnimation && L.DomUtil.TRANSITION &&\n\t\t\t\tL.Browser.any3d && !L.Browser.android23 && !L.Browser.mobileOpera;\n\n\t\t// zoom transitions run with the same duration for all layers, so if one of transitionend events\n\t\t// happens after starting zoom animation (propagating to the map pane), we know that it ended globally\n\t\tif (this._zoomAnimated) {\n\t\t\tL.DomEvent.on(this._mapPane, L.DomUtil.TRANSITION_END, this._catchTransitionEnd, this);\n\t\t}\n\t});\n}\n\nL.Map.include(!L.DomUtil.TRANSITION ? {} : {\n\n\t_catchTransitionEnd: function (e) {\n\t\tif (this._animatingZoom && e.propertyName.indexOf('transform') >= 0) {\n\t\t\tthis._onZoomTransitionEnd();\n\t\t}\n\t},\n\n\t_nothingToAnimate: function () {\n\t\treturn !this._container.getElementsByClassName('leaflet-zoom-animated').length;\n\t},\n\n\t_tryAnimatedZoom: function (center, zoom, options) {\n\n\t\tif (this._animatingZoom) { return true; }\n\n\t\toptions = options || {};\n\n\t\t// don't animate if disabled, not supported or zoom difference is too large\n\t\tif (!this._zoomAnimated || options.animate === false || this._nothingToAnimate() ||\n\t\t        Math.abs(zoom - this._zoom) > this.options.zoomAnimationThreshold) { return false; }\n\n\t\t// offset is the pixel coords of the zoom origin relative to the current center\n\t\tvar scale = this.getZoomScale(zoom),\n\t\t    offset = this._getCenterOffset(center)._divideBy(1 - 1 / scale),\n\t\t\torigin = this._getCenterLayerPoint()._add(offset);\n\n\t\t// don't animate if the zoom origin isn't within one screen from the current center, unless forced\n\t\tif (options.animate !== true && !this.getSize().contains(offset)) { return false; }\n\n\t\tthis\n\t\t    .fire('movestart')\n\t\t    .fire('zoomstart');\n\n\t\tthis._animateZoom(center, zoom, origin, scale, null, true);\n\n\t\treturn true;\n\t},\n\n\t_animateZoom: function (center, zoom, origin, scale, delta, backwards, forTouchZoom) {\n\n\t\tif (!forTouchZoom) {\n\t\t\tthis._animatingZoom = true;\n\t\t}\n\n\t\t// put transform transition on all layers with leaflet-zoom-animated class\n\t\tL.DomUtil.addClass(this._mapPane, 'leaflet-zoom-anim');\n\n\t\t// remember what center/zoom to set after animation\n\t\tthis._animateToCenter = center;\n\t\tthis._animateToZoom = zoom;\n\n\t\t// disable any dragging during animation\n\t\tif (L.Draggable) {\n\t\t\tL.Draggable._disabled = true;\n\t\t}\n\n\t\tL.Util.requestAnimFrame(function () {\n\t\t\tthis.fire('zoomanim', {\n\t\t\t\tcenter: center,\n\t\t\t\tzoom: zoom,\n\t\t\t\torigin: origin,\n\t\t\t\tscale: scale,\n\t\t\t\tdelta: delta,\n\t\t\t\tbackwards: backwards\n\t\t\t});\n\t\t}, this);\n\t},\n\n\t_onZoomTransitionEnd: function () {\n\n\t\tthis._animatingZoom = false;\n\n\t\tL.DomUtil.removeClass(this._mapPane, 'leaflet-zoom-anim');\n\n\t\tthis._resetView(this._animateToCenter, this._animateToZoom, true, true);\n\n\t\tif (L.Draggable) {\n\t\t\tL.Draggable._disabled = false;\n\t\t}\n\t}\n});\n\n\n/*\n\tZoom animation logic for L.TileLayer.\n*/\n\nL.TileLayer.include({\n\t_animateZoom: function (e) {\n\t\tif (!this._animating) {\n\t\t\tthis._animating = true;\n\t\t\tthis._prepareBgBuffer();\n\t\t}\n\n\t\tvar bg = this._bgBuffer,\n\t\t    transform = L.DomUtil.TRANSFORM,\n\t\t    initialTransform = e.delta ? L.DomUtil.getTranslateString(e.delta) : bg.style[transform],\n\t\t    scaleStr = L.DomUtil.getScaleString(e.scale, e.origin);\n\n\t\tbg.style[transform] = e.backwards ?\n\t\t\t\tscaleStr + ' ' + initialTransform :\n\t\t\t\tinitialTransform + ' ' + scaleStr;\n\t},\n\n\t_endZoomAnim: function () {\n\t\tvar front = this._tileContainer,\n\t\t    bg = this._bgBuffer;\n\n\t\tfront.style.visibility = '';\n\t\tfront.parentNode.appendChild(front); // Bring to fore\n\n\t\t// force reflow\n\t\tL.Util.falseFn(bg.offsetWidth);\n\n\t\tthis._animating = false;\n\t},\n\n\t_clearBgBuffer: function () {\n\t\tvar map = this._map;\n\n\t\tif (map && !map._animatingZoom && !map.touchZoom._zooming) {\n\t\t\tthis._bgBuffer.innerHTML = '';\n\t\t\tthis._bgBuffer.style[L.DomUtil.TRANSFORM] = '';\n\t\t}\n\t},\n\n\t_prepareBgBuffer: function () {\n\n\t\tvar front = this._tileContainer,\n\t\t    bg = this._bgBuffer;\n\n\t\t// if foreground layer doesn't have many tiles but bg layer does,\n\t\t// keep the existing bg layer and just zoom it some more\n\n\t\tvar bgLoaded = this._getLoadedTilesPercentage(bg),\n\t\t    frontLoaded = this._getLoadedTilesPercentage(front);\n\n\t\tif (bg && bgLoaded > 0.5 && frontLoaded < 0.5) {\n\n\t\t\tfront.style.visibility = 'hidden';\n\t\t\tthis._stopLoadingImages(front);\n\t\t\treturn;\n\t\t}\n\n\t\t// prepare the buffer to become the front tile pane\n\t\tbg.style.visibility = 'hidden';\n\t\tbg.style[L.DomUtil.TRANSFORM] = '';\n\n\t\t// switch out the current layer to be the new bg layer (and vice-versa)\n\t\tthis._tileContainer = bg;\n\t\tbg = this._bgBuffer = front;\n\n\t\tthis._stopLoadingImages(bg);\n\n\t\t//prevent bg buffer from clearing right after zoom\n\t\tclearTimeout(this._clearBgBufferTimer);\n\t},\n\n\t_getLoadedTilesPercentage: function (container) {\n\t\tvar tiles = container.getElementsByTagName('img'),\n\t\t    i, len, count = 0;\n\n\t\tfor (i = 0, len = tiles.length; i < len; i++) {\n\t\t\tif (tiles[i].complete) {\n\t\t\t\tcount++;\n\t\t\t}\n\t\t}\n\t\treturn count / len;\n\t},\n\n\t// stops loading all tiles in the background layer\n\t_stopLoadingImages: function (container) {\n\t\tvar tiles = Array.prototype.slice.call(container.getElementsByTagName('img')),\n\t\t    i, len, tile;\n\n\t\tfor (i = 0, len = tiles.length; i < len; i++) {\n\t\t\ttile = tiles[i];\n\n\t\t\tif (!tile.complete) {\n\t\t\t\ttile.onload = L.Util.falseFn;\n\t\t\t\ttile.onerror = L.Util.falseFn;\n\t\t\t\ttile.src = L.Util.emptyImageUrl;\n\n\t\t\t\ttile.parentNode.removeChild(tile);\n\t\t\t}\n\t\t}\n\t}\n});\n\n\n/*\r\n * Provides L.Map with convenient shortcuts for using browser geolocation features.\r\n */\r\n\r\nL.Map.include({\r\n\t_defaultLocateOptions: {\r\n\t\twatch: false,\r\n\t\tsetView: false,\r\n\t\tmaxZoom: Infinity,\r\n\t\ttimeout: 10000,\r\n\t\tmaximumAge: 0,\r\n\t\tenableHighAccuracy: false\r\n\t},\r\n\r\n\tlocate: function (/*Object*/ options) {\r\n\r\n\t\toptions = this._locateOptions = L.extend(this._defaultLocateOptions, options);\r\n\r\n\t\tif (!navigator.geolocation) {\r\n\t\t\tthis._handleGeolocationError({\r\n\t\t\t\tcode: 0,\r\n\t\t\t\tmessage: 'Geolocation not supported.'\r\n\t\t\t});\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tvar onResponse = L.bind(this._handleGeolocationResponse, this),\r\n\t\t\tonError = L.bind(this._handleGeolocationError, this);\r\n\r\n\t\tif (options.watch) {\r\n\t\t\tthis._locationWatchId =\r\n\t\t\t        navigator.geolocation.watchPosition(onResponse, onError, options);\r\n\t\t} else {\r\n\t\t\tnavigator.geolocation.getCurrentPosition(onResponse, onError, options);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tstopLocate: function () {\r\n\t\tif (navigator.geolocation) {\r\n\t\t\tnavigator.geolocation.clearWatch(this._locationWatchId);\r\n\t\t}\r\n\t\tif (this._locateOptions) {\r\n\t\t\tthis._locateOptions.setView = false;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_handleGeolocationError: function (error) {\r\n\t\tvar c = error.code,\r\n\t\t    message = error.message ||\r\n\t\t            (c === 1 ? 'permission denied' :\r\n\t\t            (c === 2 ? 'position unavailable' : 'timeout'));\r\n\r\n\t\tif (this._locateOptions.setView && !this._loaded) {\r\n\t\t\tthis.fitWorld();\r\n\t\t}\r\n\r\n\t\tthis.fire('locationerror', {\r\n\t\t\tcode: c,\r\n\t\t\tmessage: 'Geolocation error: ' + message + '.'\r\n\t\t});\r\n\t},\r\n\r\n\t_handleGeolocationResponse: function (pos) {\r\n\t\tvar lat = pos.coords.latitude,\r\n\t\t    lng = pos.coords.longitude,\r\n\t\t    latlng = new L.LatLng(lat, lng),\r\n\r\n\t\t    latAccuracy = 180 * pos.coords.accuracy / 40075017,\r\n\t\t    lngAccuracy = latAccuracy / Math.cos(L.LatLng.DEG_TO_RAD * lat),\r\n\r\n\t\t    bounds = L.latLngBounds(\r\n\t\t            [lat - latAccuracy, lng - lngAccuracy],\r\n\t\t            [lat + latAccuracy, lng + lngAccuracy]),\r\n\r\n\t\t    options = this._locateOptions;\r\n\r\n\t\tif (options.setView) {\r\n\t\t\tvar zoom = Math.min(this.getBoundsZoom(bounds), options.maxZoom);\r\n\t\t\tthis.setView(latlng, zoom);\r\n\t\t}\r\n\r\n\t\tvar data = {\r\n\t\t\tlatlng: latlng,\r\n\t\t\tbounds: bounds,\r\n\t\t\ttimestamp: pos.timestamp\r\n\t\t};\r\n\r\n\t\tfor (var i in pos.coords) {\r\n\t\t\tif (typeof pos.coords[i] === 'number') {\r\n\t\t\t\tdata[i] = pos.coords[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.fire('locationfound', data);\r\n\t}\r\n});\r\n\n\n}(window, document));","var html_sanitize = require('./sanitizer-bundle.js');\n\nmodule.exports = function(_) {\n    if (!_) return '';\n    return html_sanitize(_, cleanUrl, cleanId);\n};\n\n// https://bugzilla.mozilla.org/show_bug.cgi?id=255107\nfunction cleanUrl(url) {\n    'use strict';\n    if (/^https?/.test(url.getScheme())) return url.toString();\n    if (/^mailto?/.test(url.getScheme())) return url.toString();\n    if ('data' == url.getScheme() && /^image/.test(url.getPath())) {\n        return url.toString();\n    }\n}\n\nfunction cleanId(id) { return id; }\n","/*!\n * mustache.js - Logic-less {{mustache}} templates with JavaScript\n * http://github.com/janl/mustache.js\n */\n\n/*global define: false*/\n\n(function (root, factory) {\n  if (typeof exports === \"object\" && exports) {\n    factory(exports); // CommonJS\n  } else {\n    var mustache = {};\n    factory(mustache);\n    if (typeof define === \"function\" && define.amd) {\n      define(mustache); // AMD\n    } else {\n      root.Mustache = mustache; // <script>\n    }\n  }\n}(this, function (mustache) {\n\n  var whiteRe = /\\s*/;\n  var spaceRe = /\\s+/;\n  var nonSpaceRe = /\\S/;\n  var eqRe = /\\s*=/;\n  var curlyRe = /\\s*\\}/;\n  var tagRe = /#|\\^|\\/|>|\\{|&|=|!/;\n\n  // Workaround for https://issues.apache.org/jira/browse/COUCHDB-577\n  // See https://github.com/janl/mustache.js/issues/189\n  var RegExp_test = RegExp.prototype.test;\n  function testRegExp(re, string) {\n    return RegExp_test.call(re, string);\n  }\n\n  function isWhitespace(string) {\n    return !testRegExp(nonSpaceRe, string);\n  }\n\n  var Object_toString = Object.prototype.toString;\n  var isArray = Array.isArray || function (object) {\n    return Object_toString.call(object) === '[object Array]';\n  };\n\n  function isFunction(object) {\n    return typeof object === 'function';\n  }\n\n  function escapeRegExp(string) {\n    return string.replace(/[\\-\\[\\]{}()*+?.,\\\\\\^$|#\\s]/g, \"\\\\$&\");\n  }\n\n  var entityMap = {\n    \"&\": \"&amp;\",\n    \"<\": \"&lt;\",\n    \">\": \"&gt;\",\n    '\"': '&quot;',\n    \"'\": '&#39;',\n    \"/\": '&#x2F;'\n  };\n\n  function escapeHtml(string) {\n    return String(string).replace(/[&<>\"'\\/]/g, function (s) {\n      return entityMap[s];\n    });\n  }\n\n  function Scanner(string) {\n    this.string = string;\n    this.tail = string;\n    this.pos = 0;\n  }\n\n  /**\n   * Returns `true` if the tail is empty (end of string).\n   */\n  Scanner.prototype.eos = function () {\n    return this.tail === \"\";\n  };\n\n  /**\n   * Tries to match the given regular expression at the current position.\n   * Returns the matched text if it can match, the empty string otherwise.\n   */\n  Scanner.prototype.scan = function (re) {\n    var match = this.tail.match(re);\n\n    if (match && match.index === 0) {\n      var string = match[0];\n      this.tail = this.tail.substring(string.length);\n      this.pos += string.length;\n      return string;\n    }\n\n    return \"\";\n  };\n\n  /**\n   * Skips all text until the given regular expression can be matched. Returns\n   * the skipped string, which is the entire tail if no match can be made.\n   */\n  Scanner.prototype.scanUntil = function (re) {\n    var index = this.tail.search(re), match;\n\n    switch (index) {\n    case -1:\n      match = this.tail;\n      this.tail = \"\";\n      break;\n    case 0:\n      match = \"\";\n      break;\n    default:\n      match = this.tail.substring(0, index);\n      this.tail = this.tail.substring(index);\n    }\n\n    this.pos += match.length;\n\n    return match;\n  };\n\n  function Context(view, parent) {\n    this.view = view == null ? {} : view;\n    this.parent = parent;\n    this._cache = { '.': this.view };\n  }\n\n  Context.make = function (view) {\n    return (view instanceof Context) ? view : new Context(view);\n  };\n\n  Context.prototype.push = function (view) {\n    return new Context(view, this);\n  };\n\n  Context.prototype.lookup = function (name) {\n    var value;\n    if (name in this._cache) {\n      value = this._cache[name];\n    } else {\n      var context = this;\n\n      while (context) {\n        if (name.indexOf('.') > 0) {\n          value = context.view;\n\n          var names = name.split('.'), i = 0;\n          while (value != null && i < names.length) {\n            value = value[names[i++]];\n          }\n        } else {\n          value = context.view[name];\n        }\n\n        if (value != null) break;\n\n        context = context.parent;\n      }\n\n      this._cache[name] = value;\n    }\n\n    if (isFunction(value)) {\n      value = value.call(this.view);\n    }\n\n    return value;\n  };\n\n  function Writer() {\n    this.clearCache();\n  }\n\n  Writer.prototype.clearCache = function () {\n    this._cache = {};\n    this._partialCache = {};\n  };\n\n  Writer.prototype.compile = function (template, tags) {\n    var fn = this._cache[template];\n\n    if (!fn) {\n      var tokens = mustache.parse(template, tags);\n      fn = this._cache[template] = this.compileTokens(tokens, template);\n    }\n\n    return fn;\n  };\n\n  Writer.prototype.compilePartial = function (name, template, tags) {\n    var fn = this.compile(template, tags);\n    this._partialCache[name] = fn;\n    return fn;\n  };\n\n  Writer.prototype.getPartial = function (name) {\n    if (!(name in this._partialCache) && this._loadPartial) {\n      this.compilePartial(name, this._loadPartial(name));\n    }\n\n    return this._partialCache[name];\n  };\n\n  Writer.prototype.compileTokens = function (tokens, template) {\n    var self = this;\n    return function (view, partials) {\n      if (partials) {\n        if (isFunction(partials)) {\n          self._loadPartial = partials;\n        } else {\n          for (var name in partials) {\n            self.compilePartial(name, partials[name]);\n          }\n        }\n      }\n\n      return renderTokens(tokens, self, Context.make(view), template);\n    };\n  };\n\n  Writer.prototype.render = function (template, view, partials) {\n    return this.compile(template)(view, partials);\n  };\n\n  /**\n   * Low-level function that renders the given `tokens` using the given `writer`\n   * and `context`. The `template` string is only needed for templates that use\n   * higher-order sections to extract the portion of the original template that\n   * was contained in that section.\n   */\n  function renderTokens(tokens, writer, context, template) {\n    var buffer = '';\n\n    // This function is used to render an artbitrary template\n    // in the current context by higher-order functions.\n    function subRender(template) {\n      return writer.render(template, context);\n    }\n\n    var token, tokenValue, value;\n    for (var i = 0, len = tokens.length; i < len; ++i) {\n      token = tokens[i];\n      tokenValue = token[1];\n\n      switch (token[0]) {\n      case '#':\n        value = context.lookup(tokenValue);\n\n        if (typeof value === 'object' || typeof value === 'string') {\n          if (isArray(value)) {\n            for (var j = 0, jlen = value.length; j < jlen; ++j) {\n              buffer += renderTokens(token[4], writer, context.push(value[j]), template);\n            }\n          } else if (value) {\n            buffer += renderTokens(token[4], writer, context.push(value), template);\n          }\n        } else if (isFunction(value)) {\n          var text = template == null ? null : template.slice(token[3], token[5]);\n          value = value.call(context.view, text, subRender);\n          if (value != null) buffer += value;\n        } else if (value) {\n          buffer += renderTokens(token[4], writer, context, template);\n        }\n\n        break;\n      case '^':\n        value = context.lookup(tokenValue);\n\n        // Use JavaScript's definition of falsy. Include empty arrays.\n        // See https://github.com/janl/mustache.js/issues/186\n        if (!value || (isArray(value) && value.length === 0)) {\n          buffer += renderTokens(token[4], writer, context, template);\n        }\n\n        break;\n      case '>':\n        value = writer.getPartial(tokenValue);\n        if (isFunction(value)) buffer += value(context);\n        break;\n      case '&':\n        value = context.lookup(tokenValue);\n        if (value != null) buffer += value;\n        break;\n      case 'name':\n        value = context.lookup(tokenValue);\n        if (value != null) buffer += mustache.escape(value);\n        break;\n      case 'text':\n        buffer += tokenValue;\n        break;\n      }\n    }\n\n    return buffer;\n  }\n\n  /**\n   * Forms the given array of `tokens` into a nested tree structure where\n   * tokens that represent a section have two additional items: 1) an array of\n   * all tokens that appear in that section and 2) the index in the original\n   * template that represents the end of that section.\n   */\n  function nestTokens(tokens) {\n    var tree = [];\n    var collector = tree;\n    var sections = [];\n\n    var token;\n    for (var i = 0, len = tokens.length; i < len; ++i) {\n      token = tokens[i];\n      switch (token[0]) {\n      case '#':\n      case '^':\n        sections.push(token);\n        collector.push(token);\n        collector = token[4] = [];\n        break;\n      case '/':\n        var section = sections.pop();\n        section[5] = token[2];\n        collector = sections.length > 0 ? sections[sections.length - 1][4] : tree;\n        break;\n      default:\n        collector.push(token);\n      }\n    }\n\n    return tree;\n  }\n\n  /**\n   * Combines the values of consecutive text tokens in the given `tokens` array\n   * to a single token.\n   */\n  function squashTokens(tokens) {\n    var squashedTokens = [];\n\n    var token, lastToken;\n    for (var i = 0, len = tokens.length; i < len; ++i) {\n      token = tokens[i];\n      if (token) {\n        if (token[0] === 'text' && lastToken && lastToken[0] === 'text') {\n          lastToken[1] += token[1];\n          lastToken[3] = token[3];\n        } else {\n          lastToken = token;\n          squashedTokens.push(token);\n        }\n      }\n    }\n\n    return squashedTokens;\n  }\n\n  function escapeTags(tags) {\n    return [\n      new RegExp(escapeRegExp(tags[0]) + \"\\\\s*\"),\n      new RegExp(\"\\\\s*\" + escapeRegExp(tags[1]))\n    ];\n  }\n\n  /**\n   * Breaks up the given `template` string into a tree of token objects. If\n   * `tags` is given here it must be an array with two string values: the\n   * opening and closing tags used in the template (e.g. [\"<%\", \"%>\"]). Of\n   * course, the default is to use mustaches (i.e. Mustache.tags).\n   */\n  function parseTemplate(template, tags) {\n    template = template || '';\n    tags = tags || mustache.tags;\n\n    if (typeof tags === 'string') tags = tags.split(spaceRe);\n    if (tags.length !== 2) throw new Error('Invalid tags: ' + tags.join(', '));\n\n    var tagRes = escapeTags(tags);\n    var scanner = new Scanner(template);\n\n    var sections = [];     // Stack to hold section tokens\n    var tokens = [];       // Buffer to hold the tokens\n    var spaces = [];       // Indices of whitespace tokens on the current line\n    var hasTag = false;    // Is there a {{tag}} on the current line?\n    var nonSpace = false;  // Is there a non-space char on the current line?\n\n    // Strips all whitespace tokens array for the current line\n    // if there was a {{#tag}} on it and otherwise only space.\n    function stripSpace() {\n      if (hasTag && !nonSpace) {\n        while (spaces.length) {\n          delete tokens[spaces.pop()];\n        }\n      } else {\n        spaces = [];\n      }\n\n      hasTag = false;\n      nonSpace = false;\n    }\n\n    var start, type, value, chr, token, openSection;\n    while (!scanner.eos()) {\n      start = scanner.pos;\n\n      // Match any text between tags.\n      value = scanner.scanUntil(tagRes[0]);\n      if (value) {\n        for (var i = 0, len = value.length; i < len; ++i) {\n          chr = value.charAt(i);\n\n          if (isWhitespace(chr)) {\n            spaces.push(tokens.length);\n          } else {\n            nonSpace = true;\n          }\n\n          tokens.push(['text', chr, start, start + 1]);\n          start += 1;\n\n          // Check for whitespace on the current line.\n          if (chr == '\\n') stripSpace();\n        }\n      }\n\n      // Match the opening tag.\n      if (!scanner.scan(tagRes[0])) break;\n      hasTag = true;\n\n      // Get the tag type.\n      type = scanner.scan(tagRe) || 'name';\n      scanner.scan(whiteRe);\n\n      // Get the tag value.\n      if (type === '=') {\n        value = scanner.scanUntil(eqRe);\n        scanner.scan(eqRe);\n        scanner.scanUntil(tagRes[1]);\n      } else if (type === '{') {\n        value = scanner.scanUntil(new RegExp('\\\\s*' + escapeRegExp('}' + tags[1])));\n        scanner.scan(curlyRe);\n        scanner.scanUntil(tagRes[1]);\n        type = '&';\n      } else {\n        value = scanner.scanUntil(tagRes[1]);\n      }\n\n      // Match the closing tag.\n      if (!scanner.scan(tagRes[1])) throw new Error('Unclosed tag at ' + scanner.pos);\n\n      token = [type, value, start, scanner.pos];\n      tokens.push(token);\n\n      if (type === '#' || type === '^') {\n        sections.push(token);\n      } else if (type === '/') {\n        // Check section nesting.\n        openSection = sections.pop();\n        if (!openSection) {\n          throw new Error('Unopened section \"' + value + '\" at ' + start);\n        }\n        if (openSection[1] !== value) {\n          throw new Error('Unclosed section \"' + openSection[1] + '\" at ' + start);\n        }\n      } else if (type === 'name' || type === '{' || type === '&') {\n        nonSpace = true;\n      } else if (type === '=') {\n        // Set the tags for the next time around.\n        tags = value.split(spaceRe);\n        if (tags.length !== 2) {\n          throw new Error('Invalid tags at ' + start + ': ' + tags.join(', '));\n        }\n        tagRes = escapeTags(tags);\n      }\n    }\n\n    // Make sure there are no open sections when we're done.\n    openSection = sections.pop();\n    if (openSection) {\n      throw new Error('Unclosed section \"' + openSection[1] + '\" at ' + scanner.pos);\n    }\n\n    return nestTokens(squashTokens(tokens));\n  }\n\n  mustache.name = \"mustache.js\";\n  mustache.version = \"0.7.3\";\n  mustache.tags = [\"{{\", \"}}\"];\n\n  mustache.Scanner = Scanner;\n  mustache.Context = Context;\n  mustache.Writer = Writer;\n\n  mustache.parse = parseTemplate;\n\n  // Export the escaping function so that the user may override it.\n  // See https://github.com/janl/mustache.js/issues/244\n  mustache.escape = escapeHtml;\n\n  // All Mustache.* functions use this writer.\n  var defaultWriter = new Writer();\n\n  /**\n   * Clears all cached templates and partials in the default writer.\n   */\n  mustache.clearCache = function () {\n    return defaultWriter.clearCache();\n  };\n\n  /**\n   * Compiles the given `template` to a reusable function using the default\n   * writer.\n   */\n  mustache.compile = function (template, tags) {\n    return defaultWriter.compile(template, tags);\n  };\n\n  /**\n   * Compiles the partial with the given `name` and `template` to a reusable\n   * function using the default writer.\n   */\n  mustache.compilePartial = function (name, template, tags) {\n    return defaultWriter.compilePartial(name, template, tags);\n  };\n\n  /**\n   * Compiles the given array of tokens (the output of a parse) to a reusable\n   * function using the default writer.\n   */\n  mustache.compileTokens = function (tokens, template) {\n    return defaultWriter.compileTokens(tokens, template);\n  };\n\n  /**\n   * Renders the `template` with the given `view` and `partials` using the\n   * default writer.\n   */\n  mustache.render = function (template, view, partials) {\n    return defaultWriter.render(template, view, partials);\n  };\n\n  // This is here for backwards compatibility with 0.4.x.\n  mustache.to_html = function (template, view, partials, send) {\n    var result = mustache.render(template, view, partials);\n\n    if (isFunction(send)) {\n      send(result);\n    } else {\n      return result;\n    }\n  };\n\n}));\n","\n// Copyright (C) 2010 Google Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview\n * Implements RFC 3986 for parsing/formatting URIs.\n *\n * @author mikesamuel@gmail.com\n * \\@provides URI\n * \\@overrides window\n */\n\nvar URI = (function () {\n\n/**\n * creates a uri from the string form.  The parser is relaxed, so special\n * characters that aren't escaped but don't cause ambiguities will not cause\n * parse failures.\n *\n * @return {URI|null}\n */\nfunction parse(uriStr) {\n  var m = ('' + uriStr).match(URI_RE_);\n  if (!m) { return null; }\n  return new URI(\n      nullIfAbsent(m[1]),\n      nullIfAbsent(m[2]),\n      nullIfAbsent(m[3]),\n      nullIfAbsent(m[4]),\n      nullIfAbsent(m[5]),\n      nullIfAbsent(m[6]),\n      nullIfAbsent(m[7]));\n}\n\n\n/**\n * creates a uri from the given parts.\n *\n * @param scheme {string} an unencoded scheme such as \"http\" or null\n * @param credentials {string} unencoded user credentials or null\n * @param domain {string} an unencoded domain name or null\n * @param port {number} a port number in [1, 32768].\n *    -1 indicates no port, as does null.\n * @param path {string} an unencoded path\n * @param query {Array.<string>|string|null} a list of unencoded cgi\n *   parameters where even values are keys and odds the corresponding values\n *   or an unencoded query.\n * @param fragment {string} an unencoded fragment without the \"#\" or null.\n * @return {URI}\n */\nfunction create(scheme, credentials, domain, port, path, query, fragment) {\n  var uri = new URI(\n      encodeIfExists2(scheme, URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_),\n      encodeIfExists2(\n          credentials, URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_),\n      encodeIfExists(domain),\n      port > 0 ? port.toString() : null,\n      encodeIfExists2(path, URI_DISALLOWED_IN_PATH_),\n      null,\n      encodeIfExists(fragment));\n  if (query) {\n    if ('string' === typeof query) {\n      uri.setRawQuery(query.replace(/[^?&=0-9A-Za-z_\\-~.%]/g, encodeOne));\n    } else {\n      uri.setAllParameters(query);\n    }\n  }\n  return uri;\n}\nfunction encodeIfExists(unescapedPart) {\n  if ('string' == typeof unescapedPart) {\n    return encodeURIComponent(unescapedPart);\n  }\n  return null;\n};\n/**\n * if unescapedPart is non null, then escapes any characters in it that aren't\n * valid characters in a url and also escapes any special characters that\n * appear in extra.\n *\n * @param unescapedPart {string}\n * @param extra {RegExp} a character set of characters in [\\01-\\177].\n * @return {string|null} null iff unescapedPart == null.\n */\nfunction encodeIfExists2(unescapedPart, extra) {\n  if ('string' == typeof unescapedPart) {\n    return encodeURI(unescapedPart).replace(extra, encodeOne);\n  }\n  return null;\n};\n/** converts a character in [\\01-\\177] to its url encoded equivalent. */\nfunction encodeOne(ch) {\n  var n = ch.charCodeAt(0);\n  return '%' + '0123456789ABCDEF'.charAt((n >> 4) & 0xf) +\n      '0123456789ABCDEF'.charAt(n & 0xf);\n}\n\n/**\n * {@updoc\n *  $ normPath('foo/./bar')\n *  # 'foo/bar'\n *  $ normPath('./foo')\n *  # 'foo'\n *  $ normPath('foo/.')\n *  # 'foo'\n *  $ normPath('foo//bar')\n *  # 'foo/bar'\n * }\n */\nfunction normPath(path) {\n  return path.replace(/(^|\\/)\\.(?:\\/|$)/g, '$1').replace(/\\/{2,}/g, '/');\n}\n\nvar PARENT_DIRECTORY_HANDLER = new RegExp(\n    ''\n    // A path break\n    + '(/|^)'\n    // followed by a non .. path element\n    // (cannot be . because normPath is used prior to this RegExp)\n    + '(?:[^./][^/]*|\\\\.{2,}(?:[^./][^/]*)|\\\\.{3,}[^/]*)'\n    // followed by .. followed by a path break.\n    + '/\\\\.\\\\.(?:/|$)');\n\nvar PARENT_DIRECTORY_HANDLER_RE = new RegExp(PARENT_DIRECTORY_HANDLER);\n\nvar EXTRA_PARENT_PATHS_RE = /^(?:\\.\\.\\/)*(?:\\.\\.$)?/;\n\n/**\n * Normalizes its input path and collapses all . and .. sequences except for\n * .. sequences that would take it above the root of the current parent\n * directory.\n * {@updoc\n *  $ collapse_dots('foo/../bar')\n *  # 'bar'\n *  $ collapse_dots('foo/./bar')\n *  # 'foo/bar'\n *  $ collapse_dots('foo/../bar/./../../baz')\n *  # 'baz'\n *  $ collapse_dots('../foo')\n *  # '../foo'\n *  $ collapse_dots('../foo').replace(EXTRA_PARENT_PATHS_RE, '')\n *  # 'foo'\n * }\n */\nfunction collapse_dots(path) {\n  if (path === null) { return null; }\n  var p = normPath(path);\n  // Only /../ left to flatten\n  var r = PARENT_DIRECTORY_HANDLER_RE;\n  // We replace with $1 which matches a / before the .. because this\n  // guarantees that:\n  // (1) we have at most 1 / between the adjacent place,\n  // (2) always have a slash if there is a preceding path section, and\n  // (3) we never turn a relative path into an absolute path.\n  for (var q; (q = p.replace(r, '$1')) != p; p = q) {};\n  return p;\n}\n\n/**\n * resolves a relative url string to a base uri.\n * @return {URI}\n */\nfunction resolve(baseUri, relativeUri) {\n  // there are several kinds of relative urls:\n  // 1. //foo - replaces everything from the domain on.  foo is a domain name\n  // 2. foo - replaces the last part of the path, the whole query and fragment\n  // 3. /foo - replaces the the path, the query and fragment\n  // 4. ?foo - replace the query and fragment\n  // 5. #foo - replace the fragment only\n\n  var absoluteUri = baseUri.clone();\n  // we satisfy these conditions by looking for the first part of relativeUri\n  // that is not blank and applying defaults to the rest\n\n  var overridden = relativeUri.hasScheme();\n\n  if (overridden) {\n    absoluteUri.setRawScheme(relativeUri.getRawScheme());\n  } else {\n    overridden = relativeUri.hasCredentials();\n  }\n\n  if (overridden) {\n    absoluteUri.setRawCredentials(relativeUri.getRawCredentials());\n  } else {\n    overridden = relativeUri.hasDomain();\n  }\n\n  if (overridden) {\n    absoluteUri.setRawDomain(relativeUri.getRawDomain());\n  } else {\n    overridden = relativeUri.hasPort();\n  }\n\n  var rawPath = relativeUri.getRawPath();\n  var simplifiedPath = collapse_dots(rawPath);\n  if (overridden) {\n    absoluteUri.setPort(relativeUri.getPort());\n    simplifiedPath = simplifiedPath\n        && simplifiedPath.replace(EXTRA_PARENT_PATHS_RE, '');\n  } else {\n    overridden = !!rawPath;\n    if (overridden) {\n      // resolve path properly\n      if (simplifiedPath.charCodeAt(0) !== 0x2f /* / */) {  // path is relative\n        var absRawPath = collapse_dots(absoluteUri.getRawPath() || '')\n            .replace(EXTRA_PARENT_PATHS_RE, '');\n        var slash = absRawPath.lastIndexOf('/') + 1;\n        simplifiedPath = collapse_dots(\n            (slash ? absRawPath.substring(0, slash) : '')\n            + collapse_dots(rawPath))\n            .replace(EXTRA_PARENT_PATHS_RE, '');\n      }\n    } else {\n      simplifiedPath = simplifiedPath\n          && simplifiedPath.replace(EXTRA_PARENT_PATHS_RE, '');\n      if (simplifiedPath !== rawPath) {\n        absoluteUri.setRawPath(simplifiedPath);\n      }\n    }\n  }\n\n  if (overridden) {\n    absoluteUri.setRawPath(simplifiedPath);\n  } else {\n    overridden = relativeUri.hasQuery();\n  }\n\n  if (overridden) {\n    absoluteUri.setRawQuery(relativeUri.getRawQuery());\n  } else {\n    overridden = relativeUri.hasFragment();\n  }\n\n  if (overridden) {\n    absoluteUri.setRawFragment(relativeUri.getRawFragment());\n  }\n\n  return absoluteUri;\n}\n\n/**\n * a mutable URI.\n *\n * This class contains setters and getters for the parts of the URI.\n * The <tt>getXYZ</tt>/<tt>setXYZ</tt> methods return the decoded part -- so\n * <code>uri.parse('/foo%20bar').getPath()</code> will return the decoded path,\n * <tt>/foo bar</tt>.\n *\n * <p>The raw versions of fields are available too.\n * <code>uri.parse('/foo%20bar').getRawPath()</code> will return the raw path,\n * <tt>/foo%20bar</tt>.  Use the raw setters with care, since\n * <code>URI::toString</code> is not guaranteed to return a valid url if a\n * raw setter was used.\n *\n * <p>All setters return <tt>this</tt> and so may be chained, a la\n * <code>uri.parse('/foo').setFragment('part').toString()</code>.\n *\n * <p>You should not use this constructor directly -- please prefer the factory\n * functions {@link uri.parse}, {@link uri.create}, {@link uri.resolve}\n * instead.</p>\n *\n * <p>The parameters are all raw (assumed to be properly escaped) parts, and\n * any (but not all) may be null.  Undefined is not allowed.</p>\n *\n * @constructor\n */\nfunction URI(\n    rawScheme,\n    rawCredentials, rawDomain, port,\n    rawPath, rawQuery, rawFragment) {\n  this.scheme_ = rawScheme;\n  this.credentials_ = rawCredentials;\n  this.domain_ = rawDomain;\n  this.port_ = port;\n  this.path_ = rawPath;\n  this.query_ = rawQuery;\n  this.fragment_ = rawFragment;\n  /**\n   * @type {Array|null}\n   */\n  this.paramCache_ = null;\n}\n\n/** returns the string form of the url. */\nURI.prototype.toString = function () {\n  var out = [];\n  if (null !== this.scheme_) { out.push(this.scheme_, ':'); }\n  if (null !== this.domain_) {\n    out.push('//');\n    if (null !== this.credentials_) { out.push(this.credentials_, '@'); }\n    out.push(this.domain_);\n    if (null !== this.port_) { out.push(':', this.port_.toString()); }\n  }\n  if (null !== this.path_) { out.push(this.path_); }\n  if (null !== this.query_) { out.push('?', this.query_); }\n  if (null !== this.fragment_) { out.push('#', this.fragment_); }\n  return out.join('');\n};\n\nURI.prototype.clone = function () {\n  return new URI(this.scheme_, this.credentials_, this.domain_, this.port_,\n                 this.path_, this.query_, this.fragment_);\n};\n\nURI.prototype.getScheme = function () {\n  // HTML5 spec does not require the scheme to be lowercased but\n  // all common browsers except Safari lowercase the scheme.\n  return this.scheme_ && decodeURIComponent(this.scheme_).toLowerCase();\n};\nURI.prototype.getRawScheme = function () {\n  return this.scheme_;\n};\nURI.prototype.setScheme = function (newScheme) {\n  this.scheme_ = encodeIfExists2(\n      newScheme, URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_);\n  return this;\n};\nURI.prototype.setRawScheme = function (newScheme) {\n  this.scheme_ = newScheme ? newScheme : null;\n  return this;\n};\nURI.prototype.hasScheme = function () {\n  return null !== this.scheme_;\n};\n\n\nURI.prototype.getCredentials = function () {\n  return this.credentials_ && decodeURIComponent(this.credentials_);\n};\nURI.prototype.getRawCredentials = function () {\n  return this.credentials_;\n};\nURI.prototype.setCredentials = function (newCredentials) {\n  this.credentials_ = encodeIfExists2(\n      newCredentials, URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_);\n\n  return this;\n};\nURI.prototype.setRawCredentials = function (newCredentials) {\n  this.credentials_ = newCredentials ? newCredentials : null;\n  return this;\n};\nURI.prototype.hasCredentials = function () {\n  return null !== this.credentials_;\n};\n\n\nURI.prototype.getDomain = function () {\n  return this.domain_ && decodeURIComponent(this.domain_);\n};\nURI.prototype.getRawDomain = function () {\n  return this.domain_;\n};\nURI.prototype.setDomain = function (newDomain) {\n  return this.setRawDomain(newDomain && encodeURIComponent(newDomain));\n};\nURI.prototype.setRawDomain = function (newDomain) {\n  this.domain_ = newDomain ? newDomain : null;\n  // Maintain the invariant that paths must start with a slash when the URI\n  // is not path-relative.\n  return this.setRawPath(this.path_);\n};\nURI.prototype.hasDomain = function () {\n  return null !== this.domain_;\n};\n\n\nURI.prototype.getPort = function () {\n  return this.port_ && decodeURIComponent(this.port_);\n};\nURI.prototype.setPort = function (newPort) {\n  if (newPort) {\n    newPort = Number(newPort);\n    if (newPort !== (newPort & 0xffff)) {\n      throw new Error('Bad port number ' + newPort);\n    }\n    this.port_ = '' + newPort;\n  } else {\n    this.port_ = null;\n  }\n  return this;\n};\nURI.prototype.hasPort = function () {\n  return null !== this.port_;\n};\n\n\nURI.prototype.getPath = function () {\n  return this.path_ && decodeURIComponent(this.path_);\n};\nURI.prototype.getRawPath = function () {\n  return this.path_;\n};\nURI.prototype.setPath = function (newPath) {\n  return this.setRawPath(encodeIfExists2(newPath, URI_DISALLOWED_IN_PATH_));\n};\nURI.prototype.setRawPath = function (newPath) {\n  if (newPath) {\n    newPath = String(newPath);\n    this.path_ = \n      // Paths must start with '/' unless this is a path-relative URL.\n      (!this.domain_ || /^\\//.test(newPath)) ? newPath : '/' + newPath;\n  } else {\n    this.path_ = null;\n  }\n  return this;\n};\nURI.prototype.hasPath = function () {\n  return null !== this.path_;\n};\n\n\nURI.prototype.getQuery = function () {\n  // From http://www.w3.org/Addressing/URL/4_URI_Recommentations.html\n  // Within the query string, the plus sign is reserved as shorthand notation\n  // for a space.\n  return this.query_ && decodeURIComponent(this.query_).replace(/\\+/g, ' ');\n};\nURI.prototype.getRawQuery = function () {\n  return this.query_;\n};\nURI.prototype.setQuery = function (newQuery) {\n  this.paramCache_ = null;\n  this.query_ = encodeIfExists(newQuery);\n  return this;\n};\nURI.prototype.setRawQuery = function (newQuery) {\n  this.paramCache_ = null;\n  this.query_ = newQuery ? newQuery : null;\n  return this;\n};\nURI.prototype.hasQuery = function () {\n  return null !== this.query_;\n};\n\n/**\n * sets the query given a list of strings of the form\n * [ key0, value0, key1, value1, ... ].\n *\n * <p><code>uri.setAllParameters(['a', 'b', 'c', 'd']).getQuery()</code>\n * will yield <code>'a=b&c=d'</code>.\n */\nURI.prototype.setAllParameters = function (params) {\n  if (typeof params === 'object') {\n    if (!(params instanceof Array)\n        && (params instanceof Object\n            || Object.prototype.toString.call(params) !== '[object Array]')) {\n      var newParams = [];\n      var i = -1;\n      for (var k in params) {\n        var v = params[k];\n        if ('string' === typeof v) {\n          newParams[++i] = k;\n          newParams[++i] = v;\n        }\n      }\n      params = newParams;\n    }\n  }\n  this.paramCache_ = null;\n  var queryBuf = [];\n  var separator = '';\n  for (var j = 0; j < params.length;) {\n    var k = params[j++];\n    var v = params[j++];\n    queryBuf.push(separator, encodeURIComponent(k.toString()));\n    separator = '&';\n    if (v) {\n      queryBuf.push('=', encodeURIComponent(v.toString()));\n    }\n  }\n  this.query_ = queryBuf.join('');\n  return this;\n};\nURI.prototype.checkParameterCache_ = function () {\n  if (!this.paramCache_) {\n    var q = this.query_;\n    if (!q) {\n      this.paramCache_ = [];\n    } else {\n      var cgiParams = q.split(/[&\\?]/);\n      var out = [];\n      var k = -1;\n      for (var i = 0; i < cgiParams.length; ++i) {\n        var m = cgiParams[i].match(/^([^=]*)(?:=(.*))?$/);\n        // From http://www.w3.org/Addressing/URL/4_URI_Recommentations.html\n        // Within the query string, the plus sign is reserved as shorthand\n        // notation for a space.\n        out[++k] = decodeURIComponent(m[1]).replace(/\\+/g, ' ');\n        out[++k] = decodeURIComponent(m[2] || '').replace(/\\+/g, ' ');\n      }\n      this.paramCache_ = out;\n    }\n  }\n};\n/**\n * sets the values of the named cgi parameters.\n *\n * <p>So, <code>uri.parse('foo?a=b&c=d&e=f').setParameterValues('c', ['new'])\n * </code> yields <tt>foo?a=b&c=new&e=f</tt>.</p>\n *\n * @param key {string}\n * @param values {Array.<string>} the new values.  If values is a single string\n *   then it will be treated as the sole value.\n */\nURI.prototype.setParameterValues = function (key, values) {\n  // be nice and avoid subtle bugs where [] operator on string performs charAt\n  // on some browsers and crashes on IE\n  if (typeof values === 'string') {\n    values = [ values ];\n  }\n\n  this.checkParameterCache_();\n  var newValueIndex = 0;\n  var pc = this.paramCache_;\n  var params = [];\n  for (var i = 0, k = 0; i < pc.length; i += 2) {\n    if (key === pc[i]) {\n      if (newValueIndex < values.length) {\n        params.push(key, values[newValueIndex++]);\n      }\n    } else {\n      params.push(pc[i], pc[i + 1]);\n    }\n  }\n  while (newValueIndex < values.length) {\n    params.push(key, values[newValueIndex++]);\n  }\n  this.setAllParameters(params);\n  return this;\n};\nURI.prototype.removeParameter = function (key) {\n  return this.setParameterValues(key, []);\n};\n/**\n * returns the parameters specified in the query part of the uri as a list of\n * keys and values like [ key0, value0, key1, value1, ... ].\n *\n * @return {Array.<string>}\n */\nURI.prototype.getAllParameters = function () {\n  this.checkParameterCache_();\n  return this.paramCache_.slice(0, this.paramCache_.length);\n};\n/**\n * returns the value<b>s</b> for a given cgi parameter as a list of decoded\n * query parameter values.\n * @return {Array.<string>}\n */\nURI.prototype.getParameterValues = function (paramNameUnescaped) {\n  this.checkParameterCache_();\n  var values = [];\n  for (var i = 0; i < this.paramCache_.length; i += 2) {\n    if (paramNameUnescaped === this.paramCache_[i]) {\n      values.push(this.paramCache_[i + 1]);\n    }\n  }\n  return values;\n};\n/**\n * returns a map of cgi parameter names to (non-empty) lists of values.\n * @return {Object.<string,Array.<string>>}\n */\nURI.prototype.getParameterMap = function (paramNameUnescaped) {\n  this.checkParameterCache_();\n  var paramMap = {};\n  for (var i = 0; i < this.paramCache_.length; i += 2) {\n    var key = this.paramCache_[i++],\n      value = this.paramCache_[i++];\n    if (!(key in paramMap)) {\n      paramMap[key] = [value];\n    } else {\n      paramMap[key].push(value);\n    }\n  }\n  return paramMap;\n};\n/**\n * returns the first value for a given cgi parameter or null if the given\n * parameter name does not appear in the query string.\n * If the given parameter name does appear, but has no '<tt>=</tt>' following\n * it, then the empty string will be returned.\n * @return {string|null}\n */\nURI.prototype.getParameterValue = function (paramNameUnescaped) {\n  this.checkParameterCache_();\n  for (var i = 0; i < this.paramCache_.length; i += 2) {\n    if (paramNameUnescaped === this.paramCache_[i]) {\n      return this.paramCache_[i + 1];\n    }\n  }\n  return null;\n};\n\nURI.prototype.getFragment = function () {\n  return this.fragment_ && decodeURIComponent(this.fragment_);\n};\nURI.prototype.getRawFragment = function () {\n  return this.fragment_;\n};\nURI.prototype.setFragment = function (newFragment) {\n  this.fragment_ = newFragment ? encodeURIComponent(newFragment) : null;\n  return this;\n};\nURI.prototype.setRawFragment = function (newFragment) {\n  this.fragment_ = newFragment ? newFragment : null;\n  return this;\n};\nURI.prototype.hasFragment = function () {\n  return null !== this.fragment_;\n};\n\nfunction nullIfAbsent(matchPart) {\n  return ('string' == typeof matchPart) && (matchPart.length > 0)\n         ? matchPart\n         : null;\n}\n\n\n\n\n/**\n * a regular expression for breaking a URI into its component parts.\n *\n * <p>http://www.gbiv.com/protocols/uri/rfc/rfc3986.html#RFC2234 says\n * As the \"first-match-wins\" algorithm is identical to the \"greedy\"\n * disambiguation method used by POSIX regular expressions, it is natural and\n * commonplace to use a regular expression for parsing the potential five\n * components of a URI reference.\n *\n * <p>The following line is the regular expression for breaking-down a\n * well-formed URI reference into its components.\n *\n * <pre>\n * ^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?\n *  12            3  4          5       6  7        8 9\n * </pre>\n *\n * <p>The numbers in the second line above are only to assist readability; they\n * indicate the reference points for each subexpression (i.e., each paired\n * parenthesis). We refer to the value matched for subexpression <n> as $<n>.\n * For example, matching the above expression to\n * <pre>\n *     http://www.ics.uci.edu/pub/ietf/uri/#Related\n * </pre>\n * results in the following subexpression matches:\n * <pre>\n *    $1 = http:\n *    $2 = http\n *    $3 = //www.ics.uci.edu\n *    $4 = www.ics.uci.edu\n *    $5 = /pub/ietf/uri/\n *    $6 = <undefined>\n *    $7 = <undefined>\n *    $8 = #Related\n *    $9 = Related\n * </pre>\n * where <undefined> indicates that the component is not present, as is the\n * case for the query component in the above example. Therefore, we can\n * determine the value of the five components as\n * <pre>\n *    scheme    = $2\n *    authority = $4\n *    path      = $5\n *    query     = $7\n *    fragment  = $9\n * </pre>\n *\n * <p>msamuel: I have modified the regular expression slightly to expose the\n * credentials, domain, and port separately from the authority.\n * The modified version yields\n * <pre>\n *    $1 = http              scheme\n *    $2 = <undefined>       credentials -\\\n *    $3 = www.ics.uci.edu   domain       | authority\n *    $4 = <undefined>       port        -/\n *    $5 = /pub/ietf/uri/    path\n *    $6 = <undefined>       query without ?\n *    $7 = Related           fragment without #\n * </pre>\n */\nvar URI_RE_ = new RegExp(\n      \"^\" +\n      \"(?:\" +\n        \"([^:/?#]+)\" +         // scheme\n      \":)?\" +\n      \"(?://\" +\n        \"(?:([^/?#]*)@)?\" +    // credentials\n        \"([^/?#:@]*)\" +        // domain\n        \"(?::([0-9]+))?\" +     // port\n      \")?\" +\n      \"([^?#]+)?\" +            // path\n      \"(?:\\\\?([^#]*))?\" +      // query\n      \"(?:#(.*))?\" +           // fragment\n      \"$\"\n      );\n\nvar URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_ = /[#\\/\\?@]/g;\nvar URI_DISALLOWED_IN_PATH_ = /[\\#\\?]/g;\n\nURI.parse = parse;\nURI.create = create;\nURI.resolve = resolve;\nURI.collapse_dots = collapse_dots;  // Visible for testing.\n\n// lightweight string-based api for loadModuleMaker\nURI.utils = {\n  mimeTypeOf: function (uri) {\n    var uriObj = parse(uri);\n    if (/\\.html$/.test(uriObj.getPath())) {\n      return 'text/html';\n    } else {\n      return 'application/javascript';\n    }\n  },\n  resolve: function (base, uri) {\n    if (base) {\n      return resolve(parse(base), parse(uri)).toString();\n    } else {\n      return '' + uri;\n    }\n  }\n};\n\n\nreturn URI;\n})();\n\n// Copyright Google Inc.\n// Licensed under the Apache Licence Version 2.0\n// Autogenerated at Mon Feb 25 13:05:42 EST 2013\n// @overrides window\n// @provides html4\nvar html4 = {};\nhtml4.atype = {\n  'NONE': 0,\n  'URI': 1,\n  'URI_FRAGMENT': 11,\n  'SCRIPT': 2,\n  'STYLE': 3,\n  'HTML': 12,\n  'ID': 4,\n  'IDREF': 5,\n  'IDREFS': 6,\n  'GLOBAL_NAME': 7,\n  'LOCAL_NAME': 8,\n  'CLASSES': 9,\n  'FRAME_TARGET': 10,\n  'MEDIA_QUERY': 13\n};\nhtml4[ 'atype' ] = html4.atype;\nhtml4.ATTRIBS = {\n  '*::class': 9,\n  '*::dir': 0,\n  '*::draggable': 0,\n  '*::hidden': 0,\n  '*::id': 4,\n  '*::inert': 0,\n  '*::itemprop': 0,\n  '*::itemref': 6,\n  '*::itemscope': 0,\n  '*::lang': 0,\n  '*::onblur': 2,\n  '*::onchange': 2,\n  '*::onclick': 2,\n  '*::ondblclick': 2,\n  '*::onfocus': 2,\n  '*::onkeydown': 2,\n  '*::onkeypress': 2,\n  '*::onkeyup': 2,\n  '*::onload': 2,\n  '*::onmousedown': 2,\n  '*::onmousemove': 2,\n  '*::onmouseout': 2,\n  '*::onmouseover': 2,\n  '*::onmouseup': 2,\n  '*::onreset': 2,\n  '*::onscroll': 2,\n  '*::onselect': 2,\n  '*::onsubmit': 2,\n  '*::onunload': 2,\n  '*::spellcheck': 0,\n  '*::style': 3,\n  '*::title': 0,\n  '*::translate': 0,\n  'a::accesskey': 0,\n  'a::coords': 0,\n  'a::href': 1,\n  'a::hreflang': 0,\n  'a::name': 7,\n  'a::onblur': 2,\n  'a::onfocus': 2,\n  'a::shape': 0,\n  'a::tabindex': 0,\n  'a::target': 10,\n  'a::type': 0,\n  'area::accesskey': 0,\n  'area::alt': 0,\n  'area::coords': 0,\n  'area::href': 1,\n  'area::nohref': 0,\n  'area::onblur': 2,\n  'area::onfocus': 2,\n  'area::shape': 0,\n  'area::tabindex': 0,\n  'area::target': 10,\n  'audio::controls': 0,\n  'audio::loop': 0,\n  'audio::mediagroup': 5,\n  'audio::muted': 0,\n  'audio::preload': 0,\n  'bdo::dir': 0,\n  'blockquote::cite': 1,\n  'br::clear': 0,\n  'button::accesskey': 0,\n  'button::disabled': 0,\n  'button::name': 8,\n  'button::onblur': 2,\n  'button::onfocus': 2,\n  'button::tabindex': 0,\n  'button::type': 0,\n  'button::value': 0,\n  'canvas::height': 0,\n  'canvas::width': 0,\n  'caption::align': 0,\n  'col::align': 0,\n  'col::char': 0,\n  'col::charoff': 0,\n  'col::span': 0,\n  'col::valign': 0,\n  'col::width': 0,\n  'colgroup::align': 0,\n  'colgroup::char': 0,\n  'colgroup::charoff': 0,\n  'colgroup::span': 0,\n  'colgroup::valign': 0,\n  'colgroup::width': 0,\n  'command::checked': 0,\n  'command::command': 5,\n  'command::disabled': 0,\n  'command::icon': 1,\n  'command::label': 0,\n  'command::radiogroup': 0,\n  'command::type': 0,\n  'data::value': 0,\n  'del::cite': 1,\n  'del::datetime': 0,\n  'details::open': 0,\n  'dir::compact': 0,\n  'div::align': 0,\n  'dl::compact': 0,\n  'fieldset::disabled': 0,\n  'font::color': 0,\n  'font::face': 0,\n  'font::size': 0,\n  'form::accept': 0,\n  'form::action': 1,\n  'form::autocomplete': 0,\n  'form::enctype': 0,\n  'form::method': 0,\n  'form::name': 7,\n  'form::novalidate': 0,\n  'form::onreset': 2,\n  'form::onsubmit': 2,\n  'form::target': 10,\n  'h1::align': 0,\n  'h2::align': 0,\n  'h3::align': 0,\n  'h4::align': 0,\n  'h5::align': 0,\n  'h6::align': 0,\n  'hr::align': 0,\n  'hr::noshade': 0,\n  'hr::size': 0,\n  'hr::width': 0,\n  'iframe::align': 0,\n  'iframe::frameborder': 0,\n  'iframe::height': 0,\n  'iframe::marginheight': 0,\n  'iframe::marginwidth': 0,\n  'iframe::width': 0,\n  'img::align': 0,\n  'img::alt': 0,\n  'img::border': 0,\n  'img::height': 0,\n  'img::hspace': 0,\n  'img::ismap': 0,\n  'img::name': 7,\n  'img::src': 1,\n  'img::usemap': 11,\n  'img::vspace': 0,\n  'img::width': 0,\n  'input::accept': 0,\n  'input::accesskey': 0,\n  'input::align': 0,\n  'input::alt': 0,\n  'input::autocomplete': 0,\n  'input::checked': 0,\n  'input::disabled': 0,\n  'input::inputmode': 0,\n  'input::ismap': 0,\n  'input::list': 5,\n  'input::max': 0,\n  'input::maxlength': 0,\n  'input::min': 0,\n  'input::multiple': 0,\n  'input::name': 8,\n  'input::onblur': 2,\n  'input::onchange': 2,\n  'input::onfocus': 2,\n  'input::onselect': 2,\n  'input::placeholder': 0,\n  'input::readonly': 0,\n  'input::required': 0,\n  'input::size': 0,\n  'input::src': 1,\n  'input::step': 0,\n  'input::tabindex': 0,\n  'input::type': 0,\n  'input::usemap': 11,\n  'input::value': 0,\n  'ins::cite': 1,\n  'ins::datetime': 0,\n  'label::accesskey': 0,\n  'label::for': 5,\n  'label::onblur': 2,\n  'label::onfocus': 2,\n  'legend::accesskey': 0,\n  'legend::align': 0,\n  'li::type': 0,\n  'li::value': 0,\n  'map::name': 7,\n  'menu::compact': 0,\n  'menu::label': 0,\n  'menu::type': 0,\n  'meter::high': 0,\n  'meter::low': 0,\n  'meter::max': 0,\n  'meter::min': 0,\n  'meter::value': 0,\n  'ol::compact': 0,\n  'ol::reversed': 0,\n  'ol::start': 0,\n  'ol::type': 0,\n  'optgroup::disabled': 0,\n  'optgroup::label': 0,\n  'option::disabled': 0,\n  'option::label': 0,\n  'option::selected': 0,\n  'option::value': 0,\n  'output::for': 6,\n  'output::name': 8,\n  'p::align': 0,\n  'pre::width': 0,\n  'progress::max': 0,\n  'progress::min': 0,\n  'progress::value': 0,\n  'q::cite': 1,\n  'select::autocomplete': 0,\n  'select::disabled': 0,\n  'select::multiple': 0,\n  'select::name': 8,\n  'select::onblur': 2,\n  'select::onchange': 2,\n  'select::onfocus': 2,\n  'select::required': 0,\n  'select::size': 0,\n  'select::tabindex': 0,\n  'source::type': 0,\n  'table::align': 0,\n  'table::bgcolor': 0,\n  'table::border': 0,\n  'table::cellpadding': 0,\n  'table::cellspacing': 0,\n  'table::frame': 0,\n  'table::rules': 0,\n  'table::summary': 0,\n  'table::width': 0,\n  'tbody::align': 0,\n  'tbody::char': 0,\n  'tbody::charoff': 0,\n  'tbody::valign': 0,\n  'td::abbr': 0,\n  'td::align': 0,\n  'td::axis': 0,\n  'td::bgcolor': 0,\n  'td::char': 0,\n  'td::charoff': 0,\n  'td::colspan': 0,\n  'td::headers': 6,\n  'td::height': 0,\n  'td::nowrap': 0,\n  'td::rowspan': 0,\n  'td::scope': 0,\n  'td::valign': 0,\n  'td::width': 0,\n  'textarea::accesskey': 0,\n  'textarea::autocomplete': 0,\n  'textarea::cols': 0,\n  'textarea::disabled': 0,\n  'textarea::inputmode': 0,\n  'textarea::name': 8,\n  'textarea::onblur': 2,\n  'textarea::onchange': 2,\n  'textarea::onfocus': 2,\n  'textarea::onselect': 2,\n  'textarea::placeholder': 0,\n  'textarea::readonly': 0,\n  'textarea::required': 0,\n  'textarea::rows': 0,\n  'textarea::tabindex': 0,\n  'textarea::wrap': 0,\n  'tfoot::align': 0,\n  'tfoot::char': 0,\n  'tfoot::charoff': 0,\n  'tfoot::valign': 0,\n  'th::abbr': 0,\n  'th::align': 0,\n  'th::axis': 0,\n  'th::bgcolor': 0,\n  'th::char': 0,\n  'th::charoff': 0,\n  'th::colspan': 0,\n  'th::headers': 6,\n  'th::height': 0,\n  'th::nowrap': 0,\n  'th::rowspan': 0,\n  'th::scope': 0,\n  'th::valign': 0,\n  'th::width': 0,\n  'thead::align': 0,\n  'thead::char': 0,\n  'thead::charoff': 0,\n  'thead::valign': 0,\n  'tr::align': 0,\n  'tr::bgcolor': 0,\n  'tr::char': 0,\n  'tr::charoff': 0,\n  'tr::valign': 0,\n  'track::default': 0,\n  'track::kind': 0,\n  'track::label': 0,\n  'track::srclang': 0,\n  'ul::compact': 0,\n  'ul::type': 0,\n  'video::controls': 0,\n  'video::height': 0,\n  'video::loop': 0,\n  'video::mediagroup': 5,\n  'video::muted': 0,\n  'video::poster': 1,\n  'video::preload': 0,\n  'video::width': 0\n};\nhtml4[ 'ATTRIBS' ] = html4.ATTRIBS;\nhtml4.eflags = {\n  'OPTIONAL_ENDTAG': 1,\n  'EMPTY': 2,\n  'CDATA': 4,\n  'RCDATA': 8,\n  'UNSAFE': 16,\n  'FOLDABLE': 32,\n  'SCRIPT': 64,\n  'STYLE': 128,\n  'VIRTUALIZED': 256\n};\nhtml4[ 'eflags' ] = html4.eflags;\nhtml4.ELEMENTS = {\n  'a': 0,\n  'abbr': 0,\n  'acronym': 0,\n  'address': 0,\n  'applet': 272,\n  'area': 2,\n  'article': 0,\n  'aside': 0,\n  'audio': 0,\n  'b': 0,\n  'base': 274,\n  'basefont': 274,\n  'bdi': 0,\n  'bdo': 0,\n  'big': 0,\n  'blockquote': 0,\n  'body': 305,\n  'br': 2,\n  'button': 0,\n  'canvas': 0,\n  'caption': 0,\n  'center': 0,\n  'cite': 0,\n  'code': 0,\n  'col': 2,\n  'colgroup': 1,\n  'command': 2,\n  'data': 0,\n  'datalist': 0,\n  'dd': 1,\n  'del': 0,\n  'details': 0,\n  'dfn': 0,\n  'dialog': 272,\n  'dir': 0,\n  'div': 0,\n  'dl': 0,\n  'dt': 1,\n  'em': 0,\n  'fieldset': 0,\n  'figcaption': 0,\n  'figure': 0,\n  'font': 0,\n  'footer': 0,\n  'form': 0,\n  'frame': 274,\n  'frameset': 272,\n  'h1': 0,\n  'h2': 0,\n  'h3': 0,\n  'h4': 0,\n  'h5': 0,\n  'h6': 0,\n  'head': 305,\n  'header': 0,\n  'hgroup': 0,\n  'hr': 2,\n  'html': 305,\n  'i': 0,\n  'iframe': 4,\n  'img': 2,\n  'input': 2,\n  'ins': 0,\n  'isindex': 274,\n  'kbd': 0,\n  'keygen': 274,\n  'label': 0,\n  'legend': 0,\n  'li': 1,\n  'link': 274,\n  'map': 0,\n  'mark': 0,\n  'menu': 0,\n  'meta': 274,\n  'meter': 0,\n  'nav': 0,\n  'nobr': 0,\n  'noembed': 276,\n  'noframes': 276,\n  'noscript': 276,\n  'object': 272,\n  'ol': 0,\n  'optgroup': 0,\n  'option': 1,\n  'output': 0,\n  'p': 1,\n  'param': 274,\n  'pre': 0,\n  'progress': 0,\n  'q': 0,\n  's': 0,\n  'samp': 0,\n  'script': 84,\n  'section': 0,\n  'select': 0,\n  'small': 0,\n  'source': 2,\n  'span': 0,\n  'strike': 0,\n  'strong': 0,\n  'style': 148,\n  'sub': 0,\n  'summary': 0,\n  'sup': 0,\n  'table': 0,\n  'tbody': 1,\n  'td': 1,\n  'textarea': 8,\n  'tfoot': 1,\n  'th': 1,\n  'thead': 1,\n  'time': 0,\n  'title': 280,\n  'tr': 1,\n  'track': 2,\n  'tt': 0,\n  'u': 0,\n  'ul': 0,\n  'var': 0,\n  'video': 0,\n  'wbr': 2\n};\nhtml4[ 'ELEMENTS' ] = html4.ELEMENTS;\nhtml4.ELEMENT_DOM_INTERFACES = {\n  'a': 'HTMLAnchorElement',\n  'abbr': 'HTMLElement',\n  'acronym': 'HTMLElement',\n  'address': 'HTMLElement',\n  'applet': 'HTMLAppletElement',\n  'area': 'HTMLAreaElement',\n  'article': 'HTMLElement',\n  'aside': 'HTMLElement',\n  'audio': 'HTMLAudioElement',\n  'b': 'HTMLElement',\n  'base': 'HTMLBaseElement',\n  'basefont': 'HTMLBaseFontElement',\n  'bdi': 'HTMLElement',\n  'bdo': 'HTMLElement',\n  'big': 'HTMLElement',\n  'blockquote': 'HTMLQuoteElement',\n  'body': 'HTMLBodyElement',\n  'br': 'HTMLBRElement',\n  'button': 'HTMLButtonElement',\n  'canvas': 'HTMLCanvasElement',\n  'caption': 'HTMLTableCaptionElement',\n  'center': 'HTMLElement',\n  'cite': 'HTMLElement',\n  'code': 'HTMLElement',\n  'col': 'HTMLTableColElement',\n  'colgroup': 'HTMLTableColElement',\n  'command': 'HTMLCommandElement',\n  'data': 'HTMLElement',\n  'datalist': 'HTMLDataListElement',\n  'dd': 'HTMLElement',\n  'del': 'HTMLModElement',\n  'details': 'HTMLDetailsElement',\n  'dfn': 'HTMLElement',\n  'dialog': 'HTMLDialogElement',\n  'dir': 'HTMLDirectoryElement',\n  'div': 'HTMLDivElement',\n  'dl': 'HTMLDListElement',\n  'dt': 'HTMLElement',\n  'em': 'HTMLElement',\n  'fieldset': 'HTMLFieldSetElement',\n  'figcaption': 'HTMLElement',\n  'figure': 'HTMLElement',\n  'font': 'HTMLFontElement',\n  'footer': 'HTMLElement',\n  'form': 'HTMLFormElement',\n  'frame': 'HTMLFrameElement',\n  'frameset': 'HTMLFrameSetElement',\n  'h1': 'HTMLHeadingElement',\n  'h2': 'HTMLHeadingElement',\n  'h3': 'HTMLHeadingElement',\n  'h4': 'HTMLHeadingElement',\n  'h5': 'HTMLHeadingElement',\n  'h6': 'HTMLHeadingElement',\n  'head': 'HTMLHeadElement',\n  'header': 'HTMLElement',\n  'hgroup': 'HTMLElement',\n  'hr': 'HTMLHRElement',\n  'html': 'HTMLHtmlElement',\n  'i': 'HTMLElement',\n  'iframe': 'HTMLIFrameElement',\n  'img': 'HTMLImageElement',\n  'input': 'HTMLInputElement',\n  'ins': 'HTMLModElement',\n  'isindex': 'HTMLUnknownElement',\n  'kbd': 'HTMLElement',\n  'keygen': 'HTMLKeygenElement',\n  'label': 'HTMLLabelElement',\n  'legend': 'HTMLLegendElement',\n  'li': 'HTMLLIElement',\n  'link': 'HTMLLinkElement',\n  'map': 'HTMLMapElement',\n  'mark': 'HTMLElement',\n  'menu': 'HTMLMenuElement',\n  'meta': 'HTMLMetaElement',\n  'meter': 'HTMLMeterElement',\n  'nav': 'HTMLElement',\n  'nobr': 'HTMLElement',\n  'noembed': 'HTMLElement',\n  'noframes': 'HTMLElement',\n  'noscript': 'HTMLElement',\n  'object': 'HTMLObjectElement',\n  'ol': 'HTMLOListElement',\n  'optgroup': 'HTMLOptGroupElement',\n  'option': 'HTMLOptionElement',\n  'output': 'HTMLOutputElement',\n  'p': 'HTMLParagraphElement',\n  'param': 'HTMLParamElement',\n  'pre': 'HTMLPreElement',\n  'progress': 'HTMLProgressElement',\n  'q': 'HTMLQuoteElement',\n  's': 'HTMLElement',\n  'samp': 'HTMLElement',\n  'script': 'HTMLScriptElement',\n  'section': 'HTMLElement',\n  'select': 'HTMLSelectElement',\n  'small': 'HTMLElement',\n  'source': 'HTMLSourceElement',\n  'span': 'HTMLSpanElement',\n  'strike': 'HTMLElement',\n  'strong': 'HTMLElement',\n  'style': 'HTMLStyleElement',\n  'sub': 'HTMLElement',\n  'summary': 'HTMLElement',\n  'sup': 'HTMLElement',\n  'table': 'HTMLTableElement',\n  'tbody': 'HTMLTableSectionElement',\n  'td': 'HTMLTableDataCellElement',\n  'textarea': 'HTMLTextAreaElement',\n  'tfoot': 'HTMLTableSectionElement',\n  'th': 'HTMLTableHeaderCellElement',\n  'thead': 'HTMLTableSectionElement',\n  'time': 'HTMLTimeElement',\n  'title': 'HTMLTitleElement',\n  'tr': 'HTMLTableRowElement',\n  'track': 'HTMLTrackElement',\n  'tt': 'HTMLElement',\n  'u': 'HTMLElement',\n  'ul': 'HTMLUListElement',\n  'var': 'HTMLElement',\n  'video': 'HTMLVideoElement',\n  'wbr': 'HTMLElement'\n};\nhtml4[ 'ELEMENT_DOM_INTERFACES' ] = html4.ELEMENT_DOM_INTERFACES;\nhtml4.ueffects = {\n  'NOT_LOADED': 0,\n  'SAME_DOCUMENT': 1,\n  'NEW_DOCUMENT': 2\n};\nhtml4[ 'ueffects' ] = html4.ueffects;\nhtml4.URIEFFECTS = {\n  'a::href': 2,\n  'area::href': 2,\n  'blockquote::cite': 0,\n  'command::icon': 1,\n  'del::cite': 0,\n  'form::action': 2,\n  'img::src': 1,\n  'input::src': 1,\n  'ins::cite': 0,\n  'q::cite': 0,\n  'video::poster': 1\n};\nhtml4[ 'URIEFFECTS' ] = html4.URIEFFECTS;\nhtml4.ltypes = {\n  'UNSANDBOXED': 2,\n  'SANDBOXED': 1,\n  'DATA': 0\n};\nhtml4[ 'ltypes' ] = html4.ltypes;\nhtml4.LOADERTYPES = {\n  'a::href': 2,\n  'area::href': 2,\n  'blockquote::cite': 2,\n  'command::icon': 1,\n  'del::cite': 2,\n  'form::action': 2,\n  'img::src': 1,\n  'input::src': 1,\n  'ins::cite': 2,\n  'q::cite': 2,\n  'video::poster': 1\n};\nhtml4[ 'LOADERTYPES' ] = html4.LOADERTYPES;\n\n// Copyright (C) 2006 Google Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview\n * An HTML sanitizer that can satisfy a variety of security policies.\n *\n * <p>\n * The HTML sanitizer is built around a SAX parser and HTML element and\n * attributes schemas.\n *\n * If the cssparser is loaded, inline styles are sanitized using the\n * css property and value schemas.  Else they are remove during\n * sanitization.\n *\n * If it exists, uses parseCssDeclarations, sanitizeCssProperty,  cssSchema\n *\n * @author mikesamuel@gmail.com\n * @author jasvir@gmail.com\n * \\@requires html4, URI\n * \\@overrides window\n * \\@provides html, html_sanitize\n */\n\n// The Turkish i seems to be a non-issue, but abort in case it is.\nif ('I'.toLowerCase() !== 'i') { throw 'I/i problem'; }\n\n/**\n * \\@namespace\n */\nvar html = (function(html4) {\n\n  // For closure compiler\n  var parseCssDeclarations, sanitizeCssProperty, cssSchema;\n  if ('undefined' !== typeof window) {\n    parseCssDeclarations = window['parseCssDeclarations'];\n    sanitizeCssProperty = window['sanitizeCssProperty'];\n    cssSchema = window['cssSchema'];\n  }\n\n  // The keys of this object must be 'quoted' or JSCompiler will mangle them!\n  // This is a partial list -- lookupEntity() uses the host browser's parser\n  // (when available) to implement full entity lookup.\n  // Note that entities are in general case-sensitive; the uppercase ones are\n  // explicitly defined by HTML5 (presumably as compatibility).\n  var ENTITIES = {\n    'lt': '<',\n    'LT': '<',\n    'gt': '>',\n    'GT': '>',\n    'amp': '&',\n    'AMP': '&',\n    'quot': '\"',\n    'apos': '\\'',\n    'nbsp': '\\240'\n  };\n\n  // Patterns for types of entity/character reference names.\n  var decimalEscapeRe = /^#(\\d+)$/;\n  var hexEscapeRe = /^#x([0-9A-Fa-f]+)$/;\n  // contains every entity per http://www.w3.org/TR/2011/WD-html5-20110113/named-character-references.html\n  var safeEntityNameRe = /^[A-Za-z][A-za-z0-9]+$/;\n  // Used as a hook to invoke the browser's entity parsing. <textarea> is used\n  // because its content is parsed for entities but not tags.\n  // TODO(kpreid): This retrieval is a kludge and leads to silent loss of\n  // functionality if the document isn't available.\n  var entityLookupElement =\n      ('undefined' !== typeof window && window['document'])\n          ? window['document'].createElement('textarea') : null;\n  /**\n   * Decodes an HTML entity.\n   *\n   * {\\@updoc\n   * $ lookupEntity('lt')\n   * # '<'\n   * $ lookupEntity('GT')\n   * # '>'\n   * $ lookupEntity('amp')\n   * # '&'\n   * $ lookupEntity('nbsp')\n   * # '\\xA0'\n   * $ lookupEntity('apos')\n   * # \"'\"\n   * $ lookupEntity('quot')\n   * # '\"'\n   * $ lookupEntity('#xa')\n   * # '\\n'\n   * $ lookupEntity('#10')\n   * # '\\n'\n   * $ lookupEntity('#x0a')\n   * # '\\n'\n   * $ lookupEntity('#010')\n   * # '\\n'\n   * $ lookupEntity('#x00A')\n   * # '\\n'\n   * $ lookupEntity('Pi')      // Known failure\n   * # '\\u03A0'\n   * $ lookupEntity('pi')      // Known failure\n   * # '\\u03C0'\n   * }\n   *\n   * @param {string} name the content between the '&' and the ';'.\n   * @return {string} a single unicode code-point as a string.\n   */\n  function lookupEntity(name) {\n    // TODO: entity lookup as specified by HTML5 actually depends on the\n    // presence of the \";\".\n    if (ENTITIES.hasOwnProperty(name)) { return ENTITIES[name]; }\n    var m = name.match(decimalEscapeRe);\n    if (m) {\n      return String.fromCharCode(parseInt(m[1], 10));\n    } else if (!!(m = name.match(hexEscapeRe))) {\n      return String.fromCharCode(parseInt(m[1], 16));\n    } else if (entityLookupElement && safeEntityNameRe.test(name)) {\n      entityLookupElement.innerHTML = '&' + name + ';';\n      var text = entityLookupElement.textContent;\n      ENTITIES[name] = text;\n      return text;\n    } else {\n      return '&' + name + ';';\n    }\n  }\n\n  function decodeOneEntity(_, name) {\n    return lookupEntity(name);\n  }\n\n  var nulRe = /\\0/g;\n  function stripNULs(s) {\n    return s.replace(nulRe, '');\n  }\n\n  var ENTITY_RE_1 = /&(#[0-9]+|#[xX][0-9A-Fa-f]+|\\w+);/g;\n  var ENTITY_RE_2 = /^(#[0-9]+|#[xX][0-9A-Fa-f]+|\\w+);/;\n  /**\n   * The plain text of a chunk of HTML CDATA which possibly containing.\n   *\n   * {\\@updoc\n   * $ unescapeEntities('')\n   * # ''\n   * $ unescapeEntities('hello World!')\n   * # 'hello World!'\n   * $ unescapeEntities('1 &lt; 2 &amp;&AMP; 4 &gt; 3&#10;')\n   * # '1 < 2 && 4 > 3\\n'\n   * $ unescapeEntities('&lt;&lt <- unfinished entity&gt;')\n   * # '<&lt <- unfinished entity>'\n   * $ unescapeEntities('/foo?bar=baz&copy=true')  // & often unescaped in URLS\n   * # '/foo?bar=baz&copy=true'\n   * $ unescapeEntities('pi=&pi;&#x3c0;, Pi=&Pi;\\u03A0') // FIXME: known failure\n   * # 'pi=\\u03C0\\u03c0, Pi=\\u03A0\\u03A0'\n   * }\n   *\n   * @param {string} s a chunk of HTML CDATA.  It must not start or end inside\n   *     an HTML entity.\n   */\n  function unescapeEntities(s) {\n    return s.replace(ENTITY_RE_1, decodeOneEntity);\n  }\n\n  var ampRe = /&/g;\n  var looseAmpRe = /&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi;\n  var ltRe = /[<]/g;\n  var gtRe = />/g;\n  var quotRe = /\\\"/g;\n\n  /**\n   * Escapes HTML special characters in attribute values.\n   *\n   * {\\@updoc\n   * $ escapeAttrib('')\n   * # ''\n   * $ escapeAttrib('\"<<&==&>>\"')  // Do not just escape the first occurrence.\n   * # '&#34;&lt;&lt;&amp;&#61;&#61;&amp;&gt;&gt;&#34;'\n   * $ escapeAttrib('Hello <World>!')\n   * # 'Hello &lt;World&gt;!'\n   * }\n   */\n  function escapeAttrib(s) {\n    return ('' + s).replace(ampRe, '&amp;').replace(ltRe, '&lt;')\n        .replace(gtRe, '&gt;').replace(quotRe, '&#34;');\n  }\n\n  /**\n   * Escape entities in RCDATA that can be escaped without changing the meaning.\n   * {\\@updoc\n   * $ normalizeRCData('1 < 2 &&amp; 3 > 4 &amp;& 5 &lt; 7&8')\n   * # '1 &lt; 2 &amp;&amp; 3 &gt; 4 &amp;&amp; 5 &lt; 7&amp;8'\n   * }\n   */\n  function normalizeRCData(rcdata) {\n    return rcdata\n        .replace(looseAmpRe, '&amp;$1')\n        .replace(ltRe, '&lt;')\n        .replace(gtRe, '&gt;');\n  }\n\n  // TODO(felix8a): validate sanitizer regexs against the HTML5 grammar at\n  // http://www.whatwg.org/specs/web-apps/current-work/multipage/syntax.html\n  // http://www.whatwg.org/specs/web-apps/current-work/multipage/parsing.html\n  // http://www.whatwg.org/specs/web-apps/current-work/multipage/tokenization.html\n  // http://www.whatwg.org/specs/web-apps/current-work/multipage/tree-construction.html\n\n  // We initially split input so that potentially meaningful characters\n  // like '<' and '>' are separate tokens, using a fast dumb process that\n  // ignores quoting.  Then we walk that token stream, and when we see a\n  // '<' that's the start of a tag, we use ATTR_RE to extract tag\n  // attributes from the next token.  That token will never have a '>'\n  // character.  However, it might have an unbalanced quote character, and\n  // when we see that, we combine additional tokens to balance the quote.\n\n  var ATTR_RE = new RegExp(\n    '^\\\\s*' +\n    '([-.:\\\\w]+)' +             // 1 = Attribute name\n    '(?:' + (\n      '\\\\s*(=)\\\\s*' +           // 2 = Is there a value?\n      '(' + (                   // 3 = Attribute value\n        // TODO(felix8a): maybe use backref to match quotes\n        '(\\\")[^\\\"]*(\\\"|$)' +    // 4, 5 = Double-quoted string\n        '|' +\n        '(\\')[^\\']*(\\'|$)' +    // 6, 7 = Single-quoted string\n        '|' +\n        // Positive lookahead to prevent interpretation of\n        // <foo a= b=c> as <foo a='b=c'>\n        // TODO(felix8a): might be able to drop this case\n        '(?=[a-z][-\\\\w]*\\\\s*=)' +\n        '|' +\n        // Unquoted value that isn't an attribute name\n        // (since we didn't match the positive lookahead above)\n        '[^\\\"\\'\\\\s]*' ) +\n      ')' ) +\n    ')?',\n    'i');\n\n  // false on IE<=8, true on most other browsers\n  var splitWillCapture = ('a,b'.split(/(,)/).length === 3);\n\n  // bitmask for tags with special parsing, like <script> and <textarea>\n  var EFLAGS_TEXT = html4.eflags['CDATA'] | html4.eflags['RCDATA'];\n\n  /**\n   * Given a SAX-like event handler, produce a function that feeds those\n   * events and a parameter to the event handler.\n   *\n   * The event handler has the form:{@code\n   * {\n   *   // Name is an upper-case HTML tag name.  Attribs is an array of\n   *   // alternating upper-case attribute names, and attribute values.  The\n   *   // attribs array is reused by the parser.  Param is the value passed to\n   *   // the saxParser.\n   *   startTag: function (name, attribs, param) { ... },\n   *   endTag:   function (name, param) { ... },\n   *   pcdata:   function (text, param) { ... },\n   *   rcdata:   function (text, param) { ... },\n   *   cdata:    function (text, param) { ... },\n   *   startDoc: function (param) { ... },\n   *   endDoc:   function (param) { ... }\n   * }}\n   *\n   * @param {Object} handler a record containing event handlers.\n   * @return {function(string, Object)} A function that takes a chunk of HTML\n   *     and a parameter.  The parameter is passed on to the handler methods.\n   */\n  function makeSaxParser(handler) {\n    // Accept quoted or unquoted keys (Closure compat)\n    var hcopy = {\n      cdata: handler.cdata || handler['cdata'],\n      comment: handler.comment || handler['comment'],\n      endDoc: handler.endDoc || handler['endDoc'],\n      endTag: handler.endTag || handler['endTag'],\n      pcdata: handler.pcdata || handler['pcdata'],\n      rcdata: handler.rcdata || handler['rcdata'],\n      startDoc: handler.startDoc || handler['startDoc'],\n      startTag: handler.startTag || handler['startTag']\n    };\n    return function(htmlText, param) {\n      return parse(htmlText, hcopy, param);\n    };\n  }\n\n  // Parsing strategy is to split input into parts that might be lexically\n  // meaningful (every \">\" becomes a separate part), and then recombine\n  // parts if we discover they're in a different context.\n\n  // TODO(felix8a): Significant performance regressions from -legacy,\n  // tested on\n  //    Chrome 18.0\n  //    Firefox 11.0\n  //    IE 6, 7, 8, 9\n  //    Opera 11.61\n  //    Safari 5.1.3\n  // Many of these are unusual patterns that are linearly slower and still\n  // pretty fast (eg 1ms to 5ms), so not necessarily worth fixing.\n\n  // TODO(felix8a): \"<script> && && && ... <\\/script>\" is slower on all\n  // browsers.  The hotspot is htmlSplit.\n\n  // TODO(felix8a): \"<p title='>>>>...'><\\/p>\" is slower on all browsers.\n  // This is partly htmlSplit, but the hotspot is parseTagAndAttrs.\n\n  // TODO(felix8a): \"<a><\\/a><a><\\/a>...\" is slower on IE9.\n  // \"<a>1<\\/a><a>1<\\/a>...\" is faster, \"<a><\\/a>2<a><\\/a>2...\" is faster.\n\n  // TODO(felix8a): \"<p<p<p...\" is slower on IE[6-8]\n\n  var continuationMarker = {};\n  function parse(htmlText, handler, param) {\n    var m, p, tagName;\n    var parts = htmlSplit(htmlText);\n    var state = {\n      noMoreGT: false,\n      noMoreEndComments: false\n    };\n    parseCPS(handler, parts, 0, state, param);\n  }\n\n  function continuationMaker(h, parts, initial, state, param) {\n    return function () {\n      parseCPS(h, parts, initial, state, param);\n    };\n  }\n\n  function parseCPS(h, parts, initial, state, param) {\n    try {\n      if (h.startDoc && initial == 0) { h.startDoc(param); }\n      var m, p, tagName;\n      for (var pos = initial, end = parts.length; pos < end;) {\n        var current = parts[pos++];\n        var next = parts[pos];\n        switch (current) {\n        case '&':\n          if (ENTITY_RE_2.test(next)) {\n            if (h.pcdata) {\n              h.pcdata('&' + next, param, continuationMarker,\n                continuationMaker(h, parts, pos, state, param));\n            }\n            pos++;\n          } else {\n            if (h.pcdata) { h.pcdata(\"&amp;\", param, continuationMarker,\n                continuationMaker(h, parts, pos, state, param));\n            }\n          }\n          break;\n        case '<\\/':\n          if (m = /^([-\\w:]+)[^\\'\\\"]*/.exec(next)) {\n            if (m[0].length === next.length && parts[pos + 1] === '>') {\n              // fast case, no attribute parsing needed\n              pos += 2;\n              tagName = m[1].toLowerCase();\n              if (h.endTag) {\n                h.endTag(tagName, param, continuationMarker,\n                  continuationMaker(h, parts, pos, state, param));\n              }\n            } else {\n              // slow case, need to parse attributes\n              // TODO(felix8a): do we really care about misparsing this?\n              pos = parseEndTag(\n                parts, pos, h, param, continuationMarker, state);\n            }\n          } else {\n            if (h.pcdata) {\n              h.pcdata('&lt;/', param, continuationMarker,\n                continuationMaker(h, parts, pos, state, param));\n            }\n          }\n          break;\n        case '<':\n          if (m = /^([-\\w:]+)\\s*\\/?/.exec(next)) {\n            if (m[0].length === next.length && parts[pos + 1] === '>') {\n              // fast case, no attribute parsing needed\n              pos += 2;\n              tagName = m[1].toLowerCase();\n              if (h.startTag) {\n                h.startTag(tagName, [], param, continuationMarker,\n                  continuationMaker(h, parts, pos, state, param));\n              }\n              // tags like <script> and <textarea> have special parsing\n              var eflags = html4.ELEMENTS[tagName];\n              if (eflags & EFLAGS_TEXT) {\n                var tag = { name: tagName, next: pos, eflags: eflags };\n                pos = parseText(\n                  parts, tag, h, param, continuationMarker, state);\n              }\n            } else {\n              // slow case, need to parse attributes\n              pos = parseStartTag(\n                parts, pos, h, param, continuationMarker, state);\n            }\n          } else {\n            if (h.pcdata) {\n              h.pcdata('&lt;', param, continuationMarker,\n                continuationMaker(h, parts, pos, state, param));\n            }\n          }\n          break;\n        case '<\\!--':\n          // The pathological case is n copies of '<\\!--' without '-->', and\n          // repeated failure to find '-->' is quadratic.  We avoid that by\n          // remembering when search for '-->' fails.\n          if (!state.noMoreEndComments) {\n            // A comment <\\!--x--> is split into three tokens:\n            //   '<\\!--', 'x--', '>'\n            // We want to find the next '>' token that has a preceding '--'.\n            // pos is at the 'x--'.\n            for (p = pos + 1; p < end; p++) {\n              if (parts[p] === '>' && /--$/.test(parts[p - 1])) { break; }\n            }\n            if (p < end) {\n              if (h.comment) {\n                var comment = parts.slice(pos, p).join('');\n                h.comment(\n                  comment.substr(0, comment.length - 2), param,\n                  continuationMarker,\n                  continuationMaker(h, parts, p + 1, state, param));\n              }\n              pos = p + 1;\n            } else {\n              state.noMoreEndComments = true;\n            }\n          }\n          if (state.noMoreEndComments) {\n            if (h.pcdata) {\n              h.pcdata('&lt;!--', param, continuationMarker,\n                continuationMaker(h, parts, pos, state, param));\n            }\n          }\n          break;\n        case '<\\!':\n          if (!/^\\w/.test(next)) {\n            if (h.pcdata) {\n              h.pcdata('&lt;!', param, continuationMarker,\n                continuationMaker(h, parts, pos, state, param));\n            }\n          } else {\n            // similar to noMoreEndComment logic\n            if (!state.noMoreGT) {\n              for (p = pos + 1; p < end; p++) {\n                if (parts[p] === '>') { break; }\n              }\n              if (p < end) {\n                pos = p + 1;\n              } else {\n                state.noMoreGT = true;\n              }\n            }\n            if (state.noMoreGT) {\n              if (h.pcdata) {\n                h.pcdata('&lt;!', param, continuationMarker,\n                  continuationMaker(h, parts, pos, state, param));\n              }\n            }\n          }\n          break;\n        case '<?':\n          // similar to noMoreEndComment logic\n          if (!state.noMoreGT) {\n            for (p = pos + 1; p < end; p++) {\n              if (parts[p] === '>') { break; }\n            }\n            if (p < end) {\n              pos = p + 1;\n            } else {\n              state.noMoreGT = true;\n            }\n          }\n          if (state.noMoreGT) {\n            if (h.pcdata) {\n              h.pcdata('&lt;?', param, continuationMarker,\n                continuationMaker(h, parts, pos, state, param));\n            }\n          }\n          break;\n        case '>':\n          if (h.pcdata) {\n            h.pcdata(\"&gt;\", param, continuationMarker,\n              continuationMaker(h, parts, pos, state, param));\n          }\n          break;\n        case '':\n          break;\n        default:\n          if (h.pcdata) {\n            h.pcdata(current, param, continuationMarker,\n              continuationMaker(h, parts, pos, state, param));\n          }\n          break;\n        }\n      }\n      if (h.endDoc) { h.endDoc(param); }\n    } catch (e) {\n      if (e !== continuationMarker) { throw e; }\n    }\n  }\n\n  // Split str into parts for the html parser.\n  function htmlSplit(str) {\n    // can't hoist this out of the function because of the re.exec loop.\n    var re = /(<\\/|<\\!--|<[!?]|[&<>])/g;\n    str += '';\n    if (splitWillCapture) {\n      return str.split(re);\n    } else {\n      var parts = [];\n      var lastPos = 0;\n      var m;\n      while ((m = re.exec(str)) !== null) {\n        parts.push(str.substring(lastPos, m.index));\n        parts.push(m[0]);\n        lastPos = m.index + m[0].length;\n      }\n      parts.push(str.substring(lastPos));\n      return parts;\n    }\n  }\n\n  function parseEndTag(parts, pos, h, param, continuationMarker, state) {\n    var tag = parseTagAndAttrs(parts, pos);\n    // drop unclosed tags\n    if (!tag) { return parts.length; }\n    if (h.endTag) {\n      h.endTag(tag.name, param, continuationMarker,\n        continuationMaker(h, parts, pos, state, param));\n    }\n    return tag.next;\n  }\n\n  function parseStartTag(parts, pos, h, param, continuationMarker, state) {\n    var tag = parseTagAndAttrs(parts, pos);\n    // drop unclosed tags\n    if (!tag) { return parts.length; }\n    if (h.startTag) {\n      h.startTag(tag.name, tag.attrs, param, continuationMarker,\n        continuationMaker(h, parts, tag.next, state, param));\n    }\n    // tags like <script> and <textarea> have special parsing\n    if (tag.eflags & EFLAGS_TEXT) {\n      return parseText(parts, tag, h, param, continuationMarker, state);\n    } else {\n      return tag.next;\n    }\n  }\n\n  var endTagRe = {};\n\n  // Tags like <script> and <textarea> are flagged as CDATA or RCDATA,\n  // which means everything is text until we see the correct closing tag.\n  function parseText(parts, tag, h, param, continuationMarker, state) {\n    var end = parts.length;\n    if (!endTagRe.hasOwnProperty(tag.name)) {\n      endTagRe[tag.name] = new RegExp('^' + tag.name + '(?:[\\\\s\\\\/]|$)', 'i');\n    }\n    var re = endTagRe[tag.name];\n    var first = tag.next;\n    var p = tag.next + 1;\n    for (; p < end; p++) {\n      if (parts[p - 1] === '<\\/' && re.test(parts[p])) { break; }\n    }\n    if (p < end) { p -= 1; }\n    var buf = parts.slice(first, p).join('');\n    if (tag.eflags & html4.eflags['CDATA']) {\n      if (h.cdata) {\n        h.cdata(buf, param, continuationMarker,\n          continuationMaker(h, parts, p, state, param));\n      }\n    } else if (tag.eflags & html4.eflags['RCDATA']) {\n      if (h.rcdata) {\n        h.rcdata(normalizeRCData(buf), param, continuationMarker,\n          continuationMaker(h, parts, p, state, param));\n      }\n    } else {\n      throw new Error('bug');\n    }\n    return p;\n  }\n\n  // at this point, parts[pos-1] is either \"<\" or \"<\\/\".\n  function parseTagAndAttrs(parts, pos) {\n    var m = /^([-\\w:]+)/.exec(parts[pos]);\n    var tag = {};\n    tag.name = m[1].toLowerCase();\n    tag.eflags = html4.ELEMENTS[tag.name];\n    var buf = parts[pos].substr(m[0].length);\n    // Find the next '>'.  We optimistically assume this '>' is not in a\n    // quoted context, and further down we fix things up if it turns out to\n    // be quoted.\n    var p = pos + 1;\n    var end = parts.length;\n    for (; p < end; p++) {\n      if (parts[p] === '>') { break; }\n      buf += parts[p];\n    }\n    if (end <= p) { return void 0; }\n    var attrs = [];\n    while (buf !== '') {\n      m = ATTR_RE.exec(buf);\n      if (!m) {\n        // No attribute found: skip garbage\n        buf = buf.replace(/^[\\s\\S][^a-z\\s]*/, '');\n\n      } else if ((m[4] && !m[5]) || (m[6] && !m[7])) {\n        // Unterminated quote: slurp to the next unquoted '>'\n        var quote = m[4] || m[6];\n        var sawQuote = false;\n        var abuf = [buf, parts[p++]];\n        for (; p < end; p++) {\n          if (sawQuote) {\n            if (parts[p] === '>') { break; }\n          } else if (0 <= parts[p].indexOf(quote)) {\n            sawQuote = true;\n          }\n          abuf.push(parts[p]);\n        }\n        // Slurp failed: lose the garbage\n        if (end <= p) { break; }\n        // Otherwise retry attribute parsing\n        buf = abuf.join('');\n        continue;\n\n      } else {\n        // We have an attribute\n        var aName = m[1].toLowerCase();\n        var aValue = m[2] ? decodeValue(m[3]) : '';\n        attrs.push(aName, aValue);\n        buf = buf.substr(m[0].length);\n      }\n    }\n    tag.attrs = attrs;\n    tag.next = p + 1;\n    return tag;\n  }\n\n  function decodeValue(v) {\n    var q = v.charCodeAt(0);\n    if (q === 0x22 || q === 0x27) { // \" or '\n      v = v.substr(1, v.length - 2);\n    }\n    return unescapeEntities(stripNULs(v));\n  }\n\n  /**\n   * Returns a function that strips unsafe tags and attributes from html.\n   * @param {function(string, Array.<string>): ?Array.<string>} tagPolicy\n   *     A function that takes (tagName, attribs[]), where tagName is a key in\n   *     html4.ELEMENTS and attribs is an array of alternating attribute names\n   *     and values.  It should return a record (as follows), or null to delete\n   *     the element.  It's okay for tagPolicy to modify the attribs array,\n   *     but the same array is reused, so it should not be held between calls.\n   *     Record keys:\n   *        attribs: (required) Sanitized attributes array.\n   *        tagName: Replacement tag name.\n   * @return {function(string, Array)} A function that sanitizes a string of\n   *     HTML and appends result strings to the second argument, an array.\n   */\n  function makeHtmlSanitizer(tagPolicy) {\n    var stack;\n    var ignoring;\n    var emit = function (text, out) {\n      if (!ignoring) { out.push(text); }\n    };\n    return makeSaxParser({\n      'startDoc': function(_) {\n        stack = [];\n        ignoring = false;\n      },\n      'startTag': function(tagNameOrig, attribs, out) {\n        if (ignoring) { return; }\n        if (!html4.ELEMENTS.hasOwnProperty(tagNameOrig)) { return; }\n        var eflagsOrig = html4.ELEMENTS[tagNameOrig];\n        if (eflagsOrig & html4.eflags['FOLDABLE']) {\n          return;\n        }\n\n        var decision = tagPolicy(tagNameOrig, attribs);\n        if (!decision) {\n          ignoring = !(eflagsOrig & html4.eflags['EMPTY']);\n          return;\n        } else if (typeof decision !== 'object') {\n          throw new Error('tagPolicy did not return object (old API?)');\n        }\n        if ('attribs' in decision) {\n          attribs = decision['attribs'];\n        } else {\n          throw new Error('tagPolicy gave no attribs');\n        }\n        var eflagsRep;\n        var tagNameRep;\n        if ('tagName' in decision) {\n          tagNameRep = decision['tagName'];\n          eflagsRep = html4.ELEMENTS[tagNameRep];\n        } else {\n          tagNameRep = tagNameOrig;\n          eflagsRep = eflagsOrig;\n        }\n        // TODO(mikesamuel): relying on tagPolicy not to insert unsafe\n        // attribute names.\n\n        // If this is an optional-end-tag element and either this element or its\n        // previous like sibling was rewritten, then insert a close tag to\n        // preserve structure.\n        if (eflagsOrig & html4.eflags['OPTIONAL_ENDTAG']) {\n          var onStack = stack[stack.length - 1];\n          if (onStack && onStack.orig === tagNameOrig &&\n              (onStack.rep !== tagNameRep || tagNameOrig !== tagNameRep)) {\n                out.push('<\\/', onStack.rep, '>');\n          }\n        }\n\n        if (!(eflagsOrig & html4.eflags['EMPTY'])) {\n          stack.push({orig: tagNameOrig, rep: tagNameRep});\n        }\n\n        out.push('<', tagNameRep);\n        for (var i = 0, n = attribs.length; i < n; i += 2) {\n          var attribName = attribs[i],\n              value = attribs[i + 1];\n          if (value !== null && value !== void 0) {\n            out.push(' ', attribName, '=\"', escapeAttrib(value), '\"');\n          }\n        }\n        out.push('>');\n\n        if ((eflagsOrig & html4.eflags['EMPTY'])\n            && !(eflagsRep & html4.eflags['EMPTY'])) {\n          // replacement is non-empty, synthesize end tag\n          out.push('<\\/', tagNameRep, '>');\n        }\n      },\n      'endTag': function(tagName, out) {\n        if (ignoring) {\n          ignoring = false;\n          return;\n        }\n        if (!html4.ELEMENTS.hasOwnProperty(tagName)) { return; }\n        var eflags = html4.ELEMENTS[tagName];\n        if (!(eflags & (html4.eflags['EMPTY'] | html4.eflags['FOLDABLE']))) {\n          var index;\n          if (eflags & html4.eflags['OPTIONAL_ENDTAG']) {\n            for (index = stack.length; --index >= 0;) {\n              var stackElOrigTag = stack[index].orig;\n              if (stackElOrigTag === tagName) { break; }\n              if (!(html4.ELEMENTS[stackElOrigTag] &\n                    html4.eflags['OPTIONAL_ENDTAG'])) {\n                // Don't pop non optional end tags looking for a match.\n                return;\n              }\n            }\n          } else {\n            for (index = stack.length; --index >= 0;) {\n              if (stack[index].orig === tagName) { break; }\n            }\n          }\n          if (index < 0) { return; }  // Not opened.\n          for (var i = stack.length; --i > index;) {\n            var stackElRepTag = stack[i].rep;\n            if (!(html4.ELEMENTS[stackElRepTag] &\n                  html4.eflags['OPTIONAL_ENDTAG'])) {\n              out.push('<\\/', stackElRepTag, '>');\n            }\n          }\n          if (index < stack.length) {\n            tagName = stack[index].rep;\n          }\n          stack.length = index;\n          out.push('<\\/', tagName, '>');\n        }\n      },\n      'pcdata': emit,\n      'rcdata': emit,\n      'cdata': emit,\n      'endDoc': function(out) {\n        for (; stack.length; stack.length--) {\n          out.push('<\\/', stack[stack.length - 1].rep, '>');\n        }\n      }\n    });\n  }\n\n  var ALLOWED_URI_SCHEMES = /^(?:https?|mailto|data)$/i;\n\n  function safeUri(uri, effect, ltype, hints, naiveUriRewriter) {\n    if (!naiveUriRewriter) { return null; }\n    try {\n      var parsed = URI.parse('' + uri);\n      if (parsed) {\n        if (!parsed.hasScheme() ||\n            ALLOWED_URI_SCHEMES.test(parsed.getScheme())) {\n          var safe = naiveUriRewriter(parsed, effect, ltype, hints);\n          return safe ? safe.toString() : null;\n        }\n      }\n    } catch (e) {\n      return null;\n    }\n    return null;\n  }\n\n  function log(logger, tagName, attribName, oldValue, newValue) {\n    if (!attribName) {\n      logger(tagName + \" removed\", {\n        change: \"removed\",\n        tagName: tagName\n      });\n    }\n    if (oldValue !== newValue) {\n      var changed = \"changed\";\n      if (oldValue && !newValue) {\n        changed = \"removed\";\n      } else if (!oldValue && newValue)  {\n        changed = \"added\";\n      }\n      logger(tagName + \".\" + attribName + \" \" + changed, {\n        change: changed,\n        tagName: tagName,\n        attribName: attribName,\n        oldValue: oldValue,\n        newValue: newValue\n      });\n    }\n  }\n\n  function lookupAttribute(map, tagName, attribName) {\n    var attribKey;\n    attribKey = tagName + '::' + attribName;\n    if (map.hasOwnProperty(attribKey)) {\n      return map[attribKey];\n    }\n    attribKey = '*::' + attribName;\n    if (map.hasOwnProperty(attribKey)) {\n      return map[attribKey];\n    }\n    return void 0;\n  }\n  function getAttributeType(tagName, attribName) {\n    return lookupAttribute(html4.ATTRIBS, tagName, attribName);\n  }\n  function getLoaderType(tagName, attribName) {\n    return lookupAttribute(html4.LOADERTYPES, tagName, attribName);\n  }\n  function getUriEffect(tagName, attribName) {\n    return lookupAttribute(html4.URIEFFECTS, tagName, attribName);\n  }\n\n  /**\n   * Sanitizes attributes on an HTML tag.\n   * @param {string} tagName An HTML tag name in lowercase.\n   * @param {Array.<?string>} attribs An array of alternating names and values.\n   * @param {?function(?string): ?string} opt_naiveUriRewriter A transform to\n   *     apply to URI attributes; it can return a new string value, or null to\n   *     delete the attribute.  If unspecified, URI attributes are deleted.\n   * @param {function(?string): ?string} opt_nmTokenPolicy A transform to apply\n   *     to attributes containing HTML names, element IDs, and space-separated\n   *     lists of classes; it can return a new string value, or null to delete\n   *     the attribute.  If unspecified, these attributes are kept unchanged.\n   * @return {Array.<?string>} The sanitized attributes as a list of alternating\n   *     names and values, where a null value means to omit the attribute.\n   */\n  function sanitizeAttribs(tagName, attribs,\n    opt_naiveUriRewriter, opt_nmTokenPolicy, opt_logger) {\n    // TODO(felix8a): it's obnoxious that domado duplicates much of this\n    // TODO(felix8a): maybe consistently enforce constraints like target=\n    for (var i = 0; i < attribs.length; i += 2) {\n      var attribName = attribs[i];\n      var value = attribs[i + 1];\n      var oldValue = value;\n      var atype = null, attribKey;\n      if ((attribKey = tagName + '::' + attribName,\n           html4.ATTRIBS.hasOwnProperty(attribKey)) ||\n          (attribKey = '*::' + attribName,\n           html4.ATTRIBS.hasOwnProperty(attribKey))) {\n        atype = html4.ATTRIBS[attribKey];\n      }\n      if (atype !== null) {\n        switch (atype) {\n          case html4.atype['NONE']: break;\n          case html4.atype['SCRIPT']:\n            value = null;\n            if (opt_logger) {\n              log(opt_logger, tagName, attribName, oldValue, value);\n            }\n            break;\n          case html4.atype['STYLE']:\n            if ('undefined' === typeof parseCssDeclarations) {\n              value = null;\n              if (opt_logger) {\n                log(opt_logger, tagName, attribName, oldValue, value);\n\t      }\n              break;\n            }\n            var sanitizedDeclarations = [];\n            parseCssDeclarations(\n                value,\n                {\n                  declaration: function (property, tokens) {\n                    var normProp = property.toLowerCase();\n                    var schema = cssSchema[normProp];\n                    if (!schema) {\n                      return;\n                    }\n                    sanitizeCssProperty(\n                        normProp, schema, tokens,\n                        opt_naiveUriRewriter\n                        ? function (url) {\n                            return safeUri(\n                                url, html4.ueffects.SAME_DOCUMENT,\n                                html4.ltypes.SANDBOXED,\n                                {\n                                  \"TYPE\": \"CSS\",\n                                  \"CSS_PROP\": normProp\n                                }, opt_naiveUriRewriter);\n                          }\n                        : null);\n                    sanitizedDeclarations.push(property + ': ' + tokens.join(' '));\n                  }\n                });\n            value = sanitizedDeclarations.length > 0 ?\n              sanitizedDeclarations.join(' ; ') : null;\n            if (opt_logger) {\n              log(opt_logger, tagName, attribName, oldValue, value);\n            }\n            break;\n          case html4.atype['ID']:\n          case html4.atype['IDREF']:\n          case html4.atype['IDREFS']:\n          case html4.atype['GLOBAL_NAME']:\n          case html4.atype['LOCAL_NAME']:\n          case html4.atype['CLASSES']:\n            value = opt_nmTokenPolicy ? opt_nmTokenPolicy(value) : value;\n            if (opt_logger) {\n              log(opt_logger, tagName, attribName, oldValue, value);\n            }\n            break;\n          case html4.atype['URI']:\n            value = safeUri(value,\n              getUriEffect(tagName, attribName),\n              getLoaderType(tagName, attribName),\n              {\n                \"TYPE\": \"MARKUP\",\n                \"XML_ATTR\": attribName,\n                \"XML_TAG\": tagName\n              }, opt_naiveUriRewriter);\n              if (opt_logger) {\n              log(opt_logger, tagName, attribName, oldValue, value);\n            }\n            break;\n          case html4.atype['URI_FRAGMENT']:\n            if (value && '#' === value.charAt(0)) {\n              value = value.substring(1);  // remove the leading '#'\n              value = opt_nmTokenPolicy ? opt_nmTokenPolicy(value) : value;\n              if (value !== null && value !== void 0) {\n                value = '#' + value;  // restore the leading '#'\n              }\n            } else {\n              value = null;\n            }\n            if (opt_logger) {\n              log(opt_logger, tagName, attribName, oldValue, value);\n            }\n            break;\n          default:\n            value = null;\n            if (opt_logger) {\n              log(opt_logger, tagName, attribName, oldValue, value);\n            }\n            break;\n        }\n      } else {\n        value = null;\n        if (opt_logger) {\n          log(opt_logger, tagName, attribName, oldValue, value);\n        }\n      }\n      attribs[i + 1] = value;\n    }\n    return attribs;\n  }\n\n  /**\n   * Creates a tag policy that omits all tags marked UNSAFE in html4-defs.js\n   * and applies the default attribute sanitizer with the supplied policy for\n   * URI attributes and NMTOKEN attributes.\n   * @param {?function(?string): ?string} opt_naiveUriRewriter A transform to\n   *     apply to URI attributes.  If not given, URI attributes are deleted.\n   * @param {function(?string): ?string} opt_nmTokenPolicy A transform to apply\n   *     to attributes containing HTML names, element IDs, and space-separated\n   *     lists of classes.  If not given, such attributes are left unchanged.\n   * @return {function(string, Array.<?string>)} A tagPolicy suitable for\n   *     passing to html.sanitize.\n   */\n  function makeTagPolicy(\n    opt_naiveUriRewriter, opt_nmTokenPolicy, opt_logger) {\n    return function(tagName, attribs) {\n      if (!(html4.ELEMENTS[tagName] & html4.eflags['UNSAFE'])) {\n        return {\n          'attribs': sanitizeAttribs(tagName, attribs,\n            opt_naiveUriRewriter, opt_nmTokenPolicy, opt_logger)\n        };\n      } else {\n        if (opt_logger) {\n          log(opt_logger, tagName, undefined, undefined, undefined);\n        }\n      }\n    };\n  }\n\n  /**\n   * Sanitizes HTML tags and attributes according to a given policy.\n   * @param {string} inputHtml The HTML to sanitize.\n   * @param {function(string, Array.<?string>)} tagPolicy A function that\n   *     decides which tags to accept and sanitizes their attributes (see\n   *     makeHtmlSanitizer above for details).\n   * @return {string} The sanitized HTML.\n   */\n  function sanitizeWithPolicy(inputHtml, tagPolicy) {\n    var outputArray = [];\n    makeHtmlSanitizer(tagPolicy)(inputHtml, outputArray);\n    return outputArray.join('');\n  }\n\n  /**\n   * Strips unsafe tags and attributes from HTML.\n   * @param {string} inputHtml The HTML to sanitize.\n   * @param {?function(?string): ?string} opt_naiveUriRewriter A transform to\n   *     apply to URI attributes.  If not given, URI attributes are deleted.\n   * @param {function(?string): ?string} opt_nmTokenPolicy A transform to apply\n   *     to attributes containing HTML names, element IDs, and space-separated\n   *     lists of classes.  If not given, such attributes are left unchanged.\n   */\n  function sanitize(inputHtml,\n    opt_naiveUriRewriter, opt_nmTokenPolicy, opt_logger) {\n    var tagPolicy = makeTagPolicy(\n      opt_naiveUriRewriter, opt_nmTokenPolicy, opt_logger);\n    return sanitizeWithPolicy(inputHtml, tagPolicy);\n  }\n\n  // Export both quoted and unquoted names for Closure linkage.\n  var html = {};\n  html.escapeAttrib = html['escapeAttrib'] = escapeAttrib;\n  html.makeHtmlSanitizer = html['makeHtmlSanitizer'] = makeHtmlSanitizer;\n  html.makeSaxParser = html['makeSaxParser'] = makeSaxParser;\n  html.makeTagPolicy = html['makeTagPolicy'] = makeTagPolicy;\n  html.normalizeRCData = html['normalizeRCData'] = normalizeRCData;\n  html.sanitize = html['sanitize'] = sanitize;\n  html.sanitizeAttribs = html['sanitizeAttribs'] = sanitizeAttribs;\n  html.sanitizeWithPolicy = html['sanitizeWithPolicy'] = sanitizeWithPolicy;\n  html.unescapeEntities = html['unescapeEntities'] = unescapeEntities;\n  return html;\n})(html4);\n\nvar html_sanitize = html['sanitize'];\n\n// Loosen restrictions of Caja's\n// html-sanitizer to allow for styling\nhtml4.ATTRIBS['*::style'] = 0;\nhtml4.ELEMENTS['style'] = 0;\nhtml4.ATTRIBS['a::target'] = 0;\nhtml4.ELEMENTS['video'] = 0;\nhtml4.ATTRIBS['video::src'] = 0;\nhtml4.ATTRIBS['video::poster'] = 0;\nhtml4.ATTRIBS['video::controls'] = 0;\nhtml4.ELEMENTS['audio'] = 0;\nhtml4.ATTRIBS['audio::src'] = 0;\nhtml4.ATTRIBS['video::autoplay'] = 0;\nhtml4.ATTRIBS['video::controls'] = 0;\n\nif (typeof module !== 'undefined') {\n    module.exports = html_sanitize;\n}\n","function corslite(url, callback, cors) {\n    var sent = false;\n\n    if (typeof window.XMLHttpRequest === 'undefined') {\n        return callback(Error('Browser not supported'));\n    }\n\n    if (typeof cors === 'undefined') {\n        var m = url.match(/^\\s*https?:\\/\\/[^\\/]*/);\n        cors = m && (m[0] !== location.protocol + '//' + location.domain +\n                (location.port ? ':' + location.port : ''));\n    }\n\n    var x = new window.XMLHttpRequest();\n\n    function isSuccessful(status) {\n        return status >= 200 && status < 300 || status === 304;\n    }\n\n    if (cors && !('withCredentials' in x)) {\n        // IE8-9\n        x = new window.XDomainRequest();\n\n        // Ensure callback is never called synchronously, i.e., before\n        // x.send() returns (this has been observed in the wild).\n        // See https://github.com/mapbox/mapbox.js/issues/472\n        var original = callback;\n        callback = function() {\n            if (sent) {\n                original.apply(this, arguments);\n            } else {\n                var that = this, args = arguments;\n                setTimeout(function() {\n                    original.apply(that, args);\n                }, 0);\n            }\n        }\n    }\n\n    function loaded() {\n        if (\n            // XDomainRequest\n            x.status === undefined ||\n            // modern browsers\n            isSuccessful(x.status)) callback.call(x, null, x);\n        else callback.call(x, x, null);\n    }\n\n    // Both `onreadystatechange` and `onload` can fire. `onreadystatechange`\n    // has [been supported for longer](http://stackoverflow.com/a/9181508/229001).\n    if ('onload' in x) {\n        x.onload = loaded;\n    } else {\n        x.onreadystatechange = function readystate() {\n            if (x.readyState === 4) {\n                loaded();\n            }\n        };\n    }\n\n    // Call the callback with the XMLHttpRequest object as an error and prevent\n    // it from ever being called again by reassigning it to `noop`\n    x.onerror = function error(evt) {\n        // XDomainRequest provides no evt parameter\n        callback.call(this, evt || true, null);\n        callback = function() { };\n    };\n\n    // IE9 must have onprogress be set to a unique function.\n    x.onprogress = function() { };\n\n    x.ontimeout = function(evt) {\n        callback.call(this, evt, null);\n        callback = function() { };\n    };\n\n    x.onabort = function(evt) {\n        callback.call(this, evt, null);\n        callback = function() { };\n    };\n\n    // GET is the only supported HTTP Verb by XDomainRequest and is the\n    // only one supported here.\n    x.open('GET', url, true);\n\n    // Send the request. Sending data is not supported.\n    x.send(null);\n    sent = true;\n\n    return x;\n}\n\nif (typeof module !== 'undefined') module.exports = corslite;\n"]}